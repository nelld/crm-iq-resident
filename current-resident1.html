<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Current Resident</title>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome Free -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        destructive: {
                            DEFAULT: "hsl(var(--destructive))",
                            foreground: "hsl(var(--destructive-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))",
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    },
                }
            }
        }
    </script>
    
    <link rel="stylesheet" href="base.css">
	<link rel="stylesheet" href="styles.css?v=190">
    
    <style>
        /* Content container width customization */
        .container {
            max-width: 1660px !important;
        }
        
        /* Sidebar width customization */
        .sidebar {
            width: 220px !important;
        }
        

        
        /* Form Label Positioning - Labels Above Fields */
        .contact-edit-form .form-row {
            display: flex !important;
            flex-direction: column !important;
            gap: 4px !important;
            margin-bottom: 16px !important;
            width: 100% !important;
        }
        
        .contact-edit-form .form-row-group ml-1 {
            display: grid !important;
            grid-template-columns: auto 1fr !important;
            gap: 16px !important;
            margin-bottom: 16px !important;
            width: 100% !important;
        }
        
        @media (max-width: 768px) {
            .contact-edit-form .form-row-group ml-1 {
                grid-template-columns: 1fr !important;
            }
        }
        
        .contact-edit-form .form-row-group ml-1 .form-row {
            margin-bottom: 0 !important;
        }
        
        .contact-edit-form .form-label {
            display: block !important;
            margin-bottom: 2px !important;
            font-weight: 400 !important;
            font-size: 13.2px !important;
            color: #374151 !important;
            order: 1 !important;
        }
        
        .contact-edit-form .form-input,
        .contact-edit-form .form-select,
        .contact-edit-form .form-input-group,
        .contact-edit-form .phone-input-group,
        .contact-edit-form .country-input-group {
            order: 2 !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }

        .contact-edit-form .form-input,
        .contact-edit-form .form-select {
            font-weight: 500 !important;
        }
        
        .contact-edit-form .form-radio-group {
            order: 2 !important;
            display: flex !important;
            flex-wrap: wrap !important;
            gap: 12px !important;
            margin-top: 2px !important;
        }
        
        .contact-edit-form .form-checkbox-group {
            order: 3 !important;
            margin-top: 4px !important;
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
        }
        
        .contact-edit-form .form-checkbox {
            margin: 0 !important;
            width: 16px !important;
            height: 16px !important;
            cursor: pointer !important;
        }
        
        .contact-edit-form .form-checkbox-label {
            margin: 0 !important;
            cursor: pointer !important;
            font-size: 14px !important;
            color: #374151 !important;
            line-height: 1.4 !important;
        }
        
        .contact-edit-form .radio-option {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
        }
        
        .contact-edit-form .form-radio {
            margin: 0 !important;
            width: 16px !important;
            height: 16px !important;
            cursor: pointer !important;
        }
        
        .contact-edit-form .form-radio-label {
            margin: 0 !important;
            cursor: pointer !important;
            font-size: 14px !important;
            color: #374151 !important;
            line-height: 1.4 !important;
        }
        
        /* Ensure phone inputs work properly with labels above */
        .contact-edit-form .phone-input-group {
            display: flex !important;
            gap: 8px !important;
        }
        
        .contact-edit-form .country-select {
            width: auto !important;
            min-width: 70px !important;
        }
        
        /* Form full width and sections spacing */
        .pageslide.contact-edit .pageslide-content {
            padding: 24px !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }
        
        .contact-edit-form {
            width: 100% !important;
            max-width: none !important;
        }
        
        .contact-edit-form .form-section {
            margin-bottom: 32px !important;
            padding-left: 0 !important;
            margin-left: 0 !important;
            border-bottom: none !important;
            width: 100% !important;
        }
        
        .contact-edit-form .form-section-title {
            margin-bottom: 20px !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            color: #111827 !important;
            padding-left: 0 !important;
            margin-left: 0 !important;
        }
        
        /* Special handling for identification section with 3 fields */
        .contact-edit-form .form-section h3 + .form-row-group ml-1:first-of-type {
            grid-template-columns: 1fr 1fr 1fr !important;
        }
        
        @media (max-width: 1024px) {
            .contact-edit-form .form-section h3 + .form-row-group ml-1:first-of-type {
                grid-template-columns: 1fr 1fr !important;
            }
        }
        
        @media (max-width: 768px) {
            .contact-edit-form .form-section h3 + .form-row-group ml-1:first-of-type {
                grid-template-columns: 1fr !important;
            }
        }
        
        /* Lease Edit Form Styling - Matching Contact Edit Form */
        .lease-edit-form .form-section {
            margin-bottom: 32px !important;
            padding-left: 0 !important;
            margin-left: 0 !important;
            border-bottom: none !important;
            width: 100% !important;
        }
        
        .lease-edit-form .form-section-title {
            margin-bottom: 20px !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            color: #111827 !important;
            padding-left: 0 !important;
            margin-left: 0 !important;
        }
        
        .lease-edit-form .form-row {
            display: flex !important;
            flex-direction: column !important;
            gap: 4px !important;
            margin-bottom: 16px !important;
            width: 100% !important;
        }
        
        .lease-edit-form .form-row-group ml-1 {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 16px !important;
            margin-bottom: 16px !important;
            width: 100% !important;
        }
        
        /* Special handling for dates section with 3 fields */
        .lease-edit-form .form-section h3 + .form-row-group.ml-1:first-of-type {
            grid-template-columns: 1fr 1fr !important;
        }
        
        .lease-edit-form .form-section h3 + .form-row-group.ml-1:first-of-type + .form-row-group.ml-1 {
            grid-template-columns: 1fr 1fr 1fr !important;
        }
        
        @media (max-width: 1024px) {
            .lease-edit-form .form-section h3 + .form-row-group.ml-1:first-of-type + .form-row-group.ml-1 {
                grid-template-columns: 1fr 1fr !important;
            }
        }
        
        @media (max-width: 768px) {
            .lease-edit-form .form-row-group.ml-1 {
                grid-template-columns: 1fr !important;
            }
        }
        
        .lease-edit-form .form-row-group.ml-1 .form-row {
            margin-bottom: 0 !important;
        }
        
        .lease-edit-form .form-label {
            display: block !important;
            margin-bottom: 2px !important;
            font-weight: 400 !important;
            color: #374151 !important;
            font-size: 13.2px !important;
        }
        
        .lease-edit-form .form-input,
        .lease-edit-form .form-select,
        .lease-edit-form .form-input-group {
            width: 100% !important;
            box-sizing: border-box !important;
        }

        .lease-edit-form .form-input,
        .lease-edit-form .form-select {
            font-weight: 500 !important;
        }
        
        /* Reduced padding for all form inputs - GLOBAL RULE */
        .form-input,
        .form-select,
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        input[type="date"],
        input[type="time"],
        input[type="tel"],
        select,
        textarea {
            padding: 8px 12px !important;
        }
        
        .lease-edit-form .form-radio-group {
            display: flex !important;
            flex-wrap: wrap !important;
            gap: 12px !important;
            margin-top: 2px !important;
        }
        
        .lease-edit-form .radio-option {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
        }
        
        .lease-edit-form .form-radio {
            margin: 0 !important;
            width: 16px !important;
            height: 16px !important;
            cursor: pointer !important;
        }
        
        .lease-edit-form .form-radio-label {
            margin: 0 !important;
            cursor: pointer !important;
            font-size: 14px !important;
            color: #374151 !important;
            line-height: 1.4 !important;
        }
        
        /* Form input prefix styling now handled by external CSS */
        
        .lease-edit-form .form-subsection {
            margin-bottom: 20px !important;
            padding-left: 20px !important;
            border-left: 3px solid #e5e7eb !important;
        }
        
        /* Form full width and sections spacing */
        .pageslide.lease-edit .pageslide-content {
            padding: 24px !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }
        
        .lease-edit-form {
            width: 100% !important;
            max-width: none !important;
        }
        
        .lease-edit-form .form-actions {
            display: flex !important;
            justify-content: flex-end !important;
            gap: 12px !important;
            padding-top: 24px !important;
            border-top: 1px solid #e5e7eb !important;
            margin-top: 32px !important;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .lease-edit-form .form-actions {
                flex-direction: column !important;
            }
        }
        
        /* Document Icons - Consistent Grey Styling */
        .document-item .bg-blue-100,
        .document-item .bg-purple-100 {
            background-color: #f3f4f6 !important; /* bg-gray-100 */
        }
        
        .document-item .fa-upload,
        .document-item .fa-signature {
            color: #4b5563 !important; /* text-gray-600 */
        }

        /* Info Icons with Tooltips - Consistent Link Color Styling */
        .fas.fa-info-circle.cursor-help,
        .fas.fa-info-circle[data-tooltip],
        .tooltip-container .fas.fa-info-circle,
        .relative.group .fas.fa-info-circle {
            color: var(--link-color, #2563eb) !important;
        }

        .fas.fa-info-circle.cursor-help:hover,
        .fas.fa-info-circle[data-tooltip]:hover,
        .tooltip-container .fas.fa-info-circle:hover,
        .relative.group .fas.fa-info-circle:hover {
            color: var(--link-hover-color, #1d4ed8) !important;
        }

        /* Action Button Design Rules */
        /* RULE 1: Icon-only action buttons should always use 'btn btn-light' classes, never 'btn-icon' */
        /* This provides consistent gray background with proper hover states and accessibility */
        
        /* RULE 2: Delete icons should always use 'fa-trash-alt' for consistency across the application */
        /* Never use 'fa-trash' - always use 'fa-trash-alt' for delete actions */
        
        /* RULE 3: Delete buttons should have 'text-red-600' class to indicate destructive action */

        /* Regenerate Icons - Standardized Rule */
        /* RULE: Always use fa-redo for regenerate actions */

        /* Manual Signature Icons - Standardized Rule */
        /* RULE: Always use fa-signature for "Mark as manually signed" actions */

        /* ========================================== */
        /* KEBAB MENU DROPDOWN STANDARDIZATION RULES */
        /* ========================================== */
        
        /* RULE 1: Kebab Menu Button Structure */
        /* Always use this exact button structure for kebab menus:
           <button id="kebab-btn-[unique-name]" class="btn btn-light btn-sm kebab-menu">
               <i class="fas fa-ellipsis-v"></i>
           </button>
        */
        
        /* RULE 2: Kebab Menu Dropdown Structure */
        /* Always use floating dropdown outside containers with this exact structure:
           <div id="kebab-dropdown-[unique-name]" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
               <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="...">
                   <i class="fas fa-[icon] mr-2 text-muted"></i>
                   Menu Item Text
               </button>
           </div>
        */
        
        /* RULE 3: Kebab Menu JavaScript Integration */
        /* Always integrate with setupKebabMenu() system:
           1. Add to setupKebabMenu() initialization: setupKebabMenu('kebab-btn-[name]', 'kebab-dropdown-[name]', 180)
           2. Add to console logging for debugging
           3. Add to click-outside-to-close arrays (both allDropdowns and allButtons)
           4. Add to scroll-close function array
           5. NEVER use custom toggle functions - always use setupKebabMenu()
        */
        
        /* RULE 4: Kebab Menu Styling Standards */
        /* - Use 'kebab-option' class for menu items
           - Use 'text-muted' for icons
           - Use 'px-3 py-2' for padding
           - Use 'hover:bg-gray-50 transition-colors' for hover effects
           - Use 'w-full text-left' for full-width clickable area
           - Use 'mr-2' spacing between icon and text
           - Use 'min-w-[180px]' or similar for consistent width
        */
        
        /* RULE 5: Kebab Menu Positioning */
        /* - Always use 'position: fixed; z-index: 9999;' for floating dropdowns
           - Place dropdown HTML outside all containers (near other floating dropdowns)
           - Let setupKebabMenu() handle positioning automatically
           - Never use relative/absolute positioning within table cells
        */

        /* Signature Status Display - Standardized Rule */
        /* RULE: Use rounded background icons for signature status - green checkmark for signed, red exclamation for pending */

        /* Tab Styling Rules - Universal Application */
        /* RULE: All tabs should use the generic .tab class for consistent underline style */
        /* Usage: <button class="tab active" data-tab="tabname">Tab Label</button> */
        /* Container: <div class="tab-nav flex">...tabs...</div> */
        .tab-nav {
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 1rem;
        }
        
        .tab-button {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .tab-button:hover {
            color: #374151;
        }
        
        .tab-button.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }
        
        /* Generic tab classes for universal use */
        .tab {
            padding: 0.75rem 1rem !important;
            font-size: 0.875rem !important;
            font-weight: 500 !important;
            color: #6b7280 !important;
            background: transparent !important;
            border: none !important;
            border-bottom: 2px solid transparent !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
        }
        
        .tab:hover {
            color: #374151 !important;
        }
        
        .tab.active {
            color: #000 !important;
            border-bottom-color: #0072CE !important;
        }
        
        /* Legacy support for existing specific tab classes */
        .lease-mgmt-tab {
            padding: 0.75rem 1rem !important;
            font-size: 0.875rem !important;
            font-weight: 500 !important;
            color: #6b7280 !important;
            background: transparent !important;
            border: none !important;
            border-bottom: 2px solid transparent !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
        }
        
        .lease-mgmt-tab:hover {
            color: #374151 !important;
        }
        
        .lease-mgmt-tab.active {
            color: #000 !important;
            border-bottom-color: #0072CE !important;
        }
        
        /* Tab filter styling for consistency */
        .tab-filter {
            background-color: white !important;
            color: rgb(107, 114, 128) !important;
            border: 1px solid rgb(209, 213, 219) !important;
        }

        .tab-filter.active {
            background-color: rgb(219, 234, 254) !important;
            color: rgb(30, 64, 175) !important;
            border-color: rgb(59, 130, 246) !important;
        }

        .tab-filter:hover:not(.active) {
            background-color: rgb(249, 250, 251) !important;
        }

        
        /* Tenant Header Layout Optimization for 1366px screens */
        @media (max-width: 1400px) and (min-width: 1200px) {
            .page-header .flex.items-center.gap-8 {
                gap: 1rem !important;
            }
            
            .balance-header {
                min-width: 340px !important;
            }
        }
        
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="left-section">
                <img src="images/crm-iq-logo.png" alt="CRM IQ" class="logo">
                <nav class="nav-menu">
                    <div class="nav-item">
                        <span>Dashboards</span>
                        <i class="fas fa-caret-down"></i>
                    </div>
                    <div class="nav-item">
                        <span>Reports</span>
                        <i class="fas fa-caret-down"></i>
                    </div>
                    <div class="nav-item">
                        <span>Communications</span>
                        <i class="fas fa-caret-down"></i>
                    </div>
                    <button class="nav-grid-btn">
                        <i class="fas fa-th"></i>
                    </button>
                </nav>
                <div class="left-actions">
                    <div class="search-section">
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="Search...">
                            <button class="search-btn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <button class="add-new-btn">
                        <span>Add New</span>
                        <i class="fas fa-caret-down"></i>
                    </button>
                    <button class="action-btn calendar-btn">
                        <i class="fas fa-calendar-alt"></i>
                    </button>
                    <button class="action-btn calculator-btn">
                        <i class="fas fa-calculator"></i>
                    </button>
                </div>
            </div>
            
            <div class="header-actions">
                <button class="action-btn star-btn">
                    <i class="fas fa-star"></i>
                </button>
                <button class="action-btn help-btn">
                    <i class="fas fa-question-circle"></i>
                </button>
                <button class="action-btn notification-btn">
                    <span class="notification-count">0</span>
                </button>
                <button class="action-btn settings-btn">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="user-profile">
                    <div class="user-avatar">ND</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="#">Home</a> <span class="breadcrumb-separator">/</span> <a href="#">Search</a> <span class="breadcrumb-separator">/</span> <a href="#">Melinda Michaels</a> <span class="breadcrumb-separator">/</span> Cityview Towers
        </div>
        <i class="fas fa-info-circle info-icon"></i>
    </div>

    <!-- Page Header -->
    <div class="page-header">
            <div class="title-section">
                <div class="title-with-badges">
				<h1 class="page-title mr-0">Melinda Michaels</h1>
                    <div class="badges-container">
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Current</span>
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800">Primary</span>
                        <!-- Health Score (Minimal) -->
                        <span class="tooltip-black tooltip-below ml-1">
                            <i class="fas fa-chart-line text-green-500"></i>
                            <span><span class="score-value">90</span>/100</span>
                            <span class="tooltip-text">Health score</span>
                        </span>
                    </div>
                </div>
			<div class="flex items-center gap-2 text-muted text-sm">
				<span>Cityview Towers<span class="ml-1">(p0031246)</span></span><span class="text-muted">•</span><span>Unit 288</span><span class="text-muted">•</span><span>t0039661</span>
            </div>
        </div>
        
        <!-- Header Actions -->
        <div class="flex items-center gap-8">
            <!-- Outstanding Balance Section -->
            <div class="balance-header cursor-pointer" onclick="openPageslide('outstanding-balance-overlay')">
                <div class="flex items-center gap-2">
                    <div class="flex items-center gap-1">
                        <i class="fas fa-exclamation-triangle text-red-500"></i>
                        <span class="font-medium">Outstanding:</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <span class="text-lg font-bold">$2,809.50</span>
                    </div>
                </div>
                <div class="flex items-center gap-1 text-sm no-wrap">
                    <span class="text-red-600 font-medium">3 past due</span>
                    <span class="text-gray-400">•</span>
                    <span class="text-yellow-600">1 processing</span>
					<span class="text-gray-400">•</span>
					<i class="fas fa-warning text-red-500"></i><span class="text-red-600 font-medium">Do not accept payment</span>
                </div>
            </div>

            <!-- Active Tasks & Alerts Section -->
            <div class="tasks-alerts-header cursor-pointer" onclick="openPageslide('active-tasks-overlay')">
        <div class="flex items-center gap-2">
                    <div class="flex items-center gap-1">
                        <i class="fas fa-exclamation-circle text-orange-500"></i>
                        <span class="font-medium">Active Tasks:</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <span class="text-lg font-bold">6</span>
                    </div>
                </div>
                <div class="flex items-center gap-1 text-sm">
                    <span class="text-muted">Lease expiry</span>
                    <span class="text-gray-400">•</span>
                    <span class="text-muted">Work order</span>
                    <span class="text-gray-400">•</span>
                    <span class="text-muted">Application</span>
                    <span class="text-gray-400">•</span>
                    <span class="text-muted">Document tasks</span>
                </div>
            </div>


            
            <div class="flex items-center gap-2 ml-6">
                <!-- Actions Dropdown -->
                <button id="tenant-header-manage-btn" class="btn btn-light">
					<span class="">Actions</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
                </div>
                </div>
                


    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-item active" id="overview-menu" onclick="toggleView('overview')">
						<i class="fas fa-home text-muted mr-2"></i>
						Overview
                </div>
                    </div>
                                 <div class="">
                     <div class="menu-item" id="lease-info-2-menu" onclick="toggleView('lease-info-2')">
						<i class="fas fa-file-contract text-muted mr-2"></i>
						Lease Information
                </div>
					<div class="menu-item" id="ledger-menu" onclick="toggleView('ledger')">
						<i class="fas fa-receipt text-muted mr-2"></i>
						Ledger
                    </div>
                     <div class="menu-item">
						<i class="fas fa-boxes text-muted mr-2"></i>
						Rentable items
                </div>
					<div class="menu-item">
						<i class="fas fa-wrench text-muted mr-2"></i>
						Work orders
                        <span class="menu-count">1</span>
                    </div>
                     <div class="menu-item">
						<i class="fas fa-university text-muted mr-2"></i>
						Bank accounts
                    </div>
                     <div class="menu-item">
						<i class="fas fa-shield-alt text-muted mr-2"></i>
						Renters insurance
                    </div>
					<div class="menu-item">
						<i class="fas fa-concierge-bell text-muted mr-2"></i>
                        Concierge
                    </div>
					<div class="menu-item" id="documents-menu" onclick="toggleView('documents')">
						<i class="fas fa-folder text-muted mr-2"></i>
						Documents
                </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content-area">
            <!-- Overview View -->
            <div id="overview-view" class="container py-6 mx-auto">

            <!-- Two Column Layout: 2/3 and 1/3 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- First Column (2/3 width) -->
                <div class="col-span-1 lg:col-span-2 space-y-6">
                    

                    
                    <!-- Row 3: Two Columns - Resident Info + Lease Info -->
                    <div class="grid grid-cols-2 gap-6" id="two-column-layout">
                        <!-- Column 1: Resident Information + Notes -->
                        <div class="flex flex-col space-y-6" id="column-1-resident-notes">

                    <!-- Resident Information Card -->
                    <div class="card shadow-sm">
                        <div class="card-header border-0">
                            <div class="flex items-center justify-between w-full">
                                <h3 class="card-title">Resident information</h3>
                                <div class="flex items-center gap-2">
                                    <button id="kebab-btn-resident" class="btn btn-light btn-sm kebab-menu">
                                        <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                    </div>
                        </div>
                        <div class="card-content">
                            <!-- CONTACT INFORMATION Section -->
                            <div class="card-section">
                                <div class="card-section-header">
                                    <div class="flex items-center justify-between w-full">
                                        <div>
                                    <h4 class="font-semibold text-muted uppercase tracking-wide">CONTACT INFORMATION</h4>
                                        </div>
                                        <button class="btn btn-link p-0" onclick="openPageslide('contact-edit-overlay')">Edit</button>
                                    </div>
                                </div>
                                <div class="card-section-content">
                                    <div class="flex items-start gap-3">
                                        <!-- Avatar -->
                                        <div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center flex-shrink-0">
                                            <span class="text-white font-semibold">MM</span>
                                        </div>

                                        <!-- Resident Info -->
                                        <div class="flex-1 space-y-1 min-w-0">
                                            <h4 class="font-semibold mb-0">Melinda Michaels 
                                                <span class="tooltip-black ml-1">
                                                    <i class="fas fa-clone text-primary text-sm cursor-pointer"></i>
                                                    <span class="tooltip-text">Copy resident name, email and phone number</span>
                                                </span>
                                            </h4>
                                            <p class="text-muted">Preferred name: Mel Michaels</p>
                                            
                                            <!-- Contact Information -->
                                            <div class="flex items-center gap-2">
												<span class="">(555) 123-4567</span>
												<div class="flex items-center gap-3">
													<span class="tooltip-black">
														<i class="fas fa-phone text-link cursor-pointer"></i>
														<span class="tooltip-text">Call</span>
													</span>
													<span class="tooltip-black">
														<i class="fas fa-mobile-alt text-link cursor-pointer"></i>
														<span class="tooltip-text">Text</span>
													</span>
												</div>
											</div>
											<div class="flex items-center gap-2">
												<span class="">melinda.michaels@email.com</span>
												<span class="tooltip-black">
													<i class="fas fa-envelope text-link cursor-pointer"></i>
													<span class="tooltip-text">Email</span>
												</span>
											</div>
										
                                            <div>
                                                <span class="">Preferred contact: </span>
                                                <span class="">SMS</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- REGISTRATION & STATUS Section -->
                            <div class="card-section">
                                <div class="card-section-header">
                                    <div class="flex items-center justify-between w-full">
                                        <h4 class="font-semibold text-muted uppercase tracking-wide">RENTCAFE REGISTRATION</h4>
                                    </div>
                                </div>
                                <div class="card-section-content">
                                    <div class="flex items-start justify-between">
                                        <div>
                                            <div class="flex items-center gap-2">
                                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                                <span><span class="font-medium text-green-700" data-field="rentcafe-status">Registered</span> on March 15, 2021</span>
                                            </div>
                                            <div class="text-sm text-muted">Account verified</div>
                                        </div>
                                        <div class="flex items-center gap-1 font-weight-normal">
                                            <a href="#" class="btn btn-link p-0">
                                                <i class="fas fa-external-link-alt ml-1"></i> Preview account
                                            </a>
                                            <button id="kebab-btn-rentcafe" class="btn btn-link text-body">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ROOMMATES Section -->
                            <div class="card-section">
                                <div class="card-section-header">
                                    <div class="flex items-center justify-between w-full">
                                        <div>
                                        <h4 class="font-semibold text-muted uppercase tracking-wide">ROOMMATES</h4>
                                        </div>
                                        <button class="btn btn-link p-0" onclick="openPageslide('roommate-details-overlay')">View details</button>
                                    </div>
                                </div>
                                <div class="card-section-content">
                                    <!-- Roommate List -->
                                    <div class="roommate-grid">
                                        <div class="roommate-item flex items-center gap-2">
                                            <!-- Avatar -->
                                            <div class="w-6 h-6 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0">
                                                <span class="text-white font-semibold" style="font-size: 10px;">AJ</span>
                                            </div>
                                            <span class="">Angela Johnson</span>
                                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-orange-100 text-orange-800">
                                                Pending
                                            </span>
                                            <div class="flex items-center gap-3">
                                                <span class="tooltip-black">
                                                    <i class="fas fa-phone text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Call</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-mobile-alt text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Text</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-envelope text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Email</span>
                                                </span>
                                            </div>
                                            <div class="ml-auto">
                                                <button id="kebab-btn-roommate-angela-overview" class="btn btn-link btn-sm kebab-menu text-body">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="roommate-item flex items-center gap-2">
                                            <!-- Avatar -->
                                            <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                                                <span class="text-white font-semibold" style="font-size: 10px;">JS</span>
                                            </div>
                                            <span class="">John Smith</span>
                                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Current</span>
                                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-700">Registered</span>
                                            <div class="flex items-center gap-3">
                                                <span class="tooltip-black">
                                                    <i class="fas fa-phone text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Call</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-mobile-alt text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Text</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-envelope text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Email</span>
                                                </span>
                                            </div>
                                            <div class="ml-auto">
                                                <button id="kebab-btn-roommate-john-overview" class="btn btn-link btn-sm kebab-menu text-body">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Past Roommates Note -->
                                    <div class="pt-2 border-t border-gray-100">
                                        <p class="text-xs text-muted">+ 2 past roommates</p>
                                    </div>
                                </div>
                            </div>

                            <!-- EMERGENCY CONTACT Section -->
                            <div class="card-section">
                                <div class="card-section-header">
                                    <div class="flex items-center justify-between w-full">
                                        <h4 class="font-semibold text-muted uppercase tracking-wide">EMERGENCY CONTACTS</h4>
                                        <button class="btn btn-link p-0">View details</button>
                                    </div>
                                </div>
                                <div class="card-section-content">
                                    <div class="flex items-center gap-2">
                                        <!-- Avatar -->
                                        <div class="w-6 h-6 bg-teal-500 rounded-full flex items-center justify-center flex-shrink-0">
                                            <span class="text-white font-semibold" style="font-size: 10px;">MB</span>
                                        </div>
                                        <span>Michael Brown<span class="ml-1 text-muted">(friend)</span></span>
                                        <div class="flex items-center gap-3">
                                            <span class="tooltip-black">
                                                <i class="fas fa-phone text-link cursor-pointer"></i>
                                                <span class="tooltip-text">Call</span>
                                            </span>
                                            <span class="tooltip-black">
                                                <i class="fas fa-mobile-alt text-link cursor-pointer"></i>
                                                <span class="tooltip-text">Text</span>
                                            </span>
                                            <span class="tooltip-black">
                                                <i class="fas fa-envelope text-link cursor-pointer"></i>
                                                <span class="tooltip-text">Email</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                    </div>
                    </div>
					
					

                    <!-- Notes Card -->
                    <div class="card shadow-sm flex-grow flex flex-col">
                        <div class="card-header border-0">
                            <div class="flex items-center justify-between w-full">
                                <h3 class="card-title">Notes</h3>
                                <button class="btn btn-light btn-sm" onclick="addNote()">
                                    <i class="fas fa-circle-plus mr-1"></i>
                                    Add
                                </button>
                            </div>
                        </div>
                        <div class="card-content flex-grow flex flex-col">
                            <!-- <div class="note-entry"> -->
                                <!-- <div class="note-header mb-2"> -->
                                    <!-- <div class="flex items-center gap-2"> -->
                                        <!-- <span class="font-semibold ">Sarah Chen</span> -->
                                        <!-- <span class="text-muted">•</span> -->
                                        <!-- <span class="text-muted">Aug 16, 2025 at 2:45 pm</span> -->
                            <!-- </div> -->
                            <!-- </div> -->
                                <!-- <div class="note-content mb-3"> -->
                                    <!-- <p class=""> -->
                                        <!-- <span id="note-preview">Received work order for refrigerator repair. Tenant mentioned it stopped cooling yesterday evening. Scheduled</span> -->
                                        <!-- <span id="note-full" class="hidden"> technician for tomorrow morning. Also discussed upcoming lease renewal - tenant interested in staying for another year.</span> -->
                                        <!-- <button id="note-toggle" class="btn btn-link ml-1 p-0" onclick="toggleNoteExpansion()">read more</button> -->
                                    <!-- </p> -->
                            <!-- </div> -->
                            <!-- </div> -->
                            
                            <!-- <div class="border-t border-gray-200 my-4"></div> -->
                            
                            <!-- Second Note Entry -->
                            <div class="note-entry">
                                <div class="note-header mb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="font-semibold ">Mike Rodriguez</span>
                                        <span class="text-muted">•</span>
                                        <span class="text-muted">Aug 15, 2025 at 10:30 am</span>
                                    </div>
                                </div>
                                <div class="note-content mb-3">
                                    <p class="">
                                        <span id="note-preview-2">Tenant called about potential lease renewal. Very satisfied with the unit and community amenities. Interested in</span>
                                        <span id="note-full-2" class="hidden"> 12-month extension starting November 1st. Mentioned possible roommate addition in the spring. Also requested information about parking space availability and pet policy updates.</span>
                                        <button id="note-toggle-2" class="btn btn-link ml-1 p-0" onclick="toggleNoteExpansion2()">read more</button>
                                    </p>
                                </div>
                            </div>
                            
                            <!-- View More Notes -->
                            <div class="mt-auto pt-3">
                                <button class="btn btn-link p-0" onclick="viewAllNotes()">
                                    View 2 more notes
                                </button>
                            </div>
                            </div>
                        </div>
                        
                        </div>
                        
                        <!-- Column 2: Lease Information -->
                        <div class="flex flex-col space-y-6" id="column-2-lease-info">
                            <!-- Lease Information Card -->
                    <div class="card shadow-sm flex-grow">
                        <div class="card-header border-0">
                            <div class="flex items-center justify-between w-full">
                                <h3 class="card-title">Lease information</h3>
                                <div class="flex items-center gap-2">
                                    <button id="kebab-btn-lease" class="btn btn-light btn-sm kebab-menu">
                                        <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                </div>
                                </div>
                            </div>
                        <div class="card-content">
                                <!-- LEASE OVERVIEW Section -->
                                <div class="card-section">
                                    <div class="card-section-header">
                                        <div class="flex items-center justify-between w-full">
                                        <div>
                                        <h4 class="font-semibold text-muted uppercase tracking-wide">LEASE OVERVIEW</h4>
                                        </div>
                                         <!-- <button class="btn btn-link p-0" onclick="openPageslide('lease-edit-overlay')">Edit</button> -->
                                    </div>
                        </div>
                                    <div class="card-section-content">
                                        <div class="lease-overview-grid">
                                            <div class="lease-overview-item space-y-1">
                                                <div class="flex items-center gap-2">
                                                    <i class="fas fa-calendar text-muted"></i>
                                                    <span class=" ">Oct 1, 2024 - Sep 30, 2025</span>
                                                    <span class="badge bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded-full ">12 months</span>
                                </div>
                                                <div class="flex items-center gap-2">
                                                    <div class="flex items-center gap-1">
                                                                                                                 <span class="">Rent: $1482.25/mo</span>
                                                         <button class="ml-1 btn btn-link p-0" onclick="toggleLeaseChargesPopover(event)" aria-label="View lease charges breakdown">
                                                             <i class="fas fa-info-circle text-sm"></i>
                                                         </button>
                            </div>
                                                    <span class="text-muted">•</span>
                                                    <div class="flex items-center gap-1">
                                                        <span class="">Total deposit: $1850.00</span>
                                                        <button class="ml-1 btn btn-link p-0" onclick="toggleDepositPopover(event)" aria-label="View deposit breakdown">
                                                             <i class="fas fa-info-circle text-sm"></i>
                                                         </button>
                                                    </div> 
                                                </div>
												<div class="flex items-center gap-2">
                                                    <div class="flex items-center gap-1">
                                                        <span class="">Late fee/NSF: 0/0</span>
                                                    </div>
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    <span class="">Move-in: Oct 2, 2020</span>
													<span class="text-muted">•</span>
                                                    <span class="">Tenancy: 4 years 11 months</span>
                                                </div>
                                            </div>
                                        </div>
                        </div>
                    </div>

                                <!-- PROPERTY DETAILS Section -->
                                <div class="card-section">
                                    <div class="card-section-header">
                                        <h4 class="font-semibold text-muted uppercase tracking-wide">UNIT DETAILS</h4>
                                    </div>
                                    <div class="card-section-content">
                                        <div class="property-details-grid">
                                            <div class="property-detail-item space-y-1">
                                                <div class="flex items-center gap-2">
                                                    <i class="fas fa-bed text-muted"></i>
                                                    <span class="">Unit: <a href="#">103</a></span>
                                                    <span class="text-muted">•</span>
													<span class="">3 bed 2 bath</span>
                                                    <span class="text-muted">•</span>
                                                    <span class="">950 ft²</span>
													<span class="text-muted">•</span>
                                                    <span class="">iq01_3b2</span>
													
                                </div>
                                                <div class="flex items-start gap-2">
                                                    <i class="fas fa-map-marker-alt text-muted mt-0.5"></i>
                                                    <div class="">
                                                        <div class="">430 S Fairview Avenue 288</div>
                                                        <div class="">Santa Barbara, CA 93117</div>
                            </div>
                        </div>
                                </div>
                            </div>
                        </div>
                    </div>

                                <!-- ADDITIONAL INFO Section -->
                                <div class="card-section">
                                    <div class="card-section-header">
                                        <h4 class="font-semibold text-muted uppercase tracking-wide">ADDITIONAL INFORMATION</h4>
                                    </div>
                                    <div class="card-section-content">
                                        <div class="additional-info-grid">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <i class="fas fa-paw text-muted"></i>
                                                    <span>2 Pets (1 dog, 1 cat)</span>
                                </div>
                                                <button class="btn btn-link p-0" onclick="openPageslide('pet-details-overlay')">View details</button>
                            </div>
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <i class="fas fa-car text-muted"></i>
                                                    <span>2 Vehicles</span>
                        </div>
                                                 <button class="btn btn-link p-0" onclick="openPageslide('vehicle-details-overlay')">View details</button>
                                </div>
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <i class="fas fa-exclamation-triangle text-muted"></i>
                                                    <span>Late fees</span>
                                                </div>
                                                <button class="btn btn-link p-0" onclick="alert('Late fees details:\n\n• View fee history\n• Payment status\n• Waiver requests')">View details</button>
                                            </div>
                    </div>
                        </div>
                    </div>

                                <!-- UNIT TRANSFER AND PROMOTION HISTORY Section -->
                                <div class="card-section">
                                    <div class="card-section-header">
                                        <h4 class="font-semibold text-muted uppercase tracking-wide">UNIT TRANSFER AND PROMOTION HISTORY</h4>
                                    </div>
                                    <div class="card-section-content">
                                        <div class="history-records-container">
                                            <div>
                                                <!-- History Record 1: Promote Roommate -->
                                                <div class="history-record">
                                                    <div class="flex items-start justify-between">
                                                        <div class="flex-1">
                                                            <div class="flex items-center gap-2">
                                                                <i class="fas fa-user-plus text-muted"></i>
                                                                <span>Roommate promotion</span>
                                                            </div>
															<div class="flex items-center gap-2 text-muted">
																<span>Prior lease: <a href="#">t0312765</a></span><span class="text-muted">•</span><span>Prior unit: <a href="#">288</a></span>
															</div>
                                                        </div>
                                                        <button class="btn btn-link p-0">View ledger</button>
                                                    </div>
                                                </div>
                                                
                                                <!-- History Record 2: Unit Transfer -->
                                                <div class="history-record">
                                                    <div class="flex items-start justify-between">
                                                        <div class="flex-1">
                                                            <div class="flex items-center gap-2">
                                                                <i class="fas fa-exchange-alt text-muted"></i>
                                                                <span>Unit Transfer</span>
                                                            </div>
                                                            <div class="flex items-center gap-2 text-muted">
																<span>Prior lease: <a href="#">t0123452</a></span><span class="text-muted">•</span><span>Prior unit: <a href="#">2101</a></span>
															</div>
                                                        </div>
                                                        <button class="btn btn-link p-0">View ledger</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
                        </div>
                </div>
                </div>
                <!-- Second Column (1/3 width) -->
                <div class="col-span-1 lg:col-span-1 space-y-6 bg-gray-100 p-3 rounded-lg">

                    <!-- Activities Card -->
                    <div class="card" id="activity-timeline-card">
                        <div class="card-header border-0">
                            <div class="flex items-center justify-between w-full">
                                <h3 class="card-title">
                                    Activity Timeline
                                </h3>
                                <div class="relative">
                                    <button id="activity-add-btn" class="btn btn-light btn-sm" onclick="toggleActivityAddMenu()">
                                        <i class="fas fa-circle-plus mr-1"></i>
                                        Add
                                        <i class="fas fa-chevron-down text-sm ml-1"></i>
                                    </button>
                                    <div id="activity-add-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50 hidden">
                                        <div class="py-1">
                                            <button class="activity-add-option w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors" onclick="addActivityType('comment')">
                                                <i class="fas fa-comment mr-2 text-muted"></i>
                                                Add comment
                                            </button>
                                            <button class="activity-add-option w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors" onclick="addActivityType('follow-up')">
                                                <i class="fas fa-clock mr-2 text-muted"></i>
                                                Add follow-up
                                            </button>
                                            <button class="activity-add-option w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors" onclick="addActivityType('appointment')">
                                                <i class="fas fa-calendar-check mr-2 text-muted"></i>
                                                Add appointment
                                            </button>
                                            <button class="activity-add-option w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors" onclick="addActivityType('log')">
                                                <i class="fas fa-clipboard-list mr-2 text-muted"></i>
                                                Log activity
                                            </button>
                                            <button class="activity-add-option w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors" onclick="addActivityType('memo')">
                                                <i class="fas fa-sticky-note mr-2 text-muted"></i>
                                                Add memo
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                    </div>
                                </div>
                        <div class="card-content pb-0">
                            <!-- Activity Filters -->
                            <div class="activity-filters">
                                <div class="flex items-center gap-4">
                                    <!-- Activity Type Filter -->
                                    <div class="activity-filter-dropdown-container">
                                        <button id="activity-filter-btn" class="activity-filter-btn">
                                            <span class="filter-current-text">All Activities</span>
                                            <i class="fas fa-chevron-down text-sm ml-2"></i>
                                        </button>
                                        <div id="activity-filter-dropdown" class="activity-filter-dropdown">
                                            <div class="activity-filter-option" data-value="all">
                                                <i class="fas fa-list"></i>
                                                <span>All Activities</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="communications">
                                                <i class="fas fa-comments"></i>
                                                <span>Communications</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="work-orders">
                                                <i class="fas fa-wrench"></i>
                                                <span>Work Orders</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="payments">
                                                <i class="fas fa-credit-card"></i>
                                                <span>Payments</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="lease">
                                                <i class="fas fa-file-contract"></i>
                                                <span>Lease</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Source Filter -->
                                    <div id="source-filter-container" class="activity-filter-dropdown-container">
                                        <button id="source-filter-btn" class="activity-filter-btn">
                                            <span class="filter-current-text">All Sources</span>
                                            <i class="fas fa-chevron-down text-sm ml-2"></i>
                                        </button>
                                        <div id="source-filter-dropdown" class="activity-filter-dropdown">
                                            <div class="activity-filter-option selected" data-value="all-sources">
                                                <i class="fas fa-globe"></i>
                                                <span>All Sources</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="system">
                                                <i class="fas fa-robot"></i>
                                                <span>System</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="user">
                                                <i class="fas fa-user"></i>
                                                <span>User</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Communication Type Sub-filter (Hidden by default) -->
                                <div id="communication-type-filter-container" class="mt-3 hidden">
                                    <div class="activity-filter-dropdown-container">
                                        <button id="communication-type-filter-btn" class="activity-filter-btn">
                                            <span class="filter-current-text">All Communications</span>
                                            <i class="fas fa-chevron-down text-sm ml-2"></i>
                                        </button>
                                        <div id="communication-type-filter-dropdown" class="activity-filter-dropdown">
                                            <div class="activity-filter-option" data-value="all-communications">
                                                <i class="fas fa-globe"></i>
                                                <span>All Communications</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="appointment">
                                                <i class="fas fa-calendar-check"></i>
                                                <span>Appointment</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="call">
                                                <i class="fas fa-phone"></i>
                                                <span>Call</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="chat">
                                                <i class="fas fa-comments"></i>
                                                <span>Chat</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="comment-memo">
                                                <i class="fas fa-sticky-note"></i>
                                                <span>Comment/Memo</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="email">
                                                <i class="fas fa-envelope"></i>
                                                <span>Email</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="event">
                                                <i class="fas fa-calendar-alt"></i>
                                                <span>Event</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="follow-up">
                                                <i class="fas fa-user-clock"></i>
                                                <span>Follow-up</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="text">
                                                <i class="fas fa-sms"></i>
                                                <span>Text</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-4" id="activity-timeline-container">
                                <!-- Today's Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-primary text-sm mr-2"></i>
                                        <span class="font-semibold ">Today: Aug 17, 2025</span>
                                </div>

                                    <!-- Text Message -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="text" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-sms text-primary"></i>
                            </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Text: Sent</span>
                                                <span class="activity-time">6:07 AM PST</span>
                                            </div>
                                            <p class="activity-description">Work order update: Technician scheduled for refrigerator repair</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via Chat IQ</span>
                                            </div>
                        </div>
                    </div>

                                    <!-- Email -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">6:07 AM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Payment Received - Account Balance Update</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via Chat IQ</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Follow-up -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="follow-up" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-user-clock text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Follow-Up - Created</span>
                                                <span class="activity-time">6:07 AM PST</span>
                                            </div>
                                            <p class="activity-description">Created follow up for lease renewal discussion</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Memo -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="comment-memo" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-sticky-note text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Memo: Added</span>
                                                <span class="activity-time">5:45 AM PST</span>
                                            </div>
                                            <p class="activity-description">Internal note: Resident prefers morning maintenance appointments</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">by Sarah Adams</span>
                                            </div>
                                        </div>
                                    </div>
                </div>

                                <!-- Recent Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 16, 2025</span>
                                    </div>
                                    
                                    <!-- Email -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">2:08 PM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Important: Payment Due Reminder</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via CRM Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-wrench text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Created</span>
                                                <span class="activity-time">10:15 AM PST</span>
                                            </div>
                                            <p class="activity-description">WO #26145: Refrigerator is not working (Appliances)</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Medium Priority • by Melinda Michaels</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Appointment Scheduled -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="appointment" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-calendar-check text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Appointment: Scheduled</span>
                                                <span class="activity-time">9:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">Refrigerator repair appointment scheduled for Aug 17, 9:00 AM</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Maintenance Team • Confirmed</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Additional Recent Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 15, 2025</span>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">8:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">August rent payment - $2,000.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • On time</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="chat" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-comments text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Chat: Incoming</span>
                                                <span class="activity-time">7:15 AM PST</span>
                                            </div>
                                            <p class="activity-description">Resident inquiry about parking policy</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via Resident Portal</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 14 Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 14, 2025</span>
                                    </div>
                                    
                                    <!-- Work Order Update -->
                                    <div class="activity-item" data-filter="work-orders" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-wrench text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: In Progress</span>
                                                <span class="activity-time">3:45 PM PST</span>
                                            </div>
                                            <p class="activity-description">WO #26145: Technician arrived, diagnosing refrigerator issue</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Assigned to Mike Johnson</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Email Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">11:20 AM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Work Order Schedule Confirmation</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">by Sarah Adams</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 13 Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 13, 2025</span>
                                    </div>
                                    
                                    <!-- Phone Call -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="call" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-phone text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Call: Outgoing</span>
                                                <span class="activity-time">4:30 PM PST</span>
                                            </div>
                                            <p class="activity-description">Follow-up call regarding maintenance request</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Duration: 8 minutes • by Sarah Adams</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- System Generated Notice -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">9:00 AM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Monthly Community Newsletter</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 12 Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 12, 2025</span>
                                    </div>
                                    
                                    <!-- Lease Activity -->
                                    <div class="activity-item" data-filter="lease" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-file-contract text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Lease Update</span>
                                                <span class="activity-time">2:15 PM PST</span>
                                            </div>
                                            <p class="activity-description">Emergency contact information updated</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Maintenance Request -->
                                    <div class="activity-item" data-filter="work-orders" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-tools text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Maintenance Request</span>
                                                <span class="activity-time">10:45 AM PST</span>
                                            </div>
                                            <p class="activity-description">Request for air conditioning inspection</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Submitted by Resident</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Hidden Activities (Initially hidden) -->
                                <div id="hidden-activities" class="hidden">
                                
                                <!-- Aug 10, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 10, 2025</span>
                                    </div>
                                    
                                    <!-- Community Event -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="event" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-calendar-alt text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Event: Scheduled</span>
                                                <span class="activity-time">5:00 PM PST</span>
                                            </div>
                                            <p class="activity-description">Community BBQ Event - August 20th</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Community Newsletter</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Inspection -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-clipboard-check text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Annual Inspection</span>
                                                <span class="activity-time">1:30 PM PST</span>
                                            </div>
                                            <p class="activity-description">Unit inspection completed - No issues found</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Inspector: John Martinez</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Jul 15, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Jul 15, 2025</span>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">8:15 AM PST</span>
                                            </div>
                                            <p class="activity-description">July rent payment - $2,000.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • On time</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-tools text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Completed</span>
                                                <span class="activity-time">2:20 PM PST</span>
                                            </div>
                                            <p class="activity-description">WO #25890: HVAC filter replacement completed</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Maintenance Team</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Jun 20, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Jun 20, 2025</span>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="text" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-sms text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Text: Received</span>
                                                <span class="activity-time">6:45 PM PST</span>
                                            </div>
                                            <p class="activity-description">Resident reported noise complaint - resolved</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via SMS Portal</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- May 10, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">May 10, 2025</span>
                                    </div>
                                    
                                    <!-- Lease Update -->
                                    <div class="activity-item" data-filter="lease" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-file-contract text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Lease Amendment</span>
                                                <span class="activity-time">11:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">Pet policy addendum signed</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Legal Department</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">8:00 AM PST</span>
                                            </div>
                                            <p class="activity-description">May rent payment - $2,000.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • On time</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Oct 1, 2024 - Lease Renewal -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Oct 1, 2024</span>
                                    </div>
                                    
                                    <!-- Lease Renewal #4 Milestone -->
                                    <div class="activity-item milestone-item" data-filter="lease" data-time="1year" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-key text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Lease Renewal #4</span>
                                                <span class="activity-time">Oct 1, 2024</span>
                                            </div>
                                            <p class="activity-description">Renewed lease for 12-month term through Sep 30, 2025</p>
                                            <div class="activity-meta">
                                                <span class="text-sm ">✓ Active Lease</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Oct 1, 2023 - Previous Lease Renewal -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Oct 1, 2023</span>
                                    </div>
                                    
                                    <!-- Lease Renewal #3 Milestone -->
                                    <div class="activity-item milestone-item" data-filter="lease" data-time="1year" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-sync text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Lease Renewal #3</span>
                                                <span class="activity-time">Oct 1, 2023</span>
                                            </div>
                                            <p class="activity-description">Renewed lease for 12-month term</p>
                                            <div class="activity-meta">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Jul 15, 2022 - Regular Activity Example -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Jul 15, 2022</span>
                                    </div>
                                    
                                    <!-- Payment Received -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">9:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">Rent payment for July 2022 - $2,000.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • On time</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Mar 10, 2021 - Regular Activity Example -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Mar 10, 2021</span>
                                    </div>
                                    
                                    <!-- Work Order Completed -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-check text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Completed</span>
                                                <span class="activity-time">2:45 PM PST</span>
                                            </div>
                                            <p class="activity-description">WO #18392: Kitchen faucet repair completed</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Maintenance Team • Satisfied</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Oct 2, 2020 - Move-in -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Oct 2, 2020</span>
                                    </div>
                                    
                                    <!-- Move-in Milestone -->
                                    <div class="activity-item milestone-item" data-filter="lease" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-home text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Move-in Date</span>
                                                <span class="activity-time">Oct 2, 2020</span>
                                            </div>
                                            <p class="activity-description">Initial move-in to Unit 288 at Cityview Towers</p>
                                            <div class="activity-meta">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Sep 15, 2020 - Lease Signing -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Sep 15, 2020</span>
                                    </div>
                                    
                                    <!-- Lease Signing Milestone -->
                                    <div class="activity-item milestone-item" data-filter="lease" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-file-signature text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Lease Signed</span>
                                                <span class="activity-time">Sep 15, 2020</span>
                                            </div>
                                            <p class="activity-description">Initial lease agreement signed for 12-month term</p>
                                            <div class="activity-meta">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Sep 10, 2020 - Application Approved -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Sep 10, 2020</span>
                                    </div>
                                    
                                    <!-- Application Approved Milestone -->
                                    <div class="activity-item milestone-item" data-filter="lease" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-check-circle text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Application Approved</span>
                                                <span class="activity-time">Sep 10, 2020</span>
                                            </div>
                                            <p class="activity-description">Rental application approved after background and credit check</p>
                                            <div class="activity-meta">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 9, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 9, 2025</span>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">7:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">Late fee payment - $75.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Credit Card • Processed</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">6:00 AM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Payment Confirmation - Late Fee</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 8, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 8, 2025</span>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-wrench text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Created</span>
                                                <span class="activity-time">3:45 PM PST</span>
                                            </div>
                                            <p class="activity-description">WO #26089: Bathroom sink drain clogged</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Low Priority • by Maintenance Team</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="chat" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-comments text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Chat: Incoming</span>
                                                <span class="activity-time">11:20 AM PST</span>
                                            </div>
                                            <p class="activity-description">Inquiry about pool maintenance schedule</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via Resident Portal</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Appointment Rescheduling -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="appointment" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-calendar-check text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Appointment: Rescheduled</span>
                                                <span class="activity-time">9:15 AM PST</span>
                                            </div>
                                            <p class="activity-description">Maintenance appointment rescheduled via text message</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via SMS Portal</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 7, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 7, 2025</span>
                                    </div>
                                    
                                    <!-- Follow-up -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="follow-up" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-user-clock text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Follow-Up - Created</span>
                                                <span class="activity-time">5:30 PM PST</span>
                                            </div>
                                            <p class="activity-description">Schedule follow-up for noise complaint resolution</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">CRM Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Email -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">2:20 PM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Lease Renewal Options Available</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">by Property Manager</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 6, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 6, 2025</span>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-tools text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Completed</span>
                                                <span class="activity-time">4:00 PM PST</span>
                                            </div>
                                            <p class="activity-description">WO #26001: Carpet cleaning service completed</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Cleaning Service • Scheduled</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="call" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-phone text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Call: Incoming</span>
                                                <span class="activity-time">1:15 PM PST</span>
                                            </div>
                                            <p class="activity-description">Question about community event parking</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Duration: 5 minutes</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 5, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 5, 2025</span>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">8:45 AM PST</span>
                                            </div>
                                            <p class="activity-description">Utility bill payment - $120.50</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • Utilities</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Text Message -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="text" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-sms text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Text: Sent</span>
                                                <span class="activity-time">7:00 AM PST</span>
                                            </div>
                                            <p class="activity-description">Reminder: Monthly pest control service scheduled</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">CRM Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 4, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 4, 2025</span>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">4:30 PM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: August Community Newsletter</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-wrench text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: In Progress</span>
                                                <span class="activity-time">11:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">WO #25978: Kitchen cabinet hinge repair</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Assigned to Tony Rodriguez</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 3, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 3, 2025</span>
                                    </div>
                                    
                                    <!-- Chat -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="chat" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-comments text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Chat: Incoming</span>
                                                <span class="activity-time">6:20 PM PST</span>
                                            </div>
                                            <p class="activity-description">Request for gym equipment maintenance update</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via Resident Portal</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Follow-up -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="follow-up" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-user-clock text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Follow-Up - Completed</span>
                                                <span class="activity-time">2:45 PM PST</span>
                                            </div>
                                            <p class="activity-description">Confirmed satisfaction with balcony door repair</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 2, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 2, 2025</span>
                                    </div>
                                    
                                    <!-- Email -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">3:10 PM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Work Order Status Update - Balcony Door</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">by Sarah Adams</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">9:20 AM PST</span>
                                            </div>
                                            <p class="activity-description">Pet deposit payment - $300.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Credit Card • Pet Policy</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 1, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 1, 2025</span>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">8:00 AM PST</span>
                                            </div>
                                            <p class="activity-description">August rent payment - $2,000.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • On time</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-tools text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Created</span>
                                                <span class="activity-time">7:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">WO #25912: Balcony sliding door sticking</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Medium Priority • Reported by Resident</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Sep 5, 2020 - Application Submitted -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Sep 5, 2020</span>
                                    </div>
                                    
                                    <!-- Application Submitted Milestone -->
                                    <div class="activity-item milestone-item" data-filter="lease" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-file-alt text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Application Submitted</span>
                                                <span class="activity-time">Sep 5, 2020</span>
                                            </div>
                                            <p class="activity-description">Initial rental application submitted for Unit 288</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Online application portal</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                </div> <!-- End hidden-activities -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Load More Section - Outside card-content -->
                        <div class="load-more-section text-center py-4" id="load-more-section" style="border-top: 1px solid #e5e7eb; position: relative; z-index: 100; display: block !important; visibility: visible !important;">
                            <button class="btn btn-light" onclick="toggleActivities()" id="toggle-activities-btn">
                                <i class="fas fa-chevron-down mr-2" id="toggle-activities-icon"></i>
                                <span id="toggle-activities-text">Load more activities</span>
                            </button>
                        </div>
                        
                                </div>
            </div>
        </div>

            <!-- Lease Information View (Hidden by default) -->
            <div id="lease-info-view" class="container py-6 mx-auto" style="display: none;">
                

            </div>

            <!-- Ledger View (Hidden by default) -->
            <div id="ledger-view" class="container py-6 mx-auto" style="display: none;">
                
                <!-- Page Title -->
                <div class="mb-6 flex items-center justify-between">
                    <h1 class="text-2xl font-semibold ">Ledger</h1>
                    <div class="flex items-center gap-3">
                        <button class="btn btn-light">
                            <i class="fas fa-circle-plus mr-2"></i>
                            Add charge
                                        </button>
                        <button class="btn btn-light">
                            <i class="fas fa-credit-card mr-2"></i>
                            Receive payment
                                        </button>
                                    </div>
                                </div>

                        <!-- Account Summary Cards -->
            <div class="mb-8">
				<div class="grid grid-cols-1 md:grid-cols-5 gap-6">
					<div class="card card-shadow-static">
						<div class="card-content text-center">
							<div class="text-2xl font-bold ">$2,809.50</div>
							<div class="text-muted">Outstanding balance</div>
						</div>
					</div>
					<div class="card card-shadow-static">
						<div class="card-content text-center">
							<div class="text-2xl font-bold ">98% on-time</div>
							<div class="text-muted">Payment performance</div>
						</div>
					</div>
					<div class="card card-shadow-static">
						<div class="card-content text-center">
							<div class="text-2xl font-bold ">Aug 16, 2025</div>
							<div class="text-muted">Last payment</div>
						</div>
					</div>
					<div class="card card-shadow-static">
						<div class="card-content text-center">
							<div class="text-2xl font-bold ">3 days early</div>
							<div class="text-muted">Average payment time</div>
						</div>
					</div>
					<div class="card card-shadow-static">
						<div class="card-content text-center">
							<div class="text-2xl font-bold ">Sep 1, 2025</div>
							<div class="text-muted">Next due date</div>
						</div>
					</div>
				</div>
            </div>



            <!-- Filters and Controls -->
            <div class="flex items-center justify-between gap-4 mb-6">
                <div class="flex items-center gap-4">
                    <!-- Search Box -->
                    <div class="flex-1 min-w-[300px]">
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" placeholder="Search transactions..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus-ring-primary">
                        </div>
                    </div>
                    
                    <!-- Tab-style Filters -->
                    <div class="flex items-center gap-2">
                        <button id="filter-all" class="tab-filter active px-4 py-2 rounded-full font-medium transition-colors" onclick="setExclusiveLedgerFilter('all')">
                            All
                        </button>
                        <button id="filter-unpaid" class="tab-filter px-4 py-2 rounded-full font-medium transition-colors" onclick="setExclusiveLedgerFilter('unpaid')">
                            Unpaid charges
                        </button>
                        <button id="filter-processing" class="tab-filter px-4 py-2 rounded-full font-medium transition-colors" onclick="setExclusiveLedgerFilter('processing')">
                            Processing payments
                        </button>
                        <button id="filter-hap" class="tab-filter px-4 py-2 rounded-full font-medium transition-colors" onclick="setExclusiveLedgerFilter('hap')">
                            HAP
                        </button>
                        <button id="filter-not-hap" class="tab-filter px-4 py-2 rounded-full font-medium transition-colors" onclick="setExclusiveLedgerFilter('not-hap')">
                            Not HAP
                        </button>
                    </div>
                </div>
                
                <!-- Kebab Menu -->
                <div class="relative">
                    <button id="ledger-kebab-btn" class="btn btn-light kebab-menu" onclick="toggleLedgerKebab()">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <div id="ledger-kebab-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-50 hidden">
                        <div class="py-1">
                            <a href="#" class="block px-4 py-2  hover:bg-gray-100" onclick="exportToExcel()">
                                <i class="fas fa-file-excel mr-2 text-muted"></i>
                                Export to Excel
                            </a>
                            <a href="#" class="block px-4 py-2  hover:bg-gray-100" onclick="exportToPDF()">
                                <i class="fas fa-file-pdf mr-2 text-muted"></i>
                                Export to PDF
                            </a>
                            <a href="#" class="block px-4 py-2  hover:bg-gray-100" onclick="emailReport()">
                                <i class="fas fa-envelope mr-2 text-muted"></i>
                                Email report
                            </a>
                            <a href="#" class="block px-4 py-2  hover:bg-gray-100" onclick="printLedger()">
                                <i class="fas fa-print mr-2 text-muted"></i>
                                Print ledger
                            </a>
                        </div>
                    </div>
                </div>
                </div>

                        <!-- Ledger Table -->
            <div class="">
                <div class="overflow-x-auto">
                    <table class="standard-table w-full">
                        <thead>
                            <tr>
                                <th class="sortable" onclick="sortTable('date')">
                                    <div class="flex items-center gap-2">
                                        Date
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="sortable" onclick="sortTable('description')">
                                    <div class="flex items-center gap-2">
                                        Description
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="text-center sortable" onclick="sortTable('status')">
                                    <div class="flex items-center justify-center gap-2">
                                        Status
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="text-right sortable" onclick="sortTable('charges')">
                                    <div class="flex items-center justify-end gap-2">
                                        Charges
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="text-right sortable" onclick="sortTable('payments')">
                                    <div class="flex items-center justify-end gap-2">
                                        Payments
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="text-right sortable" onclick="sortTable('balance')">
                                    <div class="flex items-center justify-end gap-2">
                                        Balance
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                            <tbody>
                                <!-- Current Outstanding -->
                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">Aug 17, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">Late Fee - Rent (July 2025)</div>
                                        <div class="text-sm text-muted">Applied after 5-day grace period • Code: latefee • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613267')">C-613267</a></div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">Unpaid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right font-medium ">$75.00</td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-bold ">$2,674.50</td>
                                </tr>
                                
                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">Aug 16, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">ACH Payment - Partial</div>
                                        <div class="text-sm text-muted">Bank: Wells Fargo ***4521 • Code: achpay • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613256')">C-613256</a></div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">Processing</span>
                                    </td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-medium ">$1,337.25</td>
                                    <td class="px-6 py-3 text-right font-bold">$2,599.50</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">Aug 1, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">Rent (Residential) - August 2025</div>
                                        <div class="text-sm text-muted">Monthly rent charge • Code: rentres • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613245')">C-613245</a></div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">Unpaid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right font-medium ">$2,000.00</td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-bold">$3,936.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">Jul 6, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">Late Fee - Rent (June 2025)</div>
                                        <div class="text-sm text-muted">Applied after 5-day grace period • Code: latefee • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613234')">C-613234</a></div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">Unpaid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right font-medium ">$75.00</td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-bold ">$1,936.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">Jul 1, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">Rent (Residential) - July 2025</div>
                                        <div class="text-sm text-muted">Monthly rent charge • Code: rentres • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613223')">C-613223</a></div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">Unpaid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right font-medium ">$2,000.00</td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-bold ">$1,861.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">Jun 30, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">ACH Payment - June Rent</div>
                                        <div class="text-sm text-muted">Bank: Wells Fargo ***4521 • Code: achpay</div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-medium ">$2,000.00</td>
                                    <td class="px-6 py-3 text-right font-bold">-$138.25</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">Jun 15, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">Pet Fee - Monthly (Luna & Whiskers)</div>
                                        <div class="text-sm text-muted">2 pets × $15/month • Code: petfee</div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">Unpaid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right font-medium ">$30.00</td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-bold">$1,861.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">Jun 1, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">Rent (Residential) - June 2025</div>
                                        <div class="text-sm text-muted">Monthly rent charge • Code: rentres</div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right font-medium ">$2,000.00</td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-bold">$1,831.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">Jun 3, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">HAP Payment - June 2025</div>
                                        <div class="text-sm text-muted">Housing Assistance Program payment • Code: hap • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613190')">C-613190</a></div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-medium ">$1,200.00</td>
                                    <td class="px-6 py-3 text-right font-bold ">$631.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">May 1, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">Section 8 Rent Subsidy - May 2025</div>
                                        <div class="text-sm text-muted">Housing voucher payment • Code: s8subsidy • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613179')">C-613179</a></div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-medium ">$1,150.00</td>
                                    <td class="px-6 py-3 text-right font-bold ">$631.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row hidden" data-page="2">
                                    <td class="px-6 py-3 ">May 31, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">ACH Payment - May Rent</div>
                                        <div class="text-sm text-muted">Bank: Wells Fargo ***4521 • Code: achpay</div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-medium ">$2,030.00</td>
                                    <td class="px-6 py-3 text-right font-bold">-$168.25</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">May 15, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">Pet Fee - Monthly (Luna & Whiskers)</div>
                                        <div class="text-sm text-muted">2 pets × $15/month • Code: petfee</div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right font-medium ">$30.00</td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-bold">$1,861.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row hidden" data-page="2">
                                    <td class="px-6 py-3 ">May 1, 2025</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">Rent (Residential) - May 2025</div>
                                        <div class="text-sm text-muted">Monthly rent charge • Code: rentres</div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-3 text-right font-medium ">$2,000.00</td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-bold">$1,831.75</td>
                                </tr>

                                <!-- Starting Balance for 2025 -->
                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-3 ">Dec 31, 2024</td>
                                    <td class="px-6 py-3">
                                        <div class="font-medium ">Balance Forward</div>
                                        <div class="text-sm text-muted">Carried from previous year • Code: balance</div>
                                    </td>
                                    <td class="px-6 py-3 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800">Carried forward</span>
                                    </td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right">-</td>
                                    <td class="px-6 py-3 text-right font-bold">-$168.25</td>
                                </tr>
                            </tbody>
                        </table>
            </div>
        </div>

        <!-- Pagination -->
        <div class="flex items-center justify-center mt-8 gap-6">
            <!-- Pagination Controls -->
            <div class="flex items-center gap-1">
                <!-- Previous Button -->
                <button class="pagination-prev w-8 h-8 flex items-center justify-center border border-gray-300 rounded text-gray-400 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled onclick="previousPage()">
                    <i class="fas fa-chevron-left text-sm"></i>
                </button>
                
                <!-- Page Numbers -->
                <button class="pagination-page w-8 h-8 border border-primary bg-primary text-white rounded" data-page="1" onclick="goToPage(1)">1</button>
                <button class="pagination-page w-8 h-8 border border-gray-300  hover:bg-gray-50 rounded" data-page="2" onclick="goToPage(2)">2</button>
                
                <!-- Next Button -->
                <button class="pagination-next w-8 h-8 flex items-center justify-center border border-gray-300 rounded  hover:bg-gray-50" onclick="nextPage()">
                    <i class="fas fa-chevron-right text-sm"></i>
                </button>
            </div>
            
            <!-- Records Per Page Selector -->
            <div class="flex items-center gap-2">
                <select class="px-3 py-1 border border-gray-300 rounded bg-white" onchange="changeRecordsPerPage(this.value)">
                    <option value="10" selected>10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <span class="text-muted">per page</span>
            </div>
        </div>

            
        </div>

        <!-- Lease Information 2 View (Hidden by default) -->
        <div id="lease-info-2-view" class="container py-6 mx-auto" style="display: none;">
            
            <!-- Page Title -->
            <div class="mb-6 flex items-center justify-between">
                <h1 class="text-2xl font-semibold">Lease Information</h1>
                <!-- <div class="flex items-center gap-3"> -->
                    <!-- <span class="text-sm text-muted">Experimental Layout</span> -->
                <!-- </div> -->
            </div>

            <!-- Main Content Grid: 2/3 + 1/3 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- Left Column (2/3 width) - Main Lease Information Card -->
                <div class="col-span-1 lg:col-span-2">
                    <div class="card shadow-sm flex-grow">
                        <div class="card-header border-0">
                            <div class="flex items-center justify-between w-full">
                                <h3 class="card-title">Current lease</h3>
                                <button class="btn btn-light" onclick="openPageslide('payment-details-edit-overlay')">
                                    Edit
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                                <!-- LEASE DATES Section -->
                                <div class="card-section">
                                    <div class="card-section-content">
                                        <div class="grid grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-4">
                                            <div class="flex flex-col">
                                                <span class="text-xs text-gray-500 mb-1">Lease dates</span>
                                                <div class="flex flex-col gap-2">
                                                    <span class="font-bold text-gray-900">Oct 1, 2024 - Sep 30, 2025</span>
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <span class="text-xs text-gray-500 mb-1">Move-in date</span>
                                                <div class="flex items-center gap-2">
                                                    <span class="font-bold text-gray-900">Oct 2, 2020</span>
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <span class="text-xs text-gray-500 mb-1">Lease terms</span>
                                                <div class="flex items-center gap-2">
                                                    <span class="font-bold text-gray-900">12 months</span>
                                                </div>
                                            </div>
                                        </div>
                        </div>
                    </div>

                                <!-- PAYMENT DETAILS Section -->
                                <div class="card-section">
                                    <div class="card-section-content">
                                        <div class="grid grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-4">
                                        <div class="flex flex-col">
                                            <span class="text-xs text-gray-500 mb-1">Monthly rent</span>
                                            <div class="flex items-center gap-2">
                                                <span class="font-bold text-gray-900">$1,482.25</span>
                                                <span class="tooltip-black">
                                                    <button class="btn btn-light btn-sm px-2 py-1" onclick="openPageslide('edit-lease-charges-overlay')">
                                                        <i class="fas fa-eye text-sm"></i>
                                                    </button>
                                                    <span class="tooltip-text">View lease charges</span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-xs text-gray-500 mb-1">Total deposit</span>
                                            <div class="flex items-center gap-2">
                                                <span class="font-bold text-gray-900">$1,850.00</span>
                                                <span class="tooltip-black">
                                                    <button class="btn btn-light btn-sm px-2 py-1">
                                                        <i class="fas fa-eye text-sm"></i>
                                                    </button>
                                                    <span class="tooltip-text">View deposit info</span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-xs text-gray-500 mb-1">Late fee/NSF</span>
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-exclamation-triangle text-gray-400 text-sm"></i>
                                                <span class="font-semibold text-gray-900">0/0</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-xs text-gray-500 mb-1">Lease description</span>
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-file-contract text-gray-400 text-sm"></i>
                                                <span class="font-semibold text-gray-900">Controlled</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-xs text-gray-500 mb-1">Payment method</span>
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-credit-card text-gray-400 text-sm"></i>
                                                <span class="font-semibold text-gray-900">Do not accept</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-xs text-gray-500 mb-1">Responsibility date</span>
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-calendar text-gray-400 text-sm"></i>
                                                <span class="font-semibold text-gray-900">-</span>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                </div>

						</div>
                    </div>
                    
                    <!-- Lease History Card -->
                    <div class="card shadow-sm flex-grow mt-6">
                        <div class="card-header border-0">
                            <div class="flex items-center justify-between w-full">
                                <h3 class="card-title">Lease history</h3>
                            </div>
                        </div>
                        <div class="card-content">
                            <!-- Timeline Container -->
                            <div class="relative">
                                <!-- Timeline Line -->
                                <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"></div>
                                
                                <!-- Timeline Items -->
                                <div class="space-y-3">
                                    <!-- Previous Lease 2023-2024 -->
                                    <div class="relative pl-8">
                                        <div class="absolute left-2.5 top-1 w-3 h-3 bg-blue-500 rounded-full border-2 border-white shadow"></div>
                                        <div class="bg-white border border-gray-200 rounded-lg p-3">
                                            <div class="flex items-center justify-between mb-1.5">
                                                <h4 class="font-semibold text-gray-900">Oct 1, 2023 - Sep 30, 2024</h4>
                                            </div>
                                            <div class="grid grid-cols-3 gap-x-3 gap-y-1 text-xs mt-2">
                                                <div>
                                                    <span class="text-gray-500">Rent:</span>
                                                    <span class="font-medium ml-1">$1,395.00</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Term:</span>
                                                    <span class="font-medium ml-1">12 months</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Agent:</span>
                                                    <span class="font-medium ml-1">David Chen</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Roommate Promotion -->
                                    <div class="relative pl-8">
                                        <div class="absolute left-2.5 top-1 w-3 h-3 bg-purple-500 rounded-full border-2 border-white shadow"></div>
                                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                                            <div class="flex items-center justify-between mb-1.5">
                                                <div>
                                                    <h4 class="font-semibold text-gray-900">Mar 15, 2023 - Sep 30, 2023</h4>
                                                    <p class="text-xs text-gray-600 mt-0.5">From lease <a href="#" class="text-blue-600 hover:underline">t0312765</a> in unit 288</p>
                                                </div>
                                                <span class="badge bg-purple-100 text-purple-800 text-xs px-1.5 py-0.5 rounded-full">Roommate Promotion</span>
                                            </div>
                                            <div class="grid grid-cols-3 gap-x-3 gap-y-1 text-xs mt-2">
                                                <div>
                                                    <span class="text-gray-500">Rent:</span>
                                                    <span class="font-medium ml-1">$1,350.00</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Term:</span>
                                                    <span class="font-medium ml-1">6 months</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Agent:</span>
                                                    <span class="font-medium ml-1">Jennifer Walsh</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Previous Lease in Unit 288 -->
                                    <div class="relative pl-8">
                                        <div class="absolute left-2.5 top-1 w-3 h-3 bg-blue-500 rounded-full border-2 border-white shadow"></div>
                                        <div class="bg-white border border-gray-200 rounded-lg p-3">
                                            <div class="flex items-center justify-between mb-1.5">
                                                <h4 class="font-semibold text-gray-900">Oct 1, 2022 - Mar 14, 2023</h4>
                                            </div>
                                            <div class="grid grid-cols-3 gap-x-3 gap-y-1 text-xs mt-2">
                                                <div>
                                                    <span class="text-gray-500">Rent:</span>
                                                    <span class="font-medium ml-1">$1,320.00</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Term:</span>
                                                    <span class="font-medium ml-1">5 months</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Agent:</span>
                                                    <span class="font-medium ml-1">Jennifer Walsh</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Unit Transfer -->
                                    <div class="relative pl-8">
                                        <div class="absolute left-2.5 top-1 w-3 h-3 bg-orange-500 rounded-full border-2 border-white shadow"></div>
                                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-3">
                                            <div class="flex items-center justify-between mb-1.5">
                                                <div>
                                                    <h4 class="font-semibold text-gray-900">Oct 10, 2021 - Sep 30, 2022</h4>
                                                    <p class="text-xs text-gray-600 mt-0.5">From lease <a href="#" class="text-blue-600 hover:underline">t0123452</a> in unit <a href="#" class="text-blue-600 hover:underline">2101</a></p>
                                                </div>
                                                <span class="badge bg-orange-100 text-orange-800 text-xs px-1.5 py-0.5 rounded-full">Transfer</span>
                                            </div>
                                            <div class="grid grid-cols-3 gap-x-3 gap-y-1 text-xs mt-2">
                                                <div>
                                                    <span class="text-gray-500">Rent:</span>
                                                    <span class="font-medium ml-1">$1,280.00</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Term:</span>
                                                    <span class="font-medium ml-1">12 months</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Agent:</span>
                                                    <span class="font-medium ml-1">Robert Kim</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Previous Lease in Unit 2101 -->
                                    <div class="relative pl-8">
                                        <div class="absolute left-2.5 top-1 w-3 h-3 bg-blue-500 rounded-full border-2 border-white shadow"></div>
                                        <div class="bg-white border border-gray-200 rounded-lg p-3">
                                            <div class="flex items-center justify-between mb-1.5">
                                                <h4 class="font-semibold text-gray-900">Oct 2, 2021 - Oct 9, 2021</h4>
                                            </div>
                                            <div class="grid grid-cols-3 gap-x-3 gap-y-1 text-xs mt-2">
                                                <div>
                                                    <span class="text-gray-500">Rent:</span>
                                                    <span class="font-medium ml-1">$1,250.00</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Term:</span>
                                                    <span class="font-medium ml-1">8 days</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Agent:</span>
                                                    <span class="font-medium ml-1">Robert Kim</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Original Lease -->
                                    <div class="relative pl-8">
                                        <div class="absolute left-2.5 top-1 w-3 h-3 bg-gray-500 rounded-full border-2 border-white shadow"></div>
                                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                                            <div class="flex items-center justify-between mb-1.5">
                                                <h4 class="font-semibold text-gray-900">Oct 2, 2020 - Oct 1, 2021</h4>
                                                <span class="badge bg-gray-200 text-gray-800 text-xs px-1.5 py-0.5 rounded-full">Start</span>
                                            </div>
                                            <div class="grid grid-cols-3 gap-x-3 gap-y-1 text-xs mt-2">
                                                <div>
                                                    <span class="text-gray-500">Rent:</span>
                                                    <span class="font-medium ml-1">$1,180.00</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Term:</span>
                                                    <span class="font-medium ml-1">12 months</span>
                                                </div>
                                                <div>
                                                    <span class="text-gray-500">Agent:</span>
                                                    <span class="font-medium ml-1">Michael Torres</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column (1/3 width) - Additional Information Sidebar -->
                <div class="col-span-1 lg:col-span-1">
                    <div class="third-column-separator space-y-6">
                        
                        <!-- Alerts Card -->
                        <div class="card">
                            <div class="card-header border-0">
                                <h4 class="card-title" style="font-size: 16px;">Alerts</h4>
                            </div>
                            <div class="card-content pt-0">
                                <div class="space-y-3">
                                    <!-- 30-Day Notice to Vacate -->
                                    <div class="border border-gray-300 border-l-4 border-l-orange-500 rounded-lg p-3 bg-orange-50">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-exclamation-triangle text-orange-600 text-sm"></i>
                                                <h4 class="font-semibold text-gray-800">30-Day Notice</h4>
                                            </div>
                                            <!--<span class="text-xs text-orange-600 font-medium">15 days remaining</span>-->
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-gray-700">Move-out: Sep 30, 2025</span>
                                            <div class="flex gap-1"> 
                                                <button class="btn text-xs px-2 py-1 bg-red-600 text-white hover:bg-red-700">
                                                    Reject
                                                </button>
												 <button class="btn text-xs px-2 py-1 bg-green-600 text-white hover:bg-green-700">
                                                    Approve
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Renewal Offer -->
                                    <div class="border border-gray-300 border-l-4 border-l-blue-500 rounded-lg p-3 bg-blue-50">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-file-contract text-blue-600 text-sm"></i>
                                                <h4 class="font-semibold text-gray-800">Renewal Offer #67892</h4>
                                            </div>
                                            <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium">Pending Response</span>
                                        </div>
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="text-gray-700">
                                                <span class="font-medium">$2,000.00/mo • 12 months</span>
                                            </div>
                                            <span class="text-xs text-red-600 font-medium">
                                                <i class="fas fa-clock mr-1"></i>45 days
                                            </span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-gray-600">Oct 1, 2025 - Sep 30, 2026</span>
                                            <div class="flex gap-1">
                                                <button class="btn text-xs px-2 py-1 bg-gray-100 text-gray-700 hover:bg-gray-200">
                                                    Edit
                                                </button>
                                                <button class="btn text-xs px-2 py-1 bg-gray-100 text-gray-700 hover:bg-gray-200">
                                                    View
                                                </button>
                                                <button class="btn text-xs px-2 py-1 bg-blue-600 text-white hover:bg-blue-700">
                                                    Remind
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Activity -->
                        <div class="card">
                            <div class="card-header border-0 pb-2 cursor-pointer" onclick="toggleCollapsibleCard('recent-activity')">
                                <div class="flex items-center justify-between w-full">
                                    <div class="flex items-center gap-2">
                                        <h4 class="card-title" style="font-size: 16px;">Recent activity</h4>
                                        <span class="bg-gray-100 text-gray-600 text-sm font-bold px-2 py-1 rounded-full">1</span>
                                    </div>
                                    <i id="recent-activity-icon" class="fas fa-chevron-up text-gray-400 text-sm transition-transform"></i>
                                </div>
                            </div>
                            <div id="recent-activity-content" class="card-content pt-0">
                                <div class="space-y-3">
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-circle text-blue-500 text-xs mt-2"></i>
                                        <div class="flex-1">
                                            <div class="text-xs text-gray-500">Jul 28, 2025</div>
                                            <div>Pet addendum signed</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Lease Documents -->
                        <div class="card">
                            <div class="card-header border-0 pb-2 cursor-pointer" onclick="toggleCollapsibleCard('lease-documents')">
                                <div class="flex items-center justify-between w-full">
                                    <div class="flex items-center gap-2">
                                        <h4 class="card-title" style="font-size: 16px;">Lease documents</h4>
                                        <span class="bg-gray-100 text-gray-600 text-sm font-bold px-2 py-1 rounded-full">2</span>
                                    </div>
                                    <i id="lease-documents-icon" class="fas fa-chevron-up text-gray-400 text-sm transition-transform"></i>
                                </div>
                            </div>
                            <div id="lease-documents-content" class="card-content pt-0">
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                        <div class="flex items-center gap-2">
                                            <span>Original Lease v2.1</span>
                                        </div>
                                        <button class="btn btn-link btn-sm p-0">
                                            <i class="fas fa-download text-muted"></i>
                                        </button>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                        <div class="flex items-center gap-2">
                                            <span>Pet Addendum</span>
                                        </div>
                                        <button class="btn btn-link btn-sm p-0">
                                            <i class="fas fa-download text-muted"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <div class="card">
                            <div class="card-header border-0 pb-2">
                                <h4 class="card-title" style="font-size: 16px;">Additional information</h4>
                            </div>
                            <div class="card-content pt-0">
                                <div class="space-y-2">
                                    <button class="btn btn-light w-full py-2 justify-start">
                                        <i class="fas fa-paw mr-2 text-muted"></i>
                                        Pet information
                                        <span class="ml-2 bg-white text-gray-600 text-sm font-bold px-2 py-1 rounded-full">2</span>
                                    </button>
                                    <button class="btn btn-light w-full py-2 justify-start">
                                        <i class="fas fa-car mr-2 text-muted"></i>
                                        Vehicle information
                                        <span class="ml-2 bg-white text-gray-600 text-sm font-bold px-2 py-1 rounded-full">2</span>
                                    </button>
                                    <button class="btn btn-light w-full py-2 justify-start" onclick="openPageslide('late-fees-edit-overlay')">
                                        <i class="fas fa-exclamation-triangle mr-2 text-muted"></i>
                                        Late fees
                                    </button>
                                    <button class="btn btn-light w-full py-2 justify-start" onclick="openPageslide('screening-overlay')">
                                        <i class="fas fa-clipboard-check mr-2 text-muted"></i>
                                        Screening
                                    </button>
                                    <button class="btn btn-light w-full py-2 justify-start">
                                        <i class="fas fa-file-alt mr-2 text-muted"></i>
                                        Application form
                                    </button>
                                    <button class="btn btn-light w-full py-2 justify-start">
                                        <i class="fas fa-info-circle mr-2 text-muted"></i>
                                        Other information
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Documents View (Hidden by default) -->
        <div id="documents-view" class="px-6 pt-6 pb-0" style="display: none; min-height: auto;">
            
            <!-- Page Title -->
            <div class="mb-6 flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold mb-1">Documents</h1>
                    <p class="text-muted">Manage documents, signatures and attachments</p>
                </div>
                <div class="flex items-center gap-3">
                    <button id="add-attachment-btn" class="btn btn-light" onclick="showAttachmentModal()">
                        <i class="fas fa-paperclip mr-2"></i>
                        Add attachment
                    </button>
                    <button id="add-document-btn" class="btn btn-light" onclick="showAttachmentModal()">
                        <i class="fas fa-circle-plus mr-2"></i>
                        Add document
                </button>
                    </div>
                </div>
                
 

            <!-- SIGNATURE DOCUMENTS Section -->
            <div class="mt-8 mb-6">
                <!-- Search Bar and Filters Row - Following Ledger Pattern -->
                <div class="search-filters-row">
                    <div class="search-filters-group">
                        <!-- Search Box -->
                        <div class="search-box">
                            <div class="relative">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input 
                            type="text" 
                            id="documents-search"
                            placeholder="Search..." 
                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus-ring-primary"
                            oninput="filterDocuments()"
                        >
                    </div>
                </div>
                
                <!-- Tab-style Filters -->
                <div class="flex items-center gap-2">
                    <button id="doc-filter-all" class="tab-filter active px-4 py-2 rounded-full font-medium transition-colors" onclick="setDocumentsFilter('all')">
                        All
                    </button>
                    <button id="doc-filter-signature" class="tab-filter px-4 py-2 rounded-full font-medium transition-colors" onclick="setDocumentsFilter('signature')">
                        Signature documents
                    </button>
                    <button id="doc-filter-upload" class="tab-filter px-4 py-2 rounded-full font-medium transition-colors" onclick="setDocumentsFilter('upload')">
                        Upload documents
                    </button>
                    <button id="doc-filter-attachments" class="tab-filter px-4 py-2 rounded-full font-medium transition-colors" onclick="setDocumentsFilter('attachments')">
                        Attachments
                    </button>
                </div>
                    </div>
                </div>
            </div>

            <!-- Document Sections Container -->
            <!-- Unified Documents List -->
            <div id="documents-sections" class="">
            <!-- Documents Table -->
                <div class="overflow-x-auto">
                    <table class="standard-table w-full">
                        <thead>
                            <tr>
                                <th class="sortable" onclick="sortDocumentsTable('document')">
                                    <div class="flex items-center gap-2">
                                        Document
                                        <i id="sort-document-icon" class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="sortable" onclick="sortDocumentsTable('people')">
                                    <div class="flex items-center gap-2">
                                        People
                                        <i id="sort-people-icon" class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="sortable" onclick="sortDocumentsTable('type')">
                                    <div class="flex items-center gap-2">
                                        Type
                                        <i id="sort-type-icon" class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="sortable" onclick="sortDocumentsTable('status')">
                                    <div class="flex items-center gap-2">
                                        Status
                                        <i id="sort-status-icon" class="fas fa-sort-up text-sm text-blue-600"></i>
                                    </div>
                                </th>
                                <th class="text-right">
                                    Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            
                            <!-- Lease v2.1 (Signature Document) -->
                            <tr class="document-item hover:bg-gray-50" data-category="signature" data-type="signature">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-file-signature text-gray-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium text-blue-600 hover:text-blue-800 cursor-pointer">
                                                <a href="#" class="text-blue-600 hover:text-blue-800">Lease v2.1</a>
                                            </div>
                                            <div class="text-sm text-gray-500">Aug 1, 2025 - July 31, 2026</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">Household</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Lease renewal
                                    </span>
									<div class="text-xs text-gray-500 mt-1">Modified by Sarah Wilson • July 30, 2025</div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex flex-col gap-1">
                                        <span class="inline-block px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 self-start">
                                            Pending signature
                                        </span>
                                        <div class="flex items-center gap-1 mt-2">
                                            <span class="flex items-center justify-center">
                                                <i class="fas fa-check text-green-600 text-xs"></i>
                                            </span>
                                            <span class="text-xs text-gray-600">Melinda</span>
                                            <span class="flex items-center justify-center ml-2">
                                                <i class="fas fa-check text-green-600 text-xs"></i>
                                            </span>
                                            <span class="text-xs text-gray-600">John</span>
                                            <span class="w-4 h-4 bg-red-100 rounded-full flex items-center justify-center ml-2">
                                                <i class="fas fa-exclamation text-red-600 text-xs"></i>
                                            </span>
                                            <span class="text-xs text-red-600 font-medium">Angela</span>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-1">
                                        <button class="btn btn-light btn-sm">
                                            <i class="fas fa-redo mr-1"></i>Regenerate
                                        </button>
                                        <button id="kebab-btn-lease-v21" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>

                            <!-- Current Lease (Signature Document) -->
                            <tr class="document-item hover:bg-gray-50" data-category="signature" data-type="signature">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-file-signature text-gray-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium text-blue-600 hover:text-blue-800 cursor-pointer">
                                                <a href="#" class="text-blue-600 hover:text-blue-800">Lease v1.2</a>
                                            </div>
                                            <div class="text-sm text-gray-500">Aug 1, 2024 - July 31, 2025</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">Household</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Current lease
                                    </span>
									<div class="text-xs text-gray-500 mt-1">Modified by Michael Davis • Jul 28, 2024</div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex flex-col gap-1">
                                        <span class="inline-block px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 self-start">
                                        Signed
                                    </span>
                                        <div class="flex items-center gap-1 mt-2">
                                            <span class="flex items-center justify-center">
                                                <i class="fas fa-check text-green-600 text-xs"></i>
                                            </span>
                                            <span class="text-xs text-gray-600">Melinda</span>
                                            <span class="flex items-center justify-center ml-2">
                                                <i class="fas fa-check text-green-600 text-xs"></i>
                                            </span>
                                            <span class="text-xs text-gray-600">John</span>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-2">
                                        <button class="btn btn-light btn-sm">
                                            <i class="fas fa-redo mr-1"></i>Regenerate
                                        </button>
                                        <button id="kebab-btn-lease-v12" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>

                            <!-- Insurance Certificate (Upload Document) -->
                            <tr class="document-item hover:bg-gray-50" data-category="upload" data-type="upload">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-upload text-blue-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium">
                                                Insurance Certificate<span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs ml-2 font-medium bg-red-100 text-red-800">
                                                    Required
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">Household</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Proof of Renters Insurance
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                        Pending upload
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-1">
                                        <button class="btn btn-light btn-sm">
                                            <i class="fas fa-bell mr-1"></i>Remind
                                        </button>
                                        <button id="kebab-btn-insurance-certificate" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>

                            <!-- Pet Addendum (Signature Document) -->
                            <tr class="document-item hover:bg-gray-50" data-category="signature" data-type="signature">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-file-signature text-gray-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium">
                                                <a href="#" class="text-blue-600 hover:text-blue-800">Pet Addendum</a>
                                            </div>
                                            <div class="text-xs text-gray-500 mt-1">Modified by Sarah Wilson • July 30, 2025</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">Household</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Other document
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                        Pending signature
                                    </span>
                                    <div class="flex items-center gap-1 mt-2">
                                        <span class="flex items-center justify-center">
                                            <i class="fas fa-check text-green-600 text-xs"></i>
                                        </span>
                                        <span class="text-xs text-gray-600">Melinda</span>
                                        <span class="flex items-center justify-center ml-2">
                                            <i class="fas fa-check text-green-600 text-xs"></i>
                                        </span>
                                        <span class="text-xs text-gray-600">John</span>
                                        <span class="w-4 h-4 bg-red-100 rounded-full flex items-center justify-center ml-2">
                                            <i class="fas fa-exclamation text-red-600 text-xs"></i>
                                        </span>
                                        <span class="text-xs text-red-600 font-medium">Angela</span>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-1">
                                        <button class="btn btn-light btn-sm">
                                            <i class="fas fa-redo mr-1"></i>Regenerate
                                        </button>
                                        <button id="kebab-btn-pet-addendum" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>

                            <!-- Income Verification (Upload Document) -->
                            <tr class="document-item hover:bg-gray-50" data-category="upload" data-type="upload">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-upload text-blue-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium">
                                                Driver's License<span class="inline-flex items-center px-1.5 py-0.5 ml-2 rounded text-xs font-medium bg-red-100 text-red-800">
                                                    Required
                                        </span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">Angela Johnson</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Proof of ID
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                        Pending upload
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-2">
                                        <button class="btn btn-light btn-sm">
                                            <i class="fas fa-bell mr-1"></i>Remind
                                        </button>
                                        <button id="kebab-btn-driver-license-angela" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>

                            <!-- Income Verification - John (Upload Document) -->
                            <tr class="document-item hover:bg-gray-50" data-category="upload" data-type="upload">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-upload text-blue-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium">
                                                <a href="#" class="text-blue-600 hover:text-blue-800">Driver's License</a><span class="inline-flex items-center px-1.5 py-0.5 ml-2 rounded text-xs font-medium bg-red-100 text-red-800">
                                                    Required
                                        </span>
                                            </div>
                                            <div class="text-sm text-gray-500">Uploaded Jan 15, 2024</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">John Smith</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Proof of ID
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        Uploaded
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-1">
                                        <button class="btn btn-light btn-sm" onclick="editAttachmentDocument('Driver\'s License', 'Proof of ID', false)">
                                            <i class="fas fa-pen mr-1"></i>Edit
                                        </button>
                                        <button id="kebab-btn-driver-license-john" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>

                                                        <!-- Income Verification (Upload Document) -->
                            <tr class="document-item hover:bg-gray-50" data-category="upload" data-type="upload">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-upload text-blue-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium">
                                                <a href="#" class="text-blue-600 hover:text-blue-800">Driver's License</a><span class="inline-flex items-center px-1.5 py-0.5 ml-2 rounded text-xs font-medium bg-red-100 text-red-800">
                                                    Required
                                                </span>
                                            </div>
                                            <div class="text-sm text-gray-500">Uploaded Jan 10, 2024</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">Melinda Michaels</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Proof of ID
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        Uploaded
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">     
                                    <div class="flex items-center justify-end gap-1">
                                        <button class="btn btn-light btn-sm" onclick="editAttachmentDocument('Driver\'s License', 'Proof of ID', false)">
                                            <i class="fas fa-pen mr-1"></i>Edit
                                        </button>
                                        <button id="kebab-btn-driver-license-melinda" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>

                            <!-- Parking Agreement (Signature Document) -->
                            <tr class="document-item hover:bg-gray-50" data-category="signature" data-type="signature">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-file-signature text-gray-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium">
                                                <a href="#" class="text-blue-600 hover:text-blue-800">Enclosed Garage Addendum</a>
                                            </div>
                                            <div class="text-sm text-gray-500">Aug 1, 2025 - July 31, 2026</div>
                                            
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">Household</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        One off document
                                    </span>
									<div class="text-xs text-gray-500 mt-1">Modified by Michael Davis • Jul 28, 2024</div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center gap-2">
                                        <span class="inline-block px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 self-start">
                                            Processing
                                        </span>
                                        <div class="relative group">
                                            <i class="fas fa-info-circle text-link hover:text-link-dark cursor-help text-sm"></i>
                                            <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50">
                                                Document generated successfully. Pending Bluemoon processing.
                                                <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"></div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-1">
                                        <button id="kebab-btn-pet-documentation" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>

                            <!-- Emergency Contact Form (Upload Document) -->
                            <tr class="document-item hover:bg-gray-50" data-category="upload" data-type="upload">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-upload text-blue-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium">
                                                <a href="#" class="text-blue-600 hover:text-blue-800">Emergency Contact Form</a>
                                            </div>
                                            <div class="text-sm text-gray-500">Uploaded Feb 5, 2024</div>
                                            <div class="mt-1">
                                                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                                    Optional
                                        </span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">John Smith</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Emergency contact
                                        </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        Uploaded
                                        </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-1">
                                        <button class="btn btn-light btn-sm" onclick="editAttachmentDocument('Emergency Contact Form', 'Emergency contact', false)">
                                            <i class="fas fa-pen mr-1"></i>Edit
                                        </button>
                                        <button id="kebab-btn-emergency-contact-john" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>

                            <!-- Pet Registration (Upload Document) -->
                            <tr class="document-item hover:bg-gray-50" data-category="upload" data-type="upload">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-upload text-blue-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium">
                                                Pet Registration<span class="inline-flex items-center ml-2 px-1.5 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                                    Optional
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">Household</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Pet
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                        Not Uploaded
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-1">
                                        <button id="kebab-btn-pet-registration" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <!-- Move-in Photos (Attachment) -->
                            <tr class="document-item hover:bg-gray-50" data-category="attachments" data-type="attachment">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-paperclip text-gray-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium">
                                                <a href="#" class="text-blue-600 hover:text-blue-800">photo002.jpg</a>
                                            </div>
                                            <div class="text-sm text-gray-500">JPG • Uploaded Jan 15, 2024</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">Melinda Michaels</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Delivery Attachment
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div>
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            Uploaded
                                        </span>
                                        <div class="flex items-center gap-1 mt-2">
                                            <i class="fas fa-eye text-gray-600 text-xs"></i>
                                            <span class="text-xs text-gray-600">Visible in resident portal</span>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-1">
                                        <button class="btn btn-light btn-sm" onclick="editAttachmentDocument('photo002.jpg', 'Delivery Attachment', true)">
                                            <i class="fas fa-pen mr-1"></i>Edit
                                        </button>
                                        <button id="kebab-btn-photo002-melinda" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>

                            <!-- Maintenance Notes (Attachment) -->
                            <tr class="document-item hover:bg-gray-50" data-category="attachments" data-type="attachment">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-paperclip text-gray-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium">
                                                <a href="#" class="text-blue-600 hover:text-blue-800">Maintenance Notes</a>
                                            </div>
                                            <div class="text-sm text-gray-500">PDF • Uploaded Jan 20, 2024</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">John Smith</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Residential Correspondence
                                        </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div>
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            Uploaded
                                        </span>
                                        <div class="flex items-center gap-1 mt-2">
                                            <i class="fas fa-eye text-gray-600 text-xs"></i>
                                            <span class="text-xs text-gray-600">Visible in resident portal</span>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-1">
                                        <button class="btn btn-light btn-sm" onclick="editAttachmentDocument('Maintenance Notes', 'Residential Correspondence', true)">
                                            <i class="fas fa-pen mr-1"></i>Edit
                                        </button>
                                        <button id="kebab-btn-maintenance-notes-john" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>

                            <!-- Unit Inspection Report (Attachment) -->
                            <tr class="document-item hover:bg-gray-50" data-category="attachments" data-type="attachment">
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-paperclip text-gray-600"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="font-medium">
                                                <a href="#" class="text-blue-600 hover:text-blue-800">Unit Inspection Report</a>
                                            </div>
                                            <div class="text-sm text-gray-500">PDF • Uploaded Jan 10, 2024</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">Angela Johnson</span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="text-gray-600">
                                        Additional lease document
                                        </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        Uploaded
                                    </span>
                                </td>
                                <td class="px-6 py-3 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-1">
                                        <button class="btn btn-light btn-sm" onclick="editAttachmentDocument('Unit Inspection Report', 'Additional Lease Document', false)">
                                            <i class="fas fa-pen mr-1"></i>Edit
                                        </button>
                                        <button id="kebab-btn-inspection-report-angela" class="btn btn-light btn-sm kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

            <!-- Ledger View (Hidden by default) -->
            <div id="ledger-view" class="container py-6 mx-auto" style="display: none;">
                
                <!-- Page Title -->
                <div class="mb-6 flex items-center justify-between">
                    <h1 class="text-2xl font-semibold ">Ledger</h1>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                        ⏳ Pending
                                    </span>
                                    <button class="btn btn-light btn-sm">Upload for resident</button>
                                    <button class="btn btn-light btn-sm">Remind</button>
        </div>

        </main>
    </div>


    <script>
        // Handle Create Proposal button - Global function
        function handleCreateProposal() {
            alert('Create Lease Proposal:\n\n• Review current lease terms\n• Check market rent rates\n• Generate renewal proposal\n• Calculate new rent amount\n• Prepare proposal documents\n• Schedule tenant meeting');
        }

        // Toggle additional charges visibility - Global function
        function toggleAdditionalCharges() {
            const additionalCharges = document.querySelectorAll('.additional-charge');
            const showMoreText = document.getElementById('show-more-text');
            const showMoreIcon = document.getElementById('show-more-icon');
            
            const isHidden = additionalCharges[0].style.display === 'none';
            
            additionalCharges.forEach(charge => {
                charge.style.display = isHidden ? 'block' : 'none';
            });
            
            if (isHidden) {
                showMoreText.textContent = 'Show less';
                showMoreIcon.classList.remove('fa-chevron-down');
                showMoreIcon.classList.add('fa-chevron-up');
            } else {
                showMoreText.textContent = 'Show 2 more charges';
                showMoreIcon.classList.remove('fa-chevron-up');
                showMoreIcon.classList.add('fa-chevron-down');
            }
        }

        // Toggle inactive renewal visibility
        function toggleInactiveRenewal() {
            const inactiveRenewalAlert = document.getElementById('inactive-renewal-alert');
            const toggleText = document.getElementById('toggle-inactive-text');
            const toggleIcon = document.getElementById('toggle-inactive-icon');
            
            if (inactiveRenewalAlert && toggleText && toggleIcon) {
                const isHidden = inactiveRenewalAlert.style.display === 'none';
                
                if (isHidden) {
                    // Show the cancelled renewal offer
                    inactiveRenewalAlert.style.display = 'block';
                    toggleText.textContent = 'Hide cancelled renewal offer';
                    toggleIcon.classList.remove('fa-chevron-down');
                    toggleIcon.classList.add('fa-chevron-up');
                } else {
                    // Hide the cancelled renewal offer
                    inactiveRenewalAlert.style.display = 'none';
                    toggleText.textContent = 'Show cancelled renewal offer';
                    toggleIcon.classList.remove('fa-chevron-up');
                    toggleIcon.classList.add('fa-chevron-down');
                }
            }
        }

        
        // Documents filtering variables - Global scope
        let documentsCurrentSort = {
            column: 'status',
            direction: 'desc'
        };
        let documentsCurrentFilter = 'all';
        let documentsTableInitialized = false;

        // Documents filter function - Global function
        function setDocumentsFilter(filter) {
            // Remove active class from all tab filters
            document.querySelectorAll('#documents-view .tab-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to selected filter
            document.getElementById('doc-filter-' + filter).classList.add('active');
            
            // Update current filter
            documentsCurrentFilter = filter;
            
            // Apply filter
            filterDocuments();
        }

        // Documents search and filter function - Global function
        function filterDocuments() {
            const searchTerm = document.getElementById('documents-search').value.toLowerCase();
            
            // Get all document items
            const documentItems = document.querySelectorAll('.document-item');
            
            // Filter items based on category and search term
            documentItems.forEach(item => {
                const category = item.getAttribute('data-category');
                const text = item.textContent.toLowerCase();
                
                // Check if item matches current filter
                let showByCategory = false;
                if (documentsCurrentFilter === 'all') {
                    showByCategory = true;
                } else if (documentsCurrentFilter === 'signature' && category === 'signature') {
                    showByCategory = true;
                } else if (documentsCurrentFilter === 'upload' && category === 'upload') {
                    showByCategory = true;
                } else if (documentsCurrentFilter === 'attachments' && category === 'attachments') {
                    showByCategory = true;
                }
                
                // Check if item matches search term
                let showBySearch = true;
                if (searchTerm && !text.includes(searchTerm)) {
                    showBySearch = false;
                }
                
                // Show/hide item based on both filters
                if (showByCategory && showBySearch) {
                    item.style.display = 'table-row';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Show/hide attachment upload widget based on filter
            const uploadWidget = document.getElementById('attachment-upload-widget');
            if (uploadWidget) {
                if (documentsCurrentFilter === 'attachments') {
                    uploadWidget.style.display = 'block';
                } else {
                    uploadWidget.style.display = 'none';
                }
            }
        }

        // Documents sorting function - Global function
        function sortDocumentsTable(column) {
            // Determine sort direction
            if (documentsCurrentSort.column === column) {
                documentsCurrentSort.direction = documentsCurrentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                documentsCurrentSort.direction = 'asc';
            }
            documentsCurrentSort.column = column;
            
            // Update sort icons
            updateDocumentsSortIcons(column, documentsCurrentSort.direction);
            
            // Get table body and rows
            const tbody = document.querySelector('#documents-sections tbody');
            if (!tbody) return;
            
            const rows = Array.from(tbody.querySelectorAll('.document-item'));
            
            // Define status priority order for sorting
            const statusPriority = {
                'pending signature': 1,
                'pending upload': 2,
                'processing': 3,
                'signed': 4,
                'not uploaded': 5,
                'uploaded': 6
            };
            
            // Sort rows based on column
            rows.sort((a, b) => {
                let aValue, bValue;
                
                switch(column) {
                    case 'document':
                        aValue = a.querySelector('td:nth-child(1)').textContent.trim().toLowerCase();
                        bValue = b.querySelector('td:nth-child(1)').textContent.trim().toLowerCase();
                        break;
                    case 'type':
                        aValue = a.querySelector('td:nth-child(2)').textContent.trim().toLowerCase();
                        bValue = b.querySelector('td:nth-child(2)').textContent.trim().toLowerCase();
                        break;
                    case 'status':
                        // Get status badge text
                        const aStatusElement = a.querySelector('td:nth-child(3) .rounded-full');
                        const bStatusElement = b.querySelector('td:nth-child(3) .rounded-full');
                        
                        aValue = aStatusElement ? aStatusElement.textContent.trim().toLowerCase() : '';
                        bValue = bStatusElement ? bStatusElement.textContent.trim().toLowerCase() : '';
                        
                        // Use priority order for status
                        const aPriority = statusPriority[aValue] || 999;
                        const bPriority = statusPriority[bValue] || 999;
                        
                        if (documentsCurrentSort.direction === 'asc') {
                            return aPriority - bPriority;
                        } else {
                            return bPriority - aPriority;
                        }
                }
                
                // Standard string comparison for other columns
                if (documentsCurrentSort.direction === 'asc') {
                    return aValue.localeCompare(bValue);
                } else {
                    return bValue.localeCompare(aValue);
                }
            });
            
            // Clear tbody and append sorted rows
            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
        }

        // Update documents sort icons - Global function
        function updateDocumentsSortIcons(activeColumn, direction) {
            // Reset all icons to default state
            const allIcons = document.querySelectorAll('#documents-sections .sortable i');
            allIcons.forEach(icon => {
                icon.className = 'fas fa-sort text-sm text-gray-400';
            });
            
            // Update active column icon
            const activeIcon = document.getElementById(`sort-${activeColumn}-icon`);
            if (activeIcon) {
                if (direction === 'asc') {
                    activeIcon.className = 'fas fa-sort-up text-sm text-blue-600';
                } else {
                    activeIcon.className = 'fas fa-sort-down text-sm text-blue-600';
                }
            }
        }

        // Initialize documents table with default sort
        function initializeDocumentsSort() {
            // Sort by status priority order on initial load
            sortDocumentsTable('status');
        }

        // Document kebab menu functionality
        function toggleDocumentKebab(button, event) {
            console.log('toggleDocumentKebab function called with button:', button);
            
            // Prevent event bubbling
            if (event) {
                event.stopPropagation();
                event.preventDefault();
                console.log('Event prevented');
            }
            
            // Find the dropdown within the same relative container
            const container = button.parentElement;
            console.log('Container:', container);
            const dropdown = container.querySelector('.kebab-dropdown');
            console.log('Dropdown found:', dropdown);
            
            if (!dropdown) {
                console.error('No dropdown found in container');
                return;
            }
            
            // Close all other dropdowns first
            const allDropdowns = document.querySelectorAll('.kebab-dropdown');
            console.log('Total dropdowns found:', allDropdowns.length);
            allDropdowns.forEach(dd => {
                if (dd !== dropdown) {
                    dd.classList.add('hidden');
                }
            });
            
            // Toggle this dropdown
            const isHidden = dropdown.classList.contains('hidden');
            console.log('Dropdown is currently hidden:', isHidden);
            
            if (isHidden) {
                dropdown.classList.remove('hidden');
                console.log('Dropdown opened - classes:', dropdown.className);
            } else {
                dropdown.classList.add('hidden');
                console.log('Dropdown closed - classes:', dropdown.className);
            }
        }

        // Initialize document kebab menus
        document.addEventListener('DOMContentLoaded', function() {
            // Add click listeners to all kebab menu buttons
            document.querySelectorAll('.kebab-menu').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    
                    console.log('Kebab menu clicked via event listener');
                    
                    // Find the dropdown within the same relative container
                    const container = this.parentElement;
                    const dropdown = container.querySelector('.kebab-dropdown');
                    
                    if (!dropdown) {
                        console.error('No dropdown found in container');
                        return;
                    }
                    
                    // Close all other dropdowns first
                    document.querySelectorAll('.kebab-dropdown').forEach(dd => {
                        if (dd !== dropdown) {
                            dd.classList.add('hidden');
                        }
                    });
                    
                    // Toggle this dropdown
                    dropdown.classList.toggle('hidden');
                    console.log('Dropdown toggled, hidden:', dropdown.classList.contains('hidden'));
                });
            });
            
            // Close document kebab menus when clicking outside
            document.addEventListener('click', function(e) {
                try {
                    // Check if click is outside kebab menu and dropdown
                    if (!e.target.closest('.kebab-menu') && !e.target.closest('.kebab-dropdown')) {
                        document.querySelectorAll('.kebab-dropdown').forEach(dropdown => {
                            dropdown.classList.add('hidden');
                        });
                    }
                } catch (error) {
                    console.warn('Error in document kebab click handler:', error);
                }
            });
        });

        // Delete document function - Global function
        function deleteDocument(documentId) {
            // Show confirmation dialog
            const confirmed = confirm('Are you sure you want to delete this document? This action cannot be undone.');
            
            if (!confirmed) {
                return;
            }

            // Find and remove the document row
            const documentRows = document.querySelectorAll('.document-item');
            documentRows.forEach(row => {
                const deleteButton = row.querySelector(`button[onclick*="${documentId}"]`);
                if (deleteButton) {
                    // Add fade-out animation
                    row.style.transition = 'opacity 0.3s ease-out';
                    row.style.opacity = '0';
                    
                    // Remove the row after animation
                    setTimeout(() => {
                        row.remove();
                        // Show success message
                        alert('Document deleted successfully!');
                    }, 300);
                }
            });
        }
        
        // Toggle Past Roommates expanded view - Global function
        function togglePastRoommatesExpanded() {
            const summaryView = document.getElementById('past-roommates-summary');
            const expandedView = document.getElementById('past-roommates-expanded');
            const toggleText = document.getElementById('past-roommates-toggle-text');
            const chevron = document.getElementById('past-roommates-chevron');

            if (summaryView && expandedView && toggleText && chevron) {
                if (expandedView.style.display === 'none' || !expandedView.style.display) {
                    expandedView.style.display = 'block';
                    summaryView.style.display = 'none';
                    toggleText.textContent = 'Less details';
                    chevron.style.transform = 'rotate(180deg)';
                } else {
                    expandedView.style.display = 'none';
                    summaryView.style.display = 'block';
                    toggleText.textContent = 'More details';
                    chevron.style.transform = 'rotate(0deg)';
                }
            }
        }

        // Toggle Current Roommates expanded view - Global function
        function toggleCurrentRoommatesExpanded() {
            const summaryView = document.getElementById('current-roommates-summary');
            const expandedView = document.getElementById('current-roommates-expanded');
            const toggleText = document.getElementById('current-roommates-toggle-text');
            const chevron = document.getElementById('current-roommates-chevron');

            if (summaryView && expandedView && toggleText && chevron) {
                if (expandedView.style.display === 'none' || !expandedView.style.display) {
                    expandedView.style.display = 'block';
                    summaryView.style.display = 'none';
                    toggleText.textContent = 'Less details';
                    chevron.style.transform = 'rotate(180deg)';
                } else {
                    expandedView.style.display = 'none';
                    summaryView.style.display = 'block';
                    toggleText.textContent = 'More details';
                    chevron.style.transform = 'rotate(0deg)';
                }
            }
        }

        // View switching functionality
        function toggleView(viewName) {
            const overviewView = document.getElementById('overview-view');
            const leaseInfoView = document.getElementById('lease-info-2-view');
            const ledgerView = document.getElementById('ledger-view');
            const documentsView = document.getElementById('documents-view');
            const overviewMenu = document.getElementById('overview-menu');
            const ledgerMenu = document.getElementById('ledger-menu');
            const documentsMenu = document.getElementById('documents-menu');
            
            // Hide all views
            overviewView.style.display = 'none';
            leaseInfoView.style.display = 'none';
            ledgerView.style.display = 'none';
            documentsView.style.display = 'none';
            
            // Remove active state from all menus
            overviewMenu.classList.remove('active');
            ledgerMenu.classList.remove('active');
            documentsMenu.classList.remove('active');
            
            // Show selected view and activate corresponding menu
            if (viewName === 'overview') {
                overviewView.style.display = 'block';
                overviewMenu.classList.add('active');
            } else if (viewName === 'lease-info') {
                leaseInfoView.style.display = 'block';
            } else if (viewName === 'ledger') {
                ledgerView.style.display = 'block';
                ledgerMenu.classList.add('active');
            } else if (viewName === 'documents') {
                documentsView.style.display = 'block';
                documentsMenu.classList.add('active');
                
                // Initialize documents table sorting on first load
                if (!documentsTableInitialized) {
                    initializeDocumentsSort();
                    documentsTableInitialized = true;
                }
            }
        }

        // DOMContentLoaded event handlers
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize activity timeline features
            initializeActivityTimeline();
            
            // Load saved activities from local storage
            // loadSavedActivities(); // Commented out to avoid duplicating existing activities on page reload
            
            // Keyboard shortcuts for modals
            document.addEventListener('keydown', function(e) {
                // ESC key to close modals
                if (e.key === 'Escape') {
                    closeActivityModal();
                }
                
                // Ctrl+Enter or Cmd+Enter to save activity in modal
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    const modal = document.getElementById('activity-modal');
                    if (modal) {
                        const saveButton = modal.querySelector('.btn-primary');
                        if (saveButton && !saveButton.disabled) {
                            saveButton.click();
                        }
                    }
                }
            });
            
            // Click outside modal to close
            document.addEventListener('click', function(e) {
                try {
                    // Check if clicking outside activity modal
                    const modal = document.getElementById('activity-modal');
                    if (modal && e.target === modal) {
                        closeActivityModal();
                    }
                    
                    // Check if clicking outside activity add menu
                    const addMenu = document.getElementById('activity-add-menu');
                    const addButton = document.querySelector('.activity-add-btn');
                    if (addMenu && addButton && !addMenu.contains(e.target) && !addButton.contains(e.target)) {
                        addMenu.style.display = 'none';
                    }
                } catch (error) {
                    console.warn('Error in activity modal click handler:', error);
                }
            });
        });

        // Additional functions from activity timeline system
        function addActivityType(type) {
            showActivityModal(type);
        }

        function showActivityModal(type) {
            // Modal creation code would go here
            // For now, just show an alert
            alert('Add ' + type + ' activity');
        }

        function closeActivityModal() {
            const modal = document.getElementById('activity-modal');
            if (modal) {
                modal.remove();
            }
        }

        function initializeActivityTimeline() {
            // Initialize activity timeline functionality
            console.log('Activity timeline initialized');
        }

    </script>

</body>
</html>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="font-medium">Upload Document</div>
                                </td>
                                <td class="px-6 py-3">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">
                                        <i class="fas fa-exclamation w-3 h-3 mr-1"></i>
                                        Required
                                    </span>
                                </td>
                                <td class="px-6 py-3 text-sm text-muted">
                                    -
                                </td>
                                <td class="px-6 py-3">
                                    <div class="flex items-center space-x-2">
                                        <span class="tooltip-black">
                                            <button class="btn btn-primary">
                                                <i class="fas fa-upload"></i>
                                            </button>
                                            <span class="tooltip-text">Request Upload</span>
                                        </span>
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-bell"></i>
                                            </button>
                                            <span class="tooltip-text">Send Reminder</span>
                                        </span>
                                    </div>
                                </td>
                            </tr>

                            <!-- Bank Statement - John (Missing) -->
                            <tr class="hover:bg-gray-50" data-category="upload">
                                <td class="px-6 py-3">
                                    <div class="font-medium">Bank Statement</div>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="font-medium">John Smith</div>
                                    <div class="text-sm text-muted">Roommate</div>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="font-medium">Upload Document</div>
                                </td>
                                <td class="px-6 py-3">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">
                                        <i class="fas fa-exclamation w-3 h-3 mr-1"></i>
                                        Required
                                    </span>
                                </td>
                                <td class="px-6 py-3 text-sm text-muted">
                                    -
                                </td>
                                <td class="px-6 py-3">
                                    <div class="flex items-center space-x-2">
                                        <span class="tooltip-black">
                                            <button class="btn btn-primary">
                                                <i class="fas fa-upload"></i>
                                            </button>
                                            <span class="tooltip-text">Request Upload</span>
                                        </span>
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-bell"></i>
                                            </button>
                                            <span class="tooltip-text">Send Reminder</span>
                                        </span>
                                    </div>
                                </td>
                            </tr>

                            <!-- ID Copy - Brent (Completed) -->
                            <tr class="hover:bg-gray-50" data-category="upload">
                                <td class="px-6 py-3">
                                    <a href="#" class="font-medium">Driver's License Copy</a>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="font-medium">Melinda Michaels</div>
                                    <div class="text-sm text-muted">Primary Resident</div>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="font-medium">Upload Document</div>
                                </td>
                                <td class="px-6 py-3">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                        <i class="fas fa-check w-3 h-3 mr-1"></i>
                                        Uploaded
                                    </span>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="text-sm">Aug 15, 2024</div>
                                    <div class="text-muted text-sm">By Resident</div>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="flex items-center space-x-2">
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <span class="tooltip-text">View</span>
                                        </span>
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-download"></i>
                                            </button>
                                            <span class="tooltip-text">Download</span>
                                        </span>
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-sync-alt"></i>
                                            </button>
                                            <span class="tooltip-text">Replace</span>
                                        </span>
                                    </div>
                                </td>
                            </tr>

                            <!-- ATTACHMENTS -->

                            <!-- Insurance Certificate (Completed) -->
                            <tr class="hover:bg-gray-50" data-category="attachments">
                                <td class="px-6 py-3">
                                    <a href="#" class="font-medium">Renter's Insurance Certificate</a>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="font-medium">John Smith</div>
                                    <div class="text-sm text-muted">Roommate</div>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="font-medium">Attachment</div>
                                </td>
                                <td class="px-6 py-3">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                        <i class="fas fa-paperclip w-3 h-3 mr-1"></i>
                                        Attached
                                    </span>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="text-sm">Oct 15, 2024</div>
                                    <div class="text-muted text-sm">Property Manager</div>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="flex items-center space-x-2">
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <span class="tooltip-text">View</span>
                                        </span>
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-download"></i>
                                            </button>
                                            <span class="tooltip-text">Download</span>
                                        </span>
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-user-tag"></i>
                                            </button>
                                            <span class="tooltip-text">Reassign</span>
                                        </span>
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                            <span class="tooltip-text">Delete</span>
                                        </span>
                                    </div>
                                </td>
                            </tr>

                            <!-- Pet Documentation (Completed) -->
                            <tr class="hover:bg-gray-50" data-category="attachments">
                                <td class="px-6 py-3">
                                    <a href="#" class="font-medium">Pet Vaccination Records</a>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="font-medium">Angela Johnson</div>
                                    <div class="text-sm text-muted">Roommate</div>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="font-medium">Attachment</div>
                                </td>
                                <td class="px-6 py-3">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                        <i class="fas fa-paperclip w-3 h-3 mr-1"></i>
                                        Attached
                                    </span>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="text-sm">Sep 10, 2024</div>
                                    <div class="text-muted text-sm">Property Manager</div>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="flex items-center space-x-2">
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <span class="tooltip-text">View</span>
                                        </span>
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-download"></i>
                                            </button>
                                            <span class="tooltip-text">Download</span>
                                        </span>
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-user-tag"></i>
                                            </button>
                                            <span class="tooltip-text">Reassign</span>
                                        </span>
                                        <span class="tooltip-black">
                                            <button class="btn btn-light">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                            <span class="tooltip-text">Delete</span>
                                        </span>
                                    </div>
                                </td>
                            </tr>

                            <!-- Lease Addendum (Completed) -->
                            <tr class="hover:bg-gray-50" data-category="attachments">
                                <td class="px-6 py-3">
                                    <a href="#" class="font-medium">Parking Agreement Addendum</a>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="font-medium">Melinda Michaels</div>
                                    <div class="text-sm text-muted">Primary Resident</div>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="font-medium">Attachment</div>
                                </td>
                                <td class="px-6 py-3">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                        <i class="fas fa-paperclip w-3 h-3 mr-1"></i>
                                        Attached
                                    </span>
                                </td>
                                <td class="px-6 py-3">
                                    <div class="text-sm">Aug 30, 2024</div>
                                    <div class="text-muted text-sm">Property Manager</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </div>

        </div>

        </main>
    </div>

    <!-- Outstanding Balance Pageslide -->
    <div class="pageslide-overlay" id="outstanding-balance-overlay">
        <div class="pageslide" id="outstanding-balance">
            <div class="pageslide-header">
                <div class="flex items-start justify-between w-full">
                    <div class="flex items-start gap-2">
                        <div>
                            <h2 class="pageslide-title  font-semibold text-lg mb-1">Outstanding balance</h2>
                                                    <div class="text-muted">
                            <span class="font-medium">$2,809.50 outstanding</span>
							<span class="text-gray-400 mx-1">•</span>
                                <span class="text-red-600 font-medium">3 past due</span>
							<span class="text-gray-400 mx-1">•</span>
                            <span class="font-medium">2 current</span>
                            <span class="text-gray-400 mx-1">•</span>
                            <span class="font-medium text-yellow-600">1 processing</span>
							<span class="text-gray-400">•</span>
							<i class="fas fa-warning text-red-500"></i><span class="text-red-600 font-medium ml-1">Do not accept payment</span>
                        </div>
                        </div>
                    </div>
                </div>
                <button class="pageslide-close" onclick="closePageslide('outstanding-balance-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <div class="search-container mb-6">
                    <div class="flex items-center gap-3">
                        <!-- Search Field -->
                        <div class="relative flex-1">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input 
                                type="text" 
                                placeholder="Search charges..." 
                                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus-ring-primary"
                            >
                    </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex items-center gap-2">
                            <button class="btn btn-light">
                                <i class="fas fa-credit-card mr-1"></i>
                                Receive payment
                            </button>
                            
                            <button id="kebab-btn-charges" class="btn btn-light kebab-menu">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Pending Payments Section -->
                <div class="pending-payments-section mb-8">
                    <h3 class="section-title mb-0">Processing payments</h3>
                    <p class="text-sm text-muted mb-4">Payments received within 24 hours, not yet posted.</p>
                    
                    <div class="charge-item p-2 rounded-lg shadow-sm" style="border-left: 4px solid #f0c479;">
                        <div class="flex items-center justify-between">
                            <!-- Left Side -->
                            <div class="flex-1">
                                <h4 class="text-base font-semibold  mb-1">Online Payment - Covers July Past Due</h4>
                                <div class="flex items-center gap-3 mb-2">
                                    <span class="font-medium">Today</span>
                                    <span class="text-sm font-mono text-grey-600 bg-gray-100 px-2 py-1 rounded">onlinepay</span>
                                </div>
                            </div>
                            
                            <!-- Right Side -->
                            <div class="flex flex-col items-end gap-2">
                                <div class="text-lg font-bold">-$1,337.25</div>
                                <div class="flex items-center gap-3">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">Processing</span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-3">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-clock text-orange-500"></i>
                                <span class="text-muted">Expected to post within 1-2 business days (covers all past due amounts)</span>
                                </div>
                            </div>
                            </div>
                        </div>

				
                <div class="balance-list-container">
                    <h3 class="section-title mb-0">Outstanding charges</h3>
                    
                    <!-- Balanced List View -->
                    <div class="charges-list-container space-y-4">
                        <!-- Past Due Charges -->
                        <div class="charge-item p-3 bg-white border border-gray-200 rounded-lg shadow-sm" style="border-left: 4px solid #ef4444;">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <h4 class="text-base font-semibold  mb-1">Rent (Residential) - July 2025</h4>
									<div class="flex items-center gap-3 mb-2">
                                        <span class="text-muted font-medium">Jul 1, 2025</span>
										<span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">rentres</span>
                                </div>
                                    <div class="text-sm text-muted">Tenant portion after HAP subsidy ($692.75)</div>
                            </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold ">$1,337.25</div>
                                    <div class="flex items-center gap-3">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">past due</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="charge-item p-2 bg-white border border-gray-200 rounded-lg shadow-sm" style="border-left: 4px solid #ef4444;">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <h4 class="text-base font-semibold  mb-1">Pet Fee - Monthly (Luna & Whiskers)</h4>
									<div class="flex items-center gap-3">
                                        <span class="text-muted font-medium">Jul 15, 2025</span>
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">petfee</span>
                                </div>
                            </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold ">$30.00</div>
                                    <div class="flex items-center gap-3">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">past due</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Late Fee -->
                        <div class="charge-item p-2 bg-white border border-gray-200 rounded-lg shadow-sm" style="border-left: 4px solid #ef4444;">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <h4 class="text-base font-semibold  mb-1">Late Fee - Rent (July 2025)</h4>
									<div class="flex items-center gap-3">
                                        <span class="text-muted font-medium">Aug 17, 2025</span>
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">latefee</span>
                                </div>
                            </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold ">$75.00</div>
                                    <div class="flex items-center gap-3">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">past due</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Current Outstanding Charges -->
                        <div class="charge-item p-2 bg-white border border-gray-200 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
									<h4 class="text-base font-semibold  mb-1">Rent (Residential) - August 2025</h4>
                                    <div class="flex items-center gap-3">
                                        <span class="text-muted font-medium">Aug 1, 2025</span>
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">rentres</span>
                                </div>
                                    <div class="text-sm text-muted">Tenant portion after HAP subsidy ($692.75)</div>
                            </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold ">$1,337.25</div>
                                </div>
                            </div>
                        </div>

                        <div class="charge-item p-2 bg-white border border-gray-200 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <h4 class="text-base font-semibold  mb-1">Pet Fee - Monthly (Luna & Whiskers)</h4>
                                    <div class="flex items-center gap-3">
                                        <span class="text-muted font-medium">Aug 15, 2025</span>
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">petfee</span>
                    </div>
                </div>

                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold ">$30.00</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Resident Timeline Pageslide -->
    <div class="pageslide-overlay" id="resident-timeline-overlay">
        <div class="pageslide" id="resident-timeline">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Resident timeline</h2>
                <button class="pageslide-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <div class="timeline-summary">
                    <div class="timeline-total">
                        <span class="total-label">Total Residency Duration</span>
                        <span class="total-amount">4.2 years</span>
                    </div>
                    <div class="timeline-status">
                        <span>Excellent resident with strong payment history</span>
                    </div>
                </div>

                <div class="timeline-list-container">
                    <h3 class="section-title">Residency Timeline</h3>
                    
                    <div class="timeline-list">
                        <div class="timeline-item scheduled">
                            <div class="timeline-point scheduled">
                                <i class="fas fa-calendar-times"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-date">Oct 31, 2025</span>
                                    <span class="timeline-status-badge scheduled">scheduled</span>
                                </div>
                                <div class="timeline-title">Lease Expires</div>
                                <div class="timeline-description">Current lease agreement expires</div>
                                <div class="timeline-meta">Lease renewal or move-out decision required</div>
                            </div>
                        </div>

                        <div class="timeline-item current">
                            <div class="timeline-point current">
                                <i class="fas fa-home"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-date">May 15, 2021</span>
                                    <span class="timeline-inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">current</span>
                                </div>
                                <div class="timeline-title">Move In</div>
                                <div class="timeline-description">Started residency at Cityview Towers</div>
                                <div class="timeline-meta">Initial Term: 12 months • Monthly Rent: $1,950.00</div>
                            </div>
                        </div>

                        <div class="timeline-item completed">
                            <div class="timeline-point completed">
                                <i class="fas fa-file-signature"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-date">May 10, 2021</span>
                                    <span class="timeline-status-badge completed">completed</span>
                                </div>
                                <div class="timeline-title">Lease Executed</div>
                                <div class="timeline-description">Signed initial lease agreement for Unit 303C</div>
                                <div class="timeline-meta">Lease Start: May 15, 2021 • Security Deposit: $1,950.00</div>
                            </div>
                        </div>

                        <div class="timeline-item completed">
                            <div class="timeline-point completed">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-date">Apr 25, 2021</span>
                                    <span class="timeline-status-badge completed">completed</span>
                                </div>
                                <div class="timeline-title">Prospect Approved</div>
                                <div class="timeline-description">Rental application approved after background check</div>
                                <div class="timeline-meta">Credit Score: 750 • Income Verification: Approved</div>
                            </div>
                        </div>
                    </div>
                </div>



                <div class="timeline-notes">
                    <h3 class="section-title">Residency Notes</h3>
                    <div class="note-item">
                        <strong>Payment History:</strong> Consistently pays on time, never had late fees
                    </div>
                    <div class="note-item">
                        <strong>Lease Renewals:</strong> Renewed lease 4 times without issues
                    </div>
                    <div class="note-item">
                        <strong>Next Milestone:</strong> Current lease expires October 31, 2025 - renewal decision needed
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment History Pageslide -->
    <div class="pageslide-overlay" id="payment-history-overlay">
        <div class="pageslide" id="payment-history">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Payment history</h2>
                <button class="pageslide-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <div class="payment-summary">
                    <div class="payment-total">
                        <span class="total-label">Payment Performance</span>
                        <span class="total-amount">98% On-Time</span>
                    </div>
                    <div class="payment-status">
                        <span>Showing 2 most recent payments - excellent payment history with 2 late payments out of 51 total</span>
                    </div>
                </div>

                <div class="payment-list-container">
                    <h3 class="section-title">Recent Payment Activity</h3>
                    
                    <div class="payment-list">
                        <div class="payment-item">
                            <div class="payment-item-header">
                                <span class="payment-date">Jun 30, 2025</span>
                                <div class="payment-header-right">
                                    <span class="payment-balance">$2,126.60</span>
                                </div>
                            </div>
                            <div class="payment-item-details">
                                <div class="payment-description">Payment Received - Check #1234</div>
                                <div class="payment-meta">
                                    <span class="payment-code">chk# 1234</span>
                                    <span class="payment-control">R-140811</span>
                                </div>
                            </div>
                        </div>

                        <div class="payment-item">
                            <div class="payment-item-header">
                                <span class="payment-date">May 30, 2025</span>
                                <div class="payment-header-right">
                                    <span class="payment-balance">$1,890.50</span>
                                </div>
                            </div>
                            <div class="payment-item-details">
                                <div class="payment-description">Payment Received - Online Payment</div>
                                <div class="payment-meta">
                                    <span class="payment-code">ACH Transfer</span>
                                    <span class="payment-control">R-139842</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="payment-quick-actions">
                    <button class="payment-quick-btn">
                        <i class="fas fa-print"></i>
                        <span>Print</span>
                    </button>
                    <button class="payment-quick-btn">
                        <i class="fas fa-envelope"></i>
                        <span>Email</span>
                    </button>
                </div>

                <div class="payment-actions">
                    <button class="payment-action-btn primary">
                        <i class="fas fa-credit-card"></i>
                        <span>Receive Payment</span>
                    </button>
                    <button class="payment-action-btn secondary">
                        <i class="fas fa-download"></i>
                        <span>Export Payment History</span>
                    </button>
                </div>

                <div class="payment-notes">
                    <h3 class="section-title">Payment Notes</h3>
                    <div class="note-item">
                        <strong>Payment Method:</strong> Usually pays by check, occasionally online
                    </div>
                    <div class="note-item">
                        <strong>On-Time Rate:</strong> 98% - only 2 late payments in 4.2 years
                    </div>
                    <div class="note-item">
                        <strong>Current Status:</strong> Outstanding balance of $2,809.50 - positive payment history overall
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Journey Pageslide -->
    <div class="pageslide-overlay" id="customer-journey-overlay">
        <div class="pageslide customer-journey">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Customer journey</h2>
                <button class="pageslide-close" onclick="closePageslide('customer-journey')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <!-- Journey Summary -->
                <div class="journey-summary-section">
                    <div class="journey-overview">
                        <div class="journey-stats">
                            <div class="journey-stat">
                                <span class="stat-number">4</span>
                                <span class="stat-label">Properties</span>
                            </div>
                            <div class="journey-stat">
                                <span class="stat-number">4.2</span>
                                <span class="stat-label">Years Active</span>
                            </div>
                            <div class="journey-stat">
                                <span class="stat-number">98%</span>
                                <span class="stat-label">On-Time Rate</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Property History -->
                <div class="journey-history">
                    <h3 class="section-title">Property History</h3>
                    <div class="journey-timeline">
                        <div class="journey-item detailed">
                            <div class="journey-point current"></div>
                            <div class="journey-content">
                                <div class="journey-header">
                                    <span class="journey-property">Cityview Towers</span>
                                    <span class="journey-status current-status">current resident</span>
                                </div>
                                <div class="journey-details">
                                    <div class="journey-date">2025 - Present</div>
                                    <div class="journey-meta">
                                        <span class="unit-info">Unit: 303C</span>
                                        <span class="lease-info">Month to month lease</span>
                                    </div>
                                    <div class="journey-notes">
                                        Current resident with outstanding balance. Generally reliable payment history.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="journey-item detailed">
                            <div class="journey-point prospect"></div>
                            <div class="journey-content">
                                <div class="journey-header">
                                    <span class="journey-property">Pacific Oaks</span>
                                    <span class="journey-status prospect-status">Prospect</span>
                                </div>
                                <div class="journey-details">
                                    <div class="journey-date">2023</div>
                                    <div class="journey-meta">
                                        <span class="unit-info">Inquired about 1BR units</span>
                                    </div>
                                    <div class="journey-notes">
                                        Applied but decided not to proceed with lease.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="journey-item detailed">
                            <div class="journey-point prospect"></div>
                            <div class="journey-content">
                                <div class="journey-header">
                                    <span class="journey-property">Sumida Gardens</span>
                                    <span class="journey-status prospect-status">Prospect</span>
                                </div>
                                <div class="journey-details">
                                    <div class="journey-date">2022</div>
                                    <div class="journey-meta">
                                        <span class="unit-info">Inquired about 2BR units</span>
                                    </div>
                                    <div class="journey-notes">
                                        Completed application but was not approved due to credit score.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="journey-item detailed">
                            <div class="journey-point former"></div>
                            <div class="journey-content">
                                <div class="journey-header">
                                    <span class="journey-property">Gardenview Terrace</span>
                                    <span class="journey-status resident-status">Former Resident</span>
                                </div>
                                <div class="journey-details">
                                    <div class="journey-date">2019 - 2022</div>
                                    <div class="journey-meta">
                                        <span class="unit-info">Unit: 204A</span>
                                        <span class="lease-info">3-year lease term</span>
                                    </div>
                                    <div class="journey-notes">
                                        Excellent resident history. Left in good standing after lease completion.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Edit Pageslide -->
    <div class="pageslide-overlay" id="contact-edit-overlay">
        <div class="pageslide contact-edit">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Edit resident information</h2>
                <button class="pageslide-close" onclick="closePageslide('contact-edit-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <form class="contact-edit-form">
                    <!-- Contact Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Contact information</h3>
                        
                        <div class="form-row ml-0">
                            <label class="form-label">Preferred name</label>
                            <div class="form-input-group">
                                <input type="text" class="form-input" value="Mel Michaels" placeholder="Enter preferred name">
                            </div>
						</div>
                        <div class="form-row ml-0">
                            <label class="form-label">Email</label>
                            <div class="form-input-group">
                                <input type="email" class="form-input" value="kamala.hakuna@email.com" placeholder="Enter email address">
                            </div>
                            <div class="form-checkbox-group">
                                <input type="checkbox" id="unsubscribe-email" class="form-checkbox">
                                <label for="unsubscribe-email" class="form-checkbox-label">Unsubscribe from all email</label>
                            </div>
                        </div>

                        <div class="form-row ml-0">
                            <label class="form-label">Preferred contact method</label>
                            <div class="form-radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="contact-phone" name="preferred-contact" value="phone" class="form-radio">
                                    <label for="contact-phone" class="form-radio-label">Phone</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="contact-email" name="preferred-contact" value="email" class="form-radio">
                                    <label for="contact-email" class="form-radio-label">Email</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="contact-text" name="preferred-contact" value="text" class="form-radio">
                                    <label for="contact-text" class="form-radio-label">Text</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="contact-person" name="preferred-contact" value="in-person" class="form-radio">
                                    <label for="contact-person" class="form-radio-label">In-person</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="contact-none" name="preferred-contact" value="none" class="form-radio" checked>
                                    <label for="contact-none" class="form-radio-label">None</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-row-group ml-1">
                            <div class="form-row mr-md-4 ml-0">
                                <label class="form-label">Cell</label>
                                <div class="phone-input-group">
                                    <select class="country-select">
                                        <option value="US">US</option>
                                    </select>
                                    <input type="tel" class="form-input" value="(555) 123-4567" placeholder="(xxx) xxx-xxxx">
                                </div>
                            </div>
                            <div class="form-row ml-md-4 ml-0">
                                <label class="form-label">Home phone</label>
                                <div class="phone-input-group">
                                    <select class="country-select">
                                        <option value="US">US</option>
                                    </select>
                                    <input type="tel" class="form-input" placeholder="(xxx) xxx-xxxx">
                                </div>
                            </div>
                        </div>

                        <div class="form-row-group ml-1">
                            <div class="form-row mr-md-4 ml-0">
                                <label class="form-label">Office phone</label>
                                <div class="phone-input-group">
                                    <select class="country-select">
                                        <option value="US">US</option>
                                    </select>
                                    <input type="tel" class="form-input" placeholder="(xxx) xxx-xxxx">
                                </div>
                            </div>
                            <div class="form-row ml-md-4 ml-0">
                                <label class="form-label">Other phone</label>
                                <div class="phone-input-group">
                                    <select class="country-select">
                                        <option value="US">US</option>
                                    </select>
                                    <input type="tel" class="form-input" placeholder="(xxx) xxx-xxxx">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Identification Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Identification</h3>
                        
                        <div class="form-row-group ml-1">
                            <div class="form-row ml-0">
                                <label class="form-label">First name (legal)</label>
                                <input type="text" class="form-input" value="Kamala" placeholder="Enter name">
                            </div>
                            <div class="form-row ml-0">
                                <label class="form-label">Middle name (legal)</label>
                                <input type="text" class="form-input" placeholder="Enter name">
                            </div>
                            <div class="form-row ml-0">
                                <label class="form-label">Last name (legal)</label>
                                <input type="text" class="form-input" value="Hakuna" placeholder="Enter name">
                            </div>
                        </div>

                        <div class="form-row-group ml-1">
                            <div class="form-row ml-0">
                                <label class="form-label">Date of birth</label>
                                <input type="text" class="form-input" value="07/14/****" placeholder="MM/DD/YYYY">
                            </div>
                            <div class="form-row ml-0">
                                <label class="form-label">US military service member</label>
                                <select class="form-select">
                                    <option value="">Select...</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Address Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Address</h3>
                        
                        <div class="form-row-group ml-1">
                            <div class="form-row ml-0">
                            <label class="form-label">Country <span class="required">*</span></label>
                                <select class="form-select">
                                    <option value="US" selected>US (United States)</option>
                                </select>
                            </div>
                            <div class="form-row ml-0">
                            <label class="form-label">Address</label>
                            <input type="text" class="form-input" value="430 S Fairview Avenue 288 Santa Barbara, CA 93117" placeholder="Enter address">
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-light" onclick="closePageslide('contact-edit-overlay')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Lease Edit Pageslide -->
    <div class="pageslide-overlay" id="lease-edit-overlay">
        <div class="pageslide lease-edit">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Edit payment & fees</h2>
                <button class="pageslide-close" onclick="closePageslide('lease-edit-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                        <form class="lease-edit-form">
                    
                    <!-- Payment Details Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Payment details</h3>                        
                        <div class="form-row-group ml-1">
                            <div class="form-row">
                                <label class="form-label">Lease description</label>
                                <select class="form-select">
                                    <option value="">N/A</option>
                                    <option value="commercial">Commercial</option>
                                    <option value="controlled">Controlled</option>
                                    <option value="fair-market">Fair market</option>
                                    <option value="owner">Owner</option>
                                    <option value="stabilized">Stabilized</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Payment method</label>
                                <select class="form-select">
                                    <option value="any">Any</option>
                                    <option value="do-not-accept">Do not accept</option>
                                    <option value="cash-equiv">Cash equiv.</option>
                                </select>
                            </div>
                        
							<div class="form-row">
								<div class="form-row">
									<label class="form-label">Responsibility date</label>
									<input type="date" class="form-input" value="">
								</div>
							</div>
						</div>
                        
                    </div>
                    
                    <!-- Late Fees Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Late fees</h3>
                        
                        <div class="form-row-group ml-1">
                            <div class="form-row">
                                <label class="form-label">Charge late fee(s) on</label>
                                <select class="form-select">
                                    <option value="1">1st day of month</option>
                                    <option value="2">2nd day of month</option>
                                    <option value="3">3rd day of month</option>
                                    <option value="4" selected>4th day of month</option>
                                    <option value="5">5th day of month</option>
                                    <option value="6">6th day of month</option>
                                    <option value="7">7th day of month</option>
                                    <option value="8">8th day of month</option>
                                    <option value="9">9th day of month</option>
                                    <option value="10">10th day of month</option>
                                    <option value="11">11th day of month</option>
                                    <option value="12">12th day of month</option>
                                    <option value="13">13th day of month</option>
                                    <option value="14">14th day of month</option>
                                    <option value="15">15th day of month</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Minimum due to be charged</label>
                                <div class="form-input-group">
                                    <span class="form-input-prefix">$</span>
                                    <input type="number" class="form-input" value="100.00" step="0.01" min="0">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row-group ml-1">
                            <div class="form-row">
                                <label class="form-label">Maximum monthly fee</label>
                                <div class="form-input-group">
                                    <span class="form-input-prefix">$</span>
                                    <input type="number" class="form-input" value="0" step="0.01" min="0">
                                </div>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Amount type</label>
                                <select class="form-select">
                                    <option value="fixed">Fixed amount</option>
                                    <option value="percent" selected>% of Owed Total</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Monthly Fee Section -->
                        <div class="form-subsection bg-gray-50 p-3">
                            <div class="form-row">
                                <label class="form-label">Charge a monthly fee?</label>
                                <div class="form-radio-group">
                                    <div class="radio-option">
                                        <input type="radio" id="monthly-fee-yes" name="monthly-fee" value="yes" class="form-radio" checked>
                                        <label for="monthly-fee-yes" class="form-radio-label">Yes</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="monthly-fee-no" name="monthly-fee" value="no" class="form-radio">
                                        <label for="monthly-fee-no" class="form-radio-label">No</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="monthly-fee-details" class="form-row-group ml-1">
                                <div class="flex gap-4" style="display: flex !important;">
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount</label>
                                        <div class="form-input-group">
                                            <span class="form-input-prefix">$</span>
                                            <input type="number" class="form-input" value="50.00" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount type</label>
                                        <select class="form-select">
                                            <option value="flat" selected>Flat amount</option>
                                            <option value="percent">% of Owed Total</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Daily Fee Section -->
                        <div class="form-subsection bg-gray-50 p-3">
                            <div class="form-row">
                                <label class="form-label">Charge a daily fee?</label>
                                <div class="form-radio-group">
                                    <div class="radio-option">
                                        <input type="radio" id="daily-fee-yes" name="daily-fee" value="yes" class="form-radio" checked>
                                        <label for="daily-fee-yes" class="form-radio-label">Yes</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="daily-fee-no" name="daily-fee" value="no" class="form-radio">
                                        <label for="daily-fee-no" class="form-radio-label">No</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="daily-fee-details" class="form-row-group ml-1">
                                <div class="flex gap-4" style="display: flex !important;">
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount per day</label>
                                        <div class="form-input-group">
                                            <span class="form-input-prefix">$</span>
                                            <input type="number" class="form-input" value="1.00" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Maximum days</label>
                                        <div class="form-radio-group">
                                            <div class="radio-option">
                                                <input type="radio" id="max-days-unlimited" name="max-days" value="unlimited" class="form-radio" checked>
                                                <label for="max-days-unlimited" class="form-radio-label">Unlimited</label>
                                            </div>
                                            <div class="radio-option flex items-center gap-2">
                                                <input type="radio" id="max-days-limited" name="max-days" value="limited" class="form-radio">
                                                <label for="max-days-limited" class="form-radio-label" style="min-width:50px">Limit to</label>
                                                <input type="number" class="form-input" value="0" min="1" max="365" style="width: 80px;" disabled>
                                                <span class="text-sm text-gray-600">days</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Second Late Fee Section -->
                        <div class="form-subsection bg-gray-50 p-3">
                            <div class="form-row">
                                <label class="form-label">Charge a 2nd late fee?</label>
                                <div class="form-radio-group">
                                    <div class="radio-option">
                                        <input type="radio" id="second-fee-yes" name="second-fee" value="yes" class="form-radio">
                                        <label for="second-fee-yes" class="form-radio-label">Yes</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="second-fee-no" name="second-fee" value="no" class="form-radio" checked>
                                        <label for="second-fee-no" class="form-radio-label">No</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="second-fee-details" class="form-row-group ml-1" style="display: none;">
                                <div class="flex gap-4" style="display: flex !important;">
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Charge 2nd late fee on:</label>
                                        <select class="form-select">
                                            <option value="1st" selected>1st</option>
                                            <option value="2nd">2nd</option>
                                            <option value="3rd">3rd</option>
                                            <option value="4th">4th</option>
                                            <option value="5th">5th</option>
                                            <option value="10th">10th</option>
                                            <option value="15th">15th</option>
                                            <option value="30th">30th</option>
                                            <option value="day-of-month">Day of month</option>
                                        </select>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount</label>
                                        <div class="form-input-group">
                                            <span class="form-input-prefix">$</span>
                                            <input type="number" class="form-input" value="0" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount Type</label>
                                        <select class="form-select">
                                            <option value="flat">Flat Amount</option>
                                            <option value="percent" selected>% of Owed Total</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                            <!-- Form Actions -->
                            <div class="form-actions">
                                <button type="button" class="btn btn-light" onclick="closePageslide('lease-edit-overlay')">
                                    Cancel
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    Save changes
                                </button>
                            </div>
                        </form>
            </div>
        </div>
    </div>

    <!-- Late Fees Edit Pageslide -->
    <div class="pageslide-overlay" id="late-fees-edit-overlay">
        <div class="pageslide lease-edit">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Edit late fees</h2>
                <button class="pageslide-close" onclick="closePageslide('late-fees-edit-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <form class="lease-edit-form">
                    
                    <!-- Late Fees Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Late fees</h3>
                        
                        <div class="form-row-group ml-1">
                            <div class="form-row">
                                <label class="form-label">Charge late fee(s) on</label>
                                <select class="form-select">
                                    <option value="1">1st day of month</option>
                                    <option value="2">2nd day of month</option>
                                    <option value="3">3rd day of month</option>
                                    <option value="4" selected>4th day of month</option>
                                    <option value="5">5th day of month</option>
                                    <option value="6">6th day of month</option>
                                    <option value="7">7th day of month</option>
                                    <option value="8">8th day of month</option>
                                    <option value="9">9th day of month</option>
                                    <option value="10">10th day of month</option>
                                    <option value="11">11th day of month</option>
                                    <option value="12">12th day of month</option>
                                    <option value="13">13th day of month</option>
                                    <option value="14">14th day of month</option>
                                    <option value="15">15th day of month</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Minimum due to be charged</label>
                                <div class="form-input-group">
                                    <span class="form-input-prefix">$</span>
                                    <input type="number" class="form-input" value="100.00" step="0.01" min="0">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row-group ml-1">
                            <div class="form-row">
                                <label class="form-label">Maximum monthly fee</label>
                                <div class="form-input-group">
                                    <span class="form-input-prefix">$</span>
                                    <input type="number" class="form-input" value="0" step="0.01" min="0">
                                </div>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Amount type</label>
                                <select class="form-select">
                                    <option value="fixed">Fixed amount</option>
                                    <option value="percent" selected>% of Owed Total</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Monthly Fee Section -->
                        <div class="form-subsection bg-gray-50 p-3">
                            <div class="form-row">
                                <label class="form-label">Charge a monthly fee?</label>
                                <div class="form-radio-group">
                                    <div class="radio-option">
                                        <input type="radio" id="monthly-fee-yes-late" name="monthly-fee-late" value="yes" class="form-radio" checked>
                                        <label for="monthly-fee-yes-late" class="form-radio-label">Yes</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="monthly-fee-no-late" name="monthly-fee-late" value="no" class="form-radio">
                                        <label for="monthly-fee-no-late" class="form-radio-label">No</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="monthly-fee-details-late" class="form-row-group ml-1">
                                <div class="flex gap-4" style="display: flex !important;">
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount</label>
                                        <div class="form-input-group">
                                            <span class="form-input-prefix">$</span>
                                            <input type="number" class="form-input" value="50.00" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount type</label>
                                        <select class="form-select">
                                            <option value="flat" selected>Flat amount</option>
                                            <option value="percent">% of Owed Total</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Daily Fee Section -->
                        <div class="form-subsection bg-gray-50 p-3">
                            <div class="form-row">
                                <label class="form-label">Charge a daily fee?</label>
                                <div class="form-radio-group">
                                    <div class="radio-option">
                                        <input type="radio" id="daily-fee-yes-late" name="daily-fee-late" value="yes" class="form-radio" checked>
                                        <label for="daily-fee-yes-late" class="form-radio-label">Yes</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="daily-fee-no-late" name="daily-fee-late" value="no" class="form-radio">
                                        <label for="daily-fee-no-late" class="form-radio-label">No</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="daily-fee-details-late" class="form-row-group ml-1">
                                <div class="flex gap-4" style="display: flex !important;">
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount per day</label>
                                        <div class="form-input-group">
                                            <span class="form-input-prefix">$</span>
                                            <input type="number" class="form-input" value="1.00" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Maximum days</label>
                                        <div class="form-radio-group">
                                            <div class="radio-option">
                                                <input type="radio" id="max-days-unlimited-late" name="max-days-late" value="unlimited" class="form-radio" checked>
                                                <label for="max-days-unlimited-late" class="form-radio-label">Unlimited</label>
                                            </div>
                                            <div class="radio-option flex items-center gap-2">
                                                <input type="radio" id="max-days-limited-late" name="max-days-late" value="limited" class="form-radio">
                                                <label for="max-days-limited-late" class="form-radio-label" style="min-width:50px">Limit to</label>
                                                <input type="number" class="form-input" value="0" min="1" max="365" style="width: 80px;" disabled>
                                                <span class="text-sm text-gray-600">days</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Second Late Fee Section -->
                        <div class="form-subsection bg-gray-50 p-3">
                            <div class="form-row">
                                <label class="form-label">Charge a 2nd late fee?</label>
                                <div class="form-radio-group">
                                    <div class="radio-option">
                                        <input type="radio" id="second-fee-yes-late" name="second-fee-late" value="yes" class="form-radio">
                                        <label for="second-fee-yes-late" class="form-radio-label">Yes</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="second-fee-no-late" name="second-fee-late" value="no" class="form-radio" checked>
                                        <label for="second-fee-no-late" class="form-radio-label">No</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="second-fee-details-late" class="form-row-group ml-1" style="display: none;">
                                <div class="flex gap-4" style="display: flex !important;">
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Charge 2nd late fee on:</label>
                                        <select class="form-select">
                                            <option value="1st" selected>1st</option>
                                            <option value="2nd">2nd</option>
                                            <option value="3rd">3rd</option>
                                            <option value="4th">4th</option>
                                            <option value="5th">5th</option>
                                            <option value="10th">10th</option>
                                            <option value="15th">15th</option>
                                            <option value="30th">30th</option>
                                            <option value="day-of-month">Day of month</option>
                                        </select>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount</label>
                                        <div class="form-input-group">
                                            <span class="form-input-prefix">$</span>
                                            <input type="number" class="form-input" value="0" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount Type</label>
                                        <select class="form-select">
                                            <option value="flat">Flat Amount</option>
                                            <option value="percent" selected>% of Owed Total</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-light" onclick="closePageslide('late-fees-edit-overlay')">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Save changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Screening Pageslide -->
    <div class="pageslide-overlay" id="screening-overlay">
        <div class="pageslide">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Run screening report</h2>
                <button class="pageslide-close" onclick="closePageslide('screening-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <!-- Instructions -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-info-circle text-blue-600 text-lg mt-0.5"></i>
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-1">Before running the report</h4>
                            <p class="text-sm text-gray-700">Select the individuals to include in the screening report. All applicants must have consent and photo ID confirmed before they can be included.</p>
                        </div>
                    </div>
                </div>

                <!-- Screening Subjects -->
                <div class="space-y-4">
                    <!-- Current Residents Section -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3">CURRENT RESIDENTS</h3>
                        
                        <!-- Melinda Michaels -->
                        <div class="border border-gray-200 rounded-lg p-4 bg-white">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-start gap-3 flex-1">
                                    <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0">
                                        <span class="text-purple-700 font-semibold">MM</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900">Melinda Michaels</h4>
                                        <p class="text-sm text-gray-600">Primary resident</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    <span class="ml-3 text-sm font-medium text-gray-700">Include</span>
                                </label>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs text-gray-500 mb-1 block">Role</label>
                                    <select class="form-select text-sm">
                                        <option value="occupant" selected>Occupant</option>
                                        <option value="applicant">Applicant</option>
                                    </select>
                                </div>
                                <div>
                                    <div class="flex items-center gap-2 mt-3">
                                        <input type="checkbox" id="verified-mm" class="form-checkbox h-4 w-4 text-blue-600 flex-shrink-0">
                                        <label for="verified-mm" class="text-sm text-gray-700">Consent/photo ID confirmed</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- John Smith -->
                        <div class="border border-gray-200 rounded-lg p-4 bg-white mt-3">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-start gap-3 flex-1">
                                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0">
                                        <span class="text-blue-700 font-semibold">JS</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900">John Smith</h4>
                                        <p class="text-sm text-gray-600">Co-occupant</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    <span class="ml-3 text-sm font-medium text-gray-700">Include</span>
                                </label>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs text-gray-500 mb-1 block">Role</label>
                                    <select class="form-select text-sm">
                                        <option value="occupant" selected>Occupant</option>
                                        <option value="applicant">Applicant</option>
                                    </select>
                                </div>
                                <div>
                                    <div class="flex items-center gap-2 mt-3">
                                        <input type="checkbox" id="verified-js" class="form-checkbox h-4 w-4 text-blue-600 flex-shrink-0">
                                        <label for="verified-js" class="text-sm text-gray-700">Consent/photo ID confirmed</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Applicants Section -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3">APPLICANTS</h3>
                        
                        <!-- Angela Johnson -->
                        <div class="border border-gray-200 rounded-lg p-4 bg-white">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-start gap-3 flex-1">
                                    <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                        <span class="text-green-700 font-semibold">AJ</span>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900">Angela Johnson</h4>
                                        <p class="text-sm text-gray-600">Roommate application</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    <span class="ml-3 text-sm font-medium text-gray-700">Include</span>
                                </label>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs text-gray-500 mb-1 block">Role</label>
                                    <select class="form-select text-sm">
                                        <option value="occupant">Occupant</option>
                                        <option value="applicant" selected>Applicant</option>
                                    </select>
                                </div>
                                <div>
                                    <div class="flex items-center gap-2 mt-3">
                                        <input type="checkbox" id="verified-aj" class="form-checkbox h-4 w-4 text-blue-600 flex-shrink-0">
                                        <label for="verified-aj" class="text-sm text-gray-700">Consent/photo ID confirmed</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pageslide Footer -->
            <div class="pageslide-footer flex gap-3 justify-end">
                <button class="btn btn-light" onclick="closePageslide('screening-overlay')">
                    Cancel
                </button>
                <button class="btn btn-primary">
                    <i class="fas fa-file-medical-alt mr-2"></i>
                    Run screening report
                </button>
            </div>
        </div>
    </div>

    <!-- Roommate Details Pageslide -->




                <!-- </div> <!-- End tab-content-container --> -->
            <!-- </div> -->
        <!-- </div> -->
    <!-- </div> -->

    <!-- Lease History Pageslide -->
    <div class="pageslide-overlay" id="lease-history-overlay">
        <div class="pageslide lease-history lease-history-wide">
            <div class="pageslide-header">
                <div class="flex items-start justify-between w-full">
                    <div>
                        <h2 class="pageslide-title">Lease history</h2>
                        <p class="text-sm text-muted mt-1">Melinda Michaels • 4 years 11 months tenancy</p>
                    </div>
                    <button class="pageslide-close" onclick="closePageslide('lease-history-overlay')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="pageslide-content">
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="border-b-2 border-gray-200">
                                <th class="text-left py-3 px-4 font-semibold text-muted">Type</th>
                                <th class="text-left py-3 px-4 font-semibold text-muted">Period</th>
                                <th class="text-left py-3 px-4 font-semibold text-muted">Unit</th>
                                <th class="text-left py-3 px-4 font-semibold text-muted">Lease ID</th>
                                <th class="text-left py-3 px-4 font-semibold text-muted">Monthly rent</th>
                                <th class="text-left py-3 px-4 font-semibold text-muted">Term</th>
                                <th class="text-left py-3 px-4 font-semibold text-muted">Agent</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Current Lease -->
                            <tr class="border-b border-gray-100 hover:bg-gray-50">
                                <td class="py-4 px-4 text-gray-900">Current lease</td>
                                <td class="py-4 px-4">Oct 1, 2024 - Sep 30, 2025</td>
                                <td class="py-4 px-4">288</td>
                                <td class="py-4 px-4">t0039661</td>
                                <td class="py-4 px-4">$1,482.25</td>
                                <td class="py-4 px-4">12 months</td>
                                <td class="py-4 px-4">Maria Gonzalez</td>
                            </tr>
                            <!-- Previous Lease 2023-2024 -->
                            <tr class="border-b border-gray-100 hover:bg-gray-50">
                                <td class="py-4 px-4 text-gray-900">Previous lease</td>
                                <td class="py-4 px-4">Oct 1, 2023 - Sep 30, 2024</td>
                                <td class="py-4 px-4">288</td>
                                <td class="py-4 px-4">t0038432</td>
                                <td class="py-4 px-4">$1,395.00</td>
                                <td class="py-4 px-4">12 months</td>
                                <td class="py-4 px-4">David Chen</td>
                            </tr>
                            <!-- Roommate Promotion -->
                            <tr class="border-b border-gray-100 hover:bg-gray-50">
                                <td class="py-4 px-4 text-gray-900">Roommate promotion</td>
                                <td class="py-4 px-4">Mar 15, 2023 - Sep 30, 2023</td>
                                <td class="py-4 px-4">3104 → 288</td>
                                <td class="py-4 px-4">t0312765</td>
                                <td class="py-4 px-4">$1,350.00</td>
                                <td class="py-4 px-4">6 months</td>
                                <td class="py-4 px-4">Jennifer Walsh</td>
                            </tr>
                            <!-- Previous Lease in Unit 3104 -->
                            <tr class="border-b border-gray-100 hover:bg-gray-50">
                                <td class="py-4 px-4 text-gray-900">Previous lease</td>
								 <td class="py-4 px-4">Oct 1, 2022 - Mar 14, 2023</td>
                                <td class="py-4 px-4">3104</td>
                                <td class="py-4 px-4">t0312765</td>
                                <td class="py-4 px-4">$1,320.00</td>
                                <td class="py-4 px-4">5 months</td>
                                <td class="py-4 px-4">Jennifer Walsh</td>
                            </tr>
                            <!-- Unit Transfer -->
                            <tr class="border-b border-gray-100 hover:bg-gray-50">
                                <td class="py-4 px-4 text-gray-900">Unit transfer</td>
                                <td class="py-4 px-4">Oct 10, 2021 - Sep 30, 2022</td>
                                <td class="py-4 px-4">2101 → 3104</td>
                                <td class="py-4 px-4">t0123452</td>
                                <td class="py-4 px-4">$1,280.00</td>
                                <td class="py-4 px-4">12 months</td>
                                <td class="py-4 px-4">Robert Kim</td>
                            </tr>
                            <!-- Previous Lease in Unit 2101 -->
                            <tr class="border-b border-gray-100 hover:bg-gray-50">
                                <td class="py-4 px-4 text-gray-900">Previous lease</td>
                                <td class="py-4 px-4">Oct 2, 2021 - Oct 9, 2021</td>
                                <td class="py-4 px-4">2101</td>
                                <td class="py-4 px-4">t0123452</td>
                                <td class="py-4 px-4">$1,250.00</td>
                                <td class="py-4 px-4">8 days</td>
                                <td class="py-4 px-4">Robert Kim</td>
                            </tr>
                            <!-- Original Lease -->
                            <tr class="hover:bg-gray-50">
                                <td class="py-4 px-4 text-gray-900">Original lease</td>
                                <td class="py-4 px-4">Oct 2, 2020 - Oct 1, 2021</td>
                                <td class="py-4 px-4">2101</td>
                                <td class="py-4 px-4">t0123452</td>
                                <td class="py-4 px-4">$1,180.00</td>
                                <td class="py-4 px-4">12 months</td>
                                <td class="py-4 px-4">Michael Torres</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t fixed bottom-0 right-0 bg-white z-50" style="width: 1300px; padding-right: 24px;">
                    <button type="button" onclick="closePageslide('lease-history-overlay')" class="btn btn-light">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Roommate Details Pageslide -->
    <div class="pageslide-overlay" id="roommate-details-overlay">
        <div class="pageslide roommate-details">
            <div class="pageslide-header">
                <div>
                <h2 class="pageslide-title">Roommate details</h2>
                    <p class="text-sm text-muted mt-1">2 current roommates, 2 past roommates</p>
                </div>
                <button class="pageslide-close" onclick="closePageslide('roommate-details-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <!-- Current Roommates Header -->
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Current Roommates</h3>
                    <button class="btn btn-link" onclick="toggleCurrentRoommatesExpanded()">
                        <span id="current-roommates-toggle-text">More details</span>
                        <i id="current-roommates-chevron" class="fas fa-chevron-down ml-1"></i>
                    </button>
                </div>
                
                <!-- Current Roommates (Collapsed - Show basic info) -->
                <div id="current-roommates-summary" class="space-y-4">
                    
                    <!-- Roommate #1 - Angela Johnson (Collapsed) -->
                    <div class="card hover-lift shadow-soft">
                        <div class="card-content">
                            <div class="flex items-start gap-3">
                                <!-- Avatar -->
                                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class=" font-semibold">AJ</span>
                                </div>

                                <!-- Roommate Info -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center gap-3">
                                            <h2 class="text-md font-semibold">Angela Johnson</h2>
                                            <span class="badge bg-amber-100 text-amber-800 text-sm px-2 py-1 rounded-full font-medium">
                                                Application completed
                                            </span>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 text-muted mb-2">
                                        <span>Preferred name: Ann Johnson</span><span class="text-muted">•</span><span>r112345</span>
                                    </div>
                                    
                                    <!-- Contact Information -->
                                    <div class="space-y-1 mb-3">
                                        <div class="flex items-center gap-2">
                                            <span class="">(555) 234-5678</span>
                                            <i class="fas fa-phone text-link cursor-pointer" title="Call"></i>
                                            <i class="fas fa-mobile-alt text-link cursor-pointer" title="Mobile"></i>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="">angela.johnson@email.com</span>
                                            <i class="fas fa-envelope text-link cursor-pointer" title="Send email"></i>
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons - Always Visible -->
                                    <div class="flex gap-2 flex-wrap">
                                        <button class="btn btn-light btn-sm">
                                            <i class="fas fa-envelope mr-1"></i>
                                            Invite to RentCafe
                                        </button>
                                        <button class="btn btn-light btn-sm">
                                            <i class="fas fa-file-alt mr-1"></i>
                                            View application
                                        </button>
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-check mr-1"></i>
                                            Approve
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Roommate #2 - John Smith (Collapsed) -->
                    <div class="card hover-lift shadow-soft">
                        <div class="card-content">
                            <div class="flex items-start gap-3">
                                <!-- Avatar -->
                                <div class="w-10 h-10 bg-primary-light rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-blue-600 font-semibold">JS</span>
                                </div>

                                <!-- Roommate Info -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center gap-3">
                                            <h2 class="text-md font-weight-bold">John Smith</h2>
                                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Current</span>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center gap-2 text-muted mb-2">
                                        <span>Preferred name: John Smith</span><span class="text-muted">•</span><span>r112345</span>
                                    </div>
                                    
                                    <!-- Contact Information -->
                                    <div class="space-y-1 mb-2">
                                        <div class="flex items-center gap-2">
                                            <span class="">(555) 345-6789</span>
                                            <i class="fas fa-phone text-link cursor-pointer" title="Call"></i>
                                            <i class="fas fa-mobile-alt text-link cursor-pointer" title="Mobile"></i>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="">john.smith@email.com</span>
                                            <i class="fas fa-envelope text-link cursor-pointer" title="Send email"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Current Roommates (Expanded - Show all details) -->
                <div id="current-roommates-expanded" class="space-y-4 hidden">
                    
                    <!-- Roommate #1 - Angela Johnson (Expanded) -->
                    <div class="card hover-lift shadow-soft">
                        <div class="card-content">
                            <div class="flex items-start gap-3">
                                <!-- Avatar -->
                                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class=" font-semibold">AJ</span>
                                </div>

                                <!-- Roommate Info -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center gap-3">
                                            <h2 class="text-md font-semibold">Angela Johnson</h2>
                                            <span class="badge bg-amber-100 text-amber-800 text-sm px-2 py-1 rounded-full font-medium">
                                                Application completed
                                            </span>
                                        </div>
                                        <button id="kebab-btn-roommate-angela-pageslide" class="btn btn-light kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
									<div class="flex items-center gap-2 text-muted mb-2">
										<span>Preferred name: Ann Johnson</span><span class="text-muted">•</span><span>r112345</span>
									</div>
                                    
                                    <!-- Contact Information -->
                                    <div class="space-y-1 mb-2">
                                        <div class="flex items-center gap-2">
                                            <span class="">(555) 234-5678</span>
                                            <i class="fas fa-phone text-link cursor-pointer" title="Call"></i>
                                            <i class="fas fa-mobile-alt text-link cursor-pointer" title="Mobile"></i>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="">angela.johnson@email.com</span>
                                            <i class="fas fa-envelope text-link cursor-pointer" title="Send email"></i>
                                        </div>
                                    </div>
									
									<!-- Badges -->
                                    <div class="flex items-center gap-2 mb-4">
                                        <span class="badge bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded-full font-medium">
                                            lessee
                                        </span>
                                        <span class="badge bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded-full font-medium">
                                            adult
                                        </span>
                                    </div>
                                    
                                    <!-- Emergency Contact Section -->
                                    <div class="mt-3 pt-3 border-t border-gray-100">
                                        <div class="flex items-center gap-2 mb-2">
                                            <i class="fas fa-user-shield text-muted"></i>
                                            <span class="font-medium">Emergency contact</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span>Sarah Johnson</span>
                                            <span class="text-muted">(mother)</span>
                                            <div class="flex items-center gap-3">
                                                <span class="tooltip-black">
                                                    <i class="fas fa-phone text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Call</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-mobile-alt text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Text</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-envelope text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Email</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                   
									
                                    <!-- RentCafe Registration Section -->
                                    <div class="mt-4 pt-3 pb-3 border-t border-gray-100">
                                        <div class="flex items-center justify-between">
                                            <span class="font-medium ">Rentcafe registration</span>
                                            <div class="flex items-center space-x-3">
                                                <div class="flex items-center space-x-2">
                                                    <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
                                                    <span class="font-medium text-orange-700" data-field="rentcafe-status-angela">Not registered</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Action Buttons - Always Visible -->
                                    <div class="flex gap-2 flex-wrap mt-3">
                                        <button class="btn btn-light btn-sm">
                                            <i class="fas fa-envelope mr-1"></i>
                                            Invite to RentCafe
                                        </button>
                                        <button class="btn btn-light btn-sm">
                                            <i class="fas fa-file-alt mr-1"></i>
                                            View application
                                        </button>
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-check mr-1"></i>
                                            Approve
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Roommate #2 - John Smith (Expanded) -->
                    <div class="card hover-lift shadow-soft">
                        <div class="card-content">
                            <div class="flex items-start gap-3">
                                <!-- Avatar -->
                                <div class="w-10 h-10 bg-primary-light rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-blue-600 font-semibold">JS</span>
                                </div>

                                <!-- Roommate Info -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center gap-3">
                                            <h2 class="text-md font-weight-bold">John Smith</h2>
                                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Current</span>
                                        </div>
                                        <button id="kebab-btn-roommate-john-pageslide" class="btn btn-light kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
									
									<div class="flex items-center gap-2 text-muted mb-2">
										<span>Preferred name: John Smith</span><span class="text-muted">•</span><span>r112345</span>
                                    </div>
                                    
                                    <!-- Contact Information -->
                                    <div class="space-y-1 mb-2">
                                        <div class="flex items-center gap-2">
                                            <span class="">(555) 345-6789</span>
                                            <i class="fas fa-phone text-link cursor-pointer" title="Call"></i>
                                            <i class="fas fa-mobile-alt text-link cursor-pointer" title="Mobile"></i>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="">john.smith@email.com</span>
                                            <i class="fas fa-envelope text-link cursor-pointer" title="Send email"></i>
                                        </div>
                                    </div>
									
									<!-- Badges -->
                                    <div class="flex items-center gap-2 mb-4">
                                        <span class="badge bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded-full font-medium">
                                            lessee
                                        </span>
                                        <span class="badge bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded-full font-medium">
                                            adult
                                        </span>
                                    </div>

                                    <!-- Emergency Contact Section -->
                                    <div class="mt-3 pt-3 border-t border-gray-100">
                                        <div class="flex items-center gap-2 mb-2">
                                            <i class="fas fa-user-shield text-muted"></i>
                                            <span class="font-medium">Emergency contact</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span>Robert Smith</span>
                                            <span class="text-muted">(father)</span>
                                            <div class="flex items-center gap-3">
                                                <span class="tooltip-black">
                                                    <i class="fas fa-phone text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Call</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-mobile-alt text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Text</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-envelope text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Email</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>


                                    <!-- Rentcafe registration Section -->
                                    <div class="mt-4 pt-3 mb-4 pb-3 border-t border-b border-gray-100">
                                        <div class="flex items-center justify-between">
                                            <span class="font-medium ">Rentcafe registration</span>
                                            <div class="flex items-center space-x-3">
                                                <div class="flex items-center space-x-2">
                                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                                    <span class="font-medium text-green-700" data-field="rentcafe-status-john">Registered</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between mt-1">
                                            <p class="text-sm text-muted" data-field="rentcafe-date-john">Registered on January 8, 2024
                                            <span class="text-gray-400">•</span>
                                            Account verified</p>
                                            <div class="flex items-center gap-1">
                                                <a href="#" class="btn btn-link btn-sm font-weight-normal">
                                                    <i class="fas fa-external-link-alt text-sm ml-1"></i> Preview account
                                                </a>
                                                <button id="kebab-btn-rentcafe-john" class="btn btn-link btn-sm">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Roommate Button -->
                <div class="add-pet-section mt-6 mb-4">
                        <button class="font-medium px-3 py-1" onclick="addNewRoommate()">
                            <i class="fas fa-plus mr-2"></i>
                        Add roommate
                        </button>
                    </div>

                    <!-- Past Roommates Section -->
                    <div class="mb-6 mt-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Past Roommates</h3>
                            <button class="btn btn-link" onclick="togglePastRoommatesExpanded()">
                                <span id="past-roommates-toggle-text">More details</span>
                                <i id="past-roommates-chevron" class="fas fa-chevron-down ml-1"></i>
                            </button>
                </div>
                        
                        <!-- Past Roommate List (Collapsed - Show only recent) -->
                        <div id="past-roommates-summary" class="space-y-4">
                            <div class="card hover-lift shadow-soft opacity-75">
                                <div class="card-content">
                                    <div class="flex items-start gap-3">
                                        <!-- Avatar -->
                                        <div class="w-10 h-10 bg-gray-500 rounded-full flex items-center justify-center flex-shrink-0">
                                            <span class="text-white font-semibold">SM</span>
                                        </div>

                                        <!-- Past Roommate Info -->
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-start justify-between">
                                                <div class="flex items-center gap-3">
                                                    <h2 class="text-md font-weight-bold">Sarah Martinez</h2>
                                                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                                                        Moved Out Aug 2025
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-center gap-2 text-muted mb-2">
                                                <span>Duration: 6 months</span><span class="text-muted">•</span><span>Former lessee</span>
                                            </div>
                                            
                                            <!-- Contact Information -->
                                            <div class="space-y-1 mb-2">
                                                <div class="flex items-center gap-2">
                                                    <span class="text-gray-600">(555) 123-9876</span>
                                                    <i class="fas fa-phone text-gray-400 cursor-pointer" title="Call"></i>
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    <span class="text-gray-600">sarah.martinez@email.com</span>
                                                    <i class="fas fa-envelope text-gray-400 cursor-pointer" title="Send email"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card hover-lift shadow-soft opacity-75">
                                <div class="card-content">
                                    <div class="flex items-start gap-3">
                                        <!-- Avatar -->
                                        <div class="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center flex-shrink-0">
                                            <span class="text-white font-semibold">DL</span>
                                        </div>

                                        <!-- Past Roommate Info -->
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-start justify-between">
                                                <div class="flex items-center gap-3">
                                                    <h2 class="text-md font-weight-bold">David Lee</h2>
                                                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                                                        Moved Out Feb 2025
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-center gap-2 text-muted mb-2">
                                                <span>Duration: 1 year 2 months</span><span class="text-muted">•</span><span>Former lessee</span>
                                            </div>
                                            
                                            <!-- Contact Information -->
                                            <div class="space-y-1 mb-2">
                                                <div class="flex items-center gap-2">
                                                    <span class="text-gray-600">(555) 987-2341</span>
                                                    <i class="fas fa-phone text-gray-400 cursor-pointer" title="Call"></i>
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    <span class="text-gray-600">david.lee@email.com</span>
                                                    <i class="fas fa-envelope text-gray-400 cursor-pointer" title="Send email"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Past Roommate List (Expanded - Show all) -->
                        <div id="past-roommates-expanded" class="space-y-4 hidden">
                            <div class="card hover-lift shadow-soft opacity-75">
                                <div class="card-content">
                                    <div class="flex items-start gap-3">
                                        <!-- Avatar -->
                                        <div class="w-10 h-10 bg-gray-500 rounded-full flex items-center justify-center flex-shrink-0">
                                            <span class="text-white font-semibold">SM</span>
                                        </div>

                                        <!-- Past Roommate Info -->
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-start justify-between">
                                                <div class="flex items-center gap-3">
                                                    <h2 class="text-md font-weight-bold">Sarah Martinez</h2>
                                                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                                                        Moved Out Aug 2025
                                                    </span>
                                                </div>
                                                <button class="btn btn-light btn-sm">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                            </div>
                                            
                                            <div class="flex items-center gap-2 text-muted mb-2">
                                                <span>Duration: 6 months</span><span class="text-muted">•</span><span>Former lessee</span><span class="text-muted">•</span><span>r445566</span>
                                            </div>
                                            
                                            <!-- Contact Information -->
                                            <div class="space-y-1 mb-2">
                                                <div class="flex items-center gap-2">
                                                    <span class="text-gray-600">(555) 123-9876</span>
                                                    <i class="fas fa-phone text-gray-400 cursor-pointer" title="Call"></i>
                                                    <i class="fas fa-mobile-alt text-gray-400 cursor-pointer" title="Mobile"></i>
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    <span class="text-gray-600">sarah.martinez@email.com</span>
                                                    <i class="fas fa-envelope text-gray-400 cursor-pointer" title="Send email"></i>
                                                </div>
                                            </div>
                                            
                                            <!-- Move-out details -->
                                            <div class="mt-3 pt-3 border-t border-gray-100">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <i class="fas fa-calendar-alt text-muted"></i>
                                                    <span class="font-medium">Move-out details</span>
                                                </div>
                                                <div class="text-sm text-muted">
                                                    <div>Move-out date: August 15, 2025</div>
                                                    <div>Reason: Lease ended - Not renewed</div>
                                                    <div>Deposit returned: Yes ($500.00)</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card hover-lift shadow-soft opacity-75">
                                <div class="card-content">
                                    <div class="flex items-start gap-3">
                                        <!-- Avatar -->
                                        <div class="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center flex-shrink-0">
                                            <span class="text-white font-semibold">DL</span>
                                        </div>

                                        <!-- Past Roommate Info -->
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-start justify-between">
                                                <div class="flex items-center gap-3">
                                                    <h2 class="text-md font-weight-bold">David Lee</h2>
                                                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                                                        Moved Out Feb 2025
                                                    </span>
                                                </div>
                                                <button class="btn btn-light btn-sm">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                            </div>
                                            
                                            <div class="flex items-center gap-2 text-muted mb-2">
                                                <span>Duration: 1 year 2 months</span><span class="text-muted">•</span><span>Former lessee</span><span class="text-muted">•</span><span>r334455</span>
                                            </div>
                                            
                                            <!-- Contact Information -->
                                            <div class="space-y-1 mb-2">
                                                <div class="flex items-center gap-2">
                                                    <span class="text-gray-600">(555) 987-2341</span>
                                                    <i class="fas fa-phone text-gray-400 cursor-pointer" title="Call"></i>
                                                    <i class="fas fa-mobile-alt text-gray-400 cursor-pointer" title="Mobile"></i>
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    <span class="text-gray-600">david.lee@email.com</span>
                                                    <i class="fas fa-envelope text-gray-400 cursor-pointer" title="Send email"></i>
                                                </div>
                                            </div>
                                            
                                            <!-- Move-out details -->
                                            <div class="mt-3 pt-3 border-t border-gray-100">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <i class="fas fa-calendar-alt text-muted"></i>
                                                    <span class="font-medium">Move-out details</span>
                                                </div>
                                                <div class="text-sm text-muted">
                                                    <div>Move-out date: February 28, 2025</div>
                                                    <div>Reason: Job relocation</div>
                                                    <div>Deposit returned: Yes ($750.00)</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>

    <!-- Floating Kebab Dropdown - Angela Johnson Overview (outside all containers) -->
    <div id="kebab-dropdown-roommate-angela-overview" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Approve Roommate Application:\n\n• Final review of Angela Johnson\'s application\n• Process background check results\n• Generate lease addendum\n• Notify all parties of approval')">
            <i class="fas fa-check mr-2 text-muted"></i>
            Approve
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('View Application:\n\n• Review Angela Johnson\'s application\n• Verify background check\n• Check submitted documents\n• Review credit score')">
            <i class="fas fa-file-alt mr-2 text-muted"></i>
            View application
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Invite to RentCafe:\n\n• Send RentCafe invitation to Angela Johnson\n• Generate unique access link\n• Send via email\n• Track invitation status')">
            <i class="fas fa-paper-plane mr-2 text-muted"></i>
            Invite to RentCafe
        </button>
    </div>

    <!-- Floating Kebab Dropdown - John Smith Overview (outside all containers) -->
    <div id="kebab-dropdown-roommate-john-overview" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Preview RentCafe Account:\n\n• View John Smith\'s RentCafe account\n• Check access permissions\n• Review login history\n• Verify account settings')">
            <i class="fas fa-eye mr-2 text-muted"></i>
            Preview RentCafe account
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Change Password:\n\n• Reset John Smith\'s password\n• Generate temporary password\n• Send notification email\n• Require password change on next login')">
            <i class="fas fa-key mr-2 text-muted"></i>
            Change password
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-red-50 transition-colors" onclick="alert('Lock Account:\n\n• Temporarily lock John Smith\'s account\n• Prevent RentCafe access\n• Send notification\n• Set unlock conditions')">
            <i class="fas fa-lock text-red-500 mr-2"></i>
            Lock account
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Angela Johnson (outside all containers) -->
    <div id="kebab-dropdown-roommate-angela" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-pen mr-2 text-muted"></i>
            Edit details
        </button>
		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-paper-plane mr-2 text-muted"></i>
            Send invitation
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-alt mr-2 text-muted"></i>
            View application form
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-check mr-2 text-muted"></i>
            Approve application
        </button>   
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user mr-2 text-muted"></i>
            View customer record
        </button>
        <hr class="my-1 border-gray-200">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-red-50  transition-colors">
            <i class="fas fa-times text-red-500 mr-2"></i>
            Remove roommate
        </button>
    </div>

    <!-- Floating Kebab Dropdown - John Smith (outside all containers) -->
    <div id="kebab-dropdown-roommate-john" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-pen mr-2 text-muted"></i>
            Edit details
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-alt mr-2 text-muted"></i>
            View application form
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user-plus mr-2 text-muted"></i>
            Promote roommate
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user mr-2 text-muted"></i>
            View customer record
        </button>
        <hr class="my-1 border-gray-200">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-red-50  transition-colors">
            <i class="fas fa-times text-red-500 mr-2"></i>
            Remove roommate
        </button>
    </div>

    <!-- Pet Details Pageslide -->
    <div class="pageslide-overlay" id="pet-details-overlay">
        <div class="pageslide pet-details">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Pet details</h2>
                <button class="pageslide-close" onclick="closePageslide('pet-details-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <div class="space-y-4">
                    
                    <!-- Pet #1 - Blue (Dog) -->
                    <div class="card shadow-sm">
                        <div class="card-header pb-0 border-0">
                            <div class="flex items-center justify-between w-full">
                            <div class="flex items-center gap-3">
                                <div class="pet-avatar">
                                    <i class="fas fa-dog  text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="pet-name">Blue</h3>
                                    <span class="pet-type">Dog</span>
                                </div>
                            </div>
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-light btn-sm" onclick="editPet('Blue')">
                                        <i class="fas fa-pen"></i>
                                </button>
                                    <button class="btn btn-light btn-sm" onclick="deletePet('Blue')">
                                        <i class="fas fa-trash-alt"></i>
                                </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-content">
                            <div class="pet-metadata">
                                <div class="pet-primary-info">
                                    Jack Russell Terrier • Male • 2 years old
                                </div>
                                <div class="pet-secondary-info">
                                    Weight: 10 lbs • Spayed/Neutered: Yes • Service Animal: No
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pet #2 - Cat (example) -->
                    <div class="card shadow-sm">
                        <div class="card-header pb-0 border-0">
                            <div class="flex items-center justify-between w-full">
                            <div class="flex items-center gap-3">
                                <div class="pet-avatar">
                                    <i class="fas fa-cat  text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="pet-name">Whiskers</h3>
                                    <span class="pet-type">Cat</span>
                                </div>
                            </div>
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-light btn-sm" onclick="editPet('Whiskers')">
                                        <i class="fas fa-pen"></i>
                                </button>
                                    <button class="btn btn-light btn-sm" onclick="deletePet('Whiskers')">
                                        <i class="fas fa-trash-alt"></i>
                                </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-content">
                            <div class="pet-metadata">
                                <div class="pet-primary-info">
                                    Domestic Shorthair • Female • 3 years old
                                </div>
                                <div class="pet-secondary-info">
                                    Weight: 8 lbs • Spayed/Neutered: Yes • Service Animal: No
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Pet Button -->
                    <div class="add-pet-section">
                        <button class="btn font-medium" onclick="addNewPet()">
                            <i class="fas fa-plus mr-2"></i>
                            Add Pet
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Vehicle Details Pageslide -->
    <div class="pageslide-overlay" id="vehicle-details-overlay">
        <div class="pageslide vehicle-details">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Vehicle details</h2>
                <button class="pageslide-close" onclick="closePageslide('vehicle-details-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <div class="space-y-4">
                    
                    <!-- Vehicle #1 - Honda Civic -->
                    <div class="card shadow-sm">
                        <div class="card-header pb-0 border-0">
                            <div class="flex items-center justify-between w-full">
                            <div class="flex items-center gap-3">
                                <div class="vehicle-avatar">
                                    <i class="fas fa-car  text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="vehicle-name">2019 Honda Civic</h3>
                                    <span class="vehicle-plate">License: ABC-1234 • CA</span>
                                </div>
                            </div>
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-light btn-sm" onclick="editVehicle('2019 Honda Civic')">
                                        <i class="fas fa-pen"></i>
                                </button>
                                    <button class="btn btn-light btn-sm" onclick="deleteVehicle('2019 Honda Civic')">
                                        <i class="fas fa-trash-alt"></i>
                                </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-content">
                            <div class="vehicle-metadata">
                                <div class="font-medium">
                                    Honda • Civic • 2019
                                </div>
                                <div class="text-muted">
                                    Color: White
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vehicle #2 - Toyota RAV4 -->
                    <div class="card shadow-sm">
                        <div class="card-header pb-0 border-0">
                            <div class="flex items-center justify-between w-full">
                            <div class="flex items-center gap-3">
                                <div class="vehicle-avatar">
                                        <i class="fas fa-car text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="vehicle-name">2021 Toyota RAV4</h3>
                                    <span class="vehicle-plate">License: XYZ-5678 • CA</span>
                                </div>
                            </div>
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-light btn-sm" onclick="editVehicle('2021 Toyota RAV4')">
                                        <i class="fas fa-pen"></i>
                                </button>
                                    <button class="btn btn-light btn-sm" onclick="deleteVehicle('2021 Toyota RAV4')">
                                        <i class="fas fa-trash-alt"></i>
                                </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-content">
                            <div class="vehicle-metadata">
                                <div class="font-medium">
                                    Toyota • RAV4 • 2021
                                </div>
                                <div class="text-muted">
                                    Color: Silver
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Vehicle Button -->
                    <div class="add-vehicle-section">
                        <button class="btn font-medium" onclick="addNewVehicle()">
                            <i class="fas fa-plus mr-2"></i>
                            Add Vehicle
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

         <!-- Lease Charges Popover -->
     <div id="lease-charges-popover" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl p-4 min-w-[320px]" style="position: fixed; z-index: 9999;">
         <div class="flex items-center justify-between mb-3">
             <div class="font-semibold text-gray-900">Monthly Lease Charges</div>
             <button class="btn btn-light btn-sm" onclick="document.getElementById('lease-charges-popover').classList.add('hidden'); openPageslide('edit-lease-charges-overlay')" title="Edit lease charges">
                 <i class="fas fa-pen"></i>
             </button>
         </div>
         
         <!-- Total Rent -->
         <div class="bg-gray-50 p-3 rounded-lg mb-3">
             <div class="text-sm text-gray-600 mb-2">Total Monthly Rent</div>
             <div class="flex justify-between items-center">
                 <span class="text-gray-700">Rent (Residential)</span>
                 <span class="font-medium">$2,000.00</span>
             </div>
             <div class="flex justify-between items-center">
                 <span class="text-gray-700">Pet Fee (2 pets)</span>
                 <span class="font-medium">$30.00</span>
             </div>
			 <div class="flex justify-between items-center">
				 <span class="text-gray-700">Parking Space #42</span>
				 <span class="font-medium">$75.00</span>
			 </div>
			 <div class="flex justify-between items-center">
				 <span class="text-gray-700">Storage Unit #15</span>
				 <span class="font-medium">$45.00</span>
			 </div>
			 <div class="flex justify-between items-center">
				 <span class="text-gray-700">Washer/Dryer Rental</span>
				 <span class="font-medium">$25.00</span>
			 </div>
             
             <div class="border-t border-gray-300 pt-2 mt-2">
                 <div class="flex justify-between items-center">
                     <span class="font-semibold text-gray-900">Total Charges</span>
                     <span class="font-bold text-gray-900">$2,175.00</span>
                 </div>
             </div>
         </div>
         
         <!-- HAP Subsidy -->
         <div class="space-y-2 mb-3">
             <div class="text-sm text-gray-600 mb-2">Housing Assistance</div>
             <div class="flex justify-between items-center">
                 <span class="">HAP Subsidy</span>
                 <span class="font-medium">-$692.75</span>
             </div>
         </div>
         
         <!-- Tenant Portion -->
         <div class="border-t border-gray-200 pt-3">
             <div class="flex justify-between items-center">
                 <span class="font-semibold text-gray-900">Tenant Responsibility</span>
                 <span class="font-bold">$1,482.25</span>
             </div>
         </div>
         
    </div>

    <!-- Deposit Breakdown Popover -->
    <div id="deposit-popover" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl p-4 min-w-[320px]" style="position: fixed; z-index: 9999;">
        <div class="font-semibold text-gray-900 mb-3">Deposit Breakdown</div>
        
        <!-- Deposit Items -->
        <div class="space-y-2 mb-3">
            <div class="flex justify-between items-center">
                <span class="text-gray-700">Security Deposit</span>
                <span class="font-medium">$1,400.00</span>
            </div>
            <div class="flex justify-between items-center">
                <span class="text-gray-700">Key Deposit</span>
                <span class="font-medium">$200.00</span>
            </div>
            <div class="flex justify-between items-center">
                <span class="text-gray-700">Pet Deposit (2 pets)</span>
                <span class="font-medium">$250.00</span>
            </div>
        </div>
        
        <!-- Total -->
        <div class="border-t border-gray-200 pt-3">
            <div class="flex justify-between items-center">
                <span class="font-semibold text-gray-900">Total Deposit</span>
                <span class="font-bold">$1,850.00</span>
            </div>
        </div>
        
   </div>

    <!-- Floating Kebab Dropdown - Resident (outside all containers) -->
    <div id="kebab-dropdown-resident" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <div class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
			<i class="fas fa-link"></i>
			<span>Change linked customer</span>
		</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user mr-2 text-muted"></i>
            View customer record
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user-plus mr-2 text-muted"></i>
            View prospect record
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Driver License Angela (outside all containers) -->
    <div id="kebab-dropdown-driver-license-angela" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Delete document')">
            <i class="fas fa-upload text-muted"></i>
            Upload for resident
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Lease v1.2 (outside all containers) -->
    <div id="kebab-dropdown-lease-v12" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Mark as manually signed')">
            <i class="fas fa-signature mr-2 text-muted"></i>
            Mark as manually signed
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Edit document')">
            <i class="fas fa-pen mr-2 text-muted"></i>
            Edit
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Bypass signature')">
            <i class="fas fa-arrow-right mr-2 text-muted"></i>
            Bypass
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Delete document')">
            <i class="fas fa-trash-alt mr-2 text-muted"></i>
            Delete
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Driver License John (outside all containers) -->
    <div id="kebab-dropdown-driver-license-john" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="deleteDocument('driver-license-john')">
            <i class="fas fa-trash-alt mr-2 text-muted"></i>
            Delete
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Driver License Melinda (outside all containers) -->
    <div id="kebab-dropdown-driver-license-melinda" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="deleteDocument('driver-license-melinda')">
            <i class="fas fa-trash-alt mr-2 text-muted"></i>
            Delete
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Pet Documentation (outside all containers) -->
    <div id="kebab-dropdown-pet-documentation" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Delete pet documentation')">
            <i class="fas fa-trash-alt mr-2 text-muted"></i>
            Delete
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Emergency Contact John (outside all containers) -->
    <div id="kebab-dropdown-emergency-contact-john" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="deleteDocument('emergency-contact-john')">
            <i class="fas fa-trash-alt mr-2 text-muted"></i>
            Delete
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Photo002 Melinda (outside all containers) -->
    <div id="kebab-dropdown-photo002-melinda" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="deleteDocument('photo002-melinda')">
            <i class="fas fa-trash-alt mr-2 text-muted"></i>
            Delete
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Maintenance Notes John (outside all containers) -->
    <div id="kebab-dropdown-maintenance-notes-john" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="deleteDocument('maintenance-notes-john')">
            <i class="fas fa-trash-alt mr-2 text-muted"></i>
            Delete
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Inspection Report Angela (outside all containers) -->
    <div id="kebab-dropdown-inspection-report-angela" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="deleteDocument('inspection-report-angela')">
            <i class="fas fa-trash-alt mr-2 text-muted"></i>
            Delete
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Lease v2.1 (outside all containers) -->
    <div id="kebab-dropdown-lease-v21" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Mark as manually signed')">
            <i class="fas fa-signature mr-2 text-muted"></i>
            Mark as manually signed
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Delete document')">
            <i class="fas fa-trash-alt mr-2 text-muted"></i>
            Delete
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Pet Addendum (outside all containers) -->
    <div id="kebab-dropdown-pet-addendum" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Delete document')">
            <i class="fas fa-trash-alt mr-2 text-muted"></i>
            Delete
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Insurance Certificate (outside all containers) -->
    <div id="kebab-dropdown-insurance-certificate" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Upload for resident')">
            <i class="fas fa-upload mr-2 text-muted"></i>
            Upload for resident
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Pet Registration (outside all containers) -->
    <div id="kebab-dropdown-pet-registration" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors" onclick="alert('Upload for resident')">
            <i class="fas fa-upload mr-2 text-muted"></i>
            Upload for resident
        </button>
    </div>

    <!-- Floating Kebab Dropdown - RentCafe (outside all containers) -->
    <div id="kebab-dropdown-rentcafe" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[160px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-key mr-2 text-muted"></i>
            Change password
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-lock mr-2 text-muted"></i>
            Lock account
        </button>
    </div>

    <!-- Floating Kebab Dropdown - RentCafe John Smith (outside all containers) -->
    <div id="kebab-dropdown-rentcafe-john" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[160px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-key mr-2 text-muted"></i>
            Change password
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-lock mr-2 text-muted"></i>
            Lock account
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Angela Johnson Pageslide (outside all containers) -->
    <div id="kebab-dropdown-roommate-angela-pageslide" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-pen mr-2 text-muted"></i>
            Edit details
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-alt mr-2 text-muted"></i>
            View application form
        </button>
		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-check mr-2 text-muted"></i>
            Approve application
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-paper-plane mr-2 text-muted"></i>
            Send invitation
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user mr-2 text-muted"></i>
            View customer record
        </button>
        <hr class="my-1 border-gray-200">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-red-50  transition-colors">
            <i class="fas fa-times text-red-500 mr-2"></i>
            Remove roommate
        </button>
    </div>

    <!-- Floating Kebab Dropdown - John Smith Pageslide (outside all containers) -->
    <div id="kebab-dropdown-roommate-john-pageslide" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-pen mr-2 text-muted"></i>
            Edit details
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-alt mr-2 text-muted"></i>
            View application form
        </button>
		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user-plus mr-2 text-muted"></i>
            Promote roommate
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user mr-2 text-muted"></i>
            View customer record
        </button>
        <hr class="my-1 border-gray-200">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-red-50  transition-colors">
            <i class="fas fa-times text-red-500 mr-2"></i>
            Remove roommate
        </button>
    </div>

        <!-- Floating Kebab Dropdown - Tenant Header Manage (outside all containers) -->
    <div id="tenant-header-manage-dropdown" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[260px]" style="position: fixed; z-index: 9999;">
        <!-- Financial Actions -->
        <div class="kebab-group-header">Financial</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-credit-card mr-2 text-muted"></i>
            Receive payment
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-circle-plus mr-2 text-muted"></i>
            Add one-time charge
        </button>
		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-piggy-bank mr-2 text-muted"></i>
            Apply deposit
        </button>
        
        <!-- Service & Operations -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Services</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-wrench mr-2 text-muted"></i>
            Add work order
        </button>
        
        <!-- Lease operations -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Lease operations</div>
		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-contract mr-2 text-muted"></i>
            Create proposal
        </button>
        
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-calendar-alt mr-2 text-muted"></i>
            Adjust lease-end
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-calendar mr-2 text-muted"></i>
            Change to month-to-month
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-undo mr-2 text-muted"></i>
            Reverse move-in
        </button>
        
        <!-- Unit & Resident -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Unit & Resident</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-home mr-2 text-muted"></i>
            Assign unit
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-exchange-alt mr-2 text-muted"></i>
            Transfer unit
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user-plus mr-2 text-muted"></i>
            Promote roommate
        </button>
        
        <!-- Termination -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Termination</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-bell mr-2 text-muted"></i>
            Give notice
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-exclamation-triangle mr-2 text-muted"></i>
            Evict
        </button>
    </div>

        <!-- Floating Kebab Dropdown - Lease (outside all containers) -->
    <div id="kebab-dropdown-lease" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[240px]" style="position: fixed; z-index: 9999;">
        <!-- Financial -->
        <div class="kebab-group-header">Financial</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-piggy-bank mr-2 text-muted"></i>
            Apply deposit
        </button>
        
        <!-- Lease Operations -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Lease Operations</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-contract mr-2 text-muted"></i>
            Create proposal
        </button>
		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-calendar-alt mr-2 text-muted"></i>
            Adjust lease-end
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-calendar mr-2 text-muted"></i>
            Change to month-to-month
        </button>
 		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-undo mr-2 text-muted"></i>
            Reverse move-in
        </button>
        
        <!-- Unit & Resident -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Unit & Resident</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-home mr-2 text-muted"></i>
            Assign unit
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-exchange-alt mr-2 text-muted"></i>
            Transfer unit
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user-plus mr-2 text-muted"></i>
            Promote roommate
        </button>
        
        <!-- Termination -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Termination</div>
 		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-bell mr-2 text-muted"></i>
            Give notice
        </button>
 		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-exclamation-triangle mr-2 text-muted"></i>
            Evict
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Lease Timeline (outside all containers) -->
    <div id="kebab-dropdown-lease-timeline" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-alt mr-2 text-muted"></i>
            View Application
        </button>
    </div>

    <!-- Active Tasks & Alerts Pageslide -->
    <div class="pageslide-overlay" id="active-tasks-overlay">
        <div class="pageslide">
            <div class="pageslide-header">
                <div class="flex items-start justify-between w-full">
                    <div class="flex items-start gap-3">
                        <div>
                            <h2 class="pageslide-title  font-semibold text-lg mb-1">Active Tasks & Alerts</h2>
                            <div class="text-muted">
                                <span class="font-medium">Expiring lease</span>
                                <span class="text-gray-400 mx-1">•</span>
								<span class="font-medium">1 open work order</span>
                                <span class="text-gray-400 mx-1">•</span>
								<span class="font-medium">1 pending application</span>
                                <span class="text-gray-400 mx-1">•</span>
                                <span class="font-medium">2 pending signatures</span>
                                <span class="text-gray-400 mx-1">•</span>
                                <span class="font-medium">2 document uploads</span>
                            </div>
                        </div>
                    </div>
                    <button class="pageslide-close" onclick="closePageslide('active-tasks-overlay')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="pageslide-content">
                <div class="space-y-4">
                        <!-- Lease Expiring -->
                        <div class="task-item p-3 border border-gray-200 rounded-lg bg-white shadow-sm">
                            <div class="flex items-start gap-3">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <h4 class="text-base font-semibold ">Lease expiring soon</h4>
                                        <button class="btn btn-primary btn-sm">
                                            Create proposal
                                        </button>
                                    </div>
                                    <p class="text-muted mb-2">Current lease expires Sep 30, 2025 - renewal action required</p>
                                    <div class="text-sm text-muted">
                                        <span class="inline-flex items-center gap-1">
                                            <i class="fas fa-calendar-times text-red-500"></i>
                                            <span>43 days remaining</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Open Work Order -->
                        <div class="task-item p-3 border border-gray-200 rounded-lg bg-white shadow-sm">
                            <div class="flex items-start gap-3">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <h4 class="text-base font-semibold ">Open work order</h4>
                                        <div class="flex items-center gap-2">
                                            <button class="btn btn-light btn-sm">
                                                View details
                                            </button>
                                            <button class="btn btn-primary btn-sm">
                                                Complete
                                            </button>
                                        </div>
                                    </div>
                                    <p class="text-muted mb-2">Work Order #26145: Refrigerator is not working (Appliances) - Medium Priority</p>
                                    <div class="text-sm text-muted">
                                        <span class="inline-flex items-center gap-1">
                                            <i class="fas fa-wrench text-yellow-500"></i>
                                            <span>Created 2 days ago by Melinda Michaels</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Application Review -->
                        <div class="task-item p-3 border border-gray-200 rounded-lg shadow-sm">
                            <div class="flex items-start gap-3">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <h4 class="text-base font-semibold ">Roommate application pending</h4>
                                        <div class="flex items-center gap-2">
                                            <button class="btn btn-light btn-sm">
                                                Send invitation
                                            </button>
                                            <button class="btn btn-primary btn-sm">
                                                Approve application
                                            </button>
                                        </div>
                                    </div>
                                    <p class="text-muted mb-2">Angela Johnson's application completed - requires approval</p>
                                    <div class="text-sm text-muted">
                                        <span class="inline-flex items-center gap-1">
                                            <i class="fas fa-user-plus text-orange-500"></i>
                                            <span>Application submitted 5 days ago</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- Pending Signatures -->
                        <div class="task-item p-3 border border-gray-200 rounded-lg bg-white shadow-sm">
                            <div class="flex items-start gap-3">
                                <div class="flex-1">
                                    <div class="mb-2">
                                        <h4 class="text-base font-semibold">Documents awaiting signature</h4>
                    </div>
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded border-l-4 border-gray-400">
                                            <div class="flex items-center gap-3">
                                                <i class="fas fa-file-signature text-gray-600"></i>
                                                <div class="flex-1">
                                                    <div class="font-medium text-sm">Lease v2.1</div>
                                                    <div class="text-xs text-gray-600 mb-2">Aug 1, 2025 - July 31, 2026</div>
                                                    <div class="flex items-center gap-1">
                                                        <span class="flex items-center justify-center">
                                                            <i class="fas fa-check text-green-600 text-xs"></i>
                                                        </span>
                                                        <span class="text-xs text-gray-600">Melinda</span>
                                                        <span class="flex items-center justify-center ml-2">
                                                            <i class="fas fa-check text-green-600 text-xs"></i>
                                                        </span>
                                                        <span class="text-xs text-gray-600">John</span>
                                                        <span class="w-4 h-4 bg-red-100 rounded-full flex items-center justify-center ml-2">
                                                            <i class="fas fa-exclamation text-red-600 text-xs"></i>
                                                        </span>
                                                        <span class="text-xs text-red-600 font-medium">Angela</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-1 ml-2">
                                                <button class="btn btn-light btn-sm" onclick="alert('Regenerate Document:\n\n• Create new version of Lease v2.1\n• Reset all signatures\n• Send to all parties for signing')">
                                                    <i class="fas fa-redo mr-1"></i>Regenerate
                                                </button>
                                                <button class="btn btn-light btn-sm" onclick="alert('Mark as Manually Signed:\n\n• Bypass electronic signature\n• Mark Angela as signed\n• Document completed')">
                                                    <i class="fas fa-signature mr-1"></i>Mark as manually signed
                                                </button>
                                                <button class="btn btn-light btn-sm text-red-600" onclick="alert('Delete Document:\n\n• Permanently remove Lease v2.1\n• All signatures will be lost\n• Cannot be undone')">
                                                    <i class="fas fa-trash-alt mr-1"></i>Delete
                                                </button>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded border-l-4 border-gray-400">
                                            <div class="flex items-center gap-3">
                                                <i class="fas fa-file-signature text-gray-600"></i>
                                                <div class="flex-1">
                                                    <div class="font-medium text-sm">Pet Addendum</div>
                                                    <div class="text-xs text-gray-600 mb-2">Modified July 30, 2025</div>
                                                    <div class="flex items-center gap-1">
                                                        <span class="flex items-center justify-center">
                                                            <i class="fas fa-check text-green-600 text-xs"></i>
                                                        </span>
                                                        <span class="text-xs text-gray-600">Melinda</span>
                                                        <span class="flex items-center justify-center ml-2">
                                                            <i class="fas fa-check text-green-600 text-xs"></i>
                                                        </span>
                                                        <span class="text-xs text-gray-600">John</span>
                                                        <span class="w-4 h-4 bg-red-100 rounded-full flex items-center justify-center ml-2">
                                                            <i class="fas fa-exclamation text-red-600 text-xs"></i>
                                                        </span>
                                                        <span class="text-xs text-red-600 font-medium">Angela</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-1 ml-2">
                                                <button class="btn btn-light btn-sm" onclick="alert('Regenerate Document:\n\n• Create new version of Pet Addendum\n• Reset all signatures\n• Send to all parties for signing')">
                                                    <i class="fas fa-redo mr-1"></i>Regenerate
                                                </button>
                                                <button class="btn btn-light btn-sm" onclick="alert('Mark as Manually Signed:\n\n• Bypass electronic signature\n• Mark Angela as signed\n• Document completed')">
                                                    <i class="fas fa-signature mr-1"></i>Mark as manually signed
                                                </button>
                                                <button class="btn btn-light btn-sm text-red-600" onclick="alert('Delete Document:\n\n• Permanently remove Pet Addendum\n• All signatures will be lost\n• Cannot be undone')">
                                                    <i class="fas fa-trash-alt mr-1"></i>Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-sm text-muted mt-3">
                                        <span class="inline-flex items-center gap-1">
                                            <i class="fas fa-clock text-red-600"></i>
                                            <span>Waiting since July 30, 2025</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Required Document Uploads -->
                        <div class="task-item p-3 border border-gray-200 rounded-lg bg-white shadow-sm">
                            <div class="flex items-start gap-3">
                                <div class="flex-1">
                                    <div class="mb-2">
                                        <h4 class="text-base font-semibold">Required document uploads</h4>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded border-l-4 border-gray-400">
                                            <div class="flex items-center gap-3">
                                                <i class="fas fa-upload text-gray-600"></i>
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-2">
                                                        <div class="font-medium text-sm">Insurance Certificate</div>
                                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">Required</span>
                                                    </div>
                                                    <div class="text-xs text-gray-600">Household</div>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-2 ml-2">
                                                <button class="btn btn-light btn-sm" onclick="alert('Upload for Resident:\n\n• Upload Insurance Certificate directly\n• Assign to household\n• Mark as complete')">
                                                    <i class="fas fa-upload mr-1"></i>Upload for resident
                                                </button>
                                                <button class="btn btn-light btn-sm" onclick="alert('Send Reminder:\n\n• Email reminder to residents\n• Include upload instructions\n• Set follow-up reminder')">
                                                    <i class="fas fa-bell mr-1"></i>Remind
                                                </button>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded border-l-4 border-gray-400">
                                            <div class="flex items-center gap-3">
                                                <i class="fas fa-upload text-gray-600"></i>
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-2">
                                                        <div class="font-medium text-sm">Driver's License</div>
                                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">Required</span>
                                                    </div>
                                                    <div class="text-xs text-gray-600">Angela Johnson</div>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-2 ml-2">
                                                <button class="btn btn-light btn-sm" onclick="alert('Upload for Resident:\n\n• Upload Driver License for Angela\n• Assign to Angela Johnson\n• Mark as complete')">
                                                    <i class="fas fa-upload mr-1"></i>Upload for resident
                                                </button>
                                                <button class="btn btn-light btn-sm" onclick="alert('Send Reminder:\n\n• Email reminder to Angela Johnson\n• Include upload instructions\n• Set follow-up reminder')">
                                                    <i class="fas fa-bell mr-1"></i>Remind
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-sm text-muted mt-3">
                                        <span class="inline-flex items-center gap-1">
                                            <i class="fas fa-exclamation-triangle text-red-500"></i>
                                            <span>Documents required for lease completion</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Processing Documents -->
                        <div class="task-item p-3 border border-gray-200 rounded-lg bg-white shadow-sm">
                            <div class="flex items-start gap-3">
                                <div class="flex-1">
                                    <div class="mb-2">
                                        <h4 class="text-base font-semibold">Document processing</h4>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded border-l-4 border-gray-400">
                                        <div class="flex items-center gap-3">
                                            <i class="fas fa-file-signature text-gray-500"></i>
                                            <div class="flex-1">
                                                <div class="flex items-center gap-2">
                                                    <div class="font-medium text-sm">Enclosed Garage Addendum</div>
                                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Processing</span>
                                                </div>
                                                <div class="text-xs text-gray-600 mb-1">Aug 1, 2025 - July 31, 2026</div>
                                                <div class="text-xs text-gray-600">Modified by Michael Davis • Jul 28, 2024</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2 ml-2">
                                            <button class="btn btn-light btn-sm text-red-600" onclick="alert('Delete Document:\n\n• Permanently remove Enclosed Garage Addendum\n• Stop processing\n• Cannot be undone')">
                                                <i class="fas fa-trash-alt mr-1"></i>Delete
                                            </button>
                                        </div>
                                    </div>
                                    <div class="text-sm text-muted mt-3">
                                        <span class="inline-flex items-center gap-1">
                                            <i class="fas fa-clock text-blue-600"></i>
                                            <span>Processing since Jul 28, 2024</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Floating Kebab Dropdown - Charges Actions (outside all containers) -->
    <div id="kebab-dropdown-charges" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 99999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-circle-plus mr-2 text-muted"></i>
            Add charge
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-print mr-2 text-muted"></i>
            Print
        </button>
        <hr class="my-1 border-gray-200">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-excel mr-2 text-muted"></i>
            Export to Excel
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-pdf mr-2 text-muted"></i>
            Export to PDF
        </button>
    </div>

    <script>
        // Handle Create Proposal button - Global function
        function handleCreateProposal() {
            alert('Create Lease Proposal:\n\n• Review current lease terms\n• Check market rent rates\n• Generate renewal proposal\n• Calculate new rent amount\n• Prepare proposal documents\n• Schedule tenant meeting');
        }
        
        // Toggle Past Roommates expanded view - Global function
        function togglePastRoommatesExpanded() {
            const summaryView = document.getElementById('past-roommates-summary');
            const expandedView = document.getElementById('past-roommates-expanded');
            const toggleText = document.getElementById('past-roommates-toggle-text');
            const chevron = document.getElementById('past-roommates-chevron');
            
            if (expandedView.classList.contains('hidden')) {
                // Expanding: show expanded view, hide summary
                expandedView.classList.remove('hidden');
                summaryView.classList.add('hidden');
                toggleText.textContent = 'Less details';
                chevron.classList.remove('fa-chevron-down');
                chevron.classList.add('fa-chevron-up');
            } else {
                // Collapsing: hide expanded view, show summary
                expandedView.classList.add('hidden');
                summaryView.classList.remove('hidden');
                toggleText.textContent = 'More details';
                chevron.classList.remove('fa-chevron-up');
                chevron.classList.add('fa-chevron-down');
            }
        }
        
        // Toggle Current Roommates expanded view - Global function
        function toggleCurrentRoommatesExpanded() {
            const summaryView = document.getElementById('current-roommates-summary');
            const expandedView = document.getElementById('current-roommates-expanded');
            const toggleText = document.getElementById('current-roommates-toggle-text');
            const chevron = document.getElementById('current-roommates-chevron');
            
            if (expandedView.classList.contains('hidden')) {
                // Expanding: show expanded view with emergency contacts and RentCafe details
                expandedView.classList.remove('hidden');
                summaryView.classList.add('hidden');
                toggleText.textContent = 'Less details';
                chevron.classList.remove('fa-chevron-down');
                chevron.classList.add('fa-chevron-up');
            } else {
                // Collapsing: hide expanded view, show basic summary
                expandedView.classList.add('hidden');
                summaryView.classList.remove('hidden');
                toggleText.textContent = 'More details';
                chevron.classList.remove('fa-chevron-up');
                chevron.classList.add('fa-chevron-down');
            }
        }
        
        // Handle View All Activities button - Global function
        function viewAllActivities() {
            alert('View All Activities:\n\n• Load complete activity timeline\n• Filter by activity type\n• Search specific dates or events\n• Export activity reports\n• View detailed communication history');
        }
        
        // Track if load more has been clicked - Global variable
        let timelineExpanded = false;
        
        // Handle Add Activity dropdown - Global functions
        function toggleActivityAddMenu() {
            const menu = document.getElementById('activity-add-menu');
            if (menu) {
                menu.classList.toggle('hidden');
            }
        }
        
        // Handle Lease Charges Popover - Global function
        function toggleLeaseChargesPopover(event) {
            event.stopPropagation();
            
            const popover = document.getElementById('lease-charges-popover');
            const button = event.target.closest('button');
            
            if (!popover || !button) return;
            
            // Close all other popovers/dropdowns first
            document.querySelectorAll('[id*="dropdown"], [id*="popover"]').forEach(element => {
                if (element.id !== 'lease-charges-popover') {
                    element.classList.add('hidden');
                }
            });
            
            // Toggle current popover
            if (popover.classList.contains('hidden')) {
                // Show popover
                popover.classList.remove('hidden');
                
                // Position popover near the button
                const buttonRect = button.getBoundingClientRect();
                const popoverRect = popover.getBoundingClientRect();
                
                // Calculate position (below and to the right of button)
                let left = buttonRect.right + 5;
                let top = buttonRect.bottom + 5;
                
                // Adjust if popover would go off-screen
                if (left + popoverRect.width > window.innerWidth) {
                    left = buttonRect.left - popoverRect.width - 5;
                }
                if (top + popoverRect.height > window.innerHeight) {
                    top = buttonRect.top - popoverRect.height - 5;
                }
                
                // Ensure popover stays on screen
                left = Math.max(10, Math.min(left, window.innerWidth - popoverRect.width - 10));
                top = Math.max(10, Math.min(top, window.innerHeight - popoverRect.height - 10));
                
                popover.style.left = left + 'px';
                popover.style.top = top + 'px';
            } else {
                // Hide popover
                popover.classList.add('hidden');
            }
        }
        
        // Handle Deposit Popover - Global function
        function toggleDepositPopover(event) {
            event.stopPropagation();
            
            const popover = document.getElementById('deposit-popover');
            const button = event.target.closest('button');
            
            if (!popover || !button) return;
            
            // Close all other popovers/dropdowns first
            document.querySelectorAll('[id*="dropdown"], [id*="popover"]').forEach(element => {
                if (element.id !== 'deposit-popover') {
                    element.classList.add('hidden');
                }
            });
            
            // Toggle current popover
            if (popover.classList.contains('hidden')) {
                // Show popover
                popover.classList.remove('hidden');
                
                // Position popover near the button
                const buttonRect = button.getBoundingClientRect();
                const popoverRect = popover.getBoundingClientRect();
                
                // Calculate position (below and to the right of button)
                let left = buttonRect.right + 5;
                let top = buttonRect.bottom + 5;
                
                // Adjust if popover would go off-screen
                if (left + popoverRect.width > window.innerWidth) {
                    left = buttonRect.left - popoverRect.width - 5;
                }
                if (top + popoverRect.height > window.innerHeight) {
                    top = buttonRect.top - popoverRect.height - 5;
                }
                
                // Ensure popover stays on screen
                left = Math.max(10, Math.min(left, window.innerWidth - popoverRect.width - 10));
                top = Math.max(10, Math.min(top, window.innerHeight - popoverRect.height - 10));
                
                popover.style.left = left + 'px';
                popover.style.top = top + 'px';
            } else {
                // Hide popover
                popover.classList.add('hidden');
            }
        }
        
        function addActivityType(type) {
            // Close the dropdown
            const menu = document.getElementById('activity-add-menu');
            if (menu) menu.classList.add('hidden');
            
            // Show appropriate modal based on activity type
            switch(type) {
                case 'comment':
                    showActivityModal('comment');
                    break;
                case 'follow-up':
                    showActivityModal('follow-up');
                    break;
                case 'appointment':
                    showActivityModal('appointment');
                    break;
                case 'log':
                    showActivityModal('log');
                    break;
                case 'memo':
                    showActivityModal('memo');
                    break;
                default:
                    alert('Unknown activity type selected');
            }
        }
        
        // Show activity modal based on type
        function showActivityModal(type) {
            // Remove any existing modal
            const existingModal = document.getElementById('activity-modal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Create modal HTML based on type
            let modalContent = '';
            let modalTitle = '';
            let activityIcon = '';
            
            switch(type) {
                case 'comment':
                    modalTitle = 'Add Comment';
                    activityIcon = 'fas fa-comment';
                    modalContent = `
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Comment</label>
                            <textarea id="activity-content" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="4" placeholder="Enter your comment..."></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                            <select id="activity-priority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="normal">Normal</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'follow-up':
                    modalTitle = 'Add Follow-up';
                    activityIcon = 'fas fa-user-clock';
                    modalContent = `
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Follow-up Task</label>
                            <input type="text" id="activity-title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter follow-up task...">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Due Date</label>
                            <input type="datetime-local" id="activity-due-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea id="activity-content" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3" placeholder="Enter follow-up details..."></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                            <select id="activity-priority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="normal">Normal</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'appointment':
                    modalTitle = 'Schedule Appointment';
                    activityIcon = 'fas fa-calendar-check';
                    modalContent = `
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Appointment Title</label>
                            <input type="text" id="activity-title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter appointment title...">
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Date & Time</label>
                                <input type="datetime-local" id="activity-due-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Duration</label>
                                <select id="activity-duration" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="15">15 minutes</option>
                                    <option value="30">30 minutes</option>
                                    <option value="60" selected>1 hour</option>
                                    <option value="90">1.5 hours</option>
                                    <option value="120">2 hours</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                            <input type="text" id="activity-location" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter location...">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                            <textarea id="activity-content" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3" placeholder="Enter appointment notes..."></textarea>
                        </div>
                    `;
                    break;
                case 'log':
                    modalTitle = 'Log Activity';
                    activityIcon = 'fas fa-clipboard-list';
                    modalContent = `
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Activity Type</label>
                            <select id="activity-log-type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="phone-call">Phone Call</option>
                                <option value="email-sent">Email Sent</option>
                                <option value="meeting">Meeting</option>
                                <option value="property-visit">Property Visit</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Activity Title</label>
                            <input type="text" id="activity-title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter activity title...">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea id="activity-content" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="4" placeholder="Describe what was done..."></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Outcome</label>
                            <select id="activity-outcome" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="successful">Successful</option>
                                <option value="needs-follow-up">Needs Follow-up</option>
                                <option value="incomplete">Incomplete</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'memo':
                    modalTitle = 'Add Memo';
                    activityIcon = 'fas fa-sticky-note';
                    modalContent = `
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                            <input type="text" id="activity-title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter memo subject...">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Content</label>
                            <textarea id="activity-content" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="5" placeholder="Enter memo content..."></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                            <select id="activity-category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="general">General</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="financial">Financial</option>
                                <option value="lease">Lease</option>
                                <option value="complaint">Complaint</option>
                                <option value="emergency">Emergency</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                            <select id="activity-priority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="normal">Normal</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    `;
                    break;
            }
            
            // Create modal
            const modal = document.createElement('div');
            modal.id = 'activity-modal';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between p-6 border-b">
                        <div class="flex items-center">
                            <div class="bg-blue-100 rounded-full p-2 mr-3">
                                <i class="${activityIcon} text-blue-600"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900">${modalTitle}</h3>
                        </div>
                        <button onclick="closeActivityModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${modalContent}
                        <div class="flex justify-end gap-3 mt-6">
                            <button onclick="closeActivityModal()" class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                Cancel
                            </button>
                            <button onclick="saveActivity('${type}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                Save ${modalTitle}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add to body
            document.body.appendChild(modal);
            
            // Focus first input
            setTimeout(() => {
                const firstInput = modal.querySelector('input, textarea');
                if (firstInput) firstInput.focus();
            }, 100);
        }
        
        // Close activity modal
        function closeActivityModal() {
            const modal = document.getElementById('activity-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Validate activity form
        function validateActivityForm(type, data) {
            const errors = [];
            
            // Required field validation based on activity type
            switch(type) {
                case 'comment':
                    if (!data.content.trim()) {
                        errors.push({
                            field: 'activity-content',
                            message: 'Comment content is required.'
                        });
                    }
                    break;
                    
                case 'follow-up':
                    if (!data.title.trim()) {
                        errors.push({
                            field: 'activity-title',
                            message: 'Follow-up task is required.'
                        });
                    }
                    // Validate due date if provided
                    if (data.dueDate) {
                        const dueDateTime = new Date(data.dueDate);
                        const now = new Date();
                        if (dueDateTime <= now) {
                            errors.push({
                                field: 'activity-due-date',
                                message: 'Due date must be in the future.'
                            });
                        }
                    }
                    break;
                    
                case 'appointment':
                    if (!data.title.trim()) {
                        errors.push({
                            field: 'activity-title',
                            message: 'Appointment title is required.'
                        });
                    }
                    if (!data.dueDate) {
                        errors.push({
                            field: 'activity-due-date',
                            message: 'Appointment date and time is required.'
                        });
                    } else {
                        const appointmentDateTime = new Date(data.dueDate);
                        const now = new Date();
                        if (appointmentDateTime <= now) {
                            errors.push({
                                field: 'activity-due-date',
                                message: 'Appointment must be scheduled for a future date.'
                            });
                        }
                    }
                    break;
                    
                case 'log':
                    if (!data.title.trim()) {
                        errors.push({
                            field: 'activity-title',
                            message: 'Activity title is required.'
                        });
                    }
                    break;
                    
                case 'memo':
                    if (!data.title.trim()) {
                        errors.push({
                            field: 'activity-title',
                            message: 'Memo subject is required.'
                        });
                    }
                    if (!data.content.trim()) {
                        errors.push({
                            field: 'activity-content',
                            message: 'Memo content is required.'
                        });
                    }
                    break;
            }
            
            // General validations
            if (data.title && data.title.length > 100) {
                errors.push({
                    field: 'activity-title',
                    message: 'Title must be less than 100 characters.'
                });
            }
            
            if (data.content && data.content.length > 500) {
                errors.push({
                    field: 'activity-content',
                    message: 'Content must be less than 500 characters.'
                });
            }
            
            return errors;
        }
        
        // Clear validation errors
        function clearValidationErrors() {
            const modal = document.getElementById('activity-modal');
            if (!modal) return;
            
            // Remove error classes and messages
            const errorElements = modal.querySelectorAll('.error');
            errorElements.forEach(element => {
                element.classList.remove('error');
                element.style.borderColor = '';
            });
            
            const errorMessages = modal.querySelectorAll('.error-message');
            errorMessages.forEach(msg => msg.remove());
            
            // Remove error alert if exists
            const errorAlert = modal.querySelector('.error-alert');
            if (errorAlert) errorAlert.remove();
        }
        
        // Display validation errors
        function displayValidationErrors(errors) {
            const modal = document.getElementById('activity-modal');
            if (!modal) return;
            
            // Add error styling to fields
            errors.forEach(error => {
                const field = document.getElementById(error.field);
                if (field) {
                    field.classList.add('error');
                    field.style.borderColor = '#ef4444';
                    
                    // Add error message below field
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'error-message text-sm text-red-600 mt-1';
                    errorMessage.textContent = error.message;
                    
                    // Insert after the field
                    field.parentNode.insertBefore(errorMessage, field.nextSibling);
                }
            });
            
            // Add general error alert at top of modal
            const modalContent = modal.querySelector('.p-6');
            const errorAlert = document.createElement('div');
            errorAlert.className = 'error-alert bg-red-50 border border-red-200 rounded-lg p-3 mb-4';
            errorAlert.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                    <div>
                        <span class="text-red-800 font-medium">Please correct the following errors:</span>
                        <ul class="text-red-700 text-sm mt-1 ml-4">
                            ${errors.map(error => `<li>• ${error.message}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            modalContent.insertBefore(errorAlert, modalContent.firstChild);
            
            // Focus on first error field
            const firstErrorField = document.getElementById(errors[0].field);
            if (firstErrorField) {
                firstErrorField.focus();
            }
        }
        
        // Save new activity
        function saveActivity(type) {
            // Clear any previous error states
            clearValidationErrors();
            
            // Get form values
            const title = document.getElementById('activity-title')?.value || '';
            const content = document.getElementById('activity-content')?.value || '';
            const priority = document.getElementById('activity-priority')?.value || 'normal';
            const dueDate = document.getElementById('activity-due-date')?.value || '';
            const duration = document.getElementById('activity-duration')?.value || '';
            const location = document.getElementById('activity-location')?.value || '';
            const logType = document.getElementById('activity-log-type')?.value || '';
            const outcome = document.getElementById('activity-outcome')?.value || '';
            const category = document.getElementById('activity-category')?.value || '';
            
            // Validate fields and collect errors
            const errors = validateActivityForm(type, {
                title, content, dueDate, location
            });
            
            if (errors.length > 0) {
                displayValidationErrors(errors);
                return;
            }
            
            // Create new activity object
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                timeZoneName: 'short'
            });
            
            // Insert new activity into timeline
            insertNewActivity(type, {
                title,
                content,
                priority,
                dueDate,
                duration,
                location,
                logType,
                outcome,
                category,
                timeString,
                timestamp: now
            });
            
            // Close modal
            closeActivityModal();
        }
        
        // Insert new activity into timeline
        function insertNewActivity(type, data) {
            const today = new Date();
            const todayString = today.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
            
            // Get or create today's section
            let todaySection = null;
            const activitySections = document.querySelectorAll('.activity-section');
            
            // Check if today's section already exists
            activitySections.forEach(section => {
                const header = section.querySelector('.activity-date-header span');
                if (header && header.textContent.includes(today.getDate() + ', ' + today.getFullYear())) {
                    todaySection = section;
                }
            });
            
            // Create today's section if it doesn't exist
            if (!todaySection) {
                todaySection = document.createElement('div');
                todaySection.className = 'activity-section';
                todaySection.innerHTML = `
                    <div class="activity-date-header">
                        <i class="fas fa-circle text-primary text-sm mr-2"></i>
                        <span class="font-semibold">Today: ${todayString.replace(/^\w+: /, '')}</span>
                    </div>
                `;
                
                // Insert at the beginning of timeline container
                const timelineContainer = document.getElementById('activity-timeline-container');
                if (timelineContainer.firstElementChild) {
                    timelineContainer.insertBefore(todaySection, timelineContainer.firstElementChild);
                } else {
                    timelineContainer.appendChild(todaySection);
                }
            }
            
            // Determine activity details based on type
            let activityHTML = '';
            let activityIcon = '';
            let activityTypeText = '';
            let activityFilter = 'communications';
            let communicationType = 'comment-memo';
            let activityDescription = '';
            
            switch(type) {
                case 'comment':
                    activityIcon = 'fas fa-comment text-primary';
                    activityTypeText = 'Comment: Added';
                    activityDescription = data.content;
                    communicationType = 'comment-memo';
                    break;
                case 'follow-up':
                    activityIcon = 'fas fa-user-clock text-primary';
                    activityTypeText = 'Follow-Up: Created';
                    activityDescription = data.title + (data.content ? ' - ' + data.content : '');
                    communicationType = 'follow-up';
                    if (data.dueDate) {
                        const dueDate = new Date(data.dueDate);
                        activityDescription += ` (Due: ${dueDate.toLocaleDateString()})`;
                    }
                    break;
                case 'appointment':
                    activityIcon = 'fas fa-calendar-check text-primary';
                    activityTypeText = 'Appointment: Scheduled';
                    activityDescription = data.title;
                    communicationType = 'appointment';
                    if (data.dueDate) {
                        const aptDate = new Date(data.dueDate);
                        activityDescription += ` (${aptDate.toLocaleDateString()} ${aptDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})})`;
                    }
                    if (data.location) {
                        activityDescription += ` at ${data.location}`;
                    }
                    break;
                case 'log':
                    activityIcon = 'fas fa-clipboard-list text-primary';
                    activityTypeText = `Activity: ${data.logType?.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) || 'Logged'}`;
                    activityDescription = data.title + (data.content ? ' - ' + data.content : '');
                    communicationType = 'comment-memo';
                    break;
                case 'memo':
                    activityIcon = 'fas fa-sticky-note text-primary';
                    activityTypeText = 'Memo: Added';
                    activityDescription = data.title + (data.content ? ' - ' + data.content : '');
                    communicationType = 'comment-memo';
                    break;
            }
            
            // Create the activity HTML
            activityHTML = `
                <div class="activity-item new-activity" data-filter="${activityFilter}" data-communication-type="${communicationType}" data-time="recent" data-activity-type="user" style="opacity: 0; transform: translateY(-10px);">
                    <div class="activity-icon bg-primary-light">
                        <i class="${activityIcon}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-header">
                            <span class="activity-type">${activityTypeText}</span>
                            <span class="activity-time">${data.timeString}</span>
                        </div>
                        <p class="activity-description">${activityDescription}</p>
                        <div class="activity-meta">
                            <span class="text-sm text-muted">by Current User</span>
                            ${data.priority && data.priority !== 'normal' ? `<span class="text-sm text-muted"> • ${data.priority.charAt(0).toUpperCase() + data.priority.slice(1)} Priority</span>` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            // Insert the activity at the beginning of today's section (after the date header)
            const dateHeader = todaySection.querySelector('.activity-date-header');
            if (dateHeader.nextElementSibling) {
                dateHeader.insertAdjacentHTML('afterend', activityHTML);
            } else {
                todaySection.insertAdjacentHTML('beforeend', activityHTML);
            }
            
            // Get the newly added activity element for animation
            const newActivity = todaySection.querySelector('.new-activity');
            
            // Animate the new activity
            setTimeout(() => {
                newActivity.style.opacity = '1';
                newActivity.style.transform = 'translateY(0)';
                newActivity.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                newActivity.classList.remove('new-activity');
            }, 50);
            
            // Apply current filters to ensure visibility
            setTimeout(() => {
                applyFiltersToItem(newActivity);
                
                // Show success notification
                showNotification(`${activityTypeText.split(':')[0]} added successfully!`, 'success');
            }, 100);
            
            // Save to local storage for persistence
            saveActivityToStorage(type, data);
        }
        
        // Save activity to local storage
        function saveActivityToStorage(type, data) {
            try {
                let activities = JSON.parse(localStorage.getItem('resident-activities') || '[]');
                activities.unshift({
                    id: Date.now(),
                    type: type,
                    data: data,
                    timestamp: new Date().toISOString()
                });
                
                // Keep only last 100 activities
                activities = activities.slice(0, 100);
                
                localStorage.setItem('resident-activities', JSON.stringify(activities));
            } catch (e) {
                console.warn('Could not save activity to local storage:', e);
            }
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            // Remove existing notification
            const existing = document.getElementById('activity-notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.id = 'activity-notification';
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-x-0 ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Track progressive loading
        let activitiesShownFromHidden = 0;
        const activitiesPerLoad = 6; // Show 6 more activities each time
        
        // Toggle Activities (Load More / Collapse) - Global function
        function toggleActivities() {
            if (timelineExpanded) {
                collapseActivities();
            } else {
                loadMoreActivities();
            }
        }
        
        // Handle Load More Activities button - Progressive loading
        function loadMoreActivities() {
            const hiddenActivities = document.getElementById('hidden-activities');
            const loadMoreSection = document.getElementById('load-more-section');
            const toggleIcon = document.getElementById('toggle-activities-icon');
            const toggleText = document.getElementById('toggle-activities-text');
            
            if (hiddenActivities && loadMoreSection) {
                // Get all activity sections in the hidden area
                const allHiddenSections = hiddenActivities.querySelectorAll('.activity-section');
                
                // Show the next batch of activity sections
                const sectionsToShow = Math.min(activitiesPerLoad, allHiddenSections.length - activitiesShownFromHidden);
                
                for (let i = 0; i < sectionsToShow; i++) {
                    const sectionIndex = activitiesShownFromHidden + i;
                    if (sectionIndex < allHiddenSections.length) {
                        const section = allHiddenSections[sectionIndex];
                        section.style.display = 'block';
                        
                        // Apply current filters to activities in this section
                        const itemsInSection = section.querySelectorAll('.activity-item');
                        let visibleItemsCount = 0;
                        itemsInSection.forEach(item => {
                            applyFiltersToItem(item);
                            if (!item.classList.contains('hidden')) {
                                visibleItemsCount++;
                            }
                        });
                    }
                }
                
                // Update the count
                activitiesShownFromHidden += sectionsToShow;
                
                // Always expand the timeline to show new content
                const activityCard = document.getElementById('activity-timeline-card');
                const timelineContainer = document.getElementById('activity-timeline-container');
                const cardContent = activityCard ? activityCard.querySelector('.card-content') : null;
                
                // Ensure hidden activities container is visible
                if (hiddenActivities.classList.contains('hidden')) {
                    hiddenActivities.classList.remove('hidden');
                }
                
                if (activityCard && timelineContainer) {
                    // Remove ALL height constraints so timeline can grow
                    activityCard.style.height = 'auto';
                    activityCard.classList.remove('matched-height');
                    
                    // Clear card-content height constraint
                    if (cardContent) {
                        cardContent.style.height = 'auto';
                        cardContent.style.overflow = 'visible';
                    }
                    
                    // Clear timeline container constraints
                    timelineContainer.style.height = 'auto';
                    timelineContainer.style.maxHeight = 'none';
                    timelineContainer.style.overflowY = 'visible';
                }
                
                // Check if there are more matching activities to load
                let hasMoreMatchingActivities = false;
                
                // Get current filter settings
                const selectedFilterOption = document.querySelector('.activity-filter-option.selected');
                const currentFilter = selectedFilterOption ? selectedFilterOption.getAttribute('data-value') : 'all';
                const commTypeSelected = document.querySelector('#communication-type-filter-dropdown .activity-filter-option.selected');
                const sourceSelected = document.querySelector('#source-filter-dropdown .activity-filter-option.selected');
                const currentCommFilter = commTypeSelected ? commTypeSelected.getAttribute('data-value') : 'all-communications';
                const currentSourceFilter = sourceSelected ? sourceSelected.getAttribute('data-value') : 'all-sources';
                
                console.log('🔍 Checking for more matching activities:', {
                    currentFilter,
                    currentCommFilter,
                    currentSourceFilter,
                    activitiesShownFromHidden,
                    totalSections: allHiddenSections.length,
                    sectionsToCheck: allHiddenSections.length - activitiesShownFromHidden
                });
                
                // Check remaining sections for matching activities
                for (let i = activitiesShownFromHidden; i < allHiddenSections.length; i++) {
                    const section = allHiddenSections[i];
                    const sectionItems = section.querySelectorAll('.activity-item');
                    
                    console.log(`📂 Checking section ${i}:`, {
                        sectionItems: sectionItems.length,
                        sectionElement: section
                    });
                    
                    const matchingItems = [];
                    const hasMatchingItems = Array.from(sectionItems).some(item => {
                        const itemFilters = item.getAttribute('data-filter') || '';
                        const itemCommType = item.getAttribute('data-communication-type') || '';
                        const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                        
                        let shouldShow = false;
                        
                        if (currentFilter === 'all') {
                            shouldShow = true;
                        } else if (currentFilter === 'system') {
                            shouldShow = itemActivityType === 'system';
                        } else if (currentFilter === 'user') {
                            shouldShow = itemActivityType === 'user';
                        } else if (currentFilter === 'communications') {
                            if (itemFilters.includes('communications')) {
                                const typeMatches = currentCommFilter === 'all-communications' || itemCommType === currentCommFilter;
                                shouldShow = typeMatches;
                            }
                        } else {
                            shouldShow = itemFilters.includes(currentFilter);
                        }
                        
                        // Apply source filter to all activity types
                        if (shouldShow && currentSourceFilter !== 'all-sources') {
                            shouldShow = itemActivityType === currentSourceFilter;
                        }
                        
                        if (shouldShow) {
                            matchingItems.push({
                                itemFilters,
                                itemCommType,
                                itemActivityType,
                                element: item
                            });
                        }
                        
                        return shouldShow;
                    });
                    
                    console.log(`📂 Section ${i} results:`, {
                        hasMatchingItems,
                        matchingItems: matchingItems.length,
                        matchingDetails: matchingItems
                    });
                    
                    if (hasMatchingItems) {
                        hasMoreMatchingActivities = true;
                        break;
                    }
                }
                
                console.log('🎯 Final decision:', {
                    hasMoreMatchingActivities,
                    allSectionsShown: activitiesShownFromHidden >= allHiddenSections.length,
                    shouldCollapse: activitiesShownFromHidden >= allHiddenSections.length || !hasMoreMatchingActivities
                });
                
                // Update button based on whether there are more matching activities
                if (activitiesShownFromHidden >= allHiddenSections.length || !hasMoreMatchingActivities) {
                    // All sections shown OR no more matching activities, change to collapse button
                    console.log('✅ Switching to collapse button - no more matching activities');
                    timelineExpanded = true;
                    toggleIcon.className = 'fas fa-chevron-up mr-2';
                    toggleText.textContent = 'Show less activities';
                    
                    // Remove the hidden class from the container
                    hiddenActivities.classList.remove('hidden');
                } else {
                    // More matching activities to show, keep as "Load more"
                    console.log('📋 Keeping load more button - more matching activities found');
                    toggleText.textContent = 'Load more activities';
                }
                
                // Update empty state for visible sections
                updateActivitySections();
                
                // Also update the load more button state based on current filter
                updateLoadMoreButtonState();

            }
        }
        
        // Helper function to update load more button state based on current filter
        function updateLoadMoreButtonState() {
            const hiddenActivities = document.getElementById('hidden-activities');
            const loadMoreSection = document.getElementById('load-more-section');
            const toggleIcon = document.getElementById('toggle-activities-icon');
            const toggleText = document.getElementById('toggle-activities-text');
            
            if (!hiddenActivities || !loadMoreSection || !toggleIcon || !toggleText) {
                return;
            }
            
            const allHiddenSections = hiddenActivities.querySelectorAll('.activity-section');
            
            // If timeline is already expanded (showing collapse button), don't change it
            if (timelineExpanded) {
                return;
            }
            
            // Get current filter settings
            const selectedFilterOption = document.querySelector('.activity-filter-option.selected');
            const currentFilter = selectedFilterOption ? selectedFilterOption.getAttribute('data-value') : 'all';
            const commTypeSelected = document.querySelector('#communication-type-filter-dropdown .activity-filter-option.selected');
            const sourceSelected = document.querySelector('#source-filter-dropdown .activity-filter-option.selected');
            const currentCommFilter = commTypeSelected ? commTypeSelected.getAttribute('data-value') : 'all-communications';
            const currentSourceFilter = sourceSelected ? sourceSelected.getAttribute('data-value') : 'all-sources';
            
            let hasMatchingHiddenActivities = false;
            
            // Check if there are any activities in the hidden section that match current filter
            if (hiddenActivities.classList.contains('hidden')) {
                const hiddenItems = hiddenActivities.querySelectorAll('.activity-item');
                hasMatchingHiddenActivities = Array.from(hiddenItems).some(item => {
                    const itemFilters = item.getAttribute('data-filter') || '';
                    const itemCommType = item.getAttribute('data-communication-type') || '';
                    const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                    
                    let shouldShow = false;
                    
                    if (currentFilter === 'all') {
                        shouldShow = true;
                    } else if (currentFilter === 'system') {
                        shouldShow = itemActivityType === 'system';
                    } else if (currentFilter === 'user') {
                        shouldShow = itemActivityType === 'user';
                    } else if (currentFilter === 'communications') {
                        if (itemFilters.includes('communications')) {
                            const typeMatches = currentCommFilter === 'all-communications' || itemCommType === currentCommFilter;
                            shouldShow = typeMatches;
                        }
                    } else {
                        shouldShow = itemFilters.includes(currentFilter);
                    }
                    
                    // Apply source filter to all activity types
                    if (shouldShow && currentSourceFilter !== 'all-sources') {
                        shouldShow = itemActivityType === currentSourceFilter;
                    }
                    
                    return shouldShow;
                });
            }
            
            console.log('🔄 updateLoadMoreButtonState:', {
                currentFilter,
                hasMatchingHiddenActivities,
                hiddenSectionIsHidden: hiddenActivities.classList.contains('hidden')
            });
            
            // Update button visibility based on whether there are matching activities
            if (hasMatchingHiddenActivities) {
                loadMoreSection.style.display = 'block';
                loadMoreSection.style.opacity = '1';
                toggleIcon.className = 'fas fa-chevron-down mr-2';
                toggleText.textContent = 'Load more activities';
            } else {
                // No matching activities in hidden section, hide the button or show collapse if timeline has any content
                const visibleItems = document.querySelectorAll('.activity-item:not(.hidden):not(#hidden-activities .activity-item)');
                if (visibleItems.length > 0) {
                    // There are visible activities, so show the interface but make it clear no more can be loaded
                    loadMoreSection.style.display = 'block';
                    loadMoreSection.style.opacity = '0.5';
                    toggleIcon.className = 'fas fa-info-circle mr-2';
                    toggleText.textContent = 'No more activities to load';
                } else {
                    // No visible activities at all, hide the button
                    loadMoreSection.style.display = 'none';
                }
            }
        }
        
        // Helper function to apply current filters to a single item
        function applyFiltersToItem(item) {
            const selectedFilterOption = document.querySelector('.activity-filter-option.selected');
            const currentFilter = selectedFilterOption ? selectedFilterOption.getAttribute('data-value') : 'all';
            
            const commTypeSelected = document.querySelector('#communication-type-filter-dropdown .activity-filter-option.selected');
            const sourceSelected = document.querySelector('#source-filter-dropdown .activity-filter-option.selected');
            const currentCommFilter = commTypeSelected ? commTypeSelected.getAttribute('data-value') : 'all-communications';
            const currentSourceFilter = sourceSelected ? sourceSelected.getAttribute('data-value') : 'all-sources';
            
                        const itemFilters = item.getAttribute('data-filter') || '';
            const itemCommType = item.getAttribute('data-communication-type') || '';
            const itemActivityType = item.getAttribute('data-activity-type') || 'user';
            
            let shouldShow = false;
            
            if (currentFilter === 'all') {
                shouldShow = true;
            } else if (currentFilter === 'system') {
                shouldShow = itemActivityType === 'system';
            } else if (currentFilter === 'user') {
                shouldShow = itemActivityType === 'user';
            } else if (currentFilter === 'communications') {
                if (itemFilters.includes('communications')) {
                    const typeMatches = currentCommFilter === 'all-communications' || itemCommType === currentCommFilter;
                    shouldShow = typeMatches;
                }
                                } else {
                shouldShow = itemFilters.includes(currentFilter);
                                }
            
            // Apply source filter to all activity types
            if (shouldShow && currentSourceFilter !== 'all-sources') {
                shouldShow = itemActivityType === currentSourceFilter;
            }
            
            if (shouldShow) {
                item.classList.remove('hidden');
                            } else {
                item.classList.add('hidden');
            }
        }
        
        // Helper function to update activity section visibility
        function updateActivitySections() {
            const allSections = document.querySelectorAll('.activity-section');
            allSections.forEach(section => {
                const visibleItems = section.querySelectorAll('.activity-item:not(.hidden)');
                if (visibleItems.length > 0) {
                    section.classList.remove('empty');
                    section.style.display = 'block'; // Show sections with content
                        } else {
                    section.classList.add('empty');
                    section.style.display = 'none'; // Hide empty sections
                }
            });
        }
        
        // Reset communication filters to default values
        function resetCommunicationFilters() {
            resetCommunicationTypeFilter();
            resetSourceFilter();
        }
        
        // Reset only communication type filter
        function resetCommunicationTypeFilter() {
            const commTypeOptions = document.querySelectorAll('#communication-type-filter-dropdown .activity-filter-option');
            commTypeOptions.forEach(option => option.classList.remove('selected'));
            const defaultTypeOption = document.querySelector('#communication-type-filter-dropdown .activity-filter-option[data-value="all-communications"]');
            if (defaultTypeOption) {
                defaultTypeOption.classList.add('selected');
                const typeBtn = document.getElementById('communication-type-filter-btn');
                if (typeBtn) {
                    typeBtn.querySelector('.filter-current-text').textContent = 'All Communications';
                }
                }
            }
            
        // Reset only source filter
        function resetSourceFilter() {
            const sourceOptions = document.querySelectorAll('#source-filter-dropdown .activity-filter-option');
            sourceOptions.forEach(option => option.classList.remove('selected'));
            const defaultSourceOption = document.querySelector('#source-filter-dropdown .activity-filter-option[data-value="all-sources"]');
            if (defaultSourceOption) {
                defaultSourceOption.classList.add('selected');
                const sourceBtn = document.getElementById('source-filter-btn');
                if (sourceBtn) {
                    sourceBtn.querySelector('.filter-current-text').textContent = 'All Sources';
                }
            }
        }
        
        // Handle Collapse Activities - Global function
        function collapseActivities() {
            const hiddenActivities = document.getElementById('hidden-activities');
            const loadMoreSection = document.getElementById('load-more-section');
            const toggleIcon = document.getElementById('toggle-activities-icon');
            const toggleText = document.getElementById('toggle-activities-text');
            
            if (hiddenActivities && loadMoreSection) {
                // Reset progressive loading counter
                activitiesShownFromHidden = 0;
                
                // Use requestAnimationFrame to batch DOM updates
                    requestAnimationFrame(() => {
                    // Mark timeline as collapsed
                    timelineExpanded = false;
                    
                    // Reset button position to original location before hiding activities
                    resetButtonPosition();
                    
                    // Hide all hidden activities
                    hiddenActivities.classList.add('hidden');
                    
                    // Hide all individual sections that were progressively shown
                    const allHiddenSections = hiddenActivities.querySelectorAll('.activity-section');
                    allHiddenSections.forEach(section => {
                        section.style.display = 'none';
                    });
                    
                    // Update button to show load more option
                    if (toggleIcon && toggleText) {
                        toggleIcon.className = 'fas fa-chevron-down mr-2';
                        toggleText.textContent = 'Load more activities';
                    }
                    
                    // Restore matched height when collapsed
                setTimeout(() => {
                        // Reset the timeline to match the center column height again
                        const activityCard = document.getElementById('activity-timeline-card');
                        const timelineContainer = document.getElementById('activity-timeline-container');
                        if (activityCard && timelineContainer) {
                            // Re-apply height matching
                            matchActivityTimelineHeight();
                        }
                    }, 100);
                    
                    // Scroll back to the load more button for better UX (only if visible)
                    if (loadMoreSection.style.display !== 'none') {
                        loadMoreSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
            }
        }
        
        // Handle Add Note button - Global function
        function addNote() {
            alert('Add Note:\n\n• Create new note entry\n• Add note content and description\n• Tag relevant topics or categories\n• Assign priority level\n• Link to resident record\n• Save for future reference');
        }
        
        // Handle View All Notes button - Global function
        function viewAllNotes() {
            alert('View All Notes:\n\n• Load complete notes history\n• Filter by author or date\n• Search note content\n• Export notes reports\n• View detailed note history\n• Manage note categories');
        }
        
        // Pet Details Actions - Global functions
        function editPet(petName) {
            alert(`Edit Pet: ${petName}\n\n• Update pet information\n• Modify weight, age, breed details\n• Upload vaccination records\n• Update service animal status\n• Save changes to resident record`);
        }
        
        function deletePet(petName) {
            if (confirm(`Are you sure you want to remove ${petName} from this resident's record?\n\nThis action cannot be undone.`)) {
                alert(`Pet ${petName} has been removed from the resident record.`);
                // In a real application, this would remove the pet from the database
            }
        }
        
        function addNewPet() {
            alert('Add New Pet:\n\n• Enter pet information\n• Upload pet photos\n• Add vaccination records\n• Set service animal status\n• Complete pet registration\n• Update lease agreement if needed');
        }

        function addNewRoommate() {
            alert('Add New Roommate:\n\n• Add roommate information\n• Set roommate details\n• Update lease agreement\n• Configure access permissions');
        }
        
        // Vehicle Details Actions - Global functions
        function editVehicle(vehicleName) {
            alert(`Edit Vehicle: ${vehicleName}\n\n• Update license plate number\n• Change state registration\n• Modify make, model, year\n• Update vehicle color\n• Save changes to resident record`);
        }
        
        function deleteVehicle(vehicleName) {
            if (confirm(`Are you sure you want to remove ${vehicleName} from this resident's record?\n\nThis action cannot be undone.`)) {
                alert(`Vehicle ${vehicleName} has been removed from the resident record.`);
                // In a real application, this would remove the vehicle from the database
            }
        }
        
        function addNewVehicle() {
            alert('Add New Vehicle:\n\n• Enter license plate number\n• Select state registration\n• Add vehicle make and model\n• Enter vehicle year\n• Specify vehicle color\n• Save to resident record');
        }
        
        // Handle Note Expansion Toggle - Global function
        function toggleNoteExpansion() {
            const notePreview = document.getElementById('note-preview');
            const noteFull = document.getElementById('note-full');
            const noteToggle = document.getElementById('note-toggle');
            
            if (noteFull.classList.contains('hidden')) {
                // Expand note
                noteFull.classList.remove('hidden');
                noteToggle.textContent = 'read less';
            } else {
                // Collapse note
                noteFull.classList.add('hidden');
                noteToggle.textContent = 'read more';
            }
        }
        
        // Handle Note 2 Expansion Toggle - Global function
        function toggleNoteExpansion2() {
            const notePreview = document.getElementById('note-preview-2');
            const noteFull = document.getElementById('note-full-2');
            const noteToggle = document.getElementById('note-toggle-2');
            
            if (noteFull.classList.contains('hidden')) {
                // Expand note
                noteFull.classList.remove('hidden');
                noteToggle.textContent = 'read less';
            } else {
                // Collapse note
                noteFull.classList.add('hidden');
                noteToggle.textContent = 'read more';
            }
        }
        
        // Handle Note 3 Expansion Toggle - Global function
        function toggleNoteExpansion3() {
            const notePreview = document.getElementById('note-preview-3');
            const noteFull = document.getElementById('note-full-3');
            const noteToggle = document.getElementById('note-toggle-3');
            
            if (noteFull.classList.contains('hidden')) {
                // Expand note
                noteFull.classList.remove('hidden');
                noteToggle.textContent = 'read less';
            } else {
                // Collapse note
                noteFull.classList.add('hidden');
                noteToggle.textContent = 'read more';
            }
        }
        
        // Toggle alerts section
        function toggleAlerts() {
            const content = document.getElementById('alerts-content');
            const chevron = document.getElementById('alerts-chevron');
            const summary = document.getElementById('alerts-summary');
            
            if (content.style.display === 'none') {
                // Expanding: show content, hide summary
                content.style.display = 'block';
                summary.style.display = 'none';
                chevron.classList.remove('fa-chevron-down');
                chevron.classList.add('fa-chevron-up');
            } else {
                // Collapsing: hide content, show summary
                content.style.display = 'none';
                summary.style.display = 'flex';
                chevron.classList.remove('fa-chevron-up');
                chevron.classList.add('fa-chevron-down');
            }
        }
        
        
        // Activity filtering functionality
        function filterActivities(filter) {
            const activityCard = document.getElementById('activity-timeline-card');
            
            // Add filtering class to disable all transitions
            if (activityCard) {
                activityCard.classList.add('filtering');
            }
            
            // Use requestAnimationFrame to batch DOM updates and prevent flickering
            requestAnimationFrame(() => {
                const visibleItems = document.querySelectorAll('.activity-item:not(#hidden-activities .activity-item)');
                const hiddenSectionItems = document.querySelectorAll('#hidden-activities .activity-item');
                const communicationTypeContainer = document.getElementById('communication-type-filter-container');
                const sourceContainer = document.getElementById('source-filter-container');
                const activitySections = document.querySelectorAll('.activity-section');
                
                // Batch all DOM changes together
                const itemsToShow = [];
                const itemsToHide = [];
                
                // Show/hide communication sub-filters
                if (filter === 'communications') {
                    communicationTypeContainer.classList.remove('hidden');
                } else {
                    communicationTypeContainer.classList.add('hidden');
                    // Reset communication type filter when not showing communications
                    resetCommunicationTypeFilter();
                }
                
                // Source filter is now always visible - no need to hide/show
                
                // Get current source filter value
                const sourceSelected = document.querySelector('#source-filter-dropdown .activity-filter-option.selected');
                const currentSourceFilter = sourceSelected ? sourceSelected.getAttribute('data-value') : 'all-sources';
                
                // Prepare visible items changes
                visibleItems.forEach(item => {
                    const itemFilters = item.getAttribute('data-filter') || '';
                    const activityType = item.getAttribute('data-activity-type') || 'user';
                    
                    let shouldShow = false;
                    
                    if (filter === 'all') {
                        shouldShow = true;
                    } else if (filter === 'system') {
                        shouldShow = activityType === 'system';
                    } else if (filter === 'user') {
                        shouldShow = activityType === 'user';
                    } else {
                        shouldShow = itemFilters.includes(filter);
                    }
                    
                    // Apply source filter to all activity types
                    if (shouldShow && currentSourceFilter !== 'all-sources') {
                        shouldShow = activityType === currentSourceFilter;
                    }
                    
                    if (shouldShow) {
                        itemsToShow.push(item);
                    } else {
                        itemsToHide.push(item);
                    }
                });
                
                // Always process hidden section items and show matching ones
                const hiddenActivitiesSection = document.getElementById('hidden-activities');
                const wasHidden = hiddenActivitiesSection && hiddenActivitiesSection.classList.contains('hidden');
                let hasMatchingHiddenItems = false;
                
                if (hiddenActivitiesSection) {
                    hiddenSectionItems.forEach(item => {
                        const itemFilters = item.getAttribute('data-filter') || '';
                        const activityType = item.getAttribute('data-activity-type') || 'user';
                        
                        let shouldShow = false;
                        
                        if (filter === 'all') {
                            shouldShow = true;
                        } else if (filter === 'system') {
                            shouldShow = activityType === 'system';
                        } else if (filter === 'user') {
                            shouldShow = activityType === 'user';
                        } else {
                            shouldShow = itemFilters.includes(filter);
                        }
                        
                        // Apply source filter to all activity types
                        if (shouldShow && currentSourceFilter !== 'all-sources') {
                            shouldShow = activityType === currentSourceFilter;
                        }
                        
                        if (shouldShow) {
                            itemsToShow.push(item);
                            hasMatchingHiddenItems = true;
                        } else {
                            itemsToHide.push(item);
                        }
                    });
                    
                    // Show hidden activities section if there are matching items
                    if (hasMatchingHiddenItems && wasHidden) {
                        hiddenActivitiesSection.classList.remove('hidden');
                        
                        // Also make the individual activity sections visible
                        const sectionsToShow = new Set();
                        itemsToShow.forEach(item => {
                            const section = item.closest('.activity-section');
                            if (section && section.parentElement === hiddenActivitiesSection) {
                                sectionsToShow.add(section);
                            }
                        });
                        sectionsToShow.forEach(section => {
                            section.style.display = 'block';
                        });
                        
                        console.log('✅ filterActivities - Auto-expanded hidden activities for filter:', filter, 'sections shown:', sectionsToShow.size);
                    }
                }
                
                // Apply all changes in a single batch
                itemsToHide.forEach(item => item.classList.add('hidden'));
                itemsToShow.forEach(item => item.classList.remove('hidden'));
                
                // Check and hide empty activity sections
                requestAnimationFrame(() => {
                    activitySections.forEach(section => {
                        const visibleItemsInSection = section.querySelectorAll('.activity-item:not(.hidden)');
                        if (visibleItemsInSection.length === 0) {
                            section.classList.add('empty');
                            section.style.display = 'none'; // Hide empty sections
                        } else {
                            section.classList.remove('empty');
                            section.style.display = 'block'; // Show sections with content
                        }
                    });
                    
                    // Update load more position after all changes are complete
                    updateLoadMorePosition();
                    
                    // Update load more button state based on current filter
                    updateLoadMoreButtonState();
                    
                    // Remove filtering class after filtering is complete
                    setTimeout(() => {
                        if (activityCard) {
                            activityCard.classList.remove('filtering');
                        }
                    }, 50);
                });
            });
        }
        
        // Communication type filtering functionality
        function filterCommunicationTypes(communicationType) {
            const activityCard = document.getElementById('activity-timeline-card');
            
            // Add filtering class to disable all transitions
            if (activityCard) {
                activityCard.classList.add('filtering');
            }
            
            // Use requestAnimationFrame to batch DOM updates and prevent flickering
            requestAnimationFrame(() => {
                const visibleItems = document.querySelectorAll('.activity-item:not(#hidden-activities .activity-item)');
                const hiddenSectionItems = document.querySelectorAll('#hidden-activities .activity-item');
                const activitySections = document.querySelectorAll('.activity-section');
                
                // Batch all DOM changes together
                const itemsToShow = [];
                const itemsToHide = [];
                
                // Get current source filter value
                const sourceSelected = document.querySelector('#source-filter-dropdown .activity-filter-option.selected');
                const currentSourceFilter = sourceSelected ? sourceSelected.getAttribute('data-value') : 'all-sources';
                
                // Prepare visible items changes
                visibleItems.forEach(item => {
                    const itemFilters = item.getAttribute('data-filter') || '';
                    const itemType = item.getAttribute('data-communication-type') || '';
                    const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                    
                    // Only filter items that are communications
                    if (itemFilters.includes('communications')) {
                        // Check both communication type and source filters
                        const typeMatches = communicationType === 'all-communications' || itemType === communicationType;
                        const sourceMatches = currentSourceFilter === 'all-sources' || itemActivityType === currentSourceFilter;
                        
                        if (typeMatches && sourceMatches) {
                            itemsToShow.push(item);
                        } else {
                            itemsToHide.push(item);
                        }
                    }
                });
                
                // Always process hidden section items and show matching ones
                const hiddenActivitiesSection = document.getElementById('hidden-activities');
                const wasHidden = hiddenActivitiesSection && hiddenActivitiesSection.classList.contains('hidden');
                let hasMatchingHiddenItems = false;
                
                if (hiddenActivitiesSection) {
                    hiddenSectionItems.forEach(item => {
                        const itemFilters = item.getAttribute('data-filter') || '';
                        const itemType = item.getAttribute('data-communication-type') || '';
                        const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                        
                        // Only filter items that are communications
                        if (itemFilters.includes('communications')) {
                            // Check both communication type and source filters
                            const typeMatches = communicationType === 'all-communications' || itemType === communicationType;
                            const sourceMatches = currentSourceFilter === 'all-sources' || itemActivityType === currentSourceFilter;
                            
                            if (typeMatches && sourceMatches) {
                                itemsToShow.push(item);
                                hasMatchingHiddenItems = true;
                            } else {
                                itemsToHide.push(item);
                            }
                        }
                    });
                    
                    // Show hidden activities section if there are matching items
                    if (hasMatchingHiddenItems && wasHidden) {
                        hiddenActivitiesSection.classList.remove('hidden');
                        
                        // Also make the individual activity sections visible
                        const sectionsToShow = new Set();
                        itemsToShow.forEach(item => {
                            const section = item.closest('.activity-section');
                            if (section && section.parentElement === hiddenActivitiesSection) {
                                sectionsToShow.add(section);
                            }
                        });
                        sectionsToShow.forEach(section => {
                            section.style.display = 'block';
                        });
                        
                        console.log('✅ filterCommunicationTypes - Auto-expanded hidden activities, sections shown:', sectionsToShow.size);
                    }
                }
                
                // Apply all changes in a single batch
                itemsToHide.forEach(item => item.classList.add('hidden'));
                itemsToShow.forEach(item => item.classList.remove('hidden'));
                
                // Check and hide empty activity sections
                requestAnimationFrame(() => {
                    activitySections.forEach(section => {
                        const visibleItemsInSection = section.querySelectorAll('.activity-item:not(.hidden)');
                        if (visibleItemsInSection.length === 0) {
                            section.classList.add('empty');
                            section.style.display = 'none'; // Hide empty sections
                        } else {
                            section.classList.remove('empty');
                            section.style.display = 'block'; // Show sections with content
                        }
                    });
                    
                    // Update load more position after all changes are complete
                    updateLoadMorePosition();
                    
                    // Update load more button state based on current filter
                    updateLoadMoreButtonState();
                    
                    // Remove filtering class after filtering is complete
                    setTimeout(() => {
                        if (activityCard) {
                            activityCard.classList.remove('filtering');
                        }
                    }, 50);
                });
            });
        }
        
        // Function removed - source filtering now handled by filterActivities()
        function filterCommunicationSource_DEPRECATED(sourceType) {
            const activityCard = document.getElementById('activity-timeline-card');
            
            // Add filtering class to disable all transitions
            if (activityCard) {
                activityCard.classList.add('filtering');
            }
            
            // Use requestAnimationFrame to batch DOM updates and prevent flickering
            requestAnimationFrame(() => {
                const visibleItems = document.querySelectorAll('.activity-item:not(#hidden-activities .activity-item)');
                const hiddenSectionItems = document.querySelectorAll('#hidden-activities .activity-item');
                const activitySections = document.querySelectorAll('.activity-section');
                
                // Get current type filter value
                const commTypeSelected = document.querySelector('#communication-type-filter-dropdown .activity-filter-option.selected');
                const currentTypeFilter = commTypeSelected ? commTypeSelected.getAttribute('data-value') : 'all-communications';
                
                // Batch all DOM changes together
                const itemsToShow = [];
                const itemsToHide = [];
                
                // Prepare visible items changes
                visibleItems.forEach(item => {
                    const itemFilters = item.getAttribute('data-filter') || '';
                    const itemType = item.getAttribute('data-communication-type') || '';
                    const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                    
                    // Only filter items that are communications
                    if (itemFilters.includes('communications')) {
                        // Check both communication type and source filters
                        const typeMatches = currentTypeFilter === 'all-communications' || itemType === currentTypeFilter;
                        const sourceMatches = sourceType === 'all-sources' || itemActivityType === sourceType;
                        
                        if (typeMatches && sourceMatches) {
                            itemsToShow.push(item);
                        } else {
                            itemsToHide.push(item);
                        }
                    }
                });
                
                // Always process hidden section items and show matching ones
                const hiddenActivitiesSection = document.getElementById('hidden-activities');
                const wasHidden = hiddenActivitiesSection && hiddenActivitiesSection.classList.contains('hidden');
                let hasMatchingHiddenItems = false;
                
                if (hiddenActivitiesSection) {
                    hiddenSectionItems.forEach(item => {
                        const itemFilters = item.getAttribute('data-filter') || '';
                        const itemType = item.getAttribute('data-communication-type') || '';
                        const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                        
                        // Only filter items that are communications
                        if (itemFilters.includes('communications')) {
                            // Check both communication type and source filters
                            const typeMatches = currentTypeFilter === 'all-communications' || itemType === currentTypeFilter;
                            const sourceMatches = sourceType === 'all-sources' || itemActivityType === sourceType;
                            
                            if (typeMatches && sourceMatches) {
                                itemsToShow.push(item);
                                hasMatchingHiddenItems = true;
                            } else {
                                itemsToHide.push(item);
                            }
                        }
                    });
                    
                    // Show hidden activities section if there are matching items
                    if (hasMatchingHiddenItems && wasHidden) {
                        hiddenActivitiesSection.classList.remove('hidden');
                        
                        // Also make the individual activity sections visible
                        const sectionsToShow = new Set();
                        itemsToShow.forEach(item => {
                            const section = item.closest('.activity-section');
                            if (section && section.parentElement === hiddenActivitiesSection) {
                                sectionsToShow.add(section);
                            }
                        });
                        sectionsToShow.forEach(section => {
                            section.style.display = 'block';
                        });
                        
                        console.log('✅ filterCommunicationSource_DEPRECATED - Auto-expanded hidden activities, sections shown:', sectionsToShow.size);
                    }
                }
                
                // Apply all changes in a single batch
                itemsToHide.forEach(item => item.classList.add('hidden'));
                itemsToShow.forEach(item => item.classList.remove('hidden'));
                
                // Check and hide empty activity sections
                requestAnimationFrame(() => {
                    activitySections.forEach(section => {
                        const visibleItemsInSection = section.querySelectorAll('.activity-item:not(.hidden)');
                        if (visibleItemsInSection.length === 0) {
                            section.classList.add('empty');
                            section.style.display = 'none'; // Hide empty sections
                        } else {
                            section.classList.remove('empty');
                            section.style.display = 'block'; // Show sections with content
                        }
                    });
                    
                    // Update load more position after all changes are complete
                    updateLoadMorePosition();
                    
                    // Update load more button state based on current filter
                    updateLoadMoreButtonState();
                    
                    // Remove filtering class after filtering is complete
                    setTimeout(() => {
                        if (activityCard) {
                            activityCard.classList.remove('filtering');
                        }
                    }, 50);
                });
            });
        }
        
        // Function to maintain consistent load more button positioning and visibility
        function updateLoadMorePosition() {
            const loadMoreSection = document.getElementById('load-more-section');
            const hiddenActivitiesSection = document.getElementById('hidden-activities');
            const activityCard = document.getElementById('activity-timeline-card');
            const leaseInfoColumn = document.getElementById('column-2-lease-info');
            
            if (loadMoreSection) {
                // Check for visible activities in the main timeline
                const visibleItems = document.querySelectorAll('.activity-item:not(.hidden):not(#hidden-activities .activity-item)');
                
                // Check for visible activities in expanded section (if expanded)
                const expandedVisibleItems = document.querySelectorAll('#hidden-activities .activity-item:not(.hidden)');
                const totalVisibleItems = visibleItems.length + expandedVisibleItems.length;
                
                // When timeline is expanded, always show collapse button
                // When collapsed, always show load more button since we have hidden activities
                let showBasedOnHeight = true;
                
                // Check if there are any hidden activities that could potentially match current filters
                let hasMatchingHiddenActivities = false;
                if (hiddenActivitiesSection && hiddenActivitiesSection.classList.contains('hidden')) {
                    // Get current filter from custom dropdown
                    const selectedFilterOption = document.querySelector('.activity-filter-option.selected');
                    const currentFilter = selectedFilterOption ? selectedFilterOption.getAttribute('data-value') : 'all';
                    
                    // Get communication sub-filters
                    const commTypeSelected = document.querySelector('#communication-type-filter-dropdown .activity-filter-option.selected');
                    const sourceSelected = document.querySelector('#source-filter-dropdown .activity-filter-option.selected');
                    const currentCommTypeFilter = commTypeSelected ? commTypeSelected.getAttribute('data-value') : 'all-communications';
                    const currentSourceFilter = sourceSelected ? sourceSelected.getAttribute('data-value') : 'all-sources';
                    
                    const hiddenItems = hiddenActivitiesSection.querySelectorAll('.activity-item');
                    hasMatchingHiddenActivities = Array.from(hiddenItems).some(item => {
                        const itemFilters = item.getAttribute('data-filter') || '';
                        const itemType = item.getAttribute('data-communication-type') || '';
                        const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                        
                        // Check if item matches the current filter criteria
                        if (currentFilter === 'all') {
                            return true;
                        } else if (currentFilter === 'system') {
                            return itemActivityType === 'system';
                        } else if (currentFilter === 'user') {
                            return itemActivityType === 'user';
                        } else if (currentFilter === 'communications') {
                            // For communications, first check if item is a communication activity
                            if (itemFilters.includes('communications')) {
                                // Then check both type and source filters
                                const typeMatches = currentCommTypeFilter === 'all-communications' || itemType === currentCommTypeFilter;
                                const sourceMatches = currentSourceFilter === 'all-sources' || itemActivityType === currentSourceFilter;
                                return typeMatches && sourceMatches;
                            }
                            return false;
                } else {
                            // For other filters (work-orders, payments, etc.), check if item matches activity type
                            let activityMatches = itemFilters.includes(currentFilter);
                            // Also apply source filter to all activity types
                            if (activityMatches && currentSourceFilter !== 'all-sources') {
                                activityMatches = itemActivityType === currentSourceFilter;
                            }
                            return activityMatches;
                        }
                        return false;
                    });
                }
                
                // If timeline is expanded, we always show the collapse button (even if no results)
                // because user needs a way to collapse back
                if (timelineExpanded) {
                    loadMoreSection.style.display = 'block';
                    loadMoreSection.style.opacity = totalVisibleItems === 0 ? '0.6' : '1';
                    // Position button at bottom when timeline is expanded
                    positionCollapseButtonAtBottom();
                                } else {
                    // When timeline is collapsed, always show load more button if hidden activities exist
                    if (hiddenActivitiesSection && hiddenActivitiesSection.children.length > 0) {
                        if (totalVisibleItems === 0 && !hasMatchingHiddenActivities) {
                            // Hide load more button if no visible activities AND no matching hidden activities
                            loadMoreSection.style.display = 'none';
                        } else if (totalVisibleItems === 0 && hasMatchingHiddenActivities) {
                            // Show but dim the load more button if no current results but matching hidden activities exist
                            loadMoreSection.style.display = 'block';
                            loadMoreSection.style.opacity = '0.6';
                        } else {
                            // Show normally when there are visible activities or hidden activities exist
                            loadMoreSection.style.display = 'block';
                    loadMoreSection.style.opacity = '1';
                        }
                    } else {
                        // No hidden activities at all, hide the button
                        loadMoreSection.style.display = 'none';
                    }
                }
            }
        }
        
        // Position collapse button at bottom of expanded timeline
        function positionCollapseButtonAtBottom() {
            const loadMoreSection = document.getElementById('load-more-section');
            const hiddenActivitiesSection = document.getElementById('hidden-activities');
            
            if (loadMoreSection && hiddenActivitiesSection && !hiddenActivitiesSection.classList.contains('hidden')) {
                // Only move if button is not already at the bottom
                if (loadMoreSection.parentNode !== hiddenActivitiesSection) {
                    // Move button to be the last child of hidden-activities section
                    hiddenActivitiesSection.appendChild(loadMoreSection);
                    loadMoreSection.style.marginTop = '1rem';
                }
            }
        }
        
        // Reset button position to original location
        function resetButtonPosition() {
            const loadMoreSection = document.getElementById('load-more-section');
            const activityTimelineContainer = document.getElementById('activity-timeline-container');
            
            if (loadMoreSection && activityTimelineContainer) {
                // Move button back to its original position after the timeline container
                activityTimelineContainer.insertAdjacentElement('afterend', loadMoreSection);
                loadMoreSection.style.marginTop = '';
                loadMoreSection.style.flexShrink = '';
                loadMoreSection.style.position = '';
                loadMoreSection.style.bottom = '';
            }
        }
        
        // Match activity timeline card height with lease info card
        function matchActivityTimelineHeight() {
            
            const activityCard = document.getElementById('activity-timeline-card');
            const leaseInfoColumn = document.getElementById('column-2-lease-info');
            const timelineContainer = document.getElementById('activity-timeline-container');
            const loadMoreSection = document.getElementById('load-more-section');
            
            if (activityCard && leaseInfoColumn && timelineContainer) {
                // Get the lease info column height
                const leaseInfoHeight = leaseInfoColumn.offsetHeight;
                
                // Only proceed if we have a valid height
                if (leaseInfoHeight > 0) {
                    // Get actual button height
                    const buttonHeight = loadMoreSection ? loadMoreSection.offsetHeight : 80;
                    
                    // The TOTAL height (card + button) should equal lease info height
                    const targetCardHeight = leaseInfoHeight - buttonHeight;
                    
                    // Calculate heights for card internals
                    const cardHeader = activityCard.querySelector('.card-header');
                    const activityFilters = activityCard.querySelector('.activity-filters');
                    
                    const headerHeight = cardHeader ? cardHeader.offsetHeight : 0;
                    const filtersHeight = activityFilters ? activityFilters.offsetHeight : 0;
                    const padding = 32; // Account for card padding
                    
                    // Calculate available height for timeline content
                    const availableTimelineHeight = targetCardHeight - headerHeight - filtersHeight - padding;
                    
                    // Set the card content area to the calculated height
                    const cardContent = activityCard.querySelector('.card-content');
                    if (cardContent) {
                        cardContent.style.height = targetCardHeight + 'px';
                        cardContent.style.overflow = 'hidden';
                    }
                    
                    // Limit timeline container height so content doesn't overflow
                    timelineContainer.style.maxHeight = availableTimelineHeight + 'px';
                    timelineContainer.style.overflowY = 'hidden';
                    
                    // Add class for styling
                    activityCard.classList.add('matched-height');
                    
                    console.log('Height calculation:', {
                        leaseInfoHeight,
                        buttonHeight,
                        targetCardHeight,
                        availableTimelineHeight
                    });
                }
            }
        }
        
        // View switching functionality
        function toggleView(viewName) {
            console.log('toggleView called with:', viewName);
            const overviewView = document.getElementById('overview-view');
            const leaseInfoView = document.getElementById('lease-info-view');
            const leaseInfo2View = document.getElementById('lease-info-2-view');
            const ledgerView = document.getElementById('ledger-view');
            const documentsView = document.getElementById('documents-view');
            const overviewMenu = document.getElementById('overview-menu');
            const leaseInfo2Menu = document.getElementById('lease-info-2-menu');
            const ledgerMenu = document.getElementById('ledger-menu');
            const documentsMenu = document.getElementById('documents-menu');
            
            console.log('Found elements:', {
                overviewView: !!overviewView,
                leaseInfoView: !!leaseInfoView,
                leaseInfo2View: !!leaseInfo2View,
                ledgerView: !!ledgerView,
                documentsView: !!documentsView,
                overviewMenu: !!overviewMenu,
                leaseInfo2Menu: !!leaseInfo2Menu,
                ledgerMenu: !!ledgerMenu,
                documentsMenu: !!documentsMenu
            });
            
            // Hide all views
            overviewView.style.display = 'none';
            leaseInfoView.style.display = 'none';
            if (leaseInfo2View) leaseInfo2View.style.display = 'none';
            ledgerView.style.display = 'none';
            documentsView.style.display = 'none';
            
            // Remove active state from all menus
            overviewMenu.classList.remove('active');
            if (leaseInfo2Menu) leaseInfo2Menu.classList.remove('active');
            ledgerMenu.classList.remove('active');
            documentsMenu.classList.remove('active');
            
            // Show selected view and activate corresponding menu
            if (viewName === 'overview') {
                overviewView.style.display = 'block';
                overviewMenu.classList.add('active');
            } else if (viewName === 'lease-info') {
                leaseInfoView.style.display = 'block';
            } else if (viewName === 'lease-info-2') {
                if (leaseInfo2View) {
                    leaseInfo2View.style.display = 'block';
                    leaseInfo2Menu.classList.add('active');
                }
            } else if (viewName === 'ledger') {
                ledgerView.style.display = 'block';
                ledgerMenu.classList.add('active');
            } else if (viewName === 'documents') {
                documentsView.style.display = 'block';
                documentsMenu.classList.add('active');
                
                // Initialize documents table sorting on first load
                if (!documentsTableInitialized) {
                    initializeDocumentsSort();
                    documentsTableInitialized = true;
                }
            }
        }
        
        // Toggle collapsible card sections
        function toggleCollapsibleCard(cardId) {
            const content = document.getElementById(cardId + '-content');
            const icon = document.getElementById(cardId + '-icon');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                content.style.display = 'none';
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }
        
        // Ledger functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize pagination on page load
            if (document.getElementById('ledger-view')) {
                goToPage(1); // Start on page 1
                updatePaginationButtons();
                setExclusiveLedgerFilter('all'); // Set "All" filter as default
            }
            
            // Balance column toggle
            const showBalance = document.getElementById('show-balance');
            if (showBalance) {
                showBalance.addEventListener('change', function() {
                    const balanceColumns = document.querySelectorAll('th:nth-child(6), td:nth-child(6)');
                    balanceColumns.forEach(col => {
                        col.style.display = this.checked ? '' : 'none';
                    });
                });
            }
            
            // Close kebab menu when clicking outside
            document.addEventListener('click', function(e) {
                const kebabBtn = document.getElementById('ledger-kebab-btn');
                const kebabMenu = document.getElementById('ledger-kebab-menu');
                if (kebabBtn && kebabMenu && !kebabBtn.contains(e.target) && !kebabMenu.contains(e.target)) {
                    kebabMenu.classList.add('hidden');
                }
                
                // Close activity add menu when clicking outside
                const activityBtn = document.getElementById('activity-add-btn');
                const activityMenu = document.getElementById('activity-add-menu');
                if (activityBtn && activityMenu && !activityBtn.contains(e.target) && !activityMenu.contains(e.target)) {
                    activityMenu.classList.add('hidden');
                }
            });
        });
        
        // Ledger kebab menu functions
        function toggleLedgerKebab() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) {
                menu.classList.toggle('hidden');
            }
        }

        
        // Exclusive tab-style filter functionality
        function setExclusiveLedgerFilter(filterType) {
            const allButton = document.getElementById('filter-all');
            const unpaidButton = document.getElementById('filter-unpaid');
            const processingButton = document.getElementById('filter-processing');
            const hapButton = document.getElementById('filter-hap');
            const notHapButton = document.getElementById('filter-not-hap');
            
            // Deactivate all filters
            allButton.classList.remove('active');
            unpaidButton.classList.remove('active');
            processingButton.classList.remove('active');
            hapButton.classList.remove('active');
            notHapButton.classList.remove('active');
            
            // Activate the clicked filter
            const clickedButton = document.getElementById('filter-' + filterType);
            clickedButton.classList.add('active');
            
            // Filter table rows
            const tableRows = document.querySelectorAll('tbody tr');
            tableRows.forEach(row => {
                const statusCell = row.querySelector('td:nth-child(3)'); // Status column
                const typeCell = row.querySelector('td:nth-child(2)'); // Type column
                const descriptionCell = row.querySelector('td:nth-child(1)'); // Description column
                
                if (!statusCell || !typeCell || !descriptionCell) return;
                
                const status = statusCell.textContent.trim().toLowerCase();
                const type = typeCell.textContent.trim().toLowerCase();
                const description = descriptionCell.textContent.trim().toLowerCase();
                
                let showRow = false;
                
                if (filterType === 'all') {
                    showRow = true; // Show all rows
                } else if (filterType === 'unpaid') {
                    showRow = status.includes('unpaid');
                } else if (filterType === 'processing') {
                    showRow = status.includes('processing') && type.includes('payment');
                } else if (filterType === 'hap') {
                    // Show rows with HAP-related entries (rent subsidies, housing assistance)
                    showRow = description.includes('hap') || description.includes('housing assistance') || 
                              description.includes('rent subsidy') || description.includes('section 8') ||
                              type.includes('hap') || type.includes('subsidy');
                } else if (filterType === 'not-hap') {
                    // Show rows without HAP-related entries
                    showRow = !description.includes('hap') && !description.includes('housing assistance') && 
                              !description.includes('rent subsidy') && !description.includes('section 8') &&
                              !type.includes('hap') && !type.includes('subsidy');
                }
                
                row.style.display = showRow ? '' : 'none';
            });
            
            console.log('Filter set to:', filterType);
        }
        
        // Pagination functionality
        let currentPage = 1;
        let recordsPerPage = 10;
        
        function goToPage(pageNumber) {
            currentPage = pageNumber;
            
            // Hide all table rows
            const allRows = document.querySelectorAll('.table-row');
            allRows.forEach(row => {
                row.classList.add('hidden');
            });
            
            // Show rows for current page
            const currentPageRows = document.querySelectorAll(`[data-page="${pageNumber}"]`);
            currentPageRows.forEach(row => {
                row.classList.remove('hidden');
            });
            
            // Update pagination button styling
            const pageButtons = document.querySelectorAll('.pagination-page');
            pageButtons.forEach(btn => {
                btn.classList.remove('border-primary', 'bg-primary', 'text-white');
                btn.classList.add('border-gray-300', 'hover:bg-gray-50');
            });
            
            // Activate clicked page button
            const clickedButton = document.querySelector(`.pagination-page[data-page="${pageNumber}"]`);
            if (clickedButton) {
                clickedButton.classList.add('border-primary', 'bg-primary', 'text-white');
                clickedButton.classList.remove('border-gray-300', '', 'hover:bg-gray-50');
            }
            
            // Update previous/next button states
            updatePaginationButtons();
            
            console.log('Navigated to page:', pageNumber);
        }
        
        function updatePaginationButtons() {
            const prevButton = document.querySelector('.pagination-prev');
            const nextButton = document.querySelector('.pagination-next');
            
            // Update previous button
            if (currentPage === 1) {
                prevButton.disabled = true;
                prevButton.classList.add('text-gray-400');
                prevButton.classList.remove('');
            } else {
                prevButton.disabled = false;
                prevButton.classList.remove('text-gray-400');
                prevButton.classList.add('');
            }
            
            // Update next button (assuming we have 2 pages total)
            if (currentPage === 2) {
                nextButton.disabled = true;
                nextButton.classList.add('text-gray-400');
                nextButton.classList.remove('');
            } else {
                nextButton.disabled = false;
                nextButton.classList.remove('text-gray-400');
                nextButton.classList.add('');
            }
        }
        
        function previousPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }
        
        function nextPage() {
            if (currentPage < 2) { // Assuming 2 pages total
                goToPage(currentPage + 1);
            }
        }
        
        // Records per page functionality
        function changeRecordsPerPage(recordCount) {
            recordsPerPage = parseInt(recordCount);
            console.log('Changed records per page to:', recordCount);
            // Reset to page 1 when changing records per page
            goToPage(1);
        }
        
        function exportToExcel() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) menu.classList.add('hidden');
            alert('Export to Excel:\n\n• Generate Excel file with all transactions\n• Include current filters\n• Download automatically\n• Preserve formatting and calculations');
        }
        
        function exportToPDF() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) menu.classList.add('hidden');
            alert('Export to PDF:\n\n• Generate PDF report\n• Include resident summary\n• Professional formatting\n• Ready for printing or sharing');
        }
        
        function emailReport() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) menu.classList.add('hidden');
            alert('Email Report:\n\n• Send ledger report via email\n• Choose recipients\n• Add custom message\n• Include attachments (PDF/Excel)');
        }
        
        // View transaction details - Global function
        function viewTransactionDetails(controlNumber) {
            alert(`Transaction Details - ${controlNumber}\n\n• View complete transaction history\n• See payment method details\n• Access related documents\n• View audit trail\n• Check authorization codes\n• Review processing status`);
        }
        
        function printLedger() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) menu.classList.add('hidden');
            alert('Print Ledger:\n\n• Print current view\n• Optimize layout for printing\n• Include all visible transactions\n• Print-friendly formatting');
        }
        
        function scheduledReports() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) menu.classList.add('hidden');
            alert('Scheduled Reports:\n\n• Set up automated reports\n• Choose frequency (daily, weekly, monthly)\n• Select recipients\n• Customize report content');
        }

        // Table sorting functionality
        let currentSort = { column: null, direction: 'asc' };
        
        function sortTable(column) {
            const table = document.querySelector('#ledger-view table tbody');
            const rows = Array.from(table.querySelectorAll('tr'));
            
            // Determine sort direction
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.direction = 'asc';
            }
            currentSort.column = column;
            
            // Update sort icons
            updateSortIcons(column, currentSort.direction);
            
            // Sort rows based on column
            rows.sort((a, b) => {
                let aVal, bVal;
                
                switch(column) {
                    case 'date':
                        aVal = new Date(a.cells[0].textContent.trim());
                        bVal = new Date(b.cells[0].textContent.trim());
                        break;
                    case 'description':
                        aVal = a.cells[1].querySelector('.text-sm').textContent.trim().toLowerCase();
                        bVal = b.cells[1].querySelector('.text-sm').textContent.trim().toLowerCase();
                        break;
                    case 'status':
                        aVal = a.cells[2].textContent.trim().toLowerCase();
                        bVal = b.cells[2].textContent.trim().toLowerCase();
                        break;
                    case 'charges':
                        aVal = parseFloat(a.cells[3].textContent.replace(/[$,\-]/g, '')) || 0;
                        bVal = parseFloat(b.cells[3].textContent.replace(/[$,\-]/g, '')) || 0;
                        break;
                    case 'payments':
                        aVal = parseFloat(a.cells[4].textContent.replace(/[$,\-]/g, '')) || 0;
                        bVal = parseFloat(b.cells[4].textContent.replace(/[$,\-]/g, '')) || 0;
                        break;
                    case 'balance':
                        aVal = parseFloat(a.cells[5].textContent.replace(/[$,\-]/g, ''));
                        bVal = parseFloat(b.cells[5].textContent.replace(/[$,\-]/g, ''));
                        break;
                }
                
                if (currentSort.direction === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });
            
            // Reorder table rows
            rows.forEach(row => table.appendChild(row));
        }
        
        function updateSortIcons(sortedColumn, direction) {
            // Reset all sort icons
            document.querySelectorAll('#ledger-view th i').forEach(icon => {
                icon.className = 'fas fa-sort text-sm text-gray-400';
            });
            
            // Update the sorted column icon
            const columnMap = {
                'date': 0,
                'description': 1,
                'status': 2,
                'charges': 3,
                'payments': 4,
                'balance': 5
            };
            
            const columnIndex = columnMap[sortedColumn];
            const icon = document.querySelectorAll('#ledger-view th')[columnIndex].querySelector('i');
            
            if (direction === 'asc') {
                icon.className = 'fas fa-sort-up text-sm text-primary';
            } else {
                icon.className = 'fas fa-sort-down text-sm text-primary';
            }
        }
        
        // Pageslide functionality - Global functions
        function openPageslide(overlayId) {
            const overlay = document.getElementById(overlayId);
            if (overlay) {
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
                
                // Initialize kebab menus for roommate details pageslide
                if (overlayId === 'roommate-details-overlay') {
                    setTimeout(() => {
                        initializePageslideKebabs();
                    }, 100); // Small delay to ensure pageslide is fully rendered
                }
            }
        }

        function closePageslide(overlayId) {
            const overlay = document.getElementById(overlayId);
            if (overlay) {
                overlay.classList.remove('active');
                document.body.style.overflow = ''; // Restore scrolling
                
                // Reset forms when closing
                if (overlayId === 'add-lease-charge-overlay') {
                    const form = overlay.querySelector('#add-lease-charge-form');
                    if (form) {
                        form.reset();
                    }
                } else if (overlayId === 'edit-lease-charge-overlay') {
                    const form = overlay.querySelector('#edit-lease-charge-form');
                    if (form) {
                        form.reset();
                    }
                }
            }
        }
        
        // Initialize pageslide kebab menus - Global function
        function initializePageslideKebabs() {
            // Kebab menu functionality for pageslides
            function setupKebabMenuForPageslide(btnId, dropdownId, dropdownWidth = 180) {
                const kebabBtn = document.getElementById(btnId);
                const kebabDropdown = document.getElementById(dropdownId);
                
                console.log('Looking for pageslide elements:', { btnId, dropdownId, kebabBtn, kebabDropdown });
                
                if (kebabBtn && kebabDropdown) {
                    // Remove any existing listeners first
                    kebabBtn.removeEventListener('click', kebabBtn._kebabClickHandler);
                    
                    const clickHandler = function(e) {
                        e.stopPropagation();
                        console.log('Pageslide kebab clicked:', btnId);
                        
                        // Close all other dropdowns first
                        document.querySelectorAll('[id^="kebab-dropdown-"]').forEach(dropdown => {
                            if (dropdown !== kebabDropdown) {
                                dropdown.classList.add('hidden');
                                dropdown.style.display = 'none';
                            }
                        });
                        
                        // Also close tenant header manage dropdown
                        const tenantManageDropdown = document.getElementById('tenant-header-manage-dropdown');
                        if (tenantManageDropdown && tenantManageDropdown !== kebabDropdown) {
                            tenantManageDropdown.classList.add('hidden');
                            tenantManageDropdown.style.display = 'none';
                            tenantManageDropdown.style.visibility = 'hidden';
                        }
                        
                        // Toggle current dropdown
                        const isVisible = !kebabDropdown.classList.contains('hidden');
                        if (isVisible) {
                            kebabDropdown.classList.add('hidden');
                            kebabDropdown.style.display = 'none';
                        } else {
                            kebabDropdown.classList.remove('hidden');
                            kebabDropdown.style.display = 'block';
                            
                            // Position dropdown
                            const rect = kebabBtn.getBoundingClientRect();
                            kebabDropdown.style.position = 'fixed';
                            kebabDropdown.style.top = (rect.bottom + 5) + 'px';
                            kebabDropdown.style.left = Math.max(10, rect.right - dropdownWidth) + 'px';
                            kebabDropdown.style.zIndex = '10001'; // Higher than pageslide
                        }
                    };
                    
                    kebabBtn._kebabClickHandler = clickHandler;
                    kebabBtn.addEventListener('click', clickHandler);
                    
                    console.log('Successfully initialized pageslide kebab:', btnId);
                    return { kebabBtn, kebabDropdown };
                } else {
                    console.log('Failed to find elements for:', btnId, dropdownId);
                    return null;
                }
            }
            
            const roommateAngelaPageslideKebab = setupKebabMenuForPageslide('kebab-btn-roommate-angela-pageslide', 'kebab-dropdown-roommate-angela-pageslide', 180);
            const roommateJohnPageslideKebab = setupKebabMenuForPageslide('kebab-btn-roommate-john-pageslide', 'kebab-dropdown-roommate-john-pageslide', 180);
            
            // For RentCafe kebab, just ensure it works in pageslide context (it's already initialized globally)
            const rentcafeJohnBtn = document.getElementById('kebab-btn-rentcafe-john');
            const rentcafeJohnDropdown = document.getElementById('kebab-dropdown-rentcafe-john');
            console.log('RentCafe elements in pageslide:', { btn: rentcafeJohnBtn, dropdown: rentcafeJohnDropdown });
            
            if (rentcafeJohnBtn && rentcafeJohnDropdown) {
                console.log('Setting up RentCafe John kebab in pageslide...');
                
                // Clear any existing event listeners by cloning and replacing the button
                const newBtn = rentcafeJohnBtn.cloneNode(true);
                rentcafeJohnBtn.parentNode.replaceChild(newBtn, rentcafeJohnBtn);
                
                // Setup fresh event handler on the new button
                newBtn.addEventListener('click', function(e) {
                    console.log('✅ RentCafe kebab clicked!', e);
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Close all other dropdowns first
                    document.querySelectorAll('[id^="kebab-dropdown-"]').forEach(dropdown => {
                        if (dropdown !== rentcafeJohnDropdown) {
                            dropdown.classList.add('hidden');
                            dropdown.style.display = 'none';
                        }
                    });
                    
                    // Also close tenant header manage dropdown
                    const tenantManageDropdown = document.getElementById('tenant-header-manage-dropdown');
                    if (tenantManageDropdown && tenantManageDropdown !== rentcafeJohnDropdown) {
                        tenantManageDropdown.classList.add('hidden');
                        tenantManageDropdown.style.display = 'none';
                        tenantManageDropdown.style.visibility = 'hidden';
                    }
                    
                    // Toggle this dropdown
                    const isHidden = rentcafeJohnDropdown.classList.contains('hidden');
                    console.log('Dropdown currently hidden:', isHidden);
                    
                    if (isHidden) {
                        // Show dropdown
                        rentcafeJohnDropdown.classList.remove('hidden');
                        rentcafeJohnDropdown.style.display = 'block';
                        rentcafeJohnDropdown.style.position = 'fixed';
                        rentcafeJohnDropdown.style.zIndex = '10001';
                        
                        // Position relative to button
                        const rect = newBtn.getBoundingClientRect();
                        console.log('Button rect:', rect);
                        rentcafeJohnDropdown.style.left = (rect.left - 160 + rect.width) + 'px'; // Position to the left of button
                        rentcafeJohnDropdown.style.top = (rect.bottom + 5) + 'px'; // Below button with small gap
                        
                        console.log('✅ Dropdown should now be visible');
                    } else {
                        // Hide dropdown
                        rentcafeJohnDropdown.classList.add('hidden');
                        rentcafeJohnDropdown.style.display = 'none';
                        console.log('✅ Dropdown hidden');
                    }
                });
                
                console.log('✅ RentCafe kebab setup complete with fresh event handler');
            } else {
                console.error('❌ RentCafe elements not found:', { btn: rentcafeJohnBtn, dropdown: rentcafeJohnDropdown });
            }
            
            console.log('Pageslide kebabs initialized:', {
                angela: roommateAngelaPageslideKebab,
                john: roommateJohnPageslideKebab,
                rentcafeJohnGlobal: 'Already initialized globally'
            });
            
            // Add global click listener to close pageslide dropdowns
            document.addEventListener('click', function(e) {
                const pageslideDropdowns = document.querySelectorAll('[id*="kebab-dropdown-roommate"][id*="pageslide"], [id="kebab-dropdown-rentcafe-john"]');
                pageslideDropdowns.forEach(dropdown => {
                    const isRoommateDropdown = dropdown.id.includes('roommate');
                    const isRentcafeDropdown = dropdown.id.includes('rentcafe');
                    
                    let shouldClose = false;
                    if (isRoommateDropdown) {
                        shouldClose = !dropdown.contains(e.target) && !e.target.closest('[id*="kebab-btn-roommate"][id*="pageslide"]');
                    } else if (isRentcafeDropdown) {
                        shouldClose = !dropdown.contains(e.target) && !e.target.closest('#kebab-btn-rentcafe-john');
                    }
                    
                    if (shouldClose) {
                        dropdown.classList.add('hidden');
                        dropdown.style.display = 'none';
                    }
                });
            });
        }
        
        // Initialize activity timeline features
        function initializeActivityTimeline() {
            // Add character counters to textareas and inputs
            document.addEventListener('input', function(e) {
                if (e.target.matches('#activity-modal textarea, #activity-modal input[type="text"]')) {
                    updateCharacterCount(e.target);
                }
            });
            
            // Real-time validation as user types
            document.addEventListener('input', function(e) {
                if (e.target.closest('#activity-modal')) {
                    debounce(clearFieldError, 300)(e.target);
                }
            });
            
            console.log('Activity timeline initialized successfully');
        }
        
        // Update character count for form fields
        function updateCharacterCount(field) {
            const maxLength = field.id === 'activity-title' ? 100 : 500;
            const currentLength = field.value.length;
            
            // Remove existing counter
            const existingCounter = field.parentNode.querySelector('.char-counter');
            if (existingCounter) existingCounter.remove();
            
            // Add character counter
            const counter = document.createElement('div');
            counter.className = 'char-counter text-xs text-gray-500 mt-1 text-right';
            counter.textContent = `${currentLength}/${maxLength}`;
            
            // Color coding
            if (currentLength > maxLength * 0.8) {
                counter.className = 'char-counter text-xs text-orange-500 mt-1 text-right';
            }
            if (currentLength >= maxLength) {
                counter.className = 'char-counter text-xs text-red-500 mt-1 text-right';
            }
            
            field.parentNode.appendChild(counter);
        }
        
        // Clear field error state
        function clearFieldError(field) {
            field.classList.remove('error');
            field.style.borderColor = '';
            
            // Remove field-specific error message
            const errorMessage = field.parentNode.querySelector('.error-message');
            if (errorMessage) errorMessage.remove();
        }
        
        // Debounce utility
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Initialize page functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize activity timeline features
            initializeActivityTimeline();
            
            // Load saved activities from local storage
            // loadSavedActivities(); // Commented out to avoid duplicating existing activities on page reload
            
            // Keyboard shortcuts for modals
            document.addEventListener('keydown', function(e) {
                const modal = document.getElementById('activity-modal');
                if (modal) {
                    if (e.key === 'Escape') {
                        closeActivityModal();
                    }
                    // Ctrl/Cmd + Enter to save
                    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                        const saveBtn = modal.querySelector('button[onclick*="saveActivity"]');
                        if (saveBtn) saveBtn.click();
                    }
                }
            });
            
            // Close modal when clicking outside
            document.addEventListener('click', function(e) {
                const modal = document.getElementById('activity-modal');
                if (modal && e.target === modal) {
                    closeActivityModal();
                }
                
                // Close activity add menu when clicking outside
                const addMenu = document.getElementById('activity-add-menu');
                const addBtn = document.getElementById('activity-add-btn');
                if (addMenu && !addMenu.classList.contains('hidden') && 
                    !addMenu.contains(e.target) && !addBtn.contains(e.target)) {
                    addMenu.classList.add('hidden');
                }
            });
        
            // Kebab menu functionality for both Resident and Lease cards
            function setupKebabMenu(btnId, dropdownId, dropdownWidth = 180) {
                const kebabBtn = document.getElementById(btnId);
                const kebabDropdown = document.getElementById(dropdownId);
                
                console.log('Setting up kebab menu:', { btnId, dropdownId, kebabBtn, kebabDropdown });
                
                if (kebabBtn && kebabDropdown) {
                    kebabBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        console.log('Kebab button clicked:', btnId);
                        
                        // Close all other dropdowns first
                        document.querySelectorAll('[id^="kebab-dropdown-"]').forEach(dropdown => {
                            if (dropdown !== kebabDropdown) {
                                dropdown.classList.add('hidden');
                                dropdown.style.display = 'none';
                            }
                        });
                        
                        // Also close tenant header manage dropdown
                        const tenantManageDropdown = document.getElementById('tenant-header-manage-dropdown');
                        if (tenantManageDropdown && tenantManageDropdown !== kebabDropdown) {
                            tenantManageDropdown.classList.add('hidden');
                            tenantManageDropdown.style.display = 'none';
                            tenantManageDropdown.style.visibility = 'hidden';
                        }
                        
                        // Get button position and viewport dimensions
                        const rect = kebabBtn.getBoundingClientRect();
                        const viewportWidth = window.innerWidth;
                        const viewportHeight = window.innerHeight;
                        
                        // Estimate dropdown height based on dropdown ID
                        let dropdownHeight = 150; // Default estimate
                        if (dropdownId === 'tenant-header-manage-dropdown') {
                            dropdownHeight = 450; // Actions dropdown has many items
                        } else if (dropdownId === 'kebab-dropdown-lease') {
                            dropdownHeight = 200;
                        }
                        
                        // Calculate initial position (right-aligned with button)
                        let left = rect.right - dropdownWidth;
                        let top = rect.bottom + 4;
                        
                        // Adjust horizontal position if dropdown would go off-screen
                        if (left < 10) {
                            // If too far left, align with left edge of button
                            left = rect.left;
                        } else if (left + dropdownWidth > viewportWidth - 10) {
                            // If too far right, try positioning to the left of button
                            left = rect.left - dropdownWidth + rect.width;
                            // If still off-screen, align with right edge of viewport
                            if (left < 10) {
                                left = viewportWidth - dropdownWidth - 10;
                            }
                        }
                        
                        // Ensure minimum distance from edges
                        left = Math.max(10, Math.min(left, viewportWidth - dropdownWidth - 10));
                        
                        // Adjust vertical position if dropdown would go off-screen
                        if (top + dropdownHeight > viewportHeight - 10) {
                            // Try positioning above the button instead
                            const topPosition = rect.top - dropdownHeight - 4;
                            if (topPosition >= 10) {
                                top = topPosition;
                            } else {
                                // If too tall for both above and below, position at top of viewport
                                top = 10;
                            }
                        }
                        
                        // Ensure minimum distance from edges and max height
                        top = Math.max(10, Math.min(top, viewportHeight - Math.min(dropdownHeight, viewportHeight - 20)));
                        
                        // Show dropdown first to get actual dimensions
                        const isHidden = kebabDropdown.classList.contains('hidden');
                        
                        if (isHidden) {
                            // Show dropdown temporarily to measure it
                        kebabDropdown.style.position = 'fixed';
                        kebabDropdown.style.left = left + 'px';
                        kebabDropdown.style.top = top + 'px';
                        kebabDropdown.style.zIndex = '9999';
                            kebabDropdown.style.visibility = 'hidden'; // Hide visually but allow measurement
                            kebabDropdown.classList.remove('hidden');
                            kebabDropdown.style.display = 'block';
                            
                            // Get actual dropdown dimensions
                            const actualHeight = kebabDropdown.offsetHeight;
                            const actualWidth = kebabDropdown.offsetWidth;
                            
                            // Recalculate position with actual dimensions
                            left = rect.right - actualWidth;
                            
                            // Adjust horizontal position with actual width
                            if (left < 10) {
                                left = rect.left;
                            } else if (left + actualWidth > viewportWidth - 10) {
                                left = rect.left - actualWidth + rect.width;
                                if (left < 10) {
                                    left = viewportWidth - actualWidth - 10;
                                }
                            }
                            left = Math.max(10, Math.min(left, viewportWidth - actualWidth - 10));
                            
                            // Adjust vertical position with actual height
                            top = rect.bottom + 4;
                            if (top + actualHeight > viewportHeight - 10) {
                                const topPosition = rect.top - actualHeight - 4;
                                if (topPosition >= 10) {
                                    top = topPosition;
                                } else {
                                    top = 10;
                                }
                            }
                            top = Math.max(10, Math.min(top, viewportHeight - actualHeight - 10));
                            
                            // Apply final position and make visible
                            console.log('Positioning dropdown:', dropdownId, 'at:', { left, top, actualWidth, actualHeight });
                            kebabDropdown.style.left = left + 'px';
                            kebabDropdown.style.top = top + 'px';
                            kebabDropdown.style.visibility = 'visible'; // Make visible
                            console.log('✅ Dropdown should now be visible:', dropdownId);
                        } else {
                            kebabDropdown.classList.add('hidden');
                            kebabDropdown.style.display = 'none';
                            kebabDropdown.style.visibility = 'hidden';
                            console.log('✅ Dropdown hidden:', dropdownId);
                        }
                    });
                } else {
                    console.error('❌ Kebab menu setup failed - missing elements:', { btnId, dropdownId, kebabBtn, kebabDropdown });
                }
                
                return { kebabBtn, kebabDropdown };
            }
            
            // Setup all kebab menus (except charges - handled manually below)
            console.log('🔧 Initializing kebab menus...');
            const residentKebab = setupKebabMenu('kebab-btn-resident', 'kebab-dropdown-resident', 180);
            const leaseKebab = setupKebabMenu('kebab-btn-lease', 'kebab-dropdown-lease', 200);
            const leaseTimelineKebab = setupKebabMenu('kebab-btn-lease-timeline', 'kebab-dropdown-lease-timeline', 180);
            const tenantHeaderManageKebab = setupKebabMenu('tenant-header-manage-btn', 'tenant-header-manage-dropdown', 260);
            const roommateAngelaOverviewKebab = setupKebabMenu('kebab-btn-roommate-angela-overview', 'kebab-dropdown-roommate-angela-overview', 180);
            const roommateJohnOverviewKebab = setupKebabMenu('kebab-btn-roommate-john-overview', 'kebab-dropdown-roommate-john-overview', 180);
            const roommateAngelaKebab = setupKebabMenu('kebab-btn-roommate-angela', 'kebab-dropdown-roommate-angela', 180);
            const roommateJohnKebab = setupKebabMenu('kebab-btn-roommate-john', 'kebab-dropdown-roommate-john', 180);
            const rentcafeKebab = setupKebabMenu('kebab-btn-rentcafe', 'kebab-dropdown-rentcafe', 160);
            const driverLicenseAngelaKebab = setupKebabMenu('kebab-btn-driver-license-angela', 'kebab-dropdown-driver-license-angela', 180);
            const leaseV12Kebab = setupKebabMenu('kebab-btn-lease-v12', 'kebab-dropdown-lease-v12', 180);
            const driverLicenseJohnKebab = setupKebabMenu('kebab-btn-driver-license-john', 'kebab-dropdown-driver-license-john', 180);
            const driverLicenseMelindaKebab = setupKebabMenu('kebab-btn-driver-license-melinda', 'kebab-dropdown-driver-license-melinda', 180);
            const petDocumentationKebab = setupKebabMenu('kebab-btn-pet-documentation', 'kebab-dropdown-pet-documentation', 180);
            const emergencyContactJohnKebab = setupKebabMenu('kebab-btn-emergency-contact-john', 'kebab-dropdown-emergency-contact-john', 180);
            const photo002MelindaKebab = setupKebabMenu('kebab-btn-photo002-melinda', 'kebab-dropdown-photo002-melinda', 180);
            const maintenanceNotesJohnKebab = setupKebabMenu('kebab-btn-maintenance-notes-john', 'kebab-dropdown-maintenance-notes-john', 180);
            const inspectionReportAngelaKebab = setupKebabMenu('kebab-btn-inspection-report-angela', 'kebab-dropdown-inspection-report-angela', 180);
            const leaseV21Kebab = setupKebabMenu('kebab-btn-lease-v21', 'kebab-dropdown-lease-v21', 180);
            const petAddendumKebab = setupKebabMenu('kebab-btn-pet-addendum', 'kebab-dropdown-pet-addendum', 180);
            const insuranceCertificateKebab = setupKebabMenu('kebab-btn-insurance-certificate', 'kebab-dropdown-insurance-certificate', 180);
            const petRegistrationKebab = setupKebabMenu('kebab-btn-pet-registration', 'kebab-dropdown-pet-registration', 180);
            // Note: kebab-btn-rentcafe-john is handled in pageslide context only
            
            console.log('✅ Kebab menu initialization results:', {
                residentKebab: !!residentKebab?.kebabBtn,
                leaseKebab: !!leaseKebab?.kebabBtn,
                leaseTimelineKebab: !!leaseTimelineKebab?.kebabBtn,
                tenantHeaderManageKebab: !!tenantHeaderManageKebab?.kebabBtn,
                roommateAngelaKebab: !!roommateAngelaKebab?.kebabBtn,
                roommateJohnKebab: !!roommateJohnKebab?.kebabBtn,
                rentcafeKebab: !!rentcafeKebab?.kebabBtn,
                driverLicenseAngelaKebab: !!driverLicenseAngelaKebab?.kebabBtn,
                leaseV12Kebab: !!leaseV12Kebab?.kebabBtn,
                driverLicenseJohnKebab: !!driverLicenseJohnKebab?.kebabBtn,
                driverLicenseMelindaKebab: !!driverLicenseMelindaKebab?.kebabBtn,
                petDocumentationKebab: !!petDocumentationKebab?.kebabBtn,
                emergencyContactJohnKebab: !!emergencyContactJohnKebab?.kebabBtn,
                photo002MelindaKebab: !!photo002MelindaKebab?.kebabBtn,
                maintenanceNotesJohnKebab: !!maintenanceNotesJohnKebab?.kebabBtn,
                inspectionReportAngelaKebab: !!inspectionReportAngelaKebab?.kebabBtn,
                leaseV21Kebab: !!leaseV21Kebab?.kebabBtn,
                petAddendumKebab: !!petAddendumKebab?.kebabBtn,
                insuranceCertificateKebab: !!insuranceCertificateKebab?.kebabBtn,
                petRegistrationKebab: !!petRegistrationKebab?.kebabBtn
            });
            


            
            // Add charge button functionality
            const addChargeBtn = document.querySelector('.search-container button:first-of-type');
            if (addChargeBtn) {
                addChargeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    alert('Add Charge:\n\n• Create new charge\n• Select charge type\n• Set amount and due date\n• Apply to resident account');
                });
            }

            // Ledger button functionality for history records
            const ledgerButtons = document.querySelectorAll('.history-record .btn');
            ledgerButtons.forEach(button => {
                if (button.textContent.trim().includes('ledger')) {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Find the history record container
                        const historyRecord = this.closest('.history-record');
                        const recordType = historyRecord.querySelector('.text-sm').textContent.trim();
                        const metadataText = historyRecord.querySelector('.text-muted').parentElement.textContent.trim();
                        
                        // Extract prior lease from the metadata text
                        const priorLeaseMatch = metadataText.match(/Prior lease: (\d+)/);
                        const priorLease = priorLeaseMatch ? priorLeaseMatch[1] : 'Unknown';
                        
                        alert(`${recordType} Ledger:\n\n• Prior Lease: ${priorLease}\n• View detailed transaction history\n• Export ledger data\n• Print financial records\n• Review payment timeline`);
                    });
                }
            });
            
            // Manual setup for charges kebab menu
            const chargesKebabBtn = document.getElementById('kebab-btn-charges');
            const chargesKebabDropdown = document.getElementById('kebab-dropdown-charges');
            
            if (chargesKebabBtn && chargesKebabDropdown) {
                // Setup charges kebab click handler
                chargesKebabBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Close all other dropdowns first
                    document.querySelectorAll('[id^="kebab-dropdown-"]').forEach(dropdown => {
                        if (dropdown !== chargesKebabDropdown) {
                            dropdown.classList.add('hidden');
                            dropdown.style.display = 'none';
                        }
                    });
                    
                    // Also close tenant header manage dropdown
                    const tenantManageDropdown = document.getElementById('tenant-header-manage-dropdown');
                    if (tenantManageDropdown && tenantManageDropdown !== chargesKebabDropdown) {
                        tenantManageDropdown.classList.add('hidden');
                        tenantManageDropdown.style.display = 'none';
                        tenantManageDropdown.style.visibility = 'hidden';
                    }
                    
                    // Toggle this dropdown
                    const isHidden = chargesKebabDropdown.classList.contains('hidden');
                    
                    if (isHidden) {
                        chargesKebabDropdown.classList.remove('hidden');
                        
                        // Position the dropdown relative to the button
                        const rect = chargesKebabBtn.getBoundingClientRect();
                        const dropdownWidth = 180;
                        const dropdownHeight = 160;
                        
                        // Position dropdown to the left of the button (since it's at the right edge)
                        let left = rect.right - dropdownWidth;
                        let top = rect.bottom + 8;
                        
                        // Ensure dropdown doesn't go off screen
                        const viewportWidth = window.innerWidth;
                        const viewportHeight = window.innerHeight;
                        
                        // Adjust horizontal position if needed
                        if (left < 10) {
                            left = rect.left; // Align with left edge of button if not enough space
                        }
                        if (left + dropdownWidth > viewportWidth - 10) {
                            left = viewportWidth - dropdownWidth - 10;
                        }
                        
                        // Adjust vertical position if needed
                        if (top + dropdownHeight > viewportHeight - 10) {
                            top = rect.top - dropdownHeight - 8; // Show above button
                        }
                        
                        chargesKebabDropdown.style.cssText = `
                            position: fixed !important;
                            left: ${left}px !important;
                            top: ${top}px !important;
                            z-index: 99999 !important;
                            width: 180px !important;
                            display: block !important;
                        `;
                    } else {
                        chargesKebabDropdown.classList.add('hidden');
                        chargesKebabDropdown.style.display = 'none';
                    }
                });
            } else {
                console.error('Charges kebab elements not found');
            }
            
            // Charges kebab menu actions
            const chargesKebabOptions = document.querySelectorAll('#kebab-dropdown-charges .kebab-option');
            chargesKebabOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const action = this.textContent.trim();
                    
                    if (action.includes('Receive payment')) {
                        alert('Receive Payment:\n\n• Process payment\n• Select payment method\n• Apply to outstanding charges\n• Send receipt');
                    } else if (action.includes('Print')) {
                        alert('Print Statement:\n\n• Generate printable statement\n• Include all charges and payments\n• Ready for physical delivery');
                    } else if (action.includes('Export to excel')) {
                        alert('Export to Excel:\n\n• Download detailed spreadsheet\n• All charge and payment data\n• Ready for analysis');
                    } else if (action.includes('Export to PDF')) {
                        alert('Export to PDF:\n\n• Generate PDF statement\n• Professional formatting\n• Ready for email or printing');
                    }
                    
                    // Close the dropdown
                    chargesKebabDropdown.classList.add('hidden');
                    chargesKebabDropdown.style.display = 'none';
                });
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                const allDropdowns = [
                    residentKebab.kebabDropdown, 
                    leaseKebab.kebabDropdown, 
                    tenantHeaderManageKebab.kebabDropdown,
                    roommateAngelaKebab.kebabDropdown,
                    roommateJohnKebab.kebabDropdown,
                    rentcafeKebab.kebabDropdown,
                    driverLicenseAngelaKebab.kebabDropdown,
                    leaseV12Kebab.kebabDropdown,
                    driverLicenseJohnKebab.kebabDropdown,
                    driverLicenseMelindaKebab.kebabDropdown,
                    petDocumentationKebab.kebabDropdown,
                    emergencyContactJohnKebab.kebabDropdown,
                    photo002MelindaKebab.kebabDropdown,
                    maintenanceNotesJohnKebab.kebabDropdown,
                    inspectionReportAngelaKebab.kebabDropdown,
                    leaseV21Kebab.kebabDropdown,
                    petAddendumKebab.kebabDropdown,
                    chargesKebabDropdown
                ];
                const allButtons = [
                    residentKebab.kebabBtn, 
                    leaseKebab.kebabBtn, 
                    tenantHeaderManageKebab.kebabBtn,
                    roommateAngelaKebab.kebabBtn,
                    roommateJohnKebab.kebabBtn,
                    rentcafeKebab.kebabBtn,
                    driverLicenseAngelaKebab.kebabBtn,
                    leaseV12Kebab.kebabBtn,
                    driverLicenseJohnKebab.kebabBtn,
                    driverLicenseMelindaKebab.kebabBtn,
                    petDocumentationKebab.kebabBtn,
                    emergencyContactJohnKebab.kebabBtn,
                    photo002MelindaKebab.kebabBtn,
                    maintenanceNotesJohnKebab.kebabBtn,
                    inspectionReportAngelaKebab.kebabBtn,
                    leaseV21Kebab.kebabBtn,
                    petAddendumKebab.kebabBtn,
                    chargesKebabBtn
                ];
                
                // Check if click is outside all kebab elements
                const clickedDropdown = allDropdowns.find(dropdown => dropdown && dropdown.contains(e.target));
                const clickedButton = allButtons.find(button => button && (button === e.target || button.contains(e.target)));
                
                if (!clickedDropdown && !clickedButton) {
                    allDropdowns.forEach(dropdown => {
                        if (dropdown) {
                            dropdown.classList.add('hidden');
                                dropdown.style.display = 'none';
                            // Special handling for tenant header manage dropdown which uses visibility
                            if (dropdown === tenantHeaderManageKebab.kebabDropdown) {
                                dropdown.style.visibility = 'hidden';
                            }
                        }
                    });
                }
                
                // Close lease charges popover when clicking outside
                const leaseChargesPopover = document.getElementById('lease-charges-popover');
                const leaseChargesBtn = document.querySelector('[onclick*="toggleLeaseChargesPopover"]');
                if (leaseChargesPopover && leaseChargesBtn && 
                    !leaseChargesBtn.contains(e.target) && !leaseChargesPopover.contains(e.target)) {
                    leaseChargesPopover.classList.add('hidden');
                }
                
                // Close deposit popover when clicking outside
                const depositPopover = document.getElementById('deposit-popover');
                const depositBtn = document.querySelector('[onclick*="toggleDepositPopover"]');
                if (depositPopover && depositBtn && 
                    !depositBtn.contains(e.target) && !depositPopover.contains(e.target)) {
                    depositPopover.classList.add('hidden');
                }
            });
            
            // Close dropdowns when scrolling to prevent positioning issues
            let scrollTimeout;
            function closeAllDropdowns() {
                const allDropdowns = [
                    residentKebab.kebabDropdown, 
                    leaseKebab.kebabDropdown, 
                    tenantHeaderManageKebab.kebabDropdown,
                    roommateAngelaKebab.kebabDropdown,
                    roommateJohnKebab.kebabDropdown,
                    rentcafeKebab.kebabDropdown,
                    driverLicenseAngelaKebab.kebabDropdown,
                    leaseV12Kebab.kebabDropdown,
                    driverLicenseJohnKebab.kebabDropdown,
                    driverLicenseMelindaKebab.kebabDropdown,
                    petDocumentationKebab.kebabDropdown,
                    emergencyContactJohnKebab.kebabDropdown,
                    photo002MelindaKebab.kebabDropdown,
                    maintenanceNotesJohnKebab.kebabDropdown,
                    inspectionReportAngelaKebab.kebabDropdown,
                    leaseV21Kebab.kebabDropdown,
                    petAddendumKebab.kebabDropdown,
                    chargesKebabDropdown
                ];
                
                allDropdowns.forEach(dropdown => {
                    if (dropdown) {
                        dropdown.classList.add('hidden');
                            dropdown.style.display = 'none';
                        // Special handling for tenant header manage dropdown
                        if (dropdown === tenantHeaderManageKebab.kebabDropdown) {
                            dropdown.style.visibility = 'hidden';
                        }
                    }
                });
                
                // Resident header kebab menu has been removed
                
                // Also close the tenant header manage dropdown (uses different class system)
                const tenantHeaderManageDropdown = document.getElementById('tenant-header-manage-dropdown');
                if (tenantHeaderManageDropdown) {
                    tenantHeaderManageDropdown.classList.add('hidden');
                    tenantHeaderManageDropdown.style.display = 'none';
                    tenantHeaderManageDropdown.style.visibility = 'hidden';
                }
                
                // Also close the activity filter dropdown
                const activityFilterDropdown = document.getElementById('activity-filter-dropdown');
                if (activityFilterDropdown) {
                    activityFilterDropdown.classList.remove('active');
                }
            }
            
            function handleScroll(e) {
                // Clear previous timeout
                if (scrollTimeout) {
                    clearTimeout(scrollTimeout);
                }
                
                // Set a small delay to avoid closing during smooth scrolling
                scrollTimeout = setTimeout(closeAllDropdowns, 50);
            }
            
            // Add scroll listeners to document and all scrollable containers
            document.addEventListener('scroll', handleScroll, { passive: true });
            window.addEventListener('scroll', handleScroll, { passive: true });
            
            // Also handle scroll events on pageslides and other containers
            document.querySelectorAll('.pageslide, .main-content, .content-grid').forEach(container => {
                container.addEventListener('scroll', handleScroll, { passive: true });
            });
            
            // Close dropdowns on window resize to prevent positioning issues
            window.addEventListener('resize', function() {
                closeAllDropdowns();
            });
            
            // Handle task action buttons
            document.addEventListener('click', function(e) {
                if (e.target.closest('.task-item button')) {
                    const button = e.target.closest('button');
                    const buttonText = button.textContent.trim();
                    
                    switch(buttonText) {
                        case 'Review Application':
                            alert('Roommate Application Review:\n\n• Review Angela Johnson\'s application\n• Verify background check\n• Approve or request additional information\n• Notify applicant of decision');
                            break;
                        case 'Check Status':
                            alert('Roommate Invitation Status:\n\n• Review John Smith\'s invitation status\n• Send follow-up if needed\n• Check application progress\n• Set reminder for next follow-up');
                            break;
                        case 'Send invitation':
                            alert('Send Roommate Invitation:\n\n• Generate invitation link for Angela Johnson\n• Send via email or SMS\n• Set reminder for follow-up\n• Track invitation status');
                            break;
                        case 'Approve application':
                            alert('Approve Roommate Application:\n\n• Final review of Angela Johnson\'s application\n• Process background check results\n• Generate lease addendum\n• Notify all parties of approval');
                            break;

                        case 'Create proposal':
                            alert('Create Lease Proposal:\n\n• Review current lease terms\n• Check market rent rates\n• Generate renewal proposal\n• Calculate new rent amount\n• Prepare proposal documents\n• Schedule tenant meeting');
                            break;
                        case 'View Details':
                            alert('Work Order Details:\n\nWork Order #26145\n• Date: Aug 17, 2025\n• Category: Appliances\n• Description: Refrigerator is not working\n• Priority: Medium\n• Status: Call\n• View full work order history and notes');
                            break;
                        case 'Complete':
                            alert('Complete Work Order:\n\n• Mark work order #26145 as completed\n• Add completion notes\n• Update resident communication\n• Close work order in system\n• Generate completion report');
                            break;
                    }
                }
            });
            
            // Handle kebab menu option clicks
            document.addEventListener('click', function(e) {
                if (e.target.closest('.kebab-option')) {
                    const button = e.target.closest('.kebab-option');
                    const buttonText = button.textContent.trim();
                    
                    // Close all kebab dropdowns
                    document.querySelectorAll('[id^="kebab-dropdown-"]').forEach(dropdown => {
                        dropdown.classList.add('hidden');
                        dropdown.style.display = 'none';
                    });
                    
                    // Also close tenant header manage dropdown
                    const tenantManageDropdown = document.getElementById('tenant-header-manage-dropdown');
                    if (tenantManageDropdown) {
                        tenantManageDropdown.classList.add('hidden');
                        tenantManageDropdown.style.display = 'none';
                        tenantManageDropdown.style.visibility = 'hidden';
                    }
                    
                    switch(buttonText) {
                        case 'Change password':
                            alert('Change Password:\n\n• Generate new temporary password\n• Send to resident via email/SMS\n• Force password change on next login\n• Update security logs');
                            break;
                        case 'Lock account':
                            alert('Lock Account:\n\n• Temporarily disable account access\n• Prevent login attempts\n• Send notification to resident\n• Option to unlock later');
                            break;
                        // Add other kebab menu actions here as needed
                    }
                }
            });
            
            // Add click handlers for sidebar menu items
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all items
                    menuItems.forEach(mi => mi.classList.remove('active'));
                    // Add active class to clicked item
                    this.classList.add('active');
                });
            });

            // Add click handlers for dropdown menus
            const parentMenuItems = document.querySelectorAll('.menu-item.parent');
            parentMenuItems.forEach(item => {
                item.addEventListener('click', function() {
                    this.classList.toggle('expanded');
                });
            });

            // Add click handlers for Add links
            const addLinks = document.querySelectorAll('.add-link');
            addLinks.forEach(link => {
                link.addEventListener('click', function() {
                    alert('Add functionality would open here');
                });
            });

            // Add click handlers for blue links
            const blueLinks = document.querySelectorAll('.info-value.link');
            blueLinks.forEach(link => {
                link.addEventListener('click', function() {
                    alert('Link clicked: ' + this.textContent);
                });
            });

            // Add search functionality
            const searchInput = document.querySelector('.search-input');
            const searchBtn = document.querySelector('.search-btn');
            
            searchBtn.addEventListener('click', function() {
                const searchTerm = searchInput.value;
                if (searchTerm) {
                    alert('Searching for: ' + searchTerm);
                } else {
                    alert('Please enter a search term');
                }
            });

            // Enter key for search
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchBtn.click();
                }
            });

            // Add click handlers for header action buttons
            const actionBtns = document.querySelectorAll('.action-btn');
            actionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    if (icon) {
                        const iconClass = icon.className;
                        if (iconClass.includes('calendar')) {
                            alert('Calendar view would open here');
                        } else if (iconClass.includes('calculator')) {
                            alert('Calculator would open here');
                        } else if (iconClass.includes('star')) {
                            alert('Favorites would open here');
                        } else if (iconClass.includes('question')) {
                            alert('Help would open here');
                        } else if (iconClass.includes('cog')) {
                            alert('Settings would open here');
                        }
                    } else if (this.textContent === '0') {
                        alert('Notifications would open here');
                    }
                });
            });

            // Add click handler for Add New button
            const addNewBtn = document.querySelector('.add-new-btn');
            if (addNewBtn) {
            addNewBtn.addEventListener('click', function() {
                alert('Add New menu would open here');
            });
            }

            // Add click handler for user profile
            const userProfile = document.querySelector('.user-profile');
            if (userProfile) {
            userProfile.addEventListener('click', function() {
                alert('User profile menu would open here');
            });
            }

            // Add click handler for Verify ID button
            const verifyBtn = document.querySelector('.verified-badge');
            if (verifyBtn) {
            verifyBtn.addEventListener('click', function() {
                alert('ID Verification process would start here');
            });
            }





            // Resident action buttons for email, call, SMS, work order
            const residentActionBtns = document.querySelectorAll('.resident-action-btn');
            residentActionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.classList.contains('email')) {
                        alert('Send Email to Kamala Hakuna:\n\n• Compose new message\n• Use template\n• Send reminder\n• Schedule email');
                    } else if (this.classList.contains('call')) {
                        alert('Call Kamala Hakuna:\n\n• Primary phone: (555) 123-4567\n• Emergency contact: (555) 987-6543\n• Log call\n• Schedule callback');
                    } else if (this.classList.contains('sms')) {
                        alert('Send SMS to Kamala Hakuna:\n\n• Quick message\n• Payment reminder\n• Maintenance notice\n• Custom message');
                    } else if (this.classList.contains('work-order-btn')) {
                        alert('Create Work Order:\n\n• Report maintenance issue\n• Select category and priority\n• Add description and photos\n• Assign to maintenance team\n• Set schedule');
                    }
                });
            });

            // Header work order button
            const headerWorkOrderBtn = document.getElementById('header-work-order-btn');
            if (headerWorkOrderBtn) {
                headerWorkOrderBtn.addEventListener('click', function() {
                    alert('Create Work Order:\n\n• Report maintenance issue\n• Select category and priority\n• Add description and photos\n• Assign to maintenance team\n• Set schedule');
                });
            }
            
                        // Initialize activity timeline height to match lease info card
            setTimeout(() => {
                matchActivityTimelineHeight();
                
                // Initialize button text with count
                const loadMoreSection = document.getElementById('load-more-section');
                const toggleText = document.getElementById('toggle-activities-text');
                const hiddenActivities = document.getElementById('hidden-activities');
                
                if (loadMoreSection && toggleText && hiddenActivities) {
                    const allSections = hiddenActivities.querySelectorAll('.activity-section');
                    // Hide all sections initially for progressive loading
                    allSections.forEach(section => {
                        section.style.display = 'none';
                    });
                    toggleText.textContent = 'Load more activities';
                    console.log('Load more button initialized');
                } else {
                    console.log('Load more button NOT found');
                }
                
                // Position load more button in the preferred location (same as after collapse)
                resetButtonPosition();
                console.log('Load more button positioned in preferred location');
                
            }, 150);
            
            // Update heights on window resize (with debouncing)
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    matchActivityTimelineHeight();
                }, 250);
            });
            
            // Add debounce function to prevent rapid filter changes
            let filterTimeout = null;
            const originalFilterActivities = filterActivities;
            const originalFilterCommunicationTypes = filterCommunicationTypes;

            
            // Override filter functions with debounced versions
            window.filterActivities = function(filter) {
                if (filterTimeout) clearTimeout(filterTimeout);
                filterTimeout = setTimeout(() => {
                    originalFilterActivities(filter);
                }, 50);
            };
            
            window.filterCommunicationTypes = function(type) {
                if (filterTimeout) clearTimeout(filterTimeout);
                filterTimeout = setTimeout(() => {
                    originalFilterCommunicationTypes(type);
                }, 50);
            };


            // Activity filter dropdown functionality
            const activityFilterBtn = document.getElementById('activity-filter-btn');
            const activityFilterDropdown = document.getElementById('activity-filter-dropdown');
            const filterCurrentText = document.querySelector('.filter-current-text');
            
            // Communication filter elements
            const commTypeFilterBtn = document.getElementById('communication-type-filter-btn');
            const commTypeFilterDropdown = document.getElementById('communication-type-filter-dropdown');
            const sourceFilterBtn = document.getElementById('source-filter-btn');
            const sourceFilterDropdown = document.getElementById('source-filter-dropdown');
            
            if (activityFilterBtn && activityFilterDropdown) {
                activityFilterBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    activityFilterDropdown.classList.toggle('active');
                });

                // Handle filter option clicks
                const filterOptions = activityFilterDropdown.querySelectorAll('.activity-filter-option');
                filterOptions.forEach(option => {
                    option.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const value = this.getAttribute('data-value');
                        const text = this.querySelector('span').textContent;
                        
                        // Remove selected class from all options
                        filterOptions.forEach(opt => opt.classList.remove('selected'));
                        
                        // Add selected class to clicked option
                        this.classList.add('selected');
                        
                        // Update button text
                        filterCurrentText.textContent = text;
                        
                        // Close dropdown
                        activityFilterDropdown.classList.remove('active');
                        
                        // Apply filter
                        filterActivities(value);
                    });
                });
                
                // Set initial selected state
                const defaultOption = activityFilterDropdown.querySelector('[data-value="all"]');
                if (defaultOption) {
                    defaultOption.classList.add('selected');
                }
            }
            
            // Communication Type filter dropdown functionality
            if (commTypeFilterBtn && commTypeFilterDropdown) {
                commTypeFilterBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    commTypeFilterDropdown.classList.toggle('active');
                });

                // Handle filter option clicks
                const commTypeOptions = commTypeFilterDropdown.querySelectorAll('.activity-filter-option');
                commTypeOptions.forEach(option => {
                    option.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const value = this.getAttribute('data-value');
                        const text = this.querySelector('span').textContent;
                        
                        // Remove selected class from all options
                        commTypeOptions.forEach(opt => opt.classList.remove('selected'));
                        
                        // Add selected class to clicked option
                        this.classList.add('selected');
                        
                        // Update button text
                        commTypeFilterBtn.querySelector('.filter-current-text').textContent = text;
                        
                        // Close dropdown
                        commTypeFilterDropdown.classList.remove('active');
                        
                        // Apply filter
                        filterCommunicationTypes(value);
                    });
                });
                
                // Set initial selected state
                const defaultCommTypeOption = commTypeFilterDropdown.querySelector('[data-value="all-communications"]');
                if (defaultCommTypeOption) {
                    defaultCommTypeOption.classList.add('selected');
                }
            }
            
            // Source filter dropdown functionality
            if (sourceFilterBtn && sourceFilterDropdown) {
                sourceFilterBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    sourceFilterDropdown.classList.toggle('active');
                });

                // Handle filter option clicks
                const sourceOptions = sourceFilterDropdown.querySelectorAll('.activity-filter-option');
                sourceOptions.forEach(option => {
                    option.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const value = this.getAttribute('data-value');
                        const text = this.querySelector('span').textContent;
                        
                        // Remove selected class from all options
                        sourceOptions.forEach(opt => opt.classList.remove('selected'));
                        
                        // Add selected class to clicked option
                        this.classList.add('selected');
                        
                        // Update button text
                        sourceFilterBtn.querySelector('.filter-current-text').textContent = text;
                        
                        // Close dropdown
                        sourceFilterDropdown.classList.remove('active');
                        
                        // Re-apply current activity filter with new source selection
                        const currentActivityFilter = document.querySelector('#activity-filter-dropdown .activity-filter-option.selected');
                        const currentFilter = currentActivityFilter ? currentActivityFilter.getAttribute('data-value') : 'all';
                        filterActivities(currentFilter);
                    });
                });
                
                // Set initial selected state
                const defaultSourceOption = sourceFilterDropdown.querySelector('[data-value="all-sources"]');
                if (defaultSourceOption) {
                    defaultSourceOption.classList.add('selected');
                }
            }
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                try {
                    if (activityFilterBtn && activityFilterDropdown && 
                        !activityFilterBtn.contains(e.target) && !activityFilterDropdown.contains(e.target)) {
                        activityFilterDropdown.classList.remove('active');
                    }
                    
                    if (commTypeFilterBtn && commTypeFilterDropdown && 
                        !commTypeFilterBtn.contains(e.target) && !commTypeFilterDropdown.contains(e.target)) {
                        commTypeFilterDropdown.classList.remove('active');
                    }
                    
                    if (sourceFilterBtn && sourceFilterDropdown && 
                        !sourceFilterBtn.contains(e.target) && !sourceFilterDropdown.contains(e.target)) {
                        sourceFilterDropdown.classList.remove('active');
                    }
                } catch (error) {
                    console.warn('Error in activity filter click handler:', error);
                }
            });

            // Resident kebab menu functionality has been moved to Actions dropdown

            // Suggested actions functionality
            const actionSuggestions = document.querySelectorAll('.action-suggestion');
            actionSuggestions.forEach(btn => {
                btn.addEventListener('click', function() {
                    const actionText = this.querySelector('span').textContent;
                    
                    if (this.classList.contains('reminder')) {
                        alert('Send Payment Reminder:\n\n• Email reminder about overdue balance\n• Include payment options\n• Set follow-up date\n• Log communication');
                    } else if (this.classList.contains('call')) {
                        alert('Call Resident:\n\n• Phone: (555) 123-4567\n• Discuss overdue payment\n• Offer payment plan options\n• Log call notes');
                    } else if (this.classList.contains('payment-plan')) {
                        alert('Create Payment Plan:\n\n• Set monthly installments\n• Choose payment dates\n• Define terms and conditions\n• Send agreement for signature');
                    } else if (this.classList.contains('schedule')) {
                        alert('Schedule Renewal Meeting:\n\n• Available dates and times\n• Meeting location options\n• Lease renewal terms to discuss\n• Send calendar invite');
                    } else if (this.classList.contains('renew')) {
                        alert('Renew Lease:\n\n• Generate renewal agreement\n• Update lease terms\n• Set new rental amount\n• Schedule signing appointment');
                    }
                });
            });

            // Clone icon functionality for customer information
            const cloneIcon = document.querySelector('.fa-clone');
            if (cloneIcon) {
                cloneIcon.addEventListener('click', function(e) {
                    e.preventDefault();
                    alert('Customer Profile:\n\n• Customer found across multiple properties\n• View unified customer journey\n• Access all property interactions\n• Cross-property payment history');
                });
            }

            // Section edit button functionality
            const sectionEditBtn = document.querySelector('.section-edit-btn');
            if (sectionEditBtn) {
                sectionEditBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    openPageslide('contact-edit-overlay');
                });
            }

            // Customer ID link functionality
            const customerIdLink = document.querySelector('.customer-id-link');
            if (customerIdLink) {
                customerIdLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    alert('View Customer Record:\n\n• Complete customer history\n• All property interactions\n• Application timeline\n• Cross-property payments\n• Communication log\n• Document repository');
                });
            }

            // Prospect ID link functionality
            const prospectIdElements = document.querySelectorAll('.info-value.link');
            prospectIdElements.forEach(element => {
                if (element.textContent.includes('p0012456')) {
                    element.addEventListener('click', function(e) {
                        e.preventDefault();
                        alert('View Prospect Record:\n\n• Original application details\n• Prospect journey at this property\n• Application timeline\n• Communication history\n• Lead source information');
                    });
                }
            });

            // Add links functionality for Roommates, Vehicles, and Pets
            const residentAddLinks = document.querySelectorAll('.add-link');
            residentAddLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const parentRow = this.closest('.info-row');
                    const label = parentRow.querySelector('.info-label').textContent;
                    
                    if (label.includes('Roommates')) {
                        alert('Add Roommate:\n\n• Add roommate information\n• Set roommate details\n• Update lease agreement\n• Configure access permissions');
                    } else if (label.includes('Vehicles')) {
                        alert('Add Vehicle:\n\n• Enter license plate number\n• Select state registration\n• Add vehicle make and model\n• Enter vehicle year\n• Specify vehicle color');
                    } else if (label.includes('Pets')) {
                        alert('Add Pet:\n\n• Pet type and breed\n• Pet registration\n• Vaccination records\n• Pet deposit/fees');
                    }
                });
            });

            // Roommate link functionality
            const roommateLink = document.querySelector('.roommate-link');
            if (roommateLink) {
                roommateLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    openPageslide('roommate-details-overlay');
                });
            }

            // Journey action buttons
            const journeyActionBtns = document.querySelectorAll('.journey-action-btn');
            journeyActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const action = this.querySelector('span').textContent;
                    alert(`${action} would open here`);
                });
            });

            // Stat card interactions
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach(card => {
                card.addEventListener('click', function(e) {
                    const pageslideId = this.getAttribute('data-pageslide');
                    const label = this.querySelector('.stat-label').textContent;
                    const value = this.querySelector('.stat-value').textContent;
                    
                    if (pageslideId) {
                        // Open pageslide for monthly charges
                        openPageslide(pageslideId + '-overlay');
                    } else {
                        // Show alert for other stat cards that don't have pageslides
                    }
                });
            });

            // Customer journey button
            const customerJourneyBtn = document.querySelector('.customer-journey-btn');
            if (customerJourneyBtn) {
                customerJourneyBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    openPageslide('customer-journey-overlay');
                });
            }

            // Close pageslide when clicking overlay or close button
            const pageslideOverlays = document.querySelectorAll('.pageslide-overlay');
            pageslideOverlays.forEach(overlay => {
                overlay.addEventListener('click', function(e) {
                    if (e.target === overlay) {
                        closePageslide(overlay.id);
                    }
                });

                const closeBtn = overlay.querySelector('.pageslide-close');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function() {
                        closePageslide(overlay.id);
                    });
                }
            });

            // Pageslide action buttons
            const chargesActionBtns = document.querySelectorAll('.charges-action-btn');
            chargesActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const actionText = this.querySelector('span').textContent;
                    
                    if (actionText.includes('Add Lease Charge')) {
                        alert('Add Lease Charge form would open:\n\n• Charge Type (Rent, Fee, etc.)\n• Amount\n• Effective Date\n• Description\n• Recurring Options');
                    } else if (actionText.includes('Export Details')) {
                        alert('Export options would open:\n\n• PDF Report\n• CSV Export\n• Excel Spreadsheet\n• Email Report');
                    }
                });
            });

            // Balance action buttons
            const balanceActionBtns = document.querySelectorAll('.balance-action-btn');
            balanceActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const actionText = this.querySelector('span').textContent;
                    
                    if (actionText.includes('Receive Payment')) {
                        alert('Payment Recording form would open:\n\n• Payment Amount: $2,100.00\n• Payment Method (Cash, Check, Card, ACH)\n• Payment Date\n• Reference Number\n• Notes');
                    } else if (actionText.includes('Add Charge')) {
                        alert('Add Charge interface would open:\n\n• Charge Type (Rent, Fee, etc.)\n• Amount\n• Due Date\n• Description\n• Billing Category');
                    } else if (actionText.includes('Send Reminder')) {
                        alert('Notice Options would open:\n\n• Email overdue notice\n• Generate printed letter\n• Schedule follow-up call\n• Set payment reminder\n• Escalate to collections');
                    } else if (actionText.includes('Export Statement')) {
                        alert('Statement Export options:\n\n• PDF Account Statement\n• Detailed Transaction Report\n• Payment History CSV\n• Email to Resident\n• Print for Files');
                    }
                });
            });

            // Timeline action buttons
            const timelineActionBtns = document.querySelectorAll('.timeline-action-btn');
            timelineActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const actionText = this.querySelector('span').textContent;
                    
                    if (actionText.includes('Add Timeline Event')) {
                        alert('Add Timeline Event form would open:\n\n• Event Type (Move In, Lease Renewal, etc.)\n• Date\n• Description\n• Notes\n• Attachments');
                    } else if (actionText.includes('Edit Timeline')) {
                        alert('Timeline Management interface would open:\n\n• Modify existing events\n• Update dates and descriptions\n• Add additional notes\n• Manage event visibility');
                    } else if (actionText.includes('Export Timeline')) {
                        alert('Timeline Export options:\n\n• PDF Timeline Report\n• Detailed Event History\n• CSV Export\n• Email to Resident\n• Print for Files');
                    }
                });
            });

            // Payment action buttons
            const paymentActionBtns = document.querySelectorAll('.payment-action-btn');
            paymentActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const actionText = this.querySelector('span').textContent;
                    
                    if (actionText.includes('Receive Payment')) {
                        alert('Receive Payment form would open:\n\n• Payment Amount\n• Payment Method (Cash, Check, Card, ACH)\n• Payment Date\n• Reference Number\n• Notes');
                    } else if (actionText.includes('Export Payment History')) {
                        alert('Export Payment History options:\n\n• PDF Payment Report\n• CSV Transaction Export\n• Excel Payment History\n• Email Payment Summary');
                    }
                });
            });

            // Payment quick action buttons
            const paymentQuickBtns = document.querySelectorAll('.payment-quick-btn');
            paymentQuickBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const actionText = this.querySelector('span').textContent;
                    
                    if (actionText.includes('Print')) {
                        alert('Print Payment History:\n\n• Print payment summary\n• Print detailed payment list\n• Print payment receipt\n• Print for files');
                    } else if (actionText.includes('Email')) {
                        alert('Email Payment History:\n\n• Send payment summary to resident\n• Email payment receipt\n• Send to management team\n• Custom email recipient');
                    }
                });
            });

            // Close pageslide with ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    pageslideOverlays.forEach(overlay => {
                        if (overlay.classList.contains('active')) {
                            closePageslide(overlay.id);
                        }
                    });
                }
            });

            // Roommate edit button functionality
            const roommateEditBtn = document.querySelector('.roommate-edit-btn');
            if (roommateEditBtn) {
                roommateEditBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    alert('Edit Roommate form would open:\n\n• Update contact information\n• Modify residency dates\n• Edit personal details\n• Update emergency contacts');
                });
            }

            // Roommate kebab menu option handlers
            const roommateKebabOptions = document.querySelectorAll('#kebab-dropdown-roommate-angela .kebab-option, #kebab-dropdown-roommate-john .kebab-option, #kebab-dropdown-roommate-angela-pageslide .kebab-option, #kebab-dropdown-roommate-john-pageslide .kebab-option');
            roommateKebabOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const action = this.textContent.trim();
                    const parentDropdown = this.closest('[id*="kebab-dropdown-roommate"]');
                    const isAngela = parentDropdown && parentDropdown.id.includes('angela');
                    const roommateType = isAngela ? 'Angela Johnson (Pending Application)' : 'John Smith (Current Resident)';
                    
                    // Close the dropdown
                    parentDropdown.classList.add('hidden');
                    
                    if (action.includes('Edit details')) {
                        alert(`Edit ${roommateType}:\n\n• Update contact information\n• Modify residency dates\n• Edit personal details\n• Update emergency contacts`);
                    } else if (action.includes('Send invitation')) {
                        alert(`Send Invitation to ${roommateType}:\n\n• Generate invitation link\n• Send via email or SMS\n• Set reminder for follow-up\n• Track invitation status`);
                    } else if (action.includes('Approve application')) {
                        alert(`Approve Application for ${roommateType}:\n\n• Final review of application\n• Process background check results\n• Generate lease addendum\n• Notify all parties of approval`);
                    } else if (action.includes('View customer record')) {
                        alert(`View Customer Record for ${roommateType}:\n\n• Complete customer history\n• All property interactions\n• Application timeline\n• Cross-property payments\n• Communication log`);
                    } else if (action.includes('Remove roommate')) {
                        if (confirm(`Are you sure you want to remove ${roommateType} from this lease?`)) {
                            alert(`${roommateType} would be removed from the lease.`);
                        }
                    }
                });
            });

            // View Customer Record button functionality
            const viewRecordBtn = document.querySelector('.view-record-btn');
            if (viewRecordBtn) {
                viewRecordBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    alert('Navigate to Customer Record:\n\n• Full customer profile\n• Account history\n• Payment records\n• Communication log');
                });
            }

            // Contact action buttons
            const contactActionBtns = document.querySelectorAll('.contact-action-btn');
            contactActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const icon = this.querySelector('i');
                    const contactItem = this.closest('.contact-item');
                    const contactValue = contactItem.querySelector('.contact-value').textContent;
                    
                    if (icon.classList.contains('fa-envelope')) {
                        alert(`Send Email to ${contactValue}:\n\n• Compose email message\n• Select email template\n• Add attachments\n• Schedule send time`);
                    } else if (icon.classList.contains('fa-phone')) {
                        alert(`Call ${contactValue}:\n\n• Initiate phone call\n• Add call to calendar\n• Log call details\n• Set follow-up reminder`);
                    } else if (icon.classList.contains('fa-mobile-alt')) {
                        alert(`Send Text to ${contactValue}:\n\n• Compose SMS message\n• Send instant message\n• Schedule text message\n• Add to message thread`);
                    }
                });
            });

            // Roommate counter functionality
            const roommateCounter = document.querySelector('.roommate-counter');
            if (roommateCounter) {
                roommateCounter.addEventListener('click', function() {
                    openPageslide('roommate-details-overlay');
                });
            }

            // Kebab menu functionality
            const kebabBtns = document.querySelectorAll('.charge-kebab-menu .kebab-btn');
            kebabBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const menu = this.parentElement;
                    
                    // Close all other kebab menus
                    document.querySelectorAll('.charge-kebab-menu').forEach(otherMenu => {
                        if (otherMenu !== menu) {
                            otherMenu.classList.remove('active');
                        }
                    });
                    
                    // Toggle current menu
                    menu.classList.toggle('active');
                });
            });

            // Close kebab menus when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.charge-kebab-menu')) {
                    document.querySelectorAll('.charge-kebab-menu').forEach(menu => {
                        menu.classList.remove('active');
                    });
                }
                

            });

            // Kebab menu option handlers
            const kebabOptions = document.querySelectorAll('.kebab-option');
            kebabOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const action = this.classList.contains('edit-charge') ? 'edit' : 'delete';
                    const chargeItem = this.closest('.charge-item');
                    const chargeName = chargeItem.querySelector('.balance-description').textContent;
                    const chargeAmount = chargeItem.querySelector('.charge-amount').textContent;
                    
                    if (action === 'edit') {
                        alert(`Edit Charge: ${chargeName}\n\nCurrent Amount: ${chargeAmount}\n\n• Modify amount\n• Update description\n• Change effective date\n• Adjust recurring settings`);
                    } else if (action === 'delete') {
                        if (confirm(`Are you sure you want to delete "${chargeName}" (${chargeAmount})?`)) {
                            alert(`Charge "${chargeName}" would be deleted from the lease.`);
                        }
                    }
                    
                    // Close menu after action
                    this.closest('.charge-kebab-menu').classList.remove('active');
                });
            });



            // Contact edit form handling
            const contactEditForm = document.querySelector('.contact-edit-form');
            if (contactEditForm) {
                contactEditForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get form data
                    const formData = new FormData(this);
                    const firstName = document.querySelector('input[placeholder="Enter name"]').value;
                    const lastName = document.querySelector('input[value="Hakuna"]').value;
                    const email = document.querySelector('input[type="email"]').value;
                    const phone = document.querySelector('input[value="(555) 123-4567"]').value;
                    const preferredContact = document.querySelector('input[name="preferred-contact"]:checked')?.value;
                    
                    // Show success message
                    alert(`Contact Information Updated Successfully!\n\n` +
                          `Name: ${firstName} ${lastName}\n` +
                          `Email: ${email}\n` +
                          `Phone: ${phone}\n` +
                          `Preferred Contact: ${preferredContact || 'None'}\n\n` +
                          `Changes have been saved to the customer profile.`);
                    
                    // Close the pageslide
                    closePageslide('contact-edit-overlay');
                });
            }

            // Dynamic height matching for columns (activity timeline has fixed height)
            function matchColumnHeights() {
                const column1 = document.getElementById('column-1-resident-notes');
                const column2 = document.getElementById('column-2-lease-info');
                const activityCard = document.getElementById('activity-timeline-card');
                // Activity card height is fixed, no need to include in matching
                
                if (column1 && column2) {
                    // Reset heights to auto to get natural heights
                    column1.style.minHeight = 'auto';
                    column2.style.minHeight = 'auto';
                    column1.style.height = 'auto';
                    column2.style.height = 'auto';
                    
                    // Activity card maintains fixed height - no adjustments needed
                    
                    // Force a reflow to get accurate measurements
                    column1.offsetHeight;
                    column2.offsetHeight;
                    
                    // Get the natural heights after small delay
                    setTimeout(() => {
                        const height1 = column1.offsetHeight;
                        const height2 = column2.offsetHeight;
                        
                        // Calculate the maximum height of the left columns
                        const maxHeight = Math.max(height1, height2);
                        column1.style.minHeight = maxHeight + 'px';
                        column2.style.minHeight = maxHeight + 'px';
                        
                        // Activity card maintains fixed height - no matching needed
                        
                        // Debug log (remove in production)
                        console.log('Height matching applied:', {
                            column1Height: height1,
                            column2Height: height2,
                            maxHeight: maxHeight,
                            activityCardMatched: !!activityCard && !timelineExpanded,
                            timelineExpanded: timelineExpanded
                        });
                    }, 10);
                } else {
                    console.log('Column elements not found:', {
                        column1: !!column1,
                        column2: !!column2,
                        activityCard: !!activityCard
                    });
                }
            }

            // Call height matching on page load (with small delay to ensure content is loaded)
            // setTimeout(matchColumnHeights, 100); // Temporarily disabled

            // Re-match heights when window is resized
            // window.addEventListener('resize', function() {
            //     // Debounce the resize event
            //     clearTimeout(window.resizeTimeout);
            //     window.resizeTimeout = setTimeout(matchColumnHeights, 250);
            // }); // Temporarily disabled

            // Re-match heights when content changes (e.g., pageslide opens/closes)
            const observeContentChanges = function() {
                const observer = new MutationObserver(function(mutations) {
                    let shouldUpdate = false;
                    mutations.forEach(function(mutation) {
                        // Check if any changes affect the two-column layout
                        if (mutation.target.closest('#two-column-layout') || 
                            mutation.target.id === 'column-1-resident-notes' ||
                            mutation.target.id === 'column-2-lease-info') {
                            shouldUpdate = true;
                        }
                    });
                    
                    if (shouldUpdate) {
                        // Debounce the height matching
                        clearTimeout(window.heightMatchTimeout);
                        window.heightMatchTimeout = setTimeout(matchColumnHeights, 100);
                    }
                });

                // Observe changes in the two-column layout
                const twoColumnLayout = document.getElementById('two-column-layout');
                if (twoColumnLayout) {
                    observer.observe(twoColumnLayout, {
                        childList: true,
                        subtree: true,
                        attributes: true,
                        attributeFilter: ['style', 'class']
                    });
                }
            };

            // Start observing content changes
            // observeContentChanges(); // Temporarily disabled

        });

        // Documents page functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add Documents button now handled by onclick in HTML


            // Document action buttons
            document.querySelectorAll('#documents-view .btn-sm').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.textContent.trim();
                    const row = this.closest('tr');
                    const docName = row.querySelector('.font-medium').textContent.trim();
                    
                    if (action === 'Send') {
                        alert(`Send for Signature: ${docName}\n\n• Select recipients\n• Add custom message\n• Set signing order\n• Schedule delivery\n• Track progress`);
                    } else if (action === 'Generate') {
                        alert(`Generate Document: ${docName}\n\n• Create from template\n• Auto-populate data\n• Set document properties\n• Ready for review`);
                    }
                });
            });

            // Document table action icons
            document.querySelectorAll('#documents-view .fas').forEach(icon => {
                if (icon.closest('.p-1')) {
                    icon.closest('.p-1').addEventListener('click', function() {
                        const row = this.closest('tr');
                        const docName = row.querySelector('.font-medium').textContent.trim();
                        const action = this.title || 'Action';
                        
                        alert(`${action}: ${docName}\n\n• Document action performed\n• Status updated\n• Notifications sent\n• History logged`);
                    });
                }
            });





            // Status card click handlers
            document.querySelectorAll('#documents-view .bg-white.rounded-lg.border').forEach(card => {
                if (card.querySelector('.text-2xl')) {
                    card.addEventListener('click', function() {
                        const status = this.querySelector('.text-sm').textContent;
                        const count = this.querySelector('.text-2xl').textContent;
                        
                        alert(`Filter by ${status}:\n\n• Showing ${count} documents\n• Status: ${status}\n• Quick access to relevant items\n• View and manage documents`);
                    });
                    card.style.cursor = 'pointer';
                }
            });
        });

        // Attachment Modal Functions
        function showAttachmentModal() {
            const modal = document.getElementById('attachment-modal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }
        }

        function closeAttachmentModal() {
            const modal = document.getElementById('attachment-modal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = ''; // Restore scrolling
                
                // Reset form
                const select = modal.querySelector('select');
                const fileInput = modal.querySelector('#attachment-file-input');
                if (select) select.selectedIndex = 0;
                if (fileInput) fileInput.value = '';
            }
        }

        function uploadAttachment() {
            const modal = document.getElementById('attachment-modal');
            const select = modal.querySelector('select');
            const fileInput = modal.querySelector('#attachment-file-input');
            
            if (!select.value) {
                alert('Please select who this attachment is for.');
                return;
            }
            
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('Please select at least one file to upload.');
                return;
            }
            
            // Simulate upload process
            const recipient = select.options[select.selectedIndex].text;
            const fileCount = fileInput.files.length;
            const fileNames = Array.from(fileInput.files).map(file => file.name).join(', ');
            
            alert(`Uploading ${fileCount} file(s) for ${recipient}:\n\n${fileNames}\n\nUpload completed successfully!`);
            
            // Close modal
            closeAttachmentModal();
        }

        // Edit attachment document function
        function editAttachmentDocument(currentName, currentType, visibleInPortal = false) {
            const modal = document.createElement('div');
            modal.id = 'edit-attachment-modal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-[9999] flex items-center justify-center';
            modal.style.cssText = 'background-color: rgba(0, 0, 0, 0.3); backdrop-filter: blur(2px);';
            
            modal.innerHTML = `
                <div class="bg-white rounded-lg w-full max-w-md mx-4">
                    <div class="flex items-center justify-between p-6 border-b">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-pen text-blue-600"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900">Edit Document</h3>
                        </div>
                        <button onclick="closeEditAttachmentModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Document Name</label>
                            <input 
                                type="text" 
                                id="edit-document-name"
                                value="${currentName}"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="Enter document name"
                            >
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Document Type</label>
                            <select id="edit-document-type" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <optgroup label="Portal Lease Documents">
                                    <option value="Portal Lease Documents" ${currentType === 'Portal Lease Documents' ? 'selected' : ''}>Portal Lease Documents</option>
                                    <option value="Condo Invoice" ${currentType === 'Condo Invoice' ? 'selected' : ''}>Condo Invoice</option>
                                    <option value="Condo Letter" ${currentType === 'Condo Letter' ? 'selected' : ''}>Condo Letter</option>
                                    <option value="Condo Ledger" ${currentType === 'Condo Ledger' ? 'selected' : ''}>Condo Ledger</option>
                                    <option value="Next of Kin Form" ${currentType === 'Next of Kin Form' ? 'selected' : ''}>Next of Kin Form</option>
                                    <option value="Public Trustee Form" ${currentType === 'Public Trustee Form' ? 'selected' : ''}>Public Trustee Form</option>
                                    <option value="Lease Documents" ${currentType === 'Lease Documents' ? 'selected' : ''}>Lease Documents</option>
                                </optgroup>
                                <optgroup label="RGI Documents">
                                    <option value="RGI Documents" ${currentType === 'RGI Documents' ? 'selected' : ''}>RGI Documents</option>
                                </optgroup>
                                <optgroup label="Tenant Management">
                                    <option value="Tenant Complaints" ${currentType === 'Tenant Complaints' ? 'selected' : ''}>Tenant Complaints</option>
                                    <option value="Renters Insurance" ${currentType === 'Renters Insurance' ? 'selected' : ''}>Renters Insurance</option>
                                </optgroup>
                                <optgroup label="Bluemoon Documents">
                                    <option value="Bluemoon Lease Documents" ${currentType === 'Bluemoon Lease Documents' ? 'selected' : ''}>Bluemoon Lease Documents</option>
                                    <option value="Bluemoon Addendum Documents" ${currentType === 'Bluemoon Addendum Documents' ? 'selected' : ''}>Bluemoon Addendum Documents</option>
                                </optgroup>
                                <optgroup label="Legal Documents">
                                    <option value="DNR Order" ${currentType === 'DNR Order' ? 'selected' : ''}>DNR Order</option>
                                    <option value="Living Will" ${currentType === 'Living Will' ? 'selected' : ''}>Living Will</option>
                                    <option value="Guardian" ${currentType === 'Guardian' ? 'selected' : ''}>Guardian</option>
                                    <option value="POA" ${currentType === 'POA' ? 'selected' : ''}>POA</option>
                                    <option value="Attorney" ${currentType === 'Attorney' ? 'selected' : ''}>Attorney</option>
                                </optgroup>
                                <optgroup label="Correspondence & Attachments">
                                    <option value="Delivery Attachment" ${currentType === 'Delivery Attachment' ? 'selected' : ''}>Delivery Attachment</option>
                                    <option value="Residential Correspondence" ${currentType === 'Residential Correspondence' ? 'selected' : ''}>Residential Correspondence</option>
                                    <option value="EMAIL ATTACHMENT" ${currentType === 'EMAIL ATTACHMENT' ? 'selected' : ''}>EMAIL ATTACHMENT</option>
                                    <option value="Additional Lease Document" ${currentType === 'Additional Lease Document' ? 'selected' : ''}>Additional Lease Document</option>
                                </optgroup>
                                <optgroup label="Application Documents">
                                    <option value="Portal upload Documents" ${currentType === 'Portal upload Documents' ? 'selected' : ''}>Portal upload Documents</option>
                                    <option value="Print Application Documents" ${currentType === 'Print Application Documents' ? 'selected' : ''}>Print Application Documents</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="mb-6 flex items-center justify-between">
                            <label class="block text-sm font-medium text-gray-700">Visible in resident portal</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="portal-visibility-toggle" class="sr-only peer" ${visibleInPortal ? 'checked' : ''}>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex justify-end gap-3">
                            <button onclick="closeEditAttachmentModal()" class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                Cancel
                            </button>
                            <button onclick="saveAttachmentEdit('${currentName}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                Save changes
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            // Focus on the name input
            setTimeout(() => {
                const nameInput = document.getElementById('edit-document-name');
                if (nameInput) {
                    nameInput.focus();
                    nameInput.select();
                }
            }, 100);
        }

        // Close edit attachment modal
        function closeEditAttachmentModal() {
            const modal = document.getElementById('edit-attachment-modal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }

        // Save attachment edit
        function saveAttachmentEdit(originalName) {
            const modal = document.getElementById('edit-attachment-modal');
            const newName = document.getElementById('edit-document-name').value.trim();
            const newType = document.getElementById('edit-document-type').value;
            
            if (!newName) {
                alert('Please enter a document name.');
                return;
            }
            
            // Find the document row and update it
            const documentRows = document.querySelectorAll('.document-item');
            documentRows.forEach(row => {
                const nameLink = row.querySelector('a');
                if (nameLink && nameLink.textContent.trim() === originalName) {
                    // Update document name
                    nameLink.textContent = newName;
                    
                    // Update document type
                    const typeSpan = row.querySelector('td:nth-child(2) span');
                    if (typeSpan) {
                        typeSpan.textContent = newType;
                    }
                    
                    // Update onclick attribute with new name
                    const editButton = row.querySelector('button[onclick*="editAttachmentDocument"]');
                    if (editButton) {
                        editButton.setAttribute('onclick', `editAttachmentDocument('${newName}', '${newType}')`);
                    }
                }
            });
            
            alert(`Document updated successfully!\n\nName: ${newName}\nType: ${newType}`);
            closeEditAttachmentModal();
        }

        // ESC key to close edit modal
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const editModal = document.getElementById('edit-attachment-modal');
                if (editModal) {
                    closeEditAttachmentModal();
                }
            }
        });

        // Click outside to close edit modal
        document.addEventListener('click', function(e) {
            const editModal = document.getElementById('edit-attachment-modal');
            if (editModal && e.target === editModal) {
                closeEditAttachmentModal();
            }
        });

        // Widget upload attachment function
        function uploadWidgetAttachment() {
            const widget = document.getElementById('attachment-upload-widget');
            const select = widget.querySelector('#widget-attachment-recipient');
            const fileInput = widget.querySelector('#widget-attachment-file-input');
            
            if (!select.value) {
                alert('Please select who this attachment is for.');
                return;
            }
            
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('Please select at least one file to upload.');
                return;
            }
            
            // Simulate upload process
            const recipient = select.options[select.selectedIndex].text;
            const fileCount = fileInput.files.length;
            const fileNames = Array.from(fileInput.files).map(file => file.name).join(', ');
            
            alert(`Uploading ${fileCount} attachment(s) for ${recipient}:\n\n${fileNames}\n\nAttachment(s) uploaded successfully!`);
            
            // Reset form
            select.selectedIndex = 0;
            fileInput.value = '';
            
            // Reset upload area text
            const uploadText = widget.querySelector('h4');
            if (uploadText) {
                uploadText.textContent = 'Drop files here to upload.';
            }
        }

        // Handle drag and drop
        document.addEventListener('DOMContentLoaded', function() {
            // Modal drag and drop
            const uploadArea = document.querySelector('#attachment-modal .border-dashed');
            const fileInput = document.getElementById('attachment-file-input');
            
            // Widget drag and drop
            const widgetUploadArea = document.querySelector('#attachment-upload-widget .border-dashed');
            const widgetFileInput = document.getElementById('widget-attachment-file-input');
            
            // Setup modal drag and drop
            if (uploadArea && fileInput) {
                // Prevent default drag behaviors
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, preventDefaults, false);
                    document.body.addEventListener(eventName, preventDefaults, false);
                });
                
                // Highlight drop area when item is dragged over it
                ['dragenter', 'dragover'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, unhighlight, false);
                });
                
                // Handle dropped files
                uploadArea.addEventListener('drop', handleDrop, false);
            }
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            function highlight(e) {
                uploadArea.classList.add('border-blue-400', 'bg-blue-50');
            }
            
            function unhighlight(e) {
                uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
            }
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                fileInput.files = files;
                
                // Show file names in upload area
                if (files.length > 0) {
                    const fileNames = Array.from(files).map(file => file.name).join(', ');
                    const uploadText = uploadArea.querySelector('h4');
                    if (uploadText) {
                        uploadText.textContent = `${files.length} file(s) selected: ${fileNames}`;
                    }
                }
            }
            
            // Setup widget drag and drop
            if (widgetUploadArea && widgetFileInput) {
                // Prevent default drag behaviors
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    widgetUploadArea.addEventListener(eventName, preventDefaultsWidget, false);
                    document.body.addEventListener(eventName, preventDefaultsWidget, false);
                });
                
                // Highlight drop area when item is dragged over it
                ['dragenter', 'dragover'].forEach(eventName => {
                    widgetUploadArea.addEventListener(eventName, highlightWidget, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    widgetUploadArea.addEventListener(eventName, unhighlightWidget, false);
                });
                
                // Handle dropped files
                widgetUploadArea.addEventListener('drop', handleDropWidget, false);
                
                function preventDefaultsWidget(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                function highlightWidget(e) {
                    widgetUploadArea.classList.add('border-blue-400', 'bg-blue-50');
                }
                
                function unhighlightWidget(e) {
                    widgetUploadArea.classList.remove('border-blue-400', 'bg-blue-50');
                }
                
                function handleDropWidget(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    widgetFileInput.files = files;
                    
                    // Show file names in upload area
                    if (files.length > 0) {
                        const fileNames = Array.from(files).map(file => file.name).join(', ');
                        const uploadText = widgetUploadArea.querySelector('h4');
                        if (uploadText) {
                            uploadText.textContent = `${files.length} file(s) selected: ${fileNames}`;
                        }
                    }
                }
            }
        });

        // ESC key and click outside to close attachment modal
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAttachmentModal();
            }
        });
        
        document.addEventListener('click', function(e) {
            const attachmentModal = document.getElementById('attachment-modal');
            if (attachmentModal && e.target === attachmentModal) {
                closeAttachmentModal();
            }
        });

        // Monthly and Daily fee conditional display logic
        document.addEventListener('DOMContentLoaded', function() {
            // Monthly fee logic
            const monthlyFeeYes = document.getElementById('monthly-fee-yes');
            const monthlyFeeNo = document.getElementById('monthly-fee-no');
            const monthlyFeeDetails = document.getElementById('monthly-fee-details');
            
            function toggleMonthlyFeeDetails() {
                if (monthlyFeeNo.checked) {
                    monthlyFeeDetails.style.display = 'none';
                } else {
                    monthlyFeeDetails.style.display = 'block';
                }
            }
            
            // Add event listeners to monthly fee radio buttons
            if (monthlyFeeYes && monthlyFeeNo && monthlyFeeDetails) {
                monthlyFeeYes.addEventListener('change', toggleMonthlyFeeDetails);
                monthlyFeeNo.addEventListener('change', toggleMonthlyFeeDetails);
                
                // Set initial state
                toggleMonthlyFeeDetails();
            }
            
            // Daily fee logic
            const dailyFeeYes = document.getElementById('daily-fee-yes');
            const dailyFeeNo = document.getElementById('daily-fee-no');
            const dailyFeeDetails = document.getElementById('daily-fee-details');
            
            function toggleDailyFeeDetails() {
                if (dailyFeeNo.checked) {
                    dailyFeeDetails.style.display = 'none';
                } else {
                    dailyFeeDetails.style.display = 'block';
                }
            }
            
            // Add event listeners to daily fee radio buttons
            if (dailyFeeYes && dailyFeeNo && dailyFeeDetails) {
                dailyFeeYes.addEventListener('change', toggleDailyFeeDetails);
                dailyFeeNo.addEventListener('change', toggleDailyFeeDetails);
                
                // Set initial state
                toggleDailyFeeDetails();
            }
            
            // Maximum days limit input logic
            const maxDaysUnlimited = document.getElementById('max-days-unlimited');
            const maxDaysLimited = document.getElementById('max-days-limited');
            const maxDaysInput = document.querySelector('#daily-fee-details input[type="number"][max="365"]');
            
            function toggleMaxDaysInput() {
                if (maxDaysLimited && maxDaysInput) {
                    if (maxDaysLimited.checked) {
                        maxDaysInput.disabled = false;
                        maxDaysInput.value = maxDaysInput.value === '0' ? '30' : maxDaysInput.value;
                    } else {
                        maxDaysInput.disabled = true;
                        maxDaysInput.value = '0';
                    }
                }
            }
            
            // Add event listeners to max days radio buttons
            if (maxDaysUnlimited && maxDaysLimited && maxDaysInput) {
                maxDaysUnlimited.addEventListener('change', toggleMaxDaysInput);
                maxDaysLimited.addEventListener('change', toggleMaxDaysInput);
                
                // Set initial state
                toggleMaxDaysInput();
            }
            
            // Second late fee logic
            const secondFeeYes = document.getElementById('second-fee-yes');
            const secondFeeNo = document.getElementById('second-fee-no');
            const secondFeeDetails = document.getElementById('second-fee-details');
            
            function toggleSecondFeeDetails() {
                if (secondFeeNo.checked) {
                    secondFeeDetails.style.display = 'none';
                } else {
                    secondFeeDetails.style.display = 'block';
                }
            }
            
            // Add event listeners to second fee radio buttons
            if (secondFeeYes && secondFeeNo && secondFeeDetails) {
                secondFeeYes.addEventListener('change', toggleSecondFeeDetails);
                secondFeeNo.addEventListener('change', toggleSecondFeeDetails);
                
                // Set initial state
                toggleSecondFeeDetails();
            }
        });

        // Payment Settings standalone form functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Monthly fee logic for standalone form
            const monthlyFeeYesStandalone = document.getElementById('monthly-fee-yes-standalone');
            const monthlyFeeNoStandalone = document.getElementById('monthly-fee-no-standalone');
            const monthlyFeeDetailsStandalone = document.getElementById('monthly-fee-details-standalone');
            
            function toggleMonthlyFeeDetailsStandalone() {
                if (monthlyFeeNoStandalone && monthlyFeeNoStandalone.checked) {
                    monthlyFeeDetailsStandalone.style.display = 'none';
                } else {
                    monthlyFeeDetailsStandalone.style.display = 'block';
                }
            }
            
            // Add event listeners to monthly fee radio buttons
            if (monthlyFeeYesStandalone && monthlyFeeNoStandalone && monthlyFeeDetailsStandalone) {
                monthlyFeeYesStandalone.addEventListener('change', toggleMonthlyFeeDetailsStandalone);
                monthlyFeeNoStandalone.addEventListener('change', toggleMonthlyFeeDetailsStandalone);
                
                // Set initial state
                toggleMonthlyFeeDetailsStandalone();
            }
            
            // Daily fee logic for standalone form
            const dailyFeeYesStandalone = document.getElementById('daily-fee-yes-standalone');
            const dailyFeeNoStandalone = document.getElementById('daily-fee-no-standalone');
            const dailyFeeDetailsStandalone = document.getElementById('daily-fee-details-standalone');
            
            function toggleDailyFeeDetailsStandalone() {
                if (dailyFeeNoStandalone && dailyFeeNoStandalone.checked) {
                    dailyFeeDetailsStandalone.style.display = 'none';
                } else {
                    dailyFeeDetailsStandalone.style.display = 'block';
                }
            }
            
            // Add event listeners to daily fee radio buttons
            if (dailyFeeYesStandalone && dailyFeeNoStandalone && dailyFeeDetailsStandalone) {
                dailyFeeYesStandalone.addEventListener('change', toggleDailyFeeDetailsStandalone);
                dailyFeeNoStandalone.addEventListener('change', toggleDailyFeeDetailsStandalone);
                
                // Set initial state
                toggleDailyFeeDetailsStandalone();
            }
            
            // Maximum days limit input logic for standalone form
            const maxDaysUnlimitedStandalone = document.getElementById('max-days-unlimited-standalone');
            const maxDaysLimitedStandalone = document.getElementById('max-days-limited-standalone');
            const maxDaysInputStandalone = document.querySelector('#daily-fee-details-standalone input[type="number"][max="365"]');
            
            function toggleMaxDaysInputStandalone() {
                if (maxDaysLimitedStandalone && maxDaysInputStandalone) {
                    if (maxDaysLimitedStandalone.checked) {
                        maxDaysInputStandalone.disabled = false;
                        maxDaysInputStandalone.value = maxDaysInputStandalone.value === '0' ? '30' : maxDaysInputStandalone.value;
                    } else {
                        maxDaysInputStandalone.disabled = true;
                        maxDaysInputStandalone.value = '0';
                    }
                }
            }
            
            // Add event listeners to max days radio buttons
            if (maxDaysUnlimitedStandalone && maxDaysLimitedStandalone && maxDaysInputStandalone) {
                maxDaysUnlimitedStandalone.addEventListener('change', toggleMaxDaysInputStandalone);
                maxDaysLimitedStandalone.addEventListener('change', toggleMaxDaysInputStandalone);
                
                // Set initial state
                toggleMaxDaysInputStandalone();
            }
            
            // Second late fee logic for standalone form
            const secondFeeYesStandalone = document.getElementById('second-fee-yes-standalone');
            const secondFeeNoStandalone = document.getElementById('second-fee-no-standalone');
            const secondFeeDetailsStandalone = document.getElementById('second-fee-details-standalone');
            
            function toggleSecondFeeDetailsStandalone() {
                if (secondFeeNoStandalone && secondFeeNoStandalone.checked) {
                    secondFeeDetailsStandalone.style.display = 'none';
                } else {
                    secondFeeDetailsStandalone.style.display = 'block';
                }
            }
            
            // Add event listeners to second fee radio buttons
            if (secondFeeYesStandalone && secondFeeNoStandalone && secondFeeDetailsStandalone) {
                secondFeeYesStandalone.addEventListener('change', toggleSecondFeeDetailsStandalone);
                secondFeeNoStandalone.addEventListener('change', toggleSecondFeeDetailsStandalone);
                
                // Set initial state
                toggleSecondFeeDetailsStandalone();
            }
        });

        // Payment settings form submission
        function savePaymentSettings(event) {
            event.preventDefault();
            alert('Payment settings saved successfully!');
            closePageslide('payment-settings-overlay');
        }

        // Tab switching functionality
        function switchLeaseTab(tabName) {
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Activate selected tab button
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Show selected tab content
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Lease charges functionality
        // Set default dates when pageslide opens
        document.addEventListener('DOMContentLoaded', function() {
            // Listen for pageslide opening
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const target = mutation.target;
                        if (target.id === 'add-lease-charge-overlay' && target.classList.contains('active')) {
                            // Pageslide opened, set default dates
                            const pageslide = target;
                            const fromDateInput = pageslide.querySelector('input[name="fromDate"]');
                            if (fromDateInput) {
                                fromDateInput.value = '2024-10-01'; // Current lease period start
                            }
                            
                            const toDateInput = pageslide.querySelector('input[name="toDate"]');
                            if (toDateInput) {
                                toDateInput.value = '2025-09-30'; // Current lease period end
                            }
                            
                            // Focus on first input
                            setTimeout(() => {
                                const firstInput = pageslide.querySelector('select[name="chargeCode"]');
                                if (firstInput) {
                                    firstInput.focus();
                                }
                            }, 100);
                        }
                    }
                });
            });
            
            const pageslideOverlay = document.getElementById('add-lease-charge-overlay');
            if (pageslideOverlay) {
                observer.observe(pageslideOverlay, { attributes: true });
            }
        });

        function submitAddLeaseCharge(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            // Get form values
            const chargeCode = formData.get('chargeCode');
            const amount = parseFloat(formData.get('amount'));
            const fromDate = formData.get('fromDate');
            const toDate = formData.get('toDate');
            const status = formData.get('status');
            
            // Get charge name from select option text
            const chargeSelect = form.querySelector('select[name="chargeCode"]');
            const selectedOption = chargeSelect.options[chargeSelect.selectedIndex];
            const chargeName = selectedOption.text.split(' (')[1]?.replace(')', '') || selectedOption.text;
            
            // Format dates for display
            const startDateObj = new Date(fromDate);
            const endDateObj = toDate ? new Date(toDate) : null;
            
            const dateRange = startDateObj.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            }) + (endDateObj ? ' - ' + endDateObj.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            }) : '');
            
            // Create new charge card HTML
            const newChargeId = 'charge-' + chargeCode + '-' + Date.now();
            const newChargeHTML = `
                <div class="charge-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm" id="${newChargeId}">
                    <!-- Display View -->
                    <div class="charge-display-view">
                        <div class="flex items-center justify-between">
                            <!-- Left Side -->
                            <div class="flex-1">
                                <h4 class="text-base font-semibold mb-1">${chargeName} ${putOnHold ? '<span class="text-orange-600">(On Hold)</span>' : ''}</h4>
                                <div class="flex items-center gap-3 mb-2">
                                    <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">${chargeCode}</span>
                                    <span class="text-muted font-medium">${dateRange}</span>
                                </div>
                                <div class="flex items-center gap-4 text-sm text-muted">
                                    <span>Added by: Current User</span>
                                    <span>Modified by: Current User</span>
                                </div>
                            </div>
                            
                            <!-- Right Side -->
                            <div class="flex flex-col items-end gap-2">
                                <div class="text-lg font-bold">$${amount.toFixed(2)}</div>
                                <div class="action-buttons">
                                    <button type="button" class="btn btn-light" onclick="editLeaseCharge('${newChargeId.replace('charge-', '')}')" title="Edit">
                                        <i class="fas fa-pen"></i>
                                    </button>
                                    <button type="button" class="btn btn-light text-red-600" onclick="deleteLeaseCharge('${newChargeId.replace('charge-', '')}')" title="Delete">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add the new charge to the list
            const chargesContainer = document.querySelector('.charges-card-container');
            if (chargesContainer) {
                // Insert at the beginning (after the comment for current lease charges)
                const firstCard = chargesContainer.querySelector('.charge-card');
                if (firstCard) {
                    firstCard.insertAdjacentHTML('beforebegin', newChargeHTML);
                } else {
                    chargesContainer.innerHTML = newChargeHTML;
                }
            }
            
            // Close pageslide and show success message
            closePageslide('add-lease-charge-overlay');
            showNotification('Lease charge added successfully', 'success');
        }

        function showChargeCodeOptions() {
            // This would typically show additional charge code options or management
            alert('Additional charge code management options would be available here.');
        }


        function deleteLeaseCharge(chargeId) {
            if (confirm(`Are you sure you want to delete this charge: ${chargeId}?`)) {
                alert(`Charge ${chargeId} would be deleted.`);
                // Here you would typically remove the row from the table
            }
        }

        // Deposit functionality placeholders
        function showAddDepositSplitModal() {
            alert('Add Deposit Split modal would open here:\n\n• Deposit Amount\n• Split Between Tenants\n• Effective Date\n• Notes');
        }

        // Lease Timeline tab functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Handle lease timeline tab switching
            const leaseTimelineTabs = document.querySelectorAll('.tab');
            
            leaseTimelineTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs
                    leaseTimelineTabs.forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Hide all content divs
                    document.querySelectorAll('.lease-mgmt-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    // Show selected content
                    const targetContent = document.getElementById(tabName + '-tab');
                    if (targetContent) {
                        targetContent.style.display = 'block';
                    }
                });
            });
        });

        // Hide expired charges toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const hideExpiredToggle = document.getElementById('hide-expired-charges');
            const hideExpiredToggleStandalone = document.getElementById('hide-expired-charges-standalone');
            
            // For the original toggle in the lease edit pageslide
            if (hideExpiredToggle) {
                hideExpiredToggle.addEventListener('change', function() {
                    const expiredCards = document.querySelectorAll('#lease-charges-tab .charge-card .status.expired');
                    
                    expiredCards.forEach(status => {
                        const card = status.closest('.charge-card');
                        if (this.checked) {
                            card.style.display = 'none';
                        } else {
                            card.style.display = 'block';
                        }
                    });
                });
            }
            
            // Inactive renewals toggle functionality
            const showInactiveRenewals = document.getElementById('show-inactive-renewals');
            if (showInactiveRenewals) {
                showInactiveRenewals.addEventListener('change', function() {
                    const inactiveRenewals = document.querySelectorAll('.inactive-renewal');
                    
                    inactiveRenewals.forEach(renewal => {
                        if (this.checked) {
                            renewal.style.display = 'block';
                        } else {
                            renewal.style.display = 'none';
                        }
                    });
                });
            }
            
            // For the standalone edit lease charges pageslide
            if (hideExpiredToggleStandalone) {
                hideExpiredToggleStandalone.addEventListener('change', function() {
                    const expiredCards = document.querySelectorAll('#edit-lease-charges-overlay .charge-card .status.expired');
                    
                    expiredCards.forEach(status => {
                        const card = status.closest('.charge-card');
                        if (this.checked) {
                            card.style.display = 'none';
                        } else {
                            card.style.display = 'block';
                        }
                    });
                });
            }
        });

        // Lease Charge Edit Functionality
        function editLeaseCharge(chargeCode, chargeName, amount, startDate, endDate, status) {
            // Populate edit form with provided data
            document.getElementById('edit-charge-id').value = chargeCode;
            document.getElementById('edit-charge-code').value = chargeCode;
            document.getElementById('edit-charge-amount-display').textContent = '$' + parseFloat(amount).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('edit-charge-start-date').value = startDate;
            document.getElementById('edit-charge-end-date').value = endDate;
            
            // Set toggle status (checked = active, unchecked = inactive)
            document.getElementById('edit-charge-status').checked = (status === 'active');
            
            // Update pageslide title
            document.getElementById('edit-charge-title').textContent = 'Edit ' + chargeName;
            
            // Open pageslide
            openPageslide('edit-lease-charge-overlay');
        }
        
        // Delete Lease Charge Function
        function deleteLeaseCharge() {
            const chargeName = document.getElementById('edit-charge-title').textContent.replace('Edit ', '');
            
            if (confirm(`Are you sure you want to delete "${chargeName}"? This action cannot be undone.`)) {
                // Close pageslide
                closePageslide('edit-lease-charge-overlay');
                
                // Show success notification
                showNotification(`${chargeName} has been deleted successfully`, 'success');
                
                // Here you would typically make an API call to delete the charge
                // For now, we'll just show the notification
            }
        }
        
        // Helper function to convert display date to input format
        function formatDateForInput(dateStr) {
            if (!dateStr) return '';
            
            try {
                // Handle formats like "Oct 1, 2024" or "Sep 30, 2025"
                const date = new Date(dateStr.trim());
                if (!isNaN(date.getTime())) {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                }
            } catch (e) {
                console.error('Error parsing date:', dateStr);
            }
            return '';
        }

        function saveLeaseChargeFromPageslide(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            // Get form values
            const chargeId = formData.get('chargeId');
            const chargeCode = formData.get('chargeCode');
            const startDate = formData.get('startDate');
            const endDate = formData.get('endDate');
            const status = formData.get('status');
            
            // Find the charge card to update
            const chargeCard = document.getElementById('charge-' + chargeId);
            if (!chargeCard) {
                alert('Unable to find charge to update.');
                return;
            }
            
            const displayView = chargeCard.querySelector('.charge-display-view');
            if (!displayView) {
                alert('Unable to update charge display.');
                return;
            }
            
            // Get the current charge name and amount from display (since they're not editable)
            const chargeNameElement = displayView.querySelector('h4');
            const currentChargeName = chargeNameElement ? chargeNameElement.textContent.replace(' (On Hold)', '').trim() : '';
            
            // Format dates for display
            const startDateObj = new Date(startDate);
            const endDateObj = endDate ? new Date(endDate) : null;
            
            let dateRange = startDateObj.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
            
            if (endDateObj) {
                dateRange += ' - ' + endDateObj.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
            }
            
            // Update charge name with status indicator
            let displayName = currentChargeName;
            if (status === 'hold') {
                displayName += ' <span class="text-orange-600">(On Hold)</span>';
            }
            
            // Update display view with new values
            const nameElement = displayView.querySelector('h4');
            if (nameElement) nameElement.innerHTML = displayName;
            
            const codeElement = displayView.querySelector('.font-mono');
            if (codeElement) codeElement.textContent = chargeCode;
            
            const dateElement = displayView.querySelector('.text-muted.font-medium');
            if (dateElement) dateElement.textContent = dateRange;
            
            // Update modified by info
            const currentUser = 'Current User'; // You can get this from session/context
            const modifiedElements = displayView.querySelectorAll('.text-sm.text-muted span');
            if (modifiedElements.length > 1) {
                modifiedElements[1].textContent = 'Modified by: ' + currentUser;
            }
            
            // Close pageslide and show success message
            closePageslide('edit-lease-charge-overlay');
            showNotification('Lease charge updated successfully', 'success');
        }

        function showNotification(message, type = 'info') {
            // Create a simple notification
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 ${
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
                type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
                'bg-blue-100 text-blue-800 border border-blue-200'
            }`;
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }


    </script>

    <!-- Edit Lease Charges Pageslide -->
    <div class="pageslide-overlay" id="edit-lease-charges-overlay">
        <div class="pageslide edit-lease-charges">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Lease charges</h2>
                <button class="pageslide-close" onclick="closePageslide('edit-lease-charges-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <div class="charges-header">
                    <div class="charges-controls mb-6">
                        <div class="flex items-center gap-3">
                            <!-- Search Field -->
                            <div class="relative flex-1">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input 
                                    type="text" 
                                    placeholder="Search charges..." 
                                    class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus-ring-primary"
                                >
                            </div>
                            
                            <!-- Action Controls -->
                            <div class="flex items-center gap-3">
                                <button type="button" class="btn btn-light" onclick="openPageslide('add-lease-charge-overlay')">
                                    <i class="fas fa-plus mr-2"></i>
                                    Add lease charge
                                </button>
                                <div class="toggle-group">
                                    <input type="checkbox" id="hide-expired-charges-standalone" class="toggle-checkbox" checked>
                                    <label for="hide-expired-charges-standalone" class="toggle-label mb-0">Hide expired charges</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="charges-list">
                    <div class="charges-card-container space-y-2">
                        
                        <!-- Current Lease Charges (Oct 1, 2024 - Sep 30, 2025) -->
                        
                        <!-- Rent (Residential) -->
                        <div class="charge-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm" id="charge-rent-standalone">
                            <!-- Display View -->
                            <div class="charge-display-view">
                                <div class="flex items-center justify-between">
                                    <!-- Left Side -->
                                    <div class="flex-1">
                                        <h4 class="text-base font-semibold mb-1">Rent (Residential)</h4>
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">rentres</span>
                                            <span class="text-muted font-medium">Oct 1, 2024 - Sep 30, 2025</span>
                                        </div>
                                        <div class="flex items-center gap-4 text-sm text-muted">
                                            <span>Added by: Sarah Chen</span>
                                            <span>Modified by: Michael Rodriguez</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Right Side -->
                                    <div class="flex flex-col items-end gap-2">
                                        <div class="text-lg font-bold">$2,000.00</div>
                                        <div class="action-buttons">
                                            <button type="button" class="btn btn-light" onclick="editLeaseCharge('rent')" title="Edit">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                            <button type="button" class="btn btn-light text-red-600" onclick="deleteLeaseCharge('rent')" title="Delete">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>

                        <!-- Pet Fee (2 pets) -->
                        <div class="charge-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm" id="charge-petfee-standalone">
                            <!-- Display View -->
                            <div class="charge-display-view">
                                <div class="flex items-center justify-between">
                                    <!-- Left Side -->
                                    <div class="flex-1">
                                        <h4 class="text-base font-semibold mb-1">Pet Fee (2 pets)</h4>
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">petfee</span>
                                            <span class="text-muted font-medium">Oct 1, 2024 - Sep 30, 2025</span>
                                        </div>
                                        <div class="flex items-center gap-4 text-sm text-muted">
                                            <span>Added by: Jessica Wang</span>
                                            <span>Modified by: David Thompson</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Right Side -->
                                    <div class="flex flex-col items-end gap-2">
                                        <div class="text-lg font-bold">$30.00</div>
                                        <div class="action-buttons">
                                            <button type="button" class="btn btn-light" onclick="editLeaseCharge('petfee')" title="Edit">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                            <button type="button" class="btn btn-light text-red-600" onclick="deleteLeaseCharge('petfee')" title="Delete">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>

                        <!-- Parking Space #42 -->
                        <div class="charge-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <h4 class="text-base font-semibold mb-1">Parking Space #42</h4>
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">parking</span>
                                        <span class="text-muted font-medium">Oct 1, 2024 - Sep 30, 2025</span>
                                    </div>
                                    <div class="flex items-center gap-4 text-sm text-muted">
                                        <span>Added by: Emily Johnson</span>
                                        <span>Modified by: Alex Martinez</span>
                                    </div>
                                </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold">$75.00</div>
                                    <div class="action-buttons">
                                        <button type="button" class="btn btn-light" onclick="editLeaseCharge('parking')" title="Edit">
                                            <i class="fas fa-pen"></i>
                                        </button>
                                        <button type="button" class="btn btn-light text-red-600" onclick="deleteLeaseCharge('parking')" title="Delete">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Storage Unit #15 -->
                        <div class="charge-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <h4 class="text-base font-semibold mb-1">Storage Unit #15</h4>
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">storage</span>
                                        <span class="text-muted font-medium">Oct 1, 2024 - Sep 30, 2025</span>
                                    </div>
                                    <div class="flex items-center gap-4 text-sm text-muted">
                                        <span>Added by: Ryan Lee</span>
                                        <span>Modified by: Amanda Foster</span>
                                    </div>
                                </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold">$45.00</div>
                                    <div class="action-buttons">
                                        <button type="button" class="btn btn-light" onclick="editLeaseCharge('storage')" title="Edit">
                                            <i class="fas fa-pen"></i>
                                        </button>
                                        <button type="button" class="btn btn-light text-red-600" onclick="deleteLeaseCharge('storage')" title="Delete">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Washer/Dryer Rental -->
                        <div class="charge-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <h4 class="text-base font-semibold mb-1">Washer/Dryer Rental</h4>
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">washdry</span>
                                        <span class="text-muted font-medium">Oct 1, 2024 - Sep 30, 2025</span>
                                    </div>
                                    <div class="flex items-center gap-4 text-sm text-muted">
                                        <span>Added by: Kevin Park</span>
                                        <span>Modified by: Lisa Anderson</span>
                                    </div>
                                </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold">$25.00</div>
                                    <div class="action-buttons">
                                        <button type="button" class="btn btn-light" onclick="editLeaseCharge('washdry')" title="Edit">
                                            <i class="fas fa-pen"></i>
                                        </button>
                                        <button type="button" class="btn btn-light text-red-600" onclick="deleteLeaseCharge('washdry')" title="Delete">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Expired Charges (Previous Lease: Oct 1, 2023 - Sep 30, 2024) -->
                        
                        <!-- Expired Rent (Previous Lease) -->
                        <div class="charge-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm" style="border-left: 4px solid #991b1b; display: none;">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h4 class="text-base font-semibold">Rent (Residential)</h4>
                                        <span class="status expired">Expired</span>
                                    </div>
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">rentres</span>
                                        <span class="text-muted font-medium">Oct 1, 2023 - Sep 30, 2024</span>
                                    </div>
                                    <div class="flex items-center gap-4 text-sm text-muted">
                                        <span>Added by: Jennifer Davis</span>
                                        <span>Modified by: Mark Wilson</span>
                                    </div>
                                </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold">$1,850.00</div>
                                    <div class="action-buttons">
                                            <button type="button" class="btn btn-light" onclick="editLeaseCharge('rent-expired')" title="Edit">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                            <button type="button" class="btn btn-light text-red-600" onclick="deleteLeaseCharge('rent-expired')" title="Delete">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Expired Pet Fee (Previous Lease - Only 1 pet) -->
                        <div class="charge-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm" style="border-left: 4px solid #991b1b; display: none;">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h4 class="text-base font-semibold">Pet Fee (1 pet)</h4>
                                        <span class="status expired">Expired</span>
                                    </div>
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">petfee</span>
                                        <span class="text-muted font-medium">Oct 1, 2023 - Sep 30, 2024</span>
                                    </div>
                                    <div class="flex items-center gap-4 text-sm text-muted">
                                        <span>Added by: Rachel Brown</span>
                                        <span>Modified by: Tom Garcia</span>
                                    </div>
                                </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold">$15.00</div>
                                    <div class="action-buttons">
                                            <button type="button" class="btn btn-light" onclick="editLeaseCharge('petfee-expired')" title="Edit">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                            <button type="button" class="btn btn-light text-red-600" onclick="deleteLeaseCharge('petfee-expired')" title="Delete">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Expired Parking (Different Space) -->
                        <div class="charge-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm" style="border-left: 4px solid #991b1b; display: none;">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h4 class="text-base font-semibold">Parking Space #38</h4>
                                        <span class="status expired">Expired</span>
                                    </div>
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">parking</span>
                                        <span class="text-muted font-medium">Oct 1, 2023 - Sep 30, 2024</span>
                                    </div>
                                    <div class="flex items-center gap-4 text-sm text-muted">
                                        <span>Added by: Nicole Taylor</span>
                                        <span>Modified by: James Miller</span>
                                    </div>
                                </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold">$65.00</div>
                                    <div class="action-buttons">
                                            <button type="button" class="btn btn-light" onclick="editLeaseCharge('parking-expired')" title="Edit">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                            <button type="button" class="btn btn-light text-red-600" onclick="deleteLeaseCharge('parking-expired')" title="Delete">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Settings Pageslide -->
    <div class="pageslide-overlay" id="payment-settings-overlay">
        <div class="pageslide lease-edit payment-settings">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Payment settings</h2>
                <button class="pageslide-close" onclick="closePageslide('payment-settings-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <form id="payment-settings-form" class="lease-edit-form" onsubmit="savePaymentSettings(event)">
                    
                    <!-- Payment Details Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Payment details</h3>                        
                        <div class="form-row-group ml-1">
                            <div class="form-row">
                                <label class="form-label">Lease description</label>
                                <select class="form-select">
                                    <option value="">N/A</option>
                                    <option value="commercial">Commercial</option>
                                    <option value="controlled">Controlled</option>
                                    <option value="fair-market">Fair market</option>
                                    <option value="owner">Owner</option>
                                    <option value="stabilized">Stabilized</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Payment method</label>
                                <select class="form-select">
                                    <option value="any">Any</option>
                                    <option value="do-not-accept">Do not accept</option>
                                    <option value="cash-equiv">Cash equiv.</option>
                                </select>
                            </div>
                        
							<div class="form-row">
								<div class="form-row">
									<label class="form-label">Responsibility date</label>
									<input type="date" class="form-input" value="">
								</div>
							</div>
						</div>
                        
                    </div>
                    
                    <!-- Late Fees Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Late fees</h3>
                        
                        <div class="form-row-group ml-1">
                            <div class="form-row">
                                <label class="form-label">Charge late fee(s) on</label>
                                <select class="form-select">
                                    <option value="1">1st day of month</option>
                                    <option value="2">2nd day of month</option>
                                    <option value="3">3rd day of month</option>
                                    <option value="4" selected>4th day of month</option>
                                    <option value="5">5th day of month</option>
                                    <option value="6">6th day of month</option>
                                    <option value="7">7th day of month</option>
                                    <option value="8">8th day of month</option>
                                    <option value="9">9th day of month</option>
                                    <option value="10">10th day of month</option>
                                    <option value="11">11th day of month</option>
                                    <option value="12">12th day of month</option>
                                    <option value="13">13th day of month</option>
                                    <option value="14">14th day of month</option>
                                    <option value="15">15th day of month</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Minimum due to be charged</label>
                                <div class="form-input-group">
                                    <span class="form-input-prefix">$</span>
                                    <input type="number" class="form-input" value="100.00" step="0.01" min="0">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row-group ml-1">
                            <div class="form-row">
                                <label class="form-label">Maximum monthly fee</label>
                                <div class="form-input-group">
                                    <span class="form-input-prefix">$</span>
                                    <input type="number" class="form-input" value="0" step="0.01" min="0">
                                </div>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Amount type</label>
                                <select class="form-select">
                                    <option value="fixed">Fixed amount</option>
                                    <option value="percent" selected>% of Owed Total</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Monthly Fee Section -->
                        <div class="form-subsection bg-gray-50 p-3">
                            <div class="form-row">
                                <label class="form-label">Charge a monthly fee?</label>
                                <div class="form-radio-group">
                                    <div class="radio-option">
                                        <input type="radio" id="monthly-fee-yes-standalone" name="monthly-fee-standalone" value="yes" class="form-radio" checked>
                                        <label for="monthly-fee-yes-standalone" class="form-radio-label">Yes</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="monthly-fee-no-standalone" name="monthly-fee-standalone" value="no" class="form-radio">
                                        <label for="monthly-fee-no-standalone" class="form-radio-label">No</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="monthly-fee-details-standalone" class="form-row-group ml-1">
                                <div class="flex gap-4" style="display: flex !important;">
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount</label>
                                        <div class="form-input-group">
                                            <span class="form-input-prefix">$</span>
                                            <input type="number" class="form-input" value="50.00" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount type</label>
                                        <select class="form-select">
                                            <option value="flat" selected>Flat amount</option>
                                            <option value="percent">% of Owed Total</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Daily Fee Section -->
                        <div class="form-subsection bg-gray-50 p-3">
                            <div class="form-row">
                                <label class="form-label">Charge a daily fee?</label>
                                <div class="form-radio-group">
                                    <div class="radio-option">
                                        <input type="radio" id="daily-fee-yes-standalone" name="daily-fee-standalone" value="yes" class="form-radio" checked>
                                        <label for="daily-fee-yes-standalone" class="form-radio-label">Yes</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="daily-fee-no-standalone" name="daily-fee-standalone" value="no" class="form-radio">
                                        <label for="daily-fee-no-standalone" class="form-radio-label">No</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="daily-fee-details-standalone" class="form-row-group ml-1">
                                <div class="flex gap-4" style="display: flex !important;">
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount per day</label>
                                        <div class="form-input-group">
                                            <span class="form-input-prefix">$</span>
                                            <input type="number" class="form-input" value="1.00" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Maximum days</label>
                                        <div class="form-radio-group">
                                            <div class="radio-option">
                                                <input type="radio" id="max-days-unlimited-standalone" name="max-days-standalone" value="unlimited" class="form-radio" checked>
                                                <label for="max-days-unlimited-standalone" class="form-radio-label">Unlimited</label>
                                            </div>
                                            <div class="radio-option flex items-center gap-2">
                                                <input type="radio" id="max-days-limited-standalone" name="max-days-standalone" value="limited" class="form-radio">
                                                <label for="max-days-limited-standalone" class="form-radio-label" style="min-width:50px">Limit to</label>
                                                <input type="number" class="form-input" value="0" min="1" max="365" style="width: 80px;" disabled>
                                                <span class="text-sm text-gray-600">days</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Second Late Fee Section -->
                        <div class="form-subsection bg-gray-50 p-3">
                            <div class="form-row">
                                <label class="form-label">Charge a 2nd late fee?</label>
                                <div class="form-radio-group">
                                    <div class="radio-option">
                                        <input type="radio" id="second-fee-yes-standalone" name="second-fee-standalone" value="yes" class="form-radio">
                                        <label for="second-fee-yes-standalone" class="form-radio-label">Yes</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="second-fee-no-standalone" name="second-fee-standalone" value="no" class="form-radio" checked>
                                        <label for="second-fee-no-standalone" class="form-radio-label">No</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="second-fee-details-standalone" class="form-row-group ml-1" style="display: none;">
                                <div class="flex gap-4" style="display: flex !important;">
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Charge 2nd late fee on:</label>
                                        <select class="form-select">
                                            <option value="1st" selected>1st</option>
                                            <option value="2nd">2nd</option>
                                            <option value="3rd">3rd</option>
                                            <option value="4th">4th</option>
                                            <option value="5th">5th</option>
                                            <option value="10th">10th</option>
                                            <option value="15th">15th</option>
                                            <option value="30th">30th</option>
                                            <option value="day-of-month">Day of month</option>
                                        </select>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount</label>
                                        <div class="form-input-group">
                                            <span class="form-input-prefix">$</span>
                                            <input type="number" class="form-input" value="0" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="flex-1" style="flex: 1;">
                                        <label class="form-label">Amount Type</label>
                                        <select class="form-select">
                                            <option value="flat">Flat Amount</option>
                                            <option value="percent" selected>% of Owed Total</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-light" onclick="closePageslide('payment-settings-overlay')">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Save changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Lease Charge Pageslide -->
    <div class="pageslide-overlay" id="edit-lease-charge-overlay">
        <div class="pageslide edit-lease-charge" style="max-width: 500px;">
            <div class="pageslide-header">
                <h2 class="pageslide-title" id="edit-charge-title">Edit lease charge</h2>
                <button class="pageslide-close" onclick="closePageslide('edit-lease-charge-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <form id="edit-lease-charge-form" onsubmit="saveLeaseChargeFromPageslide(event)">
                    <input type="hidden" name="chargeId" id="edit-charge-id">

                    <!-- Charge Code -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Charge Code <span class="text-red-500">*</span>
                        </label>
                        <input type="text" class="form-input" name="chargeCode" id="edit-charge-code" required>
                    </div>

                    <!-- Amount (Read-only) -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Amount
                        </label>
                        <div class="px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg">
                            <span class="text-base font-semibold text-gray-900" id="edit-charge-amount-display">$0.00</span>
                        </div>
                    </div>

                    <!-- Date Range -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Start Date <span class="text-red-500">*</span>
                            </label>
                            <input type="date" class="form-input" name="startDate" id="edit-charge-start-date" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                End Date
                            </label>
                            <input type="date" class="form-input" name="endDate" id="edit-charge-end-date">
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="mb-8">
                        <div class="flex items-center gap-3">
                            <span class="text-sm text-gray-600">Inactive</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="edit-charge-status" name="status" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                            <span class="text-sm text-gray-600">Active</span>
                        </div>
                    </div>

                </form>
            </div>
            
            <!-- Sticky Footer Actions -->
            <div class="pageslide-footer">
                <div class="flex justify-between items-center">
                    <button type="button" onclick="deleteLeaseCharge()" class="px-4 py-2 text-red-600 bg-red-50 border border-red-200 rounded-lg hover:bg-red-100 transition-colors">
                        <i class="fas fa-trash mr-2"></i>
                        Delete
                    </button>
                    <div class="flex gap-2">
                        <button type="button" onclick="closePageslide('edit-lease-charge-overlay')" class="px-6 py-3 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                            Cancel
                        </button>
                        <button type="button" onclick="document.getElementById('edit-lease-charge-form').requestSubmit()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Save changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Lease Charge Pageslide -->
    <div class="pageslide-overlay" id="add-lease-charge-overlay">
        <div class="pageslide add-lease-charge" style="max-width: 500px;">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Add lease charge</h2>
                <button class="pageslide-close" onclick="closePageslide('add-lease-charge-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <form id="add-lease-charge-form" onsubmit="submitAddLeaseCharge(event)">

                    <!-- Charge Code -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Charge Code <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500" name="chargeCode" required>
                                <option value="">Select charge code...</option>
                                <option value="rentres">rentres (Rent - Residential)</option>
                                <option value="petfee">petfee (Pet Fee)</option>
                                <option value="keylock">keylock (Key/Lock/Remote Fee)</option>
                                <option value="parking">parking (Parking)</option>
                                <option value="storage">storage (Storage)</option>
                                <option value="washdry">washdry (Washer/Dryer)</option>
                                <option value="latefee">latefee (Late Fee)</option>
                                <option value="utilfee">utilfee (Utility Fee)</option>
                                <option value="deposit">deposit (Security Deposit)</option>
                                <option value="appfee">appfee (Application Fee)</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                <button type="button" class="text-gray-400 hover:text-gray-600" onclick="showChargeCodeOptions()">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Amount -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Amount <span class="text-red-500">*</span>
                        </label>
                        <div class="form-input-group">
                            <span class="form-input-prefix">$</span>
                            <input type="number" class="form-input" name="amount" step="0.01" min="0" placeholder="0.00" required>
                        </div>
                    </div>

                    <!-- Date Range -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                From <span class="text-red-500">*</span>
                            </label>
                            <input type="date" class="form-input" name="fromDate" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                To
                            </label>
                            <input type="date" class="form-input" name="toDate">
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="mb-8">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Status <span class="text-red-500">*</span>
                        </label>
                        <select class="form-select" name="status" required>
                            <option value="active" selected>Active</option>
                            <option value="hold">On Hold</option>
                        </select>
                    </div>

                </form>
            </div>
            
            <!-- Sticky Footer Actions -->
            <div class="pageslide-footer">
                <div class="flex justify-end gap-3">
                    <button type="button" onclick="closePageslide('add-lease-charge-overlay')" class="px-6 py-3 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                        Cancel
                    </button>
                    <button type="button" onclick="document.getElementById('add-lease-charge-form').requestSubmit()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Add charge
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Attachment Upload Modal -->
    <div id="attachment-modal" class="fixed inset-0 hidden z-[9999] flex items-center justify-center" style="background-color: rgba(0, 0, 0, 0.3); backdrop-filter: blur(2px);">
        <div class="bg-white rounded-lg w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between p-6 border-b">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-paperclip text-blue-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">Add Attachment</h3>
                </div>
                <button onclick="closeAttachmentModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <!-- Recipient Selection -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Select who this attachment is for <span class="text-red-500">*</span>
                    </label>
                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="melinda-michaels" selected>Melinda Michaels</option>
                        <option value="angela-johnson">Angela Johnson</option>
                        <option value="john-smith">John Smith</option>
                        <option value="household">Household</option>
                    </select>
                </div>
                
                <!-- Upload Area -->
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors cursor-pointer" 
                     onclick="document.getElementById('attachment-file-input').click()">
                    <div class="mb-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg mx-auto mb-4 flex items-center justify-center">
                            <i class="fas fa-cloud-upload-alt text-blue-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h4 class="font-medium text-gray-900 mb-2">Drop files here to upload.</h4>
                        <div class="mb-4">
                            <span class="text-gray-500">or</span>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="document.getElementById('attachment-file-input').click()">
                            Select File
                        </button>
                        <input type="file" id="attachment-file-input" class="hidden" multiple>
                    </div>
                </div>
                
                <!-- File Format Information -->
                <div class="mt-4 text-xs text-gray-500">
                    <strong>Max Size:</strong> 5MB, <strong>Valid files:</strong> PDF, Text(TXT, CSV, XML), Excel (XLS, XLSX, XLSB), Word(DOC, DOCX, RTF), Image(JPG, JPEG, TIF, BMP, GIF, PNG), Video (MP4, MPG, AVI), Other (ZIP, SWF, DWF, DWFX, SVG)
                </div>
                
                <!-- Action Buttons -->
                <div class="flex justify-end gap-3 mt-6">
                    <button onclick="closeAttachmentModal()" class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                        Cancel
                    </button>
                    <button onclick="uploadAttachment()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Upload Attachment
                    </button>
                </div>
            </div>
        </div>
    </div>


</body>
</html>




