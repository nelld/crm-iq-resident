<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Current Resident</title>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome Free -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        destructive: {
                            DEFAULT: "hsl(var(--destructive))",
                            foreground: "hsl(var(--destructive-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))",
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    },
                }
            }
        }
    </script>
    
    <link rel="stylesheet" href="base.css">
	<link rel="stylesheet" href="styles.css?v=190">
    
    <style>
        /* Content container width customization */
        .container {
            max-width: 1600px !important;
        }
        
        /* Sidebar width customization */
        .sidebar {
            width: 220px !important;
        }
        
        /* Black tooltips for contact icons */
        .tooltip-black {
            position: relative;
            display: inline-block;
        }
        
        .tooltip-black .tooltip-text {
            visibility: hidden;
            width: auto;
            min-width: 60px;
            background-color: #000;
            color: white;
            text-align: center;
            border-radius: 4px;
            padding: 6px 10px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px;
            font-weight: 400;
            text-transform: none;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
        
        .tooltip-black .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -4px;
            border-width: 4px;
            border-style: solid;
            border-color: #000 transparent transparent transparent;
        }
        
        .tooltip-black:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Form Label Positioning - Labels Above Fields */
        .contact-edit-form .form-row {
            display: flex !important;
            flex-direction: column !important;
            gap: 8px !important;
            margin-bottom: 16px !important;
        }
        
        .contact-edit-form .form-row-group {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 16px !important;
            margin-bottom: 16px !important;
        }
        
        @media (max-width: 768px) {
            .contact-edit-form .form-row-group {
                grid-template-columns: 1fr !important;
            }
        }
        
        .contact-edit-form .form-row-group .form-row {
            margin-bottom: 0 !important;
        }
        
        .contact-edit-form .form-label {
            display: block !important;
            margin-bottom: 6px !important;
            font-weight: 500 !important;
            font-size: 14px !important;
            color: #374151 !important;
            order: 1 !important;
        }
        
        .contact-edit-form .form-input,
        .contact-edit-form .form-select,
        .contact-edit-form .form-input-group,
        .contact-edit-form .phone-input-group,
        .contact-edit-form .country-input-group {
            order: 2 !important;
            width: 100% !important;
        }
        
        .contact-edit-form .form-radio-group {
            order: 2 !important;
            display: flex !important;
            flex-wrap: wrap !important;
            gap: 12px !important;
            margin-top: 6px !important;
        }
        
        .contact-edit-form .form-checkbox-group {
            order: 3 !important;
            margin-top: 8px !important;
        }
        
        /* Ensure phone inputs work properly with labels above */
        .contact-edit-form .phone-input-group {
            display: flex !important;
            gap: 8px !important;
        }
        
        .contact-edit-form .country-select {
            width: auto !important;
            min-width: 70px !important;
        }
        
        /* Form sections spacing */
        .contact-edit-form .form-section {
            margin-bottom: 32px !important;
        }
        
        .contact-edit-form .form-section-title {
            margin-bottom: 20px !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            color: #111827 !important;
        }
        
        /* Special handling for identification section with 3 fields */
        .contact-edit-form .form-section h3 + .form-row-group:first-of-type {
            grid-template-columns: 1fr 1fr 1fr !important;
        }
        
        @media (max-width: 1024px) {
            .contact-edit-form .form-section h3 + .form-row-group:first-of-type {
                grid-template-columns: 1fr 1fr !important;
            }
        }
        
        @media (max-width: 768px) {
            .contact-edit-form .form-section h3 + .form-row-group:first-of-type {
                grid-template-columns: 1fr !important;
            }
        }
        
        /* Tenant Header Layout Optimization for 1366px screens */
        @media (max-width: 1400px) and (min-width: 1200px) {
            .page-header .flex.items-center.gap-8 {
                gap: 1rem !important;
            }
            
            .tasks-alerts-header,
            .balance-header,
            .health-score-header {
                min-width: 200px !important;
                max-width: 280px !important;
            }
            
            .tasks-alerts-header .font-medium,
            .balance-header .font-medium,
            .health-score-header .font-medium {
                font-size: 13px !important;
            }
            
            .tasks-alerts-header .text-lg,
            .balance-header .text-lg,
            .health-score-header .text-lg {
                font-size: 16px !important;
            }
        }
        
        /* Ensure proper wrapping on smaller laptop screens */
        @media (max-width: 1366px) {
            .page-header {
                padding: 1rem 1.5rem !important;
            }
            
            .page-header .flex.items-center.gap-8 {
                flex-wrap: nowrap !important;
                gap: 0.75rem !important;
                justify-content: space-between !important;
            }
            
            .tasks-alerts-header,
            .balance-header,
            .health-score-header {
                flex: 1 !important;
                min-width: 180px !important;
                max-width: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="left-section">
                <img src="images/crm-iq-logo.png" alt="CRM IQ" class="logo">
                <nav class="nav-menu">
                    <div class="nav-item">
                        <span>Dashboards</span>
                        <i class="fas fa-caret-down"></i>
                    </div>
                    <div class="nav-item">
                        <span>Reports</span>
                        <i class="fas fa-caret-down"></i>
                    </div>
                    <div class="nav-item">
                        <span>Communications</span>
                        <i class="fas fa-caret-down"></i>
                    </div>
                    <button class="nav-grid-btn">
                        <i class="fas fa-th"></i>
                    </button>
                </nav>
                <div class="left-actions">
                    <div class="search-section">
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="Search...">
                            <button class="search-btn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <button class="add-new-btn">
                        <span>Add New</span>
                        <i class="fas fa-caret-down"></i>
                    </button>
                    <button class="action-btn calendar-btn">
                        <i class="fas fa-calendar-alt"></i>
                    </button>
                    <button class="action-btn calculator-btn">
                        <i class="fas fa-calculator"></i>
                    </button>
                </div>
            </div>
            
            <div class="header-actions">
                <button class="action-btn star-btn">
                    <i class="fas fa-star"></i>
                </button>
                <button class="action-btn help-btn">
                    <i class="fas fa-question-circle"></i>
                </button>
                <button class="action-btn notification-btn">
                    <span class="notification-count">0</span>
                </button>
                <button class="action-btn settings-btn">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="user-profile">
                    <div class="user-avatar">ND</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="#">Home</a> <span class="breadcrumb-separator">/</span> <a href="#">Search</a> <span class="breadcrumb-separator">/</span> <a href="#">Melinda Michaels</a> <span class="breadcrumb-separator">/</span> Cityview Towers
        </div>
        <i class="fas fa-info-circle info-icon"></i>
    </div>

    <!-- Page Header -->
    <div class="page-header">
            <div class="title-section">
                <div class="title-with-badges">
				<h1 class="page-title mr-0">Melinda Michaels</h1>
                    <div class="badges-container">
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Current</span>
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800">Primary</span>
                    </div>
                </div>
			<div class="flex items-center gap-2 text-muted text-sm">
				<span>Cityview Towers<span class="ml-1">(p0031246)</span></span><span class="text-muted">•</span><span>Unit 288</span><span class="text-muted">•</span><span>t0039661</span>
            </div>
        </div>
        
        <!-- Header Actions -->
        <div class="flex items-center gap-8">
            <!-- Active Tasks & Alerts Section -->
            <div class="tasks-alerts-header cursor-pointer" onclick="openPageslide('active-tasks-overlay')">
        <div class="flex items-center gap-2">
                    <div class="flex items-center gap-1">
                        <i class="fas fa-exclamation-circle text-orange-500"></i>
                        <span class="font-medium">Active Tasks:</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <span class="text-lg font-bold">3</span>
                    </div>
                </div>
                <div class="flex items-center gap-1 text-sm">
                    <span class="text-muted">Lease expiry</span>
                    <span class="text-gray-400">•</span>
                    <span class="text-muted">Work order</span>
                    <span class="text-gray-400">•</span>
                    <span class="text-muted">Application</span>
                </div>
            </div>

            <!-- Outstanding Balance Section -->
            <div class="balance-header cursor-pointer" onclick="openPageslide('outstanding-balance-overlay')">
                <div class="flex items-center gap-2">
                    <div class="flex items-center gap-1">
                        <i class="fas fa-exclamation-triangle text-red-500"></i>
                        <span class="font-medium">Outstanding:</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <span class="text-lg font-bold">$2,809.50</span>
                    </div>
                </div>
                <div class="flex items-center gap-1 text-sm">
                    <span class="text-red-600 font-medium">3 past due</span>
                    <span class="text-gray-400">•</span>
                    <span class="text-yellow-600">1 processing</span>
					<span class="text-gray-400">•</span>
					<i class="fas fa-warning text-red-500"></i><span class="text-red-600 font-medium">Do not accept payment</span>
                </div>
            </div>

            <!-- Health Score Section -->
            <div class="health-score-header">
                <div class="health-score-tooltip">
                    <div class="flex items-center gap-2">
                        <div class="flex items-center gap-1">
                            <i class="fas fa-chart-line text-green-500"></i>
                            <span class="font-medium ">Health Score:</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <span class="text-lg font-bold">90</span>
                            <span class="text-sm text-muted">/100</span>
                        </div>
                    </div>
					<div class="flex items-center gap-1 text-sm">
						<span class="text-muted">Excellent</span>
						<span class="text-gray-400">•</span>
						<span class="text-muted">Low risk</span>
					</div>
                    <div class="tooltip-content">
                        <div class="tooltip-header">Resident Health Score Breakdown</div>
                        <div class="performance-item">
                            <span class="performance-label">Payment History</span>
                            <span class="performance-value">85%</span>
                            <div class="performance-bar">
                                <div class="performance-fill payment-fill" style="width: 85%"></div>
                            </div>
                        </div>
                        <div class="performance-item">
                            <span class="performance-label">Communication</span>
                            <span class="performance-value">92%</span>
                            <div class="performance-bar">
                                <div class="performance-fill communication-fill" style="width: 92%"></div>
                            </div>
                        </div>
                        <div class="performance-item">
                            <span class="performance-label">Compliance</span>
                            <span class="performance-value">95%</span>
                            <div class="performance-bar">
                                <div class="performance-fill compliance-fill" style="width: 95%"></div>
                            </div>
                        </div>
                        <div class="performance-item">
                            <span class="performance-label">Renewal Likelihood</span>
                            <span class="performance-value">89%</span>
                            <div class="performance-bar">
                                <div class="performance-fill renewal-fill" style="width: 89%"></div>
                            </div>
                        </div>
                        <div class="tooltip-footer">
                            Health score is calculated based on payment history, communication responsiveness, lease compliance, and renewal probability. Updated daily.
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-2"><!-- Add Work Order Button -->
            
            <!-- Lease Manage Dropdown -->
            <div class="resident-kebab-menu">
                <button id="tenant-header-manage-btn" class="btn btn-light">
                    <span class="">Manage Lease</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <!-- Kebab Menu -->
            <div class="resident-kebab-menu">
                <button id="resident-header-kebab-btn" class="btn btn-light kebab-menu">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            <div id="resident-header-kebab-dropdown" class="resident-kebab-dropdown">
                <!-- Financial -->
                <div class="resident-kebab-group-header">FINANCIAL</div>
                <div class="resident-kebab-option" data-action="receive-payment">
                    <i class="fas fa-circle-plus"></i>
                    <span>Add one-time charge</span>
                </div>
				<div class="resident-kebab-option" data-action="receive-payment">
                    <i class="fas fa-credit-card"></i>
                    <span>Receive payment</span>
                </div>
                
                <!-- Service -->
                <div class="resident-kebab-separator"></div>
                <div class="resident-kebab-group-header">SERVICE</div>
                <div class="resident-kebab-option" data-action="add-work-order">
                    <i class="fas fa-wrench"></i>
                    <span>Add work order</span>
                </div>
               
                </div>
                </div> 
            </div>
        </div>
    </div>



    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-item active" id="overview-menu" onclick="toggleView('overview')">
						<i class="fas fa-home text-muted mr-2"></i>
						Overview
                </div>
                    </div>
                                 <div class="">
                     <div class="menu-item">
						<i class="fas fa-file-contract text-muted mr-2"></i>
						Lease information
                </div>
					<div class="menu-item" id="ledger-menu" onclick="toggleView('ledger')">
						<i class="fas fa-receipt text-muted mr-2"></i>
						Ledger
                    </div>
                     <div class="menu-item">
						<i class="fas fa-boxes text-muted mr-2"></i>
						Rentable items
                </div>
					<div class="menu-item">
						<i class="fas fa-wrench text-muted mr-2"></i>
						Work orders
                        <span class="menu-count">1</span>
                    </div>
                     <div class="menu-item">
						<i class="fas fa-university text-muted mr-2"></i>
						Bank accounts
                    </div>
                     <div class="menu-item">
						<i class="fas fa-shield-alt text-muted mr-2"></i>
						Renters insurance
                    </div>
					<div class="menu-item">
						<i class="fas fa-concierge-bell text-muted mr-2"></i>
                        Concierge
                    </div>
					<div class="menu-item">
						<i class="fas fa-folder text-muted mr-2"></i>
						Documents
                </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content-area">
            <!-- Overview View -->
            <div id="overview-view" class="container py-6 mx-auto">

            <!-- Two Column Layout: 2/3 and 1/3 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- First Column (2/3 width) -->
                <div class="col-span-1 lg:col-span-2 space-y-6">
                    

                    
                    <!-- Row 3: Two Columns - Resident Info + Lease Info -->
                    <div class="grid grid-cols-2 gap-6" id="two-column-layout">
                        <!-- Column 1: Resident Information + Notes -->
                        <div class="flex flex-col space-y-6" id="column-1-resident-notes">

                    <!-- Resident Information Card -->
                    <div class="card shadow-sm">
                        <div class="card-header border-0">
                            <div class="flex items-center justify-between w-full">
                                <h3 class="card-title">Resident information</h3>
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-light btn-sm section-edit-btn">
                                        <i class="fas fa-pen mr-1"></i>
                                        Edit
                                    </button>
                                    <button id="kebab-btn-resident" class="btn btn-light btn-sm kebab-menu">
                                        <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                    </div>
                        </div>
                        <div class="card-content">
                            <div class="flex items-start gap-3">
                                <!-- Avatar -->
                                <div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-white font-semibold">MM</span>
                            </div>

                                <!-- Resident Info -->
                                <div class="flex-1 min-w-0">
                                    <h4 class="font-semibold  mb-1">Melinda Michaels <i class="fas fa-clone text-primary text-sm cursor-pointer ml-1" title="Copy resident name, email and phone number"></i></h4>
                                    <p class="text-muted mb-2">Preferred name: Mel Michaels</p>
                                    
                                    <!-- Contact Information -->
                                    <div class="space-y-1 mb-2">
                                        <div class="flex items-center gap-2">
                                            <span class="">(555) 123-4567</span>
                                            <div class="flex items-center gap-3">
												<span class="tooltip-black">
													<i class="fas fa-phone text-link cursor-pointer"></i>
													<span class="tooltip-text">Call</span>
												</span>
												<span class="tooltip-black">
													<i class="fas fa-mobile-alt text-link cursor-pointer"></i>
													<span class="tooltip-text">Text</span>
												</span>
											</div>
                            </div>
                                        <div class="flex items-center gap-2">
                                            <span class="">melinda.michaels@email.com</span>
                                            <span class="tooltip-black">
                                                <i class="fas fa-envelope text-link cursor-pointer"></i>
                                                <span class="tooltip-text">Email</span>
                                            </span>
                            </div>
                            </div>
                                    
                                    <div class="text-sm">
                                        <span class="">Preferred contact: </span>
                                        <span class="">SMS</span>
                            </div>
                            </div>
                            </div>
                            
                            <!-- RentCafe Registration Section -->
                            <div class="mt-6 pt-6 border-t border-gray-100">
                                <div class="flex items-center justify-between mb-1">
                                    <span class="font-medium ">RentCafe registration</span>
                                    <div class="flex items-center space-x-3">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                            <span class="font-medium text-green-700" data-field="rentcafe-status">Registered</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <p class="text-sm text-muted" data-field="rentcafe-date">Registered on March 15, 2023
									<span class="text-gray-400">•</span>
									Account verified</p>
                                    <div class="flex items-center gap-1 font-weight-normal">
                                        <a href="#" class="btn btn-link btn-sm">
                                            <i class="fas fa-external-link-alt text-sm ml-1"></i> Preview account
                                        </a>
                                        <button id="kebab-btn-rentcafe" class="btn btn-link btn-sm">
											<i class="fas fa-ellipsis-v"></i>
										</button>
                                    </div>
                                </div>
                            </div>
                    
                    <!-- Roommates Section -->
                    <div class="mt-6 pt-6 border-t border-gray-100">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-users text-muted"></i>
                                <span class="font-medium">Roommates</span>
                            </div>
                            <button class="btn btn-link p-0" onclick="openPageslide('roommate-details-overlay')">View details</button>
                        </div>
                        
                        <!-- Roommate List -->
                        <div class="space-y-2">
                            <div class="flex items-center gap-2">
                                <span class="">Angela Johnson</span>
                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-orange-100 text-orange-800">
                                    Pending approval
                                </span>
                                <div class="flex items-center gap-3">
                                    <span class="tooltip-black">
                                        <i class="fas fa-phone text-link cursor-pointer"></i>
                                        <span class="tooltip-text">Call</span>
                                    </span>
                                    <span class="tooltip-black">
                                        <i class="fas fa-mobile-alt text-link cursor-pointer"></i>
                                        <span class="tooltip-text">Text</span>
                                    </span>
                                    <span class="tooltip-black">
                                        <i class="fas fa-envelope text-link cursor-pointer"></i>
                                        <span class="tooltip-text">Email</span>
                                    </span>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="">John Smith</span>
                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Current</span>
                                <div class="flex items-center gap-3">
                                    <span class="tooltip-black">
                                        <i class="fas fa-phone text-link cursor-pointer"></i>
                                        <span class="tooltip-text">Call</span>
                                    </span>
                                    <span class="tooltip-black">
                                        <i class="fas fa-mobile-alt text-link cursor-pointer"></i>
                                        <span class="tooltip-text">Text</span>
                                    </span>
                                    <span class="tooltip-black">
                                        <i class="fas fa-envelope text-link cursor-pointer"></i>
                                        <span class="tooltip-text">Email</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
					
					<!-- Emergency Contacts Section -->
					<div class="mt-6 pt-6 border-t border-gray-100">
						<div class="flex items-start justify-between">
							<div class="flex-1">
								<div class="flex items-center gap-2 mb-2">
									<i class="fas fa-user-shield text-muted"></i>
									<span class="font-medium">Emergency contact</span>
								</div>
								<div class="flex items-center gap-2 text-muted">
									<span>Michael Brown<span class="ml-1 text-muted">(friend)</span></span>
									<div class="flex items-center gap-3">
										<span class="tooltip-black">
											<i class="fas fa-phone text-link cursor-pointer"></i>
											<span class="tooltip-text">Call</span>
										</span>
										<span class="tooltip-black">
											<i class="fas fa-mobile-alt text-link cursor-pointer"></i>
											<span class="tooltip-text">Text</span>
										</span>
										<span class="tooltip-black">
											<i class="fas fa-envelope text-link cursor-pointer"></i>
											<span class="tooltip-text">Email</span>
										</span>
									</div>
								</div>
							</div>
							<button class="btn btn-link p-0">View details</button>
						</div>
					</div>

                    </div>
                    </div>
					
					

                    <!-- Notes Card -->
                    <div class="card shadow-sm flex-grow flex flex-col">
                        <div class="card-header border-0">
                            <div class="flex items-center justify-between w-full">
                                <h3 class="card-title">Notes</h3>
                                <button class="btn btn-light btn-sm" onclick="addNote()">
                                    <i class="fas fa-circle-plus mr-1"></i>
                                    Add
                                </button>
                            </div>
                        </div>
                        <div class="card-content flex-grow flex flex-col">
                            <!-- <div class="note-entry"> -->
                                <!-- <div class="note-header mb-2"> -->
                                    <!-- <div class="flex items-center gap-2"> -->
                                        <!-- <span class="font-semibold ">Sarah Chen</span> -->
                                        <!-- <span class="text-muted">•</span> -->
                                        <!-- <span class="text-muted">Aug 16, 2025 at 2:45 pm</span> -->
                            <!-- </div> -->
                            <!-- </div> -->
                                <!-- <div class="note-content mb-3"> -->
                                    <!-- <p class=""> -->
                                        <!-- <span id="note-preview">Received work order for refrigerator repair. Tenant mentioned it stopped cooling yesterday evening. Scheduled</span> -->
                                        <!-- <span id="note-full" class="hidden"> technician for tomorrow morning. Also discussed upcoming lease renewal - tenant interested in staying for another year.</span> -->
                                        <!-- <button id="note-toggle" class="btn btn-link ml-1 p-0" onclick="toggleNoteExpansion()">read more</button> -->
                                    <!-- </p> -->
                            <!-- </div> -->
                            <!-- </div> -->
                            
                            <!-- <div class="border-t border-gray-200 my-4"></div> -->
                            
                            <!-- Second Note Entry -->
                            <div class="note-entry">
                                <div class="note-header mb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="font-semibold ">Mike Rodriguez</span>
                                        <span class="text-muted">•</span>
                                        <span class="text-muted">Aug 15, 2025 at 10:30 am</span>
                                    </div>
                                </div>
                                <div class="note-content mb-3">
                                    <p class="">
                                        <span id="note-preview-2">Tenant called about potential lease renewal. Very satisfied with the unit and community amenities. Interested in</span>
                                        <span id="note-full-2" class="hidden"> 12-month extension starting November 1st. Mentioned possible roommate addition in the spring. Also requested information about parking space availability and pet policy updates.</span>
                                        <button id="note-toggle-2" class="btn btn-link ml-1 p-0" onclick="toggleNoteExpansion2()">read more</button>
                                    </p>
                                </div>
                            </div>
                            
                            <!-- View More Notes -->
                            <div class="mt-auto pt-3">
                                <button class="btn btn-link p-0" onclick="viewAllNotes()">
                                    View 2 more notes
                                </button>
                            </div>
                            </div>
                        </div>
                        
                        </div>
                        
                        <!-- Column 2: Lease Information -->
                        <div class="flex flex-col space-y-6" id="column-2-lease-info">
                            <!-- Lease Information Card -->
                    <div class="card shadow-sm flex-grow">
                        <div class="card-header border-0">
                            <div class="flex items-center justify-between w-full">
                                <h3 class="card-title">Lease information</h3>
                                <!-- <div class="flex items-center gap-2">
                                    <button id="kebab-btn-lease" class="btn btn-light btn-sm">
                                        <span class="">Manage</span>
                                        <i class="fas fa-chevron-down"></i>
                                        </button>
                                    </div> -->
                                </div>
                            </div>
                        <div class="card-content">
                            <div class="space-y-12">
                                
                                <!-- LEASE OVERVIEW Section -->
                                <div class="lease-section">
                                    <div class="lease-section-header">
                                        <h4 class="font-semibold text-muted uppercase tracking-wide">Lease overview</h4>
                        </div>
                                    <div class="lease-section-content">
                                        <div class="lease-overview-grid">
                                            <div class="lease-overview-item">
                                                <div class="flex items-center gap-2 mb-1">
                                                    <i class="fas fa-calendar text-muted"></i>
                                                    <span class=" ">Oct 1, 2024 - Sep 30, 2025</span>
                                                    <span class="badge bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded-full ">12 months</span>
                                </div>
                                                <div class="flex items-center gap-2 mt-2">
                                                    <div class="flex items-center gap-1">
                                                                                                                 <span class="">$1337.25/mo</span>
                                                         <button class="ml-1 btn btn-link p-0" onclick="toggleLeaseChargesPopover(event)" aria-label="View lease charges breakdown">
                                                             <i class="fas fa-info-circle text-sm"></i>
                                                         </button>
                            </div>
                                                    <span class="text-muted">•</span>
                                                    <div class="flex items-center gap-1">
                                                        <span class="">$1850 deposit</span>
                                                    </div>
													<span class="text-muted">•</span>
                                                    <div class="flex items-center gap-1">
                                                        <span class="">Late fee/NSF: 0/0</span>
                                                    </div>
                                                </div>
                                                <div class="flex items-center gap-2 mt-2">
                                                    <div class="lease-status-indicator active"></div>
                                                    <span class="text-green-700">Active lease</span>
                                                    <span class="text-muted">•</span>
                                                    <span class="">Move-in: Oct 2, 2025</span>
                                                </div>
                                            </div>
                                        </div>
                        </div>
                    </div>

                                <!-- PROPERTY DETAILS Section -->
                                <div class="lease-section">
                                    <div class="lease-section-header">
                                        <h4 class="font-semibold text-muted uppercase tracking-wide">Unit details</h4>
                                    </div>
                                    <div class="lease-section-content">
                                        <div class="property-details-grid">
                                            <div class="property-detail-item">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <i class="fas fa-bed text-muted"></i>
                                                    <span class="">Unit: <a href="#">103</a></span>
                                                    <span class="text-muted">•</span>
													<span class="">3 bed 2 bath</span>
                                                    <span class="text-muted">•</span>
                                                    <span class="">950 ft²</span>
													<span class="text-muted">•</span>
                                                    <span class="">iq01_3b2</span>
													
                                </div>
                                                <div class="flex items-start gap-2">
                                                    <i class="fas fa-map-marker-alt text-muted mt-0.5"></i>
                                                    <div class="">
                                                        <div class="mb-1">430 S Fairview Avenue 288</div>
                                                        <div class="">Santa Barbara, CA 93117</div>
                            </div>
                        </div>
                                </div>
                            </div>
                        </div>
                    </div>

                                <!-- ADDITIONAL INFO Section -->
                                <div class="lease-section">
                                    <div class="lease-section-header">
                                        <h4 class="font-semibold text-muted uppercase tracking-wide">Additional info</h4>
                                    </div>
                                    <div class="lease-section-content">
                                        <div class="additional-info-grid">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <i class="fas fa-paw text-muted"></i>
                                                    <span>2 Pets (1 dog, 1 cat)</span>
                                </div>
                                                <button class="btn btn-link p-0" onclick="openPageslide('pet-details-overlay')">View details</button>
                            </div>
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <i class="fas fa-car text-muted"></i>
                                                    <span>2 Vehicles</span>
                        </div>
                                                 <button class="btn btn-link p-0" onclick="openPageslide('vehicle-details-overlay')">View details</button>
                                </div>				
                    </div>
                        </div>
                    </div>

                                <!-- UNIT TRANSFER AND PROMOTION HISTORY Section -->
                                <div class="lease-section">
                                    <div class="lease-section-header">
                                        <h4 class="font-semibold text-muted uppercase tracking-wide">Unit transfer and promotion history</h4>
                                    </div>
                                    <div class="lease-section-content">
                                        <div class="history-records-container">
                                            <div class="space-y-3">
                                                <!-- History Record 1: Promote Roommate -->
                                                <div class="history-record">
                                                    <div class="flex items-start justify-between">
                                                        <div class="flex-1">
                                                            <div class="flex items-center gap-2 mb-2">
                                                                <i class="fas fa-user-plus text-muted"></i>
                                                                <span>Roommate promotion</span>
                                                            </div>
															<div class="flex items-center gap-2 text-muted">
																<span>Prior lease: 10312765</span><span class="text-muted">•</span><span>Prior unit: 3104</span>
															</div>
                                                        </div>
                                                        <button class="btn btn-link p-0">View ledger</button>
                                                    </div>
                                                </div>
                                                
                                                <!-- History Record 2: Unit Transfer -->
                                                <div class="history-record">
                                                    <div class="flex items-start justify-between">
                                                        <div class="flex-1">
                                                            <div class="flex items-center gap-2 mb-2">
                                                                <i class="fas fa-exchange-alt text-muted"></i>
                                                                <span>Unit Transfer</span>
                                                            </div>
                                                            <div class="flex items-center gap-2 text-muted">
																<span>Prior lease: 10123452</span><span class="text-muted">•</span><span>Prior unit: 2101</span>
															</div>
                                                        </div>
                                                        <button class="btn btn-link p-0">View ledger</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
                        </div>
                    </div>
                </div>
                </div>
                <!-- Second Column (1/3 width) -->
                <div class="col-span-1 lg:col-span-1 space-y-6 bg-gray-100 p-3 rounded-lg">

                    <!-- Activities Card -->
                    <div class="card" id="activity-timeline-card">
                        <div class="card-header border-0">
                            <div class="flex items-center justify-between w-full">
                                <h3 class="card-title">
                                    Activity Timeline
                                </h3>
                                <div class="relative">
                                    <button id="activity-add-btn" class="btn btn-light btn-sm" onclick="toggleActivityAddMenu()">
                                        <i class="fas fa-circle-plus mr-1"></i>
                                        Add
                                        <i class="fas fa-chevron-down text-sm ml-1"></i>
                                    </button>
                                    <div id="activity-add-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50 hidden">
                                        <div class="py-1">
                                            <button class="activity-add-option w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors" onclick="addActivityType('comment')">
                                                <i class="fas fa-comment mr-2 text-muted"></i>
                                                Add comment
                                            </button>
                                            <button class="activity-add-option w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors" onclick="addActivityType('follow-up')">
                                                <i class="fas fa-clock mr-2 text-muted"></i>
                                                Add follow-up
                                            </button>
                                            <button class="activity-add-option w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors" onclick="addActivityType('appointment')">
                                                <i class="fas fa-calendar-check mr-2 text-muted"></i>
                                                Add appointment
                                            </button>
                                            <button class="activity-add-option w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors" onclick="addActivityType('log')">
                                                <i class="fas fa-clipboard-list mr-2 text-muted"></i>
                                                Log activity
                                            </button>
                                            <button class="activity-add-option w-full text-left px-4 py-2 hover:bg-gray-50 transition-colors" onclick="addActivityType('memo')">
                                                <i class="fas fa-sticky-note mr-2 text-muted"></i>
                                                Add memo
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                    </div>
                                </div>
                        <div class="card-content pb-0">
                            <!-- Activity Filters -->
                            <div class="activity-filters">
                                <div class="flex items-center gap-4">
                                    <!-- Activity Type Filter -->
                                    <div class="activity-filter-dropdown-container">
                                        <button id="activity-filter-btn" class="activity-filter-btn">
                                            <span class="filter-current-text">All Activities</span>
                                            <i class="fas fa-chevron-down text-sm ml-2"></i>
                                        </button>
                                        <div id="activity-filter-dropdown" class="activity-filter-dropdown">
                                            <div class="activity-filter-option" data-value="all">
                                                <i class="fas fa-list"></i>
                                                <span>All Activities</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="communications">
                                                <i class="fas fa-comments"></i>
                                                <span>Communications</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="work-orders">
                                                <i class="fas fa-wrench"></i>
                                                <span>Work Orders</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="payments">
                                                <i class="fas fa-credit-card"></i>
                                                <span>Payments</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="lease">
                                                <i class="fas fa-file-contract"></i>
                                                <span>Lease</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Source Filter -->
                                    <div id="source-filter-container" class="activity-filter-dropdown-container hidden">
                                        <button id="source-filter-btn" class="activity-filter-btn">
                                            <span class="filter-current-text">All Sources</span>
                                            <i class="fas fa-chevron-down text-sm ml-2"></i>
                                        </button>
                                        <div id="source-filter-dropdown" class="activity-filter-dropdown">
                                            <div class="activity-filter-option selected" data-value="all-sources">
                                                <i class="fas fa-globe"></i>
                                                <span>All Sources</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="system">
                                                <i class="fas fa-robot"></i>
                                                <span>System</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="user">
                                                <i class="fas fa-user"></i>
                                                <span>User</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Communication Type Sub-filter (Hidden by default) -->
                                <div id="communication-type-filter-container" class="mt-3 hidden">
                                    <div class="activity-filter-dropdown-container">
                                        <button id="communication-type-filter-btn" class="activity-filter-btn">
                                            <span class="filter-current-text">All Communications</span>
                                            <i class="fas fa-chevron-down text-sm ml-2"></i>
                                        </button>
                                        <div id="communication-type-filter-dropdown" class="activity-filter-dropdown">
                                            <div class="activity-filter-option" data-value="all-communications">
                                                <i class="fas fa-globe"></i>
                                                <span>All Communications</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="appointment">
                                                <i class="fas fa-calendar-check"></i>
                                                <span>Appointment</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="call">
                                                <i class="fas fa-phone"></i>
                                                <span>Call</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="chat">
                                                <i class="fas fa-comments"></i>
                                                <span>Chat</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="comment-memo">
                                                <i class="fas fa-sticky-note"></i>
                                                <span>Comment/Memo</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="email">
                                                <i class="fas fa-envelope"></i>
                                                <span>Email</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="event">
                                                <i class="fas fa-calendar-alt"></i>
                                                <span>Event</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="follow-up">
                                                <i class="fas fa-user-clock"></i>
                                                <span>Follow-up</span>
                                            </div>
                                            <div class="activity-filter-option" data-value="text">
                                                <i class="fas fa-sms"></i>
                                                <span>Text</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-4" id="activity-timeline-container">
                                <!-- Today's Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-primary text-sm mr-2"></i>
                                        <span class="font-semibold ">Today: Aug 17, 2025</span>
                                </div>

                                    <!-- Text Message -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="text" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-sms text-primary"></i>
                            </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Text: Sent</span>
                                                <span class="activity-time">6:07 AM PST</span>
                                            </div>
                                            <p class="activity-description">Work order update: Technician scheduled for refrigerator repair</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via Chat IQ</span>
                                            </div>
                        </div>
                    </div>

                                    <!-- Email -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">6:07 AM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Payment Received - Account Balance Update</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via Chat IQ</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Follow-up -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="follow-up" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-user-clock text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Follow-Up - Created</span>
                                                <span class="activity-time">6:07 AM PST</span>
                                            </div>
                                            <p class="activity-description">Created follow up for lease renewal discussion</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Memo -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="comment-memo" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-sticky-note text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Memo: Added</span>
                                                <span class="activity-time">5:45 AM PST</span>
                                            </div>
                                            <p class="activity-description">Internal note: Resident prefers morning maintenance appointments</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">by Sarah Adams</span>
                                            </div>
                                        </div>
                                    </div>
                </div>

                                <!-- Recent Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 16, 2025</span>
                                    </div>
                                    
                                    <!-- Email -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">2:08 PM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Important: Payment Due Reminder</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via CRM Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-wrench text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Created</span>
                                                <span class="activity-time">10:15 AM PST</span>
                                            </div>
                                            <p class="activity-description">WO #26145: Refrigerator is not working (Appliances)</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Medium Priority • by Melinda Michaels</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Appointment Scheduled -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="appointment" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-calendar-check text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Appointment: Scheduled</span>
                                                <span class="activity-time">9:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">Refrigerator repair appointment scheduled for Aug 17, 9:00 AM</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Maintenance Team • Confirmed</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Additional Recent Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 15, 2025</span>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">8:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">August rent payment - $2,000.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • On time</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="chat" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-comments text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Chat: Incoming</span>
                                                <span class="activity-time">7:15 AM PST</span>
                                            </div>
                                            <p class="activity-description">Resident inquiry about parking policy</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via Resident Portal</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 14 Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 14, 2025</span>
                                    </div>
                                    
                                    <!-- Work Order Update -->
                                    <div class="activity-item" data-filter="work-orders" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-wrench text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: In Progress</span>
                                                <span class="activity-time">3:45 PM PST</span>
                                            </div>
                                            <p class="activity-description">WO #26145: Technician arrived, diagnosing refrigerator issue</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Assigned to Mike Johnson</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Email Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">11:20 AM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Work Order Schedule Confirmation</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">by Sarah Adams</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 13 Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 13, 2025</span>
                                    </div>
                                    
                                    <!-- Phone Call -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="call" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-phone text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Call: Outgoing</span>
                                                <span class="activity-time">4:30 PM PST</span>
                                            </div>
                                            <p class="activity-description">Follow-up call regarding maintenance request</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Duration: 8 minutes • by Sarah Adams</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- System Generated Notice -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">9:00 AM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Monthly Community Newsletter</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 12 Activities -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 12, 2025</span>
                                    </div>
                                    
                                    <!-- Lease Activity -->
                                    <div class="activity-item" data-filter="lease" data-time="recent" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-file-contract text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Lease Update</span>
                                                <span class="activity-time">2:15 PM PST</span>
                                            </div>
                                            <p class="activity-description">Emergency contact information updated</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Maintenance Request -->
                                    <div class="activity-item" data-filter="work-orders" data-time="recent" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-tools text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Maintenance Request</span>
                                                <span class="activity-time">10:45 AM PST</span>
                                            </div>
                                            <p class="activity-description">Request for air conditioning inspection</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Submitted by Resident</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Hidden Activities (Initially hidden) -->
                                <div id="hidden-activities" class="hidden">
                                
                                <!-- Aug 10, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 10, 2025</span>
                                    </div>
                                    
                                    <!-- Community Event -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="event" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-calendar-alt text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Event: Scheduled</span>
                                                <span class="activity-time">5:00 PM PST</span>
                                            </div>
                                            <p class="activity-description">Community BBQ Event - August 20th</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Community Newsletter</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Inspection -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-clipboard-check text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Annual Inspection</span>
                                                <span class="activity-time">1:30 PM PST</span>
                                            </div>
                                            <p class="activity-description">Unit inspection completed - No issues found</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Inspector: John Martinez</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Jul 15, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Jul 15, 2025</span>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">8:15 AM PST</span>
                                            </div>
                                            <p class="activity-description">July rent payment - $2,000.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • On time</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-tools text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Completed</span>
                                                <span class="activity-time">2:20 PM PST</span>
                                            </div>
                                            <p class="activity-description">WO #25890: HVAC filter replacement completed</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Maintenance Team</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Jun 20, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Jun 20, 2025</span>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="text" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-sms text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Text: Received</span>
                                                <span class="activity-time">6:45 PM PST</span>
                                            </div>
                                            <p class="activity-description">Resident reported noise complaint - resolved</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via SMS Portal</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- May 10, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">May 10, 2025</span>
                                    </div>
                                    
                                    <!-- Lease Update -->
                                    <div class="activity-item" data-filter="lease" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-file-contract text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Lease Amendment</span>
                                                <span class="activity-time">11:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">Pet policy addendum signed</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Legal Department</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">8:00 AM PST</span>
                                            </div>
                                            <p class="activity-description">May rent payment - $2,000.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • On time</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Oct 1, 2024 - Lease Renewal -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Oct 1, 2024</span>
                                    </div>
                                    
                                    <!-- Lease Renewal #4 Milestone -->
                                    <div class="activity-item milestone-item" data-filter="milestones" data-time="1year" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-key text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Lease Renewal #4</span>
                                                <span class="activity-time">Oct 1, 2024</span>
                                            </div>
                                            <p class="activity-description">Renewed lease for 12-month term through Sep 30, 2025</p>
                                            <div class="activity-meta">
                                                <span class="text-sm ">✓ Active Lease</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Oct 1, 2023 - Previous Lease Renewal -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Oct 1, 2023</span>
                                    </div>
                                    
                                    <!-- Lease Renewal #3 Milestone -->
                                    <div class="activity-item milestone-item" data-filter="milestones" data-time="1year" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-sync text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Lease Renewal #3</span>
                                                <span class="activity-time">Oct 1, 2023</span>
                                            </div>
                                            <p class="activity-description">Renewed lease for 12-month term</p>
                                            <div class="activity-meta">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Jul 15, 2022 - Regular Activity Example -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Jul 15, 2022</span>
                                    </div>
                                    
                                    <!-- Payment Received -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">9:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">Rent payment for July 2022 - $2,000.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • On time</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Mar 10, 2021 - Regular Activity Example -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Mar 10, 2021</span>
                                    </div>
                                    
                                    <!-- Work Order Completed -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-check text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Completed</span>
                                                <span class="activity-time">2:45 PM PST</span>
                                            </div>
                                            <p class="activity-description">WO #18392: Kitchen faucet repair completed</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Maintenance Team • Satisfied</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Oct 2, 2020 - Move-in -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Oct 2, 2020</span>
                                    </div>
                                    
                                    <!-- Move-in Milestone -->
                                    <div class="activity-item milestone-item" data-filter="milestones" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-home text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Move-in Date</span>
                                                <span class="activity-time">Oct 2, 2020</span>
                                            </div>
                                            <p class="activity-description">Initial move-in to Unit 288 at Cityview Towers</p>
                                            <div class="activity-meta">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Sep 15, 2020 - Lease Signing -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Sep 15, 2020</span>
                                    </div>
                                    
                                    <!-- Lease Signing Milestone -->
                                    <div class="activity-item milestone-item" data-filter="milestones" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-file-signature text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Lease Signed</span>
                                                <span class="activity-time">Sep 15, 2020</span>
                                            </div>
                                            <p class="activity-description">Initial lease agreement signed for 12-month term</p>
                                            <div class="activity-meta">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Sep 10, 2020 - Application Approved -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Sep 10, 2020</span>
                                    </div>
                                    
                                    <!-- Application Approved Milestone -->
                                    <div class="activity-item milestone-item" data-filter="milestones" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-check-circle text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Application Approved</span>
                                                <span class="activity-time">Sep 10, 2020</span>
                                            </div>
                                            <p class="activity-description">Rental application approved after background and credit check</p>
                                            <div class="activity-meta">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 9, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 9, 2025</span>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">7:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">Late fee payment - $75.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Credit Card • Processed</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">6:00 AM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Payment Confirmation - Late Fee</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 8, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 8, 2025</span>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-wrench text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Created</span>
                                                <span class="activity-time">3:45 PM PST</span>
                                            </div>
                                            <p class="activity-description">WO #26089: Bathroom sink drain clogged</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Low Priority • by Maintenance Team</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="chat" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-comments text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Chat: Incoming</span>
                                                <span class="activity-time">11:20 AM PST</span>
                                            </div>
                                            <p class="activity-description">Inquiry about pool maintenance schedule</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via Resident Portal</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Appointment Rescheduling -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="appointment" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-calendar-check text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Appointment: Rescheduled</span>
                                                <span class="activity-time">9:15 AM PST</span>
                                            </div>
                                            <p class="activity-description">Maintenance appointment rescheduled via text message</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via SMS Portal</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 7, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 7, 2025</span>
                                    </div>
                                    
                                    <!-- Follow-up -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="follow-up" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-user-clock text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Follow-Up - Created</span>
                                                <span class="activity-time">5:30 PM PST</span>
                                            </div>
                                            <p class="activity-description">Schedule follow-up for noise complaint resolution</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">CRM Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Email -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">2:20 PM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Lease Renewal Options Available</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">by Property Manager</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 6, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 6, 2025</span>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-tools text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Completed</span>
                                                <span class="activity-time">4:00 PM PST</span>
                                            </div>
                                            <p class="activity-description">WO #26001: Carpet cleaning service completed</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Cleaning Service • Scheduled</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="call" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-phone text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Call: Incoming</span>
                                                <span class="activity-time">1:15 PM PST</span>
                                            </div>
                                            <p class="activity-description">Question about community event parking</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Duration: 5 minutes</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 5, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 5, 2025</span>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">8:45 AM PST</span>
                                            </div>
                                            <p class="activity-description">Utility bill payment - $120.50</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • Utilities</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Text Message -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="text" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-sms text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Text: Sent</span>
                                                <span class="activity-time">7:00 AM PST</span>
                                            </div>
                                            <p class="activity-description">Reminder: Monthly pest control service scheduled</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">CRM Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 4, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 4, 2025</span>
                                    </div>
                                    
                                    <!-- Communication -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">4:30 PM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: August Community Newsletter</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-wrench text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: In Progress</span>
                                                <span class="activity-time">11:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">WO #25978: Kitchen cabinet hinge repair</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Assigned to Tony Rodriguez</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 3, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 3, 2025</span>
                                    </div>
                                    
                                    <!-- Chat -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="chat" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-comments text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Chat: Incoming</span>
                                                <span class="activity-time">6:20 PM PST</span>
                                            </div>
                                            <p class="activity-description">Request for gym equipment maintenance update</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">via Resident Portal</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Follow-up -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="follow-up" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-user-clock text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Follow-Up - Completed</span>
                                                <span class="activity-time">2:45 PM PST</span>
                                            </div>
                                            <p class="activity-description">Confirmed satisfaction with balcony door repair</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">System Generated</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 2, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 2, 2025</span>
                                    </div>
                                    
                                    <!-- Email -->
                                    <div class="activity-item" data-filter="communications" data-communication-type="email" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Email: Sent</span>
                                                <span class="activity-time">3:10 PM PST</span>
                                            </div>
                                            <p class="activity-description">Subject: Work Order Status Update - Balcony Door</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">by Sarah Adams</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">9:20 AM PST</span>
                                            </div>
                                            <p class="activity-description">Pet deposit payment - $300.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Credit Card • Pet Policy</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Aug 1, 2025 -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Aug 1, 2025</span>
                                    </div>
                                    
                                    <!-- Payment -->
                                    <div class="activity-item" data-filter="payments" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-dollar-sign text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Payment Received</span>
                                                <span class="activity-time">8:00 AM PST</span>
                                            </div>
                                            <p class="activity-description">August rent payment - $2,000.00</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">ACH Transfer • On time</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Work Order -->
                                    <div class="activity-item" data-filter="work-orders" data-time="all" data-activity-type="user">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-tools text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type">Work Order: Created</span>
                                                <span class="activity-time">7:30 AM PST</span>
                                            </div>
                                            <p class="activity-description">WO #25912: Balcony sliding door sticking</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Medium Priority • Reported by Resident</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Sep 5, 2020 - Application Submitted -->
                                <div class="activity-section">
                                    <div class="activity-date-header">
                                        <i class="fas fa-circle text-muted text-sm mr-2"></i>
                                        <span class="font-semibold ">Sep 5, 2020</span>
                                    </div>
                                    
                                    <!-- Application Submitted Milestone -->
                                    <div class="activity-item milestone-item" data-filter="milestones" data-time="all" data-activity-type="system">
                                        <div class="activity-icon bg-primary-light">
                                            <i class="fas fa-file-alt text-primary"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-header">
                                                <span class="activity-type font-semibold">Application Submitted</span>
                                                <span class="activity-time">Sep 5, 2020</span>
                                            </div>
                                            <p class="activity-description">Initial rental application submitted for Unit 288</p>
                                            <div class="activity-meta">
                                                <span class="text-sm text-muted">Online application portal</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                </div> <!-- End hidden-activities -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Load More Section - Outside card-content -->
                        <div class="load-more-section text-center py-4" id="load-more-section" style="background: #f8f9fa; border-top: 1px solid #e5e7eb; position: relative; z-index: 100; display: block !important; visibility: visible !important;">
                            <button class="btn btn-light" onclick="toggleActivities()" id="toggle-activities-btn">
                                <i class="fas fa-chevron-down mr-2" id="toggle-activities-icon"></i>
                                <span id="toggle-activities-text">Load more activities</span>
                            </button>
                        </div>
                        
                                </div>
            </div>
        </div>

            <!-- Ledger View (Hidden by default) -->
            <div id="ledger-view" class="container py-6 mx-auto" style="display: none;">
                
                <!-- Page Title -->
                <div class="mb-6 flex items-center justify-between">
                    <h1 class="text-2xl font-semibold ">Ledger</h1>
                    <div class="flex items-center gap-3">
                        <button class="btn btn-light">
                            <i class="fas fa-circle-plus mr-2"></i>
                            Add charge
                                        </button>
                        <button class="btn btn-light">
                            <i class="fas fa-credit-card mr-2"></i>
                            Receive payment
                                        </button>
                                    </div>
                                </div>

                        <!-- Account Summary Cards -->
            <div class="mb-8">
				<div class="grid grid-cols-1 md:grid-cols-5 gap-6">
					<div class="card card-shadow-static">
						<div class="card-content text-center">
							<div class="text-2xl font-bold ">$2,809.50</div>
							<div class="text-muted">Outstanding balance</div>
						</div>
					</div>
					<div class="card card-shadow-static">
						<div class="card-content text-center">
							<div class="text-2xl font-bold ">98% on-time</div>
							<div class="text-muted">Payment performance</div>
						</div>
					</div>
					<div class="card card-shadow-static">
						<div class="card-content text-center">
							<div class="text-2xl font-bold ">Aug 16, 2025</div>
							<div class="text-muted">Last payment</div>
						</div>
					</div>
					<div class="card card-shadow-static">
						<div class="card-content text-center">
							<div class="text-2xl font-bold ">3 days early</div>
							<div class="text-muted">Average payment time</div>
						</div>
					</div>
					<div class="card card-shadow-static">
						<div class="card-content text-center">
							<div class="text-2xl font-bold ">Sep 1, 2025</div>
							<div class="text-muted">Next due date</div>
						</div>
					</div>
				</div>
            </div>



            <!-- Filters and Controls -->
            <div class="flex items-center justify-between gap-4 mb-6">
                <div class="flex items-center gap-4">
                    <!-- Search Box -->
                    <div class="flex-1 min-w-[300px]">
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" placeholder="Search transactions..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus-ring-primary">
                        </div>
                    </div>
                    
                    <!-- Tab-style Filters -->
                    <div class="flex items-center gap-2">
                        <button id="filter-all" class="tab-filter active px-4 py-2 rounded-full font-medium transition-colors" onclick="setExclusiveLedgerFilter('all')">
                            All
                        </button>
                        <button id="filter-unpaid" class="tab-filter px-4 py-2 rounded-full font-medium transition-colors" onclick="setExclusiveLedgerFilter('unpaid')">
                            Unpaid charges
                        </button>
                        <button id="filter-processing" class="tab-filter px-4 py-2 rounded-full font-medium transition-colors" onclick="setExclusiveLedgerFilter('processing')">
                            Processing payments
                        </button>
                        <button id="filter-hap" class="tab-filter px-4 py-2 rounded-full font-medium transition-colors" onclick="setExclusiveLedgerFilter('hap')">
                            HAP
                        </button>
                        <button id="filter-not-hap" class="tab-filter px-4 py-2 rounded-full font-medium transition-colors" onclick="setExclusiveLedgerFilter('not-hap')">
                            Not HAP
                        </button>
                    </div>
                </div>
                
                <!-- Kebab Menu -->
                <div class="relative">
                    <button id="ledger-kebab-btn" class="btn btn-light kebab-menu" onclick="toggleLedgerKebab()">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <div id="ledger-kebab-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-50 hidden">
                        <div class="py-1">
                            <a href="#" class="block px-4 py-2  hover:bg-gray-100" onclick="exportToExcel()">
                                <i class="fas fa-file-excel mr-2 text-muted"></i>
                                Export to Excel
                            </a>
                            <a href="#" class="block px-4 py-2  hover:bg-gray-100" onclick="exportToPDF()">
                                <i class="fas fa-file-pdf mr-2 text-muted"></i>
                                Export to PDF
                            </a>
                            <a href="#" class="block px-4 py-2  hover:bg-gray-100" onclick="emailReport()">
                                <i class="fas fa-envelope mr-2 text-muted"></i>
                                Email report
                            </a>
                            <a href="#" class="block px-4 py-2  hover:bg-gray-100" onclick="printLedger()">
                                <i class="fas fa-print mr-2 text-muted"></i>
                                Print ledger
                            </a>
                        </div>
                    </div>
                </div>
                </div>

                        <!-- Ledger Table -->
            <div class="">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left font-bold text-muted tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('date')">
                                    <div class="flex items-center gap-2">
                                        Date
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="px-6 py-3 text-left font-bold text-muted tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('description')">
                                    <div class="flex items-center gap-2">
                                        Description
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="px-6 py-3 text-center font-bold text-muted tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('status')">
                                    <div class="flex items-center justify-center gap-2">
                                        Status
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="px-6 py-3 text-right font-bold text-muted tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('charges')">
                                    <div class="flex items-center justify-end gap-2">
                                        Charges
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="px-6 py-3 text-right font-bold text-muted tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('payments')">
                                    <div class="flex items-center justify-end gap-2">
                                        Payments
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                                <th class="px-6 py-3 text-right font-bold text-muted tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('balance')">
                                    <div class="flex items-center justify-end gap-2">
                                        Balance
                                        <i class="fas fa-sort text-sm text-gray-400"></i>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <!-- Current Outstanding -->
                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">Aug 17, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">Late Fee - Rent (July 2025)</div>
                                        <div class="text-sm text-muted">Applied after 5-day grace period • Code: latefee • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613267')">C-613267</a></div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">Unpaid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right font-medium ">$75.00</td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-bold ">$2,674.50</td>
                                </tr>
                                
                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">Aug 16, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">ACH Payment - Partial</div>
                                        <div class="text-sm text-muted">Bank: Wells Fargo ***4521 • Code: achpay • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613256')">C-613256</a></div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">Processing</span>
                                    </td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-medium ">$1,337.25</td>
                                    <td class="px-6 py-4 text-right font-bold">$2,599.50</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">Aug 1, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">Rent (Residential) - August 2025</div>
                                        <div class="text-sm text-muted">Monthly rent charge • Code: rentres • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613245')">C-613245</a></div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">Unpaid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right font-medium ">$2,000.00</td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-bold">$3,936.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">Jul 6, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">Late Fee - Rent (June 2025)</div>
                                        <div class="text-sm text-muted">Applied after 5-day grace period • Code: latefee • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613234')">C-613234</a></div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">Unpaid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right font-medium ">$75.00</td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-bold ">$1,936.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">Jul 1, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">Rent (Residential) - July 2025</div>
                                        <div class="text-sm text-muted">Monthly rent charge • Code: rentres • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613223')">C-613223</a></div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">Unpaid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right font-medium ">$2,000.00</td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-bold ">$1,861.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">Jun 30, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">ACH Payment - June Rent</div>
                                        <div class="text-sm text-muted">Bank: Wells Fargo ***4521 • Code: achpay</div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-medium ">$2,000.00</td>
                                    <td class="px-6 py-4 text-right font-bold">-$138.25</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">Jun 15, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">Pet Fee - Monthly (Luna & Whiskers)</div>
                                        <div class="text-sm text-muted">2 pets × $15/month • Code: petfee</div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">Unpaid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right font-medium ">$30.00</td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-bold">$1,861.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">Jun 1, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">Rent (Residential) - June 2025</div>
                                        <div class="text-sm text-muted">Monthly rent charge • Code: rentres</div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right font-medium ">$2,000.00</td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-bold">$1,831.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">Jun 3, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">HAP Payment - June 2025</div>
                                        <div class="text-sm text-muted">Housing Assistance Program payment • Code: hap • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613190')">C-613190</a></div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-medium ">$1,200.00</td>
                                    <td class="px-6 py-4 text-right font-bold ">$631.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">May 1, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">Section 8 Rent Subsidy - May 2025</div>
                                        <div class="text-sm text-muted">Housing voucher payment • Code: s8subsidy • Control: <a href="#" class="text-primary hover:text-primary-dark" onclick="viewTransactionDetails('C-613179')">C-613179</a></div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-medium ">$1,150.00</td>
                                    <td class="px-6 py-4 text-right font-bold ">$631.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row hidden" data-page="2">
                                    <td class="px-6 py-4 ">May 31, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">ACH Payment - May Rent</div>
                                        <div class="text-sm text-muted">Bank: Wells Fargo ***4521 • Code: achpay</div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-medium ">$2,030.00</td>
                                    <td class="px-6 py-4 text-right font-bold">-$168.25</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">May 15, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">Pet Fee - Monthly (Luna & Whiskers)</div>
                                        <div class="text-sm text-muted">2 pets × $15/month • Code: petfee</div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right font-medium ">$30.00</td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-bold">$1,861.75</td>
                                </tr>

                                <tr class="hover:bg-gray-50 table-row hidden" data-page="2">
                                    <td class="px-6 py-4 ">May 1, 2025</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">Rent (Residential) - May 2025</div>
                                        <div class="text-sm text-muted">Monthly rent charge • Code: rentres</div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Paid</span>
                                    </td>
                                    <td class="px-6 py-4 text-right font-medium ">$2,000.00</td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-bold">$1,831.75</td>
                                </tr>

                                <!-- Starting Balance for 2025 -->
                                <tr class="hover:bg-gray-50 table-row" data-page="1">
                                    <td class="px-6 py-4 ">Dec 31, 2024</td>
                                    <td class="px-6 py-4">
                                        <div class="font-medium ">Balance Forward</div>
                                        <div class="text-sm text-muted">Carried from previous year • Code: balance</div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800">Carried forward</span>
                                    </td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right">-</td>
                                    <td class="px-6 py-4 text-right font-bold">-$168.25</td>
                                </tr>
                            </tbody>
                        </table>
            </div>
        </div>

        <!-- Pagination -->
        <div class="flex items-center justify-center mt-8 gap-6">
            <!-- Pagination Controls -->
            <div class="flex items-center gap-1">
                <!-- Previous Button -->
                <button class="pagination-prev w-8 h-8 flex items-center justify-center border border-gray-300 rounded text-gray-400 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled onclick="previousPage()">
                    <i class="fas fa-chevron-left text-sm"></i>
                </button>
                
                <!-- Page Numbers -->
                <button class="pagination-page w-8 h-8 border border-primary bg-primary text-white rounded" data-page="1" onclick="goToPage(1)">1</button>
                <button class="pagination-page w-8 h-8 border border-gray-300  hover:bg-gray-50 rounded" data-page="2" onclick="goToPage(2)">2</button>
                
                <!-- Next Button -->
                <button class="pagination-next w-8 h-8 flex items-center justify-center border border-gray-300 rounded  hover:bg-gray-50" onclick="nextPage()">
                    <i class="fas fa-chevron-right text-sm"></i>
                </button>
            </div>
            
            <!-- Records Per Page Selector -->
            <div class="flex items-center gap-2">
                <select class="px-3 py-1 border border-gray-300 rounded bg-white" onchange="changeRecordsPerPage(this.value)">
                    <option value="10" selected>10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <span class="text-muted">per page</span>
            </div>
        </div>

            
        </div>

        </main>
    </div>

    <!-- Outstanding Balance Pageslide -->
    <div class="pageslide-overlay" id="outstanding-balance-overlay">
        <div class="pageslide" id="outstanding-balance">
            <div class="pageslide-header">
                <div class="flex items-start justify-between w-full">
                    <div class="flex items-start gap-2">
                        <div>
                            <h2 class="pageslide-title  font-semibold text-lg mb-1">Outstanding balance</h2>
                                                    <div class="text-muted">
                            <span class="font-medium">$2,809.50 outstanding</span>
							<span class="text-gray-400 mx-1">•</span>
                            <span class="text-red-600 font-medium ml-2">3 past due</span>
							<span class="text-gray-400 mx-1">•</span>
                            <span class="font-medium">2 current</span>
                            <span class="text-gray-400 mx-1">•</span>
                            <span class="font-medium text-yellow-600">1 processing</span>
							<span class="text-gray-400">•</span>
							<i class="fas fa-warning text-red-500 mr-1"></i><span class="text-red-600 font-medium">Do not accept payment</span>
                        </div>
                        </div>
                    </div>
                <button class="pageslide-close">
                    <i class="fas fa-times"></i>
                </button>
                </div>
            </div>
            
            <div class="pageslide-content">
			
				<!-- Search Bar with Action Buttons -->
                <div class="search-container mb-6">
                    <div class="flex items-center gap-3">
                        <!-- Search Field -->
                        <div class="relative flex-1">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input 
                                type="text" 
                                placeholder="Search charges..." 
                                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus-ring-primary"
                            >
                    </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex items-center gap-2">
                            <button class="btn btn-light">
                                <i class="fas fa-credit-card mr-1"></i>
                                Receive payment
                            </button>
                            
                            <button id="kebab-btn-charges" class="btn btn-light kebab-menu">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Pending Payments Section -->
                <div class="pending-payments-section mb-8">
                    <h3 class="section-title mb-0">Processing payments</h3>
                    <p class="text-sm text-muted mb-4">Payments received within 24 hours, not yet posted.</p>
                    
                    <div class="charge-item p-2 rounded-lg" style="border-left: 4px solid #f0c479;">
                        <div class="flex items-center justify-between">
                            <!-- Left Side -->
                            <div class="flex-1">
                                <h4 class="text-base font-semibold  mb-1">Online Payment - Covers July Past Due</h4>
                                <div class="flex items-center gap-3 mb-2">
                                    <span class="font-medium">Today</span>
                                    <span class="text-sm font-mono text-grey-600 bg-gray-100 px-2 py-1 rounded">onlinepay</span>
                                </div>
                            </div>
                            
                            <!-- Right Side -->
                            <div class="flex flex-col items-end gap-2">
                                <div class="text-lg font-bold">-$1,337.25</div>
                                <div class="flex items-center gap-3">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">Processing</span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-3">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-clock text-orange-500"></i>
                                <span class="text-muted">Expected to post within 1-2 business days (covers all past due amounts)</span>
                                </div>
                            </div>
                            </div>
                        </div>

				
                <div class="balance-list-container">
                    <h3 class="section-title mb-0">Outstanding charges</h3>
                    
                    <!-- Balanced List View -->
                    <div class="charges-list-container space-y-4">
                        <!-- Past Due Charges -->
                        <div class="charge-item p-3 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-all duration-200" style="border-left: 4px solid #ef4444;">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <h4 class="text-base font-semibold  mb-1">Rent (Residential) - July 2025</h4>
									<div class="flex items-center gap-3 mb-2">
                                        <span class="text-muted font-medium">Jul 1, 2025</span>
										<span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">rentres</span>
                                </div>
                                    <div class="text-sm text-muted">Tenant portion after HAP subsidy ($692.75)</div>
                            </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold ">$1,337.25</div>
                                    <div class="flex items-center gap-3">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">past due</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="charge-item p-2 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-all duration-200" style="border-left: 4px solid #ef4444;">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <h4 class="text-base font-semibold  mb-1">Pet Fee - Monthly (Luna & Whiskers)</h4>
									<div class="flex items-center gap-3 mb-2">
                                        <span class="text-muted font-medium">Jul 15, 2025</span>
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">petfee</span>
                                </div>
                            </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold ">$30.00</div>
                                    <div class="flex items-center gap-3">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">past due</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Late Fee -->
                        <div class="charge-item p-2 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-all duration-200" style="border-left: 4px solid #ef4444;">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <h4 class="text-base font-semibold  mb-1">Late Fee - Rent (July 2025)</h4>
									<div class="flex items-center gap-3 mb-2">
                                        <span class="text-muted font-medium">Aug 17, 2025</span>
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">latefee</span>
                                </div>
                            </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold ">$75.00</div>
                                    <div class="flex items-center gap-3">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800">past due</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Current Outstanding Charges -->
                        <div class="charge-item p-2 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
									<h4 class="text-base font-semibold  mb-1">Rent (Residential) - August 2025</h4>
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-muted font-medium">Aug 1, 2025</span>
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">rentres</span>
                                </div>
                                    <div class="text-sm text-muted">Tenant portion after HAP subsidy ($692.75)</div>
                            </div>
                                
                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold ">$1,337.25</div>
                                </div>
                            </div>
                        </div>

                        <div class="charge-item p-2 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-all duration-200">
                            <div class="flex items-center justify-between">
                                <!-- Left Side -->
                                <div class="flex-1">
                                    <h4 class="text-base font-semibold  mb-1">Pet Fee - Monthly (Luna & Whiskers)</h4>
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-muted font-medium">Aug 15, 2025</span>
                                        <span class="text-sm font-mono text-muted bg-gray-100 px-2 py-1 rounded">petfee</span>
                    </div>
                </div>

                                <!-- Right Side -->
                                <div class="flex flex-col items-end gap-2">
                                    <div class="text-lg font-bold ">$30.00</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Resident Timeline Pageslide -->
    <div class="pageslide-overlay" id="resident-timeline-overlay">
        <div class="pageslide" id="resident-timeline">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Resident Timeline</h2>
                <button class="pageslide-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <div class="timeline-summary">
                    <div class="timeline-total">
                        <span class="total-label">Total Residency Duration</span>
                        <span class="total-amount">4.2 years</span>
                    </div>
                    <div class="timeline-status">
                        <span>Excellent resident with strong payment history</span>
                    </div>
                </div>

                <div class="timeline-list-container">
                    <h3 class="section-title">Residency Timeline</h3>
                    
                    <div class="timeline-list">
                        <div class="timeline-item scheduled">
                            <div class="timeline-point scheduled">
                                <i class="fas fa-calendar-times"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-date">Oct 31, 2025</span>
                                    <span class="timeline-status-badge scheduled">scheduled</span>
                                </div>
                                <div class="timeline-title">Lease Expires</div>
                                <div class="timeline-description">Current lease agreement expires</div>
                                <div class="timeline-meta">Lease renewal or move-out decision required</div>
                            </div>
                        </div>

                        <div class="timeline-item current">
                            <div class="timeline-point current">
                                <i class="fas fa-home"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-date">May 15, 2021</span>
                                    <span class="timeline-inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">current</span>
                                </div>
                                <div class="timeline-title">Move In</div>
                                <div class="timeline-description">Started residency at Cityview Towers</div>
                                <div class="timeline-meta">Initial Term: 12 months • Monthly Rent: $1,950.00</div>
                            </div>
                        </div>

                        <div class="timeline-item completed">
                            <div class="timeline-point completed">
                                <i class="fas fa-file-signature"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-date">May 10, 2021</span>
                                    <span class="timeline-status-badge completed">completed</span>
                                </div>
                                <div class="timeline-title">Lease Executed</div>
                                <div class="timeline-description">Signed initial lease agreement for Unit 303C</div>
                                <div class="timeline-meta">Lease Start: May 15, 2021 • Security Deposit: $1,950.00</div>
                            </div>
                        </div>

                        <div class="timeline-item completed">
                            <div class="timeline-point completed">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <span class="timeline-date">Apr 25, 2021</span>
                                    <span class="timeline-status-badge completed">completed</span>
                                </div>
                                <div class="timeline-title">Prospect Approved</div>
                                <div class="timeline-description">Rental application approved after background check</div>
                                <div class="timeline-meta">Credit Score: 750 • Income Verification: Approved</div>
                            </div>
                        </div>
                    </div>
                </div>



                <div class="timeline-notes">
                    <h3 class="section-title">Residency Notes</h3>
                    <div class="note-item">
                        <strong>Payment History:</strong> Consistently pays on time, never had late fees
                    </div>
                    <div class="note-item">
                        <strong>Lease Renewals:</strong> Renewed lease 4 times without issues
                    </div>
                    <div class="note-item">
                        <strong>Next Milestone:</strong> Current lease expires October 31, 2025 - renewal decision needed
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment History Pageslide -->
    <div class="pageslide-overlay" id="payment-history-overlay">
        <div class="pageslide" id="payment-history">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Payment History</h2>
                <button class="pageslide-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <div class="payment-summary">
                    <div class="payment-total">
                        <span class="total-label">Payment Performance</span>
                        <span class="total-amount">98% On-Time</span>
                    </div>
                    <div class="payment-status">
                        <span>Showing 2 most recent payments - excellent payment history with 2 late payments out of 51 total</span>
                    </div>
                </div>

                <div class="payment-list-container">
                    <h3 class="section-title">Recent Payment Activity</h3>
                    
                    <div class="payment-list">
                        <div class="payment-item">
                            <div class="payment-item-header">
                                <span class="payment-date">Jun 30, 2025</span>
                                <div class="payment-header-right">
                                    <span class="payment-balance">$2,126.60</span>
                                </div>
                            </div>
                            <div class="payment-item-details">
                                <div class="payment-description">Payment Received - Check #1234</div>
                                <div class="payment-meta">
                                    <span class="payment-code">chk# 1234</span>
                                    <span class="payment-control">R-140811</span>
                                </div>
                            </div>
                        </div>

                        <div class="payment-item">
                            <div class="payment-item-header">
                                <span class="payment-date">May 30, 2025</span>
                                <div class="payment-header-right">
                                    <span class="payment-balance">$1,890.50</span>
                                </div>
                            </div>
                            <div class="payment-item-details">
                                <div class="payment-description">Payment Received - Online Payment</div>
                                <div class="payment-meta">
                                    <span class="payment-code">ACH Transfer</span>
                                    <span class="payment-control">R-139842</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="payment-quick-actions">
                    <button class="payment-quick-btn">
                        <i class="fas fa-print"></i>
                        <span>Print</span>
                    </button>
                    <button class="payment-quick-btn">
                        <i class="fas fa-envelope"></i>
                        <span>Email</span>
                    </button>
                </div>

                <div class="payment-actions">
                    <button class="payment-action-btn primary">
                        <i class="fas fa-credit-card"></i>
                        <span>Receive Payment</span>
                    </button>
                    <button class="payment-action-btn secondary">
                        <i class="fas fa-download"></i>
                        <span>Export Payment History</span>
                    </button>
                </div>

                <div class="payment-notes">
                    <h3 class="section-title">Payment Notes</h3>
                    <div class="note-item">
                        <strong>Payment Method:</strong> Usually pays by check, occasionally online
                    </div>
                    <div class="note-item">
                        <strong>On-Time Rate:</strong> 98% - only 2 late payments in 4.2 years
                    </div>
                    <div class="note-item">
                        <strong>Current Status:</strong> Outstanding balance of $2,809.50 - positive payment history overall
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Journey Pageslide -->
    <div class="pageslide-overlay" id="customer-journey-overlay">
        <div class="pageslide customer-journey">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Customer Journey</h2>
                <button class="pageslide-close" onclick="closePageslide('customer-journey')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <!-- Journey Summary -->
                <div class="journey-summary-section">
                    <div class="journey-overview">
                        <div class="journey-stats">
                            <div class="journey-stat">
                                <span class="stat-number">4</span>
                                <span class="stat-label">Properties</span>
                            </div>
                            <div class="journey-stat">
                                <span class="stat-number">4.2</span>
                                <span class="stat-label">Years Active</span>
                            </div>
                            <div class="journey-stat">
                                <span class="stat-number">98%</span>
                                <span class="stat-label">On-Time Rate</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Property History -->
                <div class="journey-history">
                    <h3 class="section-title">Property History</h3>
                    <div class="journey-timeline">
                        <div class="journey-item detailed">
                            <div class="journey-point current"></div>
                            <div class="journey-content">
                                <div class="journey-header">
                                    <span class="journey-property">Cityview Towers</span>
                                    <span class="journey-status current-status">current resident</span>
                                </div>
                                <div class="journey-details">
                                    <div class="journey-date">2025 - Present</div>
                                    <div class="journey-meta">
                                        <span class="unit-info">Unit: 303C</span>
                                        <span class="lease-info">Month to month lease</span>
                                    </div>
                                    <div class="journey-notes">
                                        Current resident with outstanding balance. Generally reliable payment history.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="journey-item detailed">
                            <div class="journey-point prospect"></div>
                            <div class="journey-content">
                                <div class="journey-header">
                                    <span class="journey-property">Pacific Oaks</span>
                                    <span class="journey-status prospect-status">Prospect</span>
                                </div>
                                <div class="journey-details">
                                    <div class="journey-date">2023</div>
                                    <div class="journey-meta">
                                        <span class="unit-info">Inquired about 1BR units</span>
                                    </div>
                                    <div class="journey-notes">
                                        Applied but decided not to proceed with lease.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="journey-item detailed">
                            <div class="journey-point prospect"></div>
                            <div class="journey-content">
                                <div class="journey-header">
                                    <span class="journey-property">Sumida Gardens</span>
                                    <span class="journey-status prospect-status">Prospect</span>
                                </div>
                                <div class="journey-details">
                                    <div class="journey-date">2022</div>
                                    <div class="journey-meta">
                                        <span class="unit-info">Inquired about 2BR units</span>
                                    </div>
                                    <div class="journey-notes">
                                        Completed application but was not approved due to credit score.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="journey-item detailed">
                            <div class="journey-point former"></div>
                            <div class="journey-content">
                                <div class="journey-header">
                                    <span class="journey-property">Gardenview Terrace</span>
                                    <span class="journey-status resident-status">Former Resident</span>
                                </div>
                                <div class="journey-details">
                                    <div class="journey-date">2019 - 2022</div>
                                    <div class="journey-meta">
                                        <span class="unit-info">Unit: 204A</span>
                                        <span class="lease-info">3-year lease term</span>
                                    </div>
                                    <div class="journey-notes">
                                        Excellent resident history. Left in good standing after lease completion.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Edit Pageslide -->
    <div class="pageslide-overlay" id="contact-edit-overlay">
        <div class="pageslide contact-edit">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Edit Resident Information</h2>
                <button class="pageslide-close" onclick="closePageslide('contact-edit-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <form class="contact-edit-form">
                    <!-- Contact Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Contact information</h3>
                        
                        <div class="form-row">
                            <label class="form-label">Preferred name</label>
                            <div class="form-input-group">
                                <input type="text" class="form-input" value="Mel Michaels" placeholder="Enter preferred name">
                            </div>
						</div>
                        <div class="form-row">
                            <label class="form-label">Email</label>
                            <div class="form-input-group">
                                <input type="email" class="form-input" value="kamala.hakuna@email.com" placeholder="Enter email address">
                                <div class="form-input-icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                            </div>
                            <div class="form-checkbox-group">
                                <input type="checkbox" id="unsubscribe-email" class="form-checkbox">
                                <label for="unsubscribe-email" class="form-checkbox-label">Unsubscribe to all email</label>
                            </div>
                        </div>

                        <div class="form-row">
                            <label class="form-label">Preferred contact method</label>
                            <div class="form-radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="contact-phone" name="preferred-contact" value="phone" class="form-radio">
                                    <label for="contact-phone" class="form-radio-label">Phone</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="contact-email" name="preferred-contact" value="email" class="form-radio">
                                    <label for="contact-email" class="form-radio-label">Email</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="contact-text" name="preferred-contact" value="text" class="form-radio">
                                    <label for="contact-text" class="form-radio-label">Text</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="contact-person" name="preferred-contact" value="in-person" class="form-radio">
                                    <label for="contact-person" class="form-radio-label">In-person</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="contact-none" name="preferred-contact" value="none" class="form-radio" checked>
                                    <label for="contact-none" class="form-radio-label">None</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-row-group">
                            <div class="form-row">
                                <label class="form-label">Cell</label>
                                <div class="phone-input-group">
                                    <select class="country-select">
                                        <option value="US">US</option>
                                    </select>
                                    <input type="tel" class="form-input" value="(555) 123-4567" placeholder="(201) 555-0123">
                                </div>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Home phone</label>
                                <div class="phone-input-group">
                                    <select class="country-select">
                                        <option value="US">US</option>
                                    </select>
                                    <input type="tel" class="form-input" placeholder="(201) 555-0123">
                                </div>
                            </div>
                        </div>

                        <div class="form-row-group">
                            <div class="form-row">
                                <label class="form-label">Office phone</label>
                                <div class="phone-input-group">
                                    <select class="country-select">
                                        <option value="US">US</option>
                                    </select>
                                    <input type="tel" class="form-input" placeholder="(201) 555-0123">
                                </div>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Other phone</label>
                                <div class="phone-input-group">
                                    <select class="country-select">
                                        <option value="US">US</option>
                                    </select>
                                    <input type="tel" class="form-input" placeholder="(201) 555-0123">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Identification Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Identification</h3>
                        
                        <div class="form-row-group">
                            <div class="form-row">
                                <label class="form-label">First name (legal)</label>
                                <input type="text" class="form-input" value="Kamala" placeholder="Enter name">
                            </div>
                            <div class="form-row">
                                <label class="form-label">Middle name (legal)</label>
                                <input type="text" class="form-input" placeholder="Enter name">
                            </div>
                            <div class="form-row">
                                <label class="form-label">Last name (legal)</label>
                                <input type="text" class="form-input" value="Hakuna" placeholder="Enter name">
                            </div>
                        </div>

                        <div class="form-row-group">
                            <div class="form-row">
                                <label class="form-label">Date of birth</label>
                                <input type="text" class="form-input" value="07/14/****" placeholder="MM/DD/YYYY">
                            </div>
                            <div class="form-row">
                                <label class="form-label">US military service member</label>
                                <select class="form-select">
                                    <option value="">Select...</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Address Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Address</h3>
                        
                        <div class="form-row">
                            <label class="form-label">Country <span class="required">*</span></label>
                            <div class="country-input-group">
                                <select class="form-select">
                                    <option value="US" selected>US (United States)</option>
                                </select>
                                <button type="button" class="country-remove-btn">×</button>
                            </div>
                        </div>

                            <div class="form-row">
                            <label class="form-label">Address</label>
                            <input type="text" class="form-input" value="430 S Fairview Avenue 288 Santa Barbara, CA 93117" placeholder="Enter address">
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-light" onclick="closePageslide('contact-edit-overlay')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Roommate Details Pageslide -->
    <div class="pageslide-overlay" id="roommate-details-overlay">
        <div class="pageslide roommate-details">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Roommate details</h2>
                <button class="pageslide-close" onclick="closePageslide('roommate-details-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <div class="space-y-6">
                    
                    <!-- Roommate #1 - Angela Johnson -->
                    <div class="card hover-lift shadow-soft">
                        <div class="card-content">
                            <div class="flex items-start gap-3">
                                <!-- Avatar -->
                                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class=" font-semibold">AJ</span>
                                </div>

                                <!-- Roommate Info -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center gap-3">
                                            <h2 class="text-md font-semibold">Angela Johnson</h2>
                                            <span class="badge bg-amber-100 text-amber-800 text-sm px-2 py-1 rounded-full font-medium">
                                                Application completed
                                            </span>
                                        </div>
                                        <button id="kebab-btn-roommate-angela-pageslide" class="btn btn-light kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
									<div class="flex items-center gap-2 text-muted mb-2">
										<span>Preferred name: Ann Johnson</span><span class="text-muted">•</span><span>r112345</span>
									</div>
                                    
                                    <!-- Contact Information -->
                                    <div class="space-y-1 mb-2">
                                        <div class="flex items-center gap-2">
                                            <span class="">(555) 234-5678</span>
                                            <i class="fas fa-phone text-link cursor-pointer" title="Call"></i>
                                            <i class="fas fa-mobile-alt text-link cursor-pointer" title="Mobile"></i>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="">angela.johnson@email.com</span>
                                            <i class="fas fa-envelope text-link cursor-pointer" title="Send email"></i>
                                        </div>
                                    </div>
									
									<!-- Badges -->
                                    <div class="flex items-center gap-2 mb-4">
                                        <span class="badge bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded-full font-medium">
                                            lessee
                                        </span>
                                        <span class="badge bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded-full font-medium">
                                            adult
                                        </span>
                                    </div>
                                    
                                    <!-- Emergency Contact Section -->
                                    <div class="mt-4 pt-3 border-t border-gray-100">
                                        <div class="flex items-center gap-2 mb-2">
                                            <i class="fas fa-user-shield text-muted"></i>
                                            <span class="font-medium">Emergency contact</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span>Sarah Johnson</span>
                                            <span class="text-muted">(mother)</span>
                                            <div class="flex items-center gap-3">
                                                <span class="tooltip-black">
                                                    <i class="fas fa-phone text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Call</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-mobile-alt text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Text</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-envelope text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Email</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                   
									
                                    <!-- RentCafe Registration Section -->
                                    <div class="mt-6 pt-4 mb-6 pb-4 border-t border-b border-gray-100">
                                        <div class="flex items-center justify-between">
                                            <span class="font-medium ">RentCafe registration</span>
                                            <div class="flex items-center space-x-3">
                                                <div class="flex items-center space-x-2">
                                                    <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
                                                    <span class="font-medium text-orange-700" data-field="rentcafe-status-angela">Not registered</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

									<div class="">
										<button class="btn btn-light mr-2">
                                            <i class="fas fa-email mr-1"></i>
                                            Send invitation
                                        </button>
                                        <button class="btn btn-primary">
                                            <i class="fas fa-check mr-1"></i>
                                            Approve application
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Roommate #2 - John Smith -->
                    <div class="card hover-lift shadow-soft">
                        <div class="card-content">
                            <div class="flex items-start gap-3">
                                <!-- Avatar -->
                                <div class="w-10 h-10 bg-primary-light rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-blue-600 font-semibold">JS</span>
                                </div>

                                <!-- Roommate Info -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center gap-3">
                                            <h2 class="text-md font-weight-bold">John Smith</h2>
                                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">Current</span>
                                        </div>
                                        <button id="kebab-btn-roommate-john-pageslide" class="btn btn-light kebab-menu">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                    </div>
									
									<div class="flex items-center gap-2 text-muted mb-2">
										<span>Preferred name: John Smith</span><span class="text-muted">•</span><span>r112345</span>
                                    </div>
                                    
                                    <!-- Contact Information -->
                                    <div class="space-y-1 mb-2">
                                        <div class="flex items-center gap-2">
                                            <span class="">(555) 345-6789</span>
                                            <i class="fas fa-phone text-link cursor-pointer" title="Call"></i>
                                            <i class="fas fa-mobile-alt text-link cursor-pointer" title="Mobile"></i>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="">john.smith@email.com</span>
                                            <i class="fas fa-envelope text-link cursor-pointer" title="Send email"></i>
                                        </div>
                                    </div>
									
									<!-- Badges -->
                                    <div class="flex items-center gap-2">
                                        <span class="badge bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded-full font-medium">
                                            lessee
                                        </span>
                                        <span class="badge bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded-full font-medium">
                                            adult
                                        </span>
                                    </div>

                                    <!-- Emergency Contact Section -->
                                    <div class="mt-4 pt-3 border-t border-gray-100">
                                        <div class="flex items-center gap-2 mb-2">
                                            <i class="fas fa-user-shield text-muted"></i>
                                            <span class="font-medium">Emergency contact</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span>Robert Smith</span>
                                            <span class="text-muted">(father)</span>
                                            <div class="flex items-center gap-3">
                                                <span class="tooltip-black">
                                                    <i class="fas fa-phone text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Call</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-mobile-alt text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Text</span>
                                                </span>
                                                <span class="tooltip-black">
                                                    <i class="fas fa-envelope text-link cursor-pointer"></i>
                                                    <span class="tooltip-text">Email</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>


                                    <!-- RentCafe registration Section -->
                                    <div class="mt-6 pt-4 border-t border-gray-100">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="font-medium ">RentCafe registration</span>
                                            <div class="flex items-center space-x-3">
                                                <div class="flex items-center space-x-2">
                                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                                    <span class="font-medium text-green-700" data-field="rentcafe-status-john">Registered</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <p class="text-sm text-muted" data-field="rentcafe-date-john">Registered on January 8, 2024
                                            <span class="text-gray-400">•</span>
                                            Account verified</p>
                                            <div class="flex items-center gap-1">
                                                <a href="#" class="btn btn-link btn-sm font-weight-normal">
                                                    <i class="fas fa-external-link-alt text-sm ml-1"></i> Preview account
                                                </a>
                                                <button id="kebab-btn-rentcafe-john" class="btn btn-link btn-sm">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Roommate Button -->
                    <div class="add-pet-section">
                        <button class="font-medium px-3 py-1" onclick="addNewRoommate()">
                            <i class="fas fa-plus mr-2"></i>
                            Add Roommate
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Floating Kebab Dropdown - Angela Johnson (outside all containers) -->
    <div id="kebab-dropdown-roommate-angela" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-pen mr-2 text-muted"></i>
            Edit details
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-check mr-2 text-muted"></i>
            Approve application
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-paper-plane mr-2 text-muted"></i>
            Send invitation
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user mr-2 text-muted"></i>
            View customer record
        </button>
        <hr class="my-1 border-gray-200">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-red-50  transition-colors">
            <i class="fas fa-times text-red-500 mr-2"></i>
            Remove roommate
        </button>
    </div>

    <!-- Floating Kebab Dropdown - John Smith (outside all containers) -->
    <div id="kebab-dropdown-roommate-john" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-pen mr-2 text-muted"></i>
            Edit details
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user-plus mr-2 text-muted"></i>
            Promote roommate
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user mr-2 text-muted"></i>
            View customer record
        </button>
        <hr class="my-1 border-gray-200">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-red-50  transition-colors">
            <i class="fas fa-times text-red-500 mr-2"></i>
            Remove roommate
        </button>
    </div>

    <!-- Pet Details Pageslide -->
    <div class="pageslide-overlay" id="pet-details-overlay">
        <div class="pageslide pet-details">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Pet Details</h2>
                <button class="pageslide-close" onclick="closePageslide('pet-details-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <div class="space-y-4">
                    
                    <!-- Pet #1 - Blue (Dog) -->
                    <div class="card shadow-sm">
                        <div class="card-header pb-0 border-0">
                            <div class="flex items-center justify-between w-full">
                                <div class="flex items-center gap-3">
                                    <div class="pet-avatar">
                                        <i class="fas fa-dog  text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="pet-name">Blue</h3>
                                        <span class="pet-type">Dog</span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-light btn-sm" onclick="editPet('Blue')">
                                        <i class="fas fa-pen"></i>
                                    </button>
                                    <button class="btn btn-light btn-sm" onclick="deletePet('Blue')">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-content">
                            <div class="pet-metadata">
                                <div class="pet-primary-info">
                                    Jack Russell Terrier • Male • 2 years old
                                </div>
                                <div class="pet-secondary-info">
                                    Weight: 10 lbs • Spayed/Neutered: Yes • Service Animal: No
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pet #2 - Cat (example) -->
                    <div class="card shadow-sm">
                        <div class="card-header pb-0 border-0">
                            <div class="flex items-center justify-between w-full">
                                <div class="flex items-center gap-3">
                                    <div class="pet-avatar">
                                        <i class="fas fa-cat  text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="pet-name">Whiskers</h3>
                                        <span class="pet-type">Cat</span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-light btn-sm" onclick="editPet('Whiskers')">
                                        <i class="fas fa-pen"></i>
                                    </button>
                                    <button class="btn btn-light btn-sm" onclick="deletePet('Whiskers')">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-content">
                            <div class="pet-metadata">
                                <div class="pet-primary-info">
                                    Domestic Shorthair • Female • 3 years old
                                </div>
                                <div class="pet-secondary-info">
                                    Weight: 8 lbs • Spayed/Neutered: Yes • Service Animal: No
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Pet Button -->
                    <div class="add-pet-section">
                        <button class="btn font-medium" onclick="addNewPet()">
                            <i class="fas fa-plus mr-2"></i>
                            Add Pet
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Vehicle Details Pageslide -->
    <div class="pageslide-overlay" id="vehicle-details-overlay">
        <div class="pageslide vehicle-details">
            <div class="pageslide-header">
                <h2 class="pageslide-title">Vehicle Details</h2>
                <button class="pageslide-close" onclick="closePageslide('vehicle-details-overlay')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="pageslide-content">
                <div class="space-y-4">
                    
                    <!-- Vehicle #1 - Honda Civic -->
                    <div class="card shadow-sm">
                        <div class="card-header pb-0 border-0">
                            <div class="flex items-center justify-between w-full">
                                <div class="flex items-center gap-3">
                                    <div class="vehicle-avatar">
                                        <i class="fas fa-car  text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="vehicle-name">2019 Honda Civic</h3>
                                        <span class="vehicle-plate">License: ABC-1234 • CA</span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-light btn-sm" onclick="editVehicle('2019 Honda Civic')">
                                        <i class="fas fa-pen"></i>
                                    </button>
                                    <button class="btn btn-light btn-sm" onclick="deleteVehicle('2019 Honda Civic')">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-content">
                            <div class="vehicle-metadata">
                                <div class="font-medium">
                                    Honda • Civic • 2019
                                </div>
                                <div class="text-muted">
                                    Color: White
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vehicle #2 - Toyota RAV4 -->
                    <div class="card shadow-sm">
                        <div class="card-header pb-0 border-0">
                            <div class="flex items-center justify-between w-full">
                                <div class="flex items-center gap-3">
                                    <div class="vehicle-avatar">
                                        <i class="fas fa-car text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="vehicle-name">2021 Toyota RAV4</h3>
                                        <span class="vehicle-plate">License: XYZ-5678 • CA</span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-light btn-sm" onclick="editVehicle('2021 Toyota RAV4')">
                                        <i class="fas fa-pen"></i>
                                    </button>
                                    <button class="btn btn-light btn-sm" onclick="deleteVehicle('2021 Toyota RAV4')">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-content">
                            <div class="vehicle-metadata">
                                <div class="font-medium">
                                    Toyota • RAV4 • 2021
                                </div>
                                <div class="text-muted">
                                    Color: Silver
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Vehicle Button -->
                    <div class="add-vehicle-section">
                        <button class="btn font-medium" onclick="addNewVehicle()">
                            <i class="fas fa-plus mr-2"></i>
                            Add Vehicle
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

         <!-- Lease Charges Popover -->
     <div id="lease-charges-popover" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl p-4 min-w-[320px]" style="position: fixed; z-index: 9999;">
         <div class="font-semibold text-gray-900 mb-3">Monthly Lease Charges</div>
         
         <!-- Total Rent -->
         <div class="bg-gray-50 p-3 rounded-lg mb-3">
             <div class="text-sm text-gray-600 mb-2">Total Monthly Rent</div>
             <div class="flex justify-between items-center">
                 <span class="text-gray-700">Rent (Residential)</span>
                 <span class="font-medium">$2,000.00</span>
             </div>
             <div class="flex justify-between items-center">
                 <span class="text-gray-700">Pet Fee (2 pets)</span>
                 <span class="font-medium">$30.00</span>
             </div>
             <div class="border-t border-gray-300 pt-2 mt-2">
                 <div class="flex justify-between items-center">
                     <span class="font-semibold text-gray-900">Total Charges</span>
                     <span class="font-bold text-gray-900">$2,030.00</span>
                 </div>
             </div>
         </div>
         
         <!-- HAP Subsidy -->
         <div class="space-y-2 mb-3">
             <div class="text-sm text-gray-600 mb-2">Housing Assistance</div>
             <div class="flex justify-between items-center">
                 <span class="text-green-700">HAP Subsidy</span>
                 <span class="font-medium text-green-700">-$692.75</span>
             </div>
         </div>
         
         <!-- Tenant Portion -->
         <div class="border-t border-gray-200 pt-3">
             <div class="flex justify-between items-center">
                 <span class="font-semibold text-gray-900">Tenant Responsibility</span>
                 <span class="font-bold">$1,337.25</span>
             </div>
         </div>
         
    </div>

    <!-- Floating Kebab Dropdown - Resident (outside all containers) -->
    <div id="kebab-dropdown-resident" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <div class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
			<i class="fas fa-link"></i>
			<span>Change linked customer</span>
		</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user mr-2 text-muted"></i>
            View customer record
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user-plus mr-2 text-muted"></i>
            View prospect record
        </button>
    </div>

    <!-- Floating Kebab Dropdown - RentCafe (outside all containers) -->
    <div id="kebab-dropdown-rentcafe" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[160px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-key mr-2 text-muted"></i>
            Change password
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-lock mr-2 text-muted"></i>
            Lock account
        </button>
    </div>

    <!-- Floating Kebab Dropdown - RentCafe John Smith (outside all containers) -->
    <div id="kebab-dropdown-rentcafe-john" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[160px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-key mr-2 text-muted"></i>
            Change password
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-lock mr-2 text-muted"></i>
            Lock account
        </button>
    </div>

    <!-- Floating Kebab Dropdown - Angela Johnson Pageslide (outside all containers) -->
    <div id="kebab-dropdown-roommate-angela-pageslide" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-pen mr-2 text-muted"></i>
            Edit details
        </button>
		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-check mr-2 text-muted"></i>
            Approve application
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-paper-plane mr-2 text-muted"></i>
            Send invitation
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user mr-2 text-muted"></i>
            View customer record
        </button>
        <hr class="my-1 border-gray-200">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-red-50  transition-colors">
            <i class="fas fa-times text-red-500 mr-2"></i>
            Remove roommate
        </button>
    </div>

    <!-- Floating Kebab Dropdown - John Smith Pageslide (outside all containers) -->
    <div id="kebab-dropdown-roommate-john-pageslide" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 9999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-pen mr-2 text-muted"></i>
            Edit details
        </button>
		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user-plus mr-2 text-muted"></i>
            Promote roommate
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user mr-2 text-muted"></i>
            View customer record
        </button>
        <hr class="my-1 border-gray-200">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-red-50  transition-colors">
            <i class="fas fa-times text-red-500 mr-2"></i>
            Remove roommate
        </button>
    </div>

        <!-- Floating Kebab Dropdown - Tenant Header Manage (outside all containers) -->
    <div id="tenant-header-manage-dropdown" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[240px]" style="position: fixed; z-index: 9999;">
        <!-- Financial -->
        <div class="kebab-group-header">Financial</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-circle-plus mr-2 text-muted"></i>
            Add lease charge
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-piggy-bank mr-2 text-muted"></i>
            Apply deposit
        </button>
        
        <!-- Lease Operations -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Lease Operations</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-contract mr-2 text-muted"></i>
            Create proposal
        </button>
		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-calendar-alt mr-2 text-muted"></i>
            Adjust lease-end
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-calendar mr-2 text-muted"></i>
            Change to month-to-month
        </button>
 		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-undo mr-2 text-muted"></i>
            Reverse move-in
        </button>
        
        <!-- Unit & Resident -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Unit & Resident</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-home mr-2 text-muted"></i>
            Assign unit
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-exchange-alt mr-2 text-muted"></i>
            Transfer unit
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user-plus mr-2 text-muted"></i>
            Promote roommate
        </button>
        
        <!-- Termination -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Termination</div>
 		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-bell mr-2 text-muted"></i>
            Give notice
        </button>
 		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-exclamation-triangle mr-2 text-muted"></i>
            Evict
        </button>
    </div>

        <!-- Floating Kebab Dropdown - Lease (outside all containers) -->
    <div id="kebab-dropdown-lease" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[240px]" style="position: fixed; z-index: 9999;">
        <!-- Financial -->
        <div class="kebab-group-header">Financial</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-circle-plus mr-2 text-muted"></i>
            Add lease charge
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-piggy-bank mr-2 text-muted"></i>
            Apply deposit
        </button>
        
        <!-- Lease Operations -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Lease Operations</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-contract mr-2 text-muted"></i>
            Create proposal
        </button>
		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-calendar-alt mr-2 text-muted"></i>
            Adjust lease-end
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-calendar mr-2 text-muted"></i>
            Change to month-to-month
        </button>
 		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-undo mr-2 text-muted"></i>
            Reverse move-in
        </button>
        
        <!-- Unit & Resident -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Unit & Resident</div>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-home mr-2 text-muted"></i>
            Assign unit
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-exchange-alt mr-2 text-muted"></i>
            Transfer unit
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-user-plus mr-2 text-muted"></i>
            Promote roommate
        </button>
        
        <!-- Termination -->
        <hr class="my-1 border-gray-200">
        <div class="kebab-group-header">Termination</div>
 		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-bell mr-2 text-muted"></i>
            Give notice
        </button>
 		<button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-exclamation-triangle mr-2 text-muted"></i>
            Evict
        </button>
    </div>

    <!-- Active Tasks & Alerts Pageslide -->
    <div class="pageslide-overlay" id="active-tasks-overlay">
        <div class="pageslide">
            <div class="pageslide-header">
                <div class="flex items-start justify-between w-full">
                    <div class="flex items-start gap-3">
                        <div>
                            <h2 class="pageslide-title  font-semibold text-lg mb-1">Active Tasks & Alerts</h2>
                            <div class="text-muted">
                                <span class="font-medium">Items requiring your attention</span>
                            </div>
                        </div>
                    </div>
                    <button class="pageslide-close" onclick="closePageslide('active-tasks-overlay')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="pageslide-content">
                <div class="space-y-4">
                        <!-- Lease Expiring -->
                        <div class="task-item p-4 border border-gray-200 rounded-lg bg-white shadow-sm">
                            <div class="flex items-start gap-3">
                                <div class="w-3 h-3 bg-red-500 rounded-full mt-2 flex-shrink-0"></div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="text-base font-semibold ">Lease Expiring Soon</h4>
                                        <button class="btn btn-primary">
                                            Create proposal
                                        </button>
                                    </div>
                                    <p class="text-muted mb-2">Current lease expires Sep 30, 2025 - renewal action required</p>
                                    <div class="text-sm text-muted">
                                        <span class="inline-flex items-center gap-1">
                                            <i class="fas fa-calendar-times text-red-500"></i>
                                            <span>43 days remaining</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Open Work Order -->
                        <div class="task-item p-4 border border-gray-200 rounded-lg bg-white shadow-sm">
                            <div class="flex items-start gap-3">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full mt-2 flex-shrink-0"></div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="text-base font-semibold ">Open Work Order</h4>
                                        <div class="flex items-center gap-2">
                                            <button class="btn btn-light">
                                                View Details
                                            </button>
                                            <button class="btn btn-primary">
                                                Complete
                                            </button>
                                        </div>
                                    </div>
                                    <p class="text-muted mb-2">Work Order #26145: Refrigerator is not working (Appliances) - Medium Priority</p>
                                    <div class="text-sm text-muted">
                                        <span class="inline-flex items-center gap-1">
                                            <i class="fas fa-wrench text-yellow-500"></i>
                                            <span>Created 2 days ago by Melinda Michaels</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Application Review -->
                        <div class="task-item p-4 border border-gray-200 rounded-lg shadow-sm">
                            <div class="flex items-start gap-3">
                                <div class="w-3 h-3 bg-orange-500 rounded-full mt-2 flex-shrink-0"></div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="text-base font-semibold ">Roommate Application Pending</h4>
                                        <div class="flex items-center gap-2">
                                            <button class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg transition-colors">
                                                Send invitation
                                            </button>
                                            <button class="btn btn-primary">
                                                Approve application
                                            </button>
                                        </div>
                                    </div>
                                    <p class="text-muted mb-2">Angela Johnson's application completed - requires approval</p>
                                    <div class="text-sm text-muted">
                                        <span class="inline-flex items-center gap-1">
                                            <i class="fas fa-user-plus text-orange-500"></i>
                                            <span>Application submitted 5 days ago</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Floating Kebab Dropdown - Charges Actions (outside all containers) -->
    <div id="kebab-dropdown-charges" class="hidden bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[180px]" style="position: fixed; z-index: 99999;">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-circle-plus mr-2 text-muted"></i>
            Add charge
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-print mr-2 text-muted"></i>
            Print
        </button>
        <hr class="my-1 border-gray-200">
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-excel mr-2 text-muted"></i>
            Export to excel
        </button>
        <button class="kebab-option w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors">
            <i class="fas fa-file-pdf mr-2 text-muted"></i>
            Export to PDF
        </button>
    </div>

    <script>
        // Handle Create Proposal button - Global function
        function handleCreateProposal() {
            alert('Create Lease Proposal:\n\n• Review current lease terms\n• Check market rent rates\n• Generate renewal proposal\n• Calculate new rent amount\n• Prepare proposal documents\n• Schedule tenant meeting');
        }
        
        // Handle View All Activities button - Global function
        function viewAllActivities() {
            alert('View All Activities:\n\n• Load complete activity timeline\n• Filter by activity type\n• Search specific dates or events\n• Export activity reports\n• View detailed communication history');
        }
        
        // Track if load more has been clicked - Global variable
        let timelineExpanded = false;
        
        // Handle Add Activity dropdown - Global functions
        function toggleActivityAddMenu() {
            const menu = document.getElementById('activity-add-menu');
            if (menu) {
                menu.classList.toggle('hidden');
            }
        }
        
        // Handle Lease Charges Popover - Global function
        function toggleLeaseChargesPopover(event) {
            event.stopPropagation();
            
            const popover = document.getElementById('lease-charges-popover');
            const button = event.target.closest('button');
            
            if (!popover || !button) return;
            
            // Close all other popovers/dropdowns first
            document.querySelectorAll('[id*="dropdown"], [id*="popover"]').forEach(element => {
                if (element.id !== 'lease-charges-popover') {
                    element.classList.add('hidden');
                }
            });
            
            // Toggle current popover
            if (popover.classList.contains('hidden')) {
                // Show popover
                popover.classList.remove('hidden');
                
                // Position popover near the button
                const buttonRect = button.getBoundingClientRect();
                const popoverRect = popover.getBoundingClientRect();
                
                // Calculate position (below and to the right of button)
                let left = buttonRect.right + 5;
                let top = buttonRect.bottom + 5;
                
                // Adjust if popover would go off-screen
                if (left + popoverRect.width > window.innerWidth) {
                    left = buttonRect.left - popoverRect.width - 5;
                }
                if (top + popoverRect.height > window.innerHeight) {
                    top = buttonRect.top - popoverRect.height - 5;
                }
                
                // Ensure popover stays on screen
                left = Math.max(10, Math.min(left, window.innerWidth - popoverRect.width - 10));
                top = Math.max(10, Math.min(top, window.innerHeight - popoverRect.height - 10));
                
                popover.style.left = left + 'px';
                popover.style.top = top + 'px';
            } else {
                // Hide popover
                popover.classList.add('hidden');
            }
        }
        
        function addActivityType(type) {
            // Close the dropdown
            const menu = document.getElementById('activity-add-menu');
            if (menu) menu.classList.add('hidden');
            
            // Handle different activity types
            switch(type) {
                case 'comment':
                    alert('Add Comment:\n\n• Add a comment to the activity timeline\n• Include relevant details and context\n• Tag team members if needed\n• Save for future reference');
                    break;
                case 'follow-up':
                    alert('Add Follow-up:\n\n• Schedule a follow-up task\n• Set due date and priority\n• Add follow-up details\n• Assign to team member\n• Link to previous activities');
                    break;
                case 'appointment':
                    alert('Add Appointment:\n\n• Schedule an appointment\n• Set date and time\n• Add location details\n• Send calendar invites\n• Add appointment notes');
                    break;
                case 'log':
                    alert('Log Activity:\n\n• Record completed activity\n• Document what was done\n• Add outcome and results\n• Set completion status\n• Link to related records');
                    break;
                case 'memo':
                    alert('Add Memo:\n\n• Create internal memo\n• Document important information\n• Add memo subject and content\n• Tag relevant departments\n• Set memo priority');
                    break;
                default:
                    alert('Unknown activity type selected');
            }
        }
        
        // Track progressive loading
        let activitiesShownFromHidden = 0;
        const activitiesPerLoad = 6; // Show 6 more activities each time
        
        // Toggle Activities (Load More / Collapse) - Global function
        function toggleActivities() {
            if (timelineExpanded) {
                collapseActivities();
            } else {
                loadMoreActivities();
            }
        }
        
        // Handle Load More Activities button - Progressive loading
        function loadMoreActivities() {
            const hiddenActivities = document.getElementById('hidden-activities');
            const loadMoreSection = document.getElementById('load-more-section');
            const toggleIcon = document.getElementById('toggle-activities-icon');
            const toggleText = document.getElementById('toggle-activities-text');
            
            if (hiddenActivities && loadMoreSection) {
                // Get all activity sections in the hidden area
                const allHiddenSections = hiddenActivities.querySelectorAll('.activity-section');
                
                // Show the next batch of activity sections
                const sectionsToShow = Math.min(activitiesPerLoad, allHiddenSections.length - activitiesShownFromHidden);
                
                for (let i = 0; i < sectionsToShow; i++) {
                    const sectionIndex = activitiesShownFromHidden + i;
                    if (sectionIndex < allHiddenSections.length) {
                        const section = allHiddenSections[sectionIndex];
                        section.style.display = 'block';
                        
                        // Apply current filters to activities in this section
                        const itemsInSection = section.querySelectorAll('.activity-item');
                        itemsInSection.forEach(item => {
                            applyFiltersToItem(item);
                        });
                    }
                }
                
                // Update the count
                activitiesShownFromHidden += sectionsToShow;
                
                // Always expand the timeline to show new content
                const activityCard = document.getElementById('activity-timeline-card');
                const timelineContainer = document.getElementById('activity-timeline-container');
                const cardContent = activityCard ? activityCard.querySelector('.card-content') : null;
                
                if (activityCard && timelineContainer) {
                    // Remove ALL height constraints so timeline can grow
                    activityCard.style.height = 'auto';
                    activityCard.classList.remove('matched-height');
                    
                    // Clear card-content height constraint
                    if (cardContent) {
                        cardContent.style.height = 'auto';
                        cardContent.style.overflow = 'visible';
                    }
                    
                    // Clear timeline container constraints
                    timelineContainer.style.height = 'auto';
                    timelineContainer.style.maxHeight = 'none';
                    timelineContainer.style.overflowY = 'visible';
                    
                    console.log('Timeline height constraints removed for expansion');
                }
                
                // Check if all sections are now shown
                if (activitiesShownFromHidden >= allHiddenSections.length) {
                    // All sections shown, change to collapse button
                    timelineExpanded = true;
                    toggleIcon.className = 'fas fa-chevron-up mr-2';
                    toggleText.textContent = 'Show less activities';
                    
                    // Remove the hidden class from the container
                    hiddenActivities.classList.remove('hidden');
                } else {
                    // More sections to show, keep as "Load more"
                    const remainingSections = allHiddenSections.length - activitiesShownFromHidden;
                    toggleText.textContent = `Load more activities (${remainingSections} more periods)`;
                }
                
                // Update empty state for visible sections
                updateActivitySections();
            }
        }
        
        // Helper function to apply current filters to a single item
        function applyFiltersToItem(item) {
            const selectedFilterOption = document.querySelector('.activity-filter-option.selected');
            const currentFilter = selectedFilterOption ? selectedFilterOption.getAttribute('data-value') : 'all';
            
            const commTypeSelected = document.querySelector('#communication-type-filter-dropdown .activity-filter-option.selected');
            const sourceSelected = document.querySelector('#source-filter-dropdown .activity-filter-option.selected');
            const currentCommFilter = commTypeSelected ? commTypeSelected.getAttribute('data-value') : 'all-communications';
            const currentSourceFilter = sourceSelected ? sourceSelected.getAttribute('data-value') : 'all-sources';
            
                        const itemFilters = item.getAttribute('data-filter') || '';
            const itemCommType = item.getAttribute('data-communication-type') || '';
            const itemActivityType = item.getAttribute('data-activity-type') || 'user';
            
            let shouldShow = false;
            
            if (currentFilter === 'all') {
                shouldShow = true;
            } else if (currentFilter === 'system') {
                shouldShow = itemActivityType === 'system';
            } else if (currentFilter === 'user') {
                shouldShow = itemActivityType === 'user';
            } else if (currentFilter === 'communications') {
                if (itemFilters.includes('communications')) {
                    const typeMatches = currentCommFilter === 'all-communications' || itemCommType === currentCommFilter;
                    shouldShow = typeMatches;
                }
                                } else {
                shouldShow = itemFilters.includes(currentFilter);
                                }
            
            // Apply source filter only to communications
            if (shouldShow && currentFilter === 'communications' && currentSourceFilter !== 'all-sources') {
                shouldShow = itemActivityType === currentSourceFilter;
            }
            
            if (shouldShow) {
                item.classList.remove('hidden');
                            } else {
                item.classList.add('hidden');
            }
        }
        
        // Helper function to update activity section visibility
        function updateActivitySections() {
            const allSections = document.querySelectorAll('.activity-section');
            allSections.forEach(section => {
                const visibleItems = section.querySelectorAll('.activity-item:not(.hidden)');
                if (visibleItems.length > 0) {
                    section.classList.remove('empty');
                        } else {
                    section.classList.add('empty');
                }
            });
        }
        
        // Reset communication filters to default values
        function resetCommunicationFilters() {
            resetCommunicationTypeFilter();
            resetSourceFilter();
        }
        
        // Reset only communication type filter
        function resetCommunicationTypeFilter() {
            const commTypeOptions = document.querySelectorAll('#communication-type-filter-dropdown .activity-filter-option');
            commTypeOptions.forEach(option => option.classList.remove('selected'));
            const defaultTypeOption = document.querySelector('#communication-type-filter-dropdown .activity-filter-option[data-value="all-communications"]');
            if (defaultTypeOption) {
                defaultTypeOption.classList.add('selected');
                const typeBtn = document.getElementById('communication-type-filter-btn');
                if (typeBtn) {
                    typeBtn.querySelector('.filter-current-text').textContent = 'All Communications';
                }
            }
        }
        
        // Reset only source filter
        function resetSourceFilter() {
            const sourceOptions = document.querySelectorAll('#source-filter-dropdown .activity-filter-option');
            sourceOptions.forEach(option => option.classList.remove('selected'));
            const defaultSourceOption = document.querySelector('#source-filter-dropdown .activity-filter-option[data-value="all-sources"]');
            if (defaultSourceOption) {
                defaultSourceOption.classList.add('selected');
                const sourceBtn = document.getElementById('source-filter-btn');
                if (sourceBtn) {
                    sourceBtn.querySelector('.filter-current-text').textContent = 'All Sources';
                }
            }
        }
        
        // Handle Collapse Activities - Global function
        function collapseActivities() {
            const hiddenActivities = document.getElementById('hidden-activities');
            const loadMoreSection = document.getElementById('load-more-section');
            const toggleIcon = document.getElementById('toggle-activities-icon');
            const toggleText = document.getElementById('toggle-activities-text');
            
            if (hiddenActivities && loadMoreSection) {
                // Reset progressive loading counter
                activitiesShownFromHidden = 0;
                
                // Use requestAnimationFrame to batch DOM updates
                    requestAnimationFrame(() => {
                    // Mark timeline as collapsed
                    timelineExpanded = false;
                    
                    // Reset button position to original location before hiding activities
                    resetButtonPosition();
                    
                    // Hide all hidden activities
                    hiddenActivities.classList.add('hidden');
                    
                    // Hide all individual sections that were progressively shown
                    const allHiddenSections = hiddenActivities.querySelectorAll('.activity-section');
                    allHiddenSections.forEach(section => {
                        section.style.display = 'none';
                    });
                    
                    // Update button to show load more option with count
                    if (toggleIcon && toggleText) {
                        toggleIcon.className = 'fas fa-chevron-down mr-2';
                        const totalSections = hiddenActivities.querySelectorAll('.activity-section').length;
                        toggleText.textContent = `Load more activities (${totalSections} more periods)`;
                    }
                    
                    // Restore matched height when collapsed
                setTimeout(() => {
                        // Reset the timeline to match the center column height again
                        const activityCard = document.getElementById('activity-timeline-card');
                        const timelineContainer = document.getElementById('activity-timeline-container');
                        if (activityCard && timelineContainer) {
                            // Re-apply height matching
                            matchActivityTimelineHeight();
                        }
                    }, 100);
                    
                    // Scroll back to the load more button for better UX (only if visible)
                    if (loadMoreSection.style.display !== 'none') {
                        loadMoreSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
            }
        }
        
        // Handle Add Note button - Global function
        function addNote() {
            alert('Add Note:\n\n• Create new note entry\n• Add note content and description\n• Tag relevant topics or categories\n• Assign priority level\n• Link to resident record\n• Save for future reference');
        }
        
        // Handle View All Notes button - Global function
        function viewAllNotes() {
            alert('View All Notes:\n\n• Load complete notes history\n• Filter by author or date\n• Search note content\n• Export notes reports\n• View detailed note history\n• Manage note categories');
        }
        
        // Pet Details Actions - Global functions
        function editPet(petName) {
            alert(`Edit Pet: ${petName}\n\n• Update pet information\n• Modify weight, age, breed details\n• Upload vaccination records\n• Update service animal status\n• Save changes to resident record`);
        }
        
        function deletePet(petName) {
            if (confirm(`Are you sure you want to remove ${petName} from this resident's record?\n\nThis action cannot be undone.`)) {
                alert(`Pet ${petName} has been removed from the resident record.`);
                // In a real application, this would remove the pet from the database
            }
        }
        
        function addNewPet() {
            alert('Add New Pet:\n\n• Enter pet information\n• Upload pet photos\n• Add vaccination records\n• Set service animal status\n• Complete pet registration\n• Update lease agreement if needed');
        }

        function addNewRoommate() {
            alert('Add New Roommate:\n\n• Add roommate information\n• Set roommate details\n• Update lease agreement\n• Configure access permissions');
        }
        
        // Vehicle Details Actions - Global functions
        function editVehicle(vehicleName) {
            alert(`Edit Vehicle: ${vehicleName}\n\n• Update license plate number\n• Change state registration\n• Modify make, model, year\n• Update vehicle color\n• Save changes to resident record`);
        }
        
        function deleteVehicle(vehicleName) {
            if (confirm(`Are you sure you want to remove ${vehicleName} from this resident's record?\n\nThis action cannot be undone.`)) {
                alert(`Vehicle ${vehicleName} has been removed from the resident record.`);
                // In a real application, this would remove the vehicle from the database
            }
        }
        
        function addNewVehicle() {
            alert('Add New Vehicle:\n\n• Enter license plate number\n• Select state registration\n• Add vehicle make and model\n• Enter vehicle year\n• Specify vehicle color\n• Save to resident record');
        }
        
        // Handle Note Expansion Toggle - Global function
        function toggleNoteExpansion() {
            const notePreview = document.getElementById('note-preview');
            const noteFull = document.getElementById('note-full');
            const noteToggle = document.getElementById('note-toggle');
            
            if (noteFull.classList.contains('hidden')) {
                // Expand note
                noteFull.classList.remove('hidden');
                noteToggle.textContent = 'read less';
            } else {
                // Collapse note
                noteFull.classList.add('hidden');
                noteToggle.textContent = 'read more';
            }
        }
        
        // Handle Note 2 Expansion Toggle - Global function
        function toggleNoteExpansion2() {
            const notePreview = document.getElementById('note-preview-2');
            const noteFull = document.getElementById('note-full-2');
            const noteToggle = document.getElementById('note-toggle-2');
            
            if (noteFull.classList.contains('hidden')) {
                // Expand note
                noteFull.classList.remove('hidden');
                noteToggle.textContent = 'read less';
            } else {
                // Collapse note
                noteFull.classList.add('hidden');
                noteToggle.textContent = 'read more';
            }
        }
        
        // Handle Note 3 Expansion Toggle - Global function
        function toggleNoteExpansion3() {
            const notePreview = document.getElementById('note-preview-3');
            const noteFull = document.getElementById('note-full-3');
            const noteToggle = document.getElementById('note-toggle-3');
            
            if (noteFull.classList.contains('hidden')) {
                // Expand note
                noteFull.classList.remove('hidden');
                noteToggle.textContent = 'read less';
            } else {
                // Collapse note
                noteFull.classList.add('hidden');
                noteToggle.textContent = 'read more';
            }
        }
        
        // Toggle alerts section
        function toggleAlerts() {
            const content = document.getElementById('alerts-content');
            const chevron = document.getElementById('alerts-chevron');
            const summary = document.getElementById('alerts-summary');
            
            if (content.style.display === 'none') {
                // Expanding: show content, hide summary
                content.style.display = 'block';
                summary.style.display = 'none';
                chevron.classList.remove('fa-chevron-down');
                chevron.classList.add('fa-chevron-up');
            } else {
                // Collapsing: hide content, show summary
                content.style.display = 'none';
                summary.style.display = 'flex';
                chevron.classList.remove('fa-chevron-up');
                chevron.classList.add('fa-chevron-down');
            }
        }
        

        // Activity filtering functionality
        function filterActivities(filter) {
            const activityCard = document.getElementById('activity-timeline-card');
            
            // Add filtering class to disable all transitions
            if (activityCard) {
                activityCard.classList.add('filtering');
            }
            
            // Use requestAnimationFrame to batch DOM updates and prevent flickering
            requestAnimationFrame(() => {
                const visibleItems = document.querySelectorAll('.activity-item:not(#hidden-activities .activity-item)');
                const hiddenSectionItems = document.querySelectorAll('#hidden-activities .activity-item');
                const communicationTypeContainer = document.getElementById('communication-type-filter-container');
                const sourceContainer = document.getElementById('source-filter-container');
                const activitySections = document.querySelectorAll('.activity-section');
                
                // Batch all DOM changes together
                const itemsToShow = [];
                const itemsToHide = [];
                
                // Show/hide communication sub-filters
                if (filter === 'communications') {
                    communicationTypeContainer.classList.remove('hidden');
                    sourceContainer.classList.remove('hidden');
                } else {
                    communicationTypeContainer.classList.add('hidden');
                    sourceContainer.classList.add('hidden');
                    // Reset communication filters when not showing communications
                    resetCommunicationFilters();
                }
                
                // Prepare visible items changes
                visibleItems.forEach(item => {
                    const itemFilters = item.getAttribute('data-filter') || '';
                    const activityType = item.getAttribute('data-activity-type') || 'user';
                    
                    let shouldShow = false;
                    
                    if (filter === 'all') {
                        shouldShow = true;
                    } else if (filter === 'system') {
                        shouldShow = activityType === 'system';
                    } else if (filter === 'user') {
                        shouldShow = activityType === 'user';
                    } else {
                        shouldShow = itemFilters.includes(filter);
                    }
                    
                    if (shouldShow) {
                        itemsToShow.push(item);
                    } else {
                        itemsToHide.push(item);
                    }
                });
                
                // Prepare hidden section items changes (only if section is visible)
                const hiddenActivitiesSection = document.getElementById('hidden-activities');
                if (hiddenActivitiesSection && !hiddenActivitiesSection.classList.contains('hidden')) {
                    hiddenSectionItems.forEach(item => {
                        const itemFilters = item.getAttribute('data-filter') || '';
                        const activityType = item.getAttribute('data-activity-type') || 'user';
                        
                        let shouldShow = false;
                        
                        if (filter === 'all') {
                            shouldShow = true;
                        } else if (filter === 'system') {
                            shouldShow = activityType === 'system';
                        } else if (filter === 'user') {
                            shouldShow = activityType === 'user';
                        } else {
                            shouldShow = itemFilters.includes(filter);
                        }
                        
                        if (shouldShow) {
                            itemsToShow.push(item);
                        } else {
                            itemsToHide.push(item);
                        }
                    });
                }
                
                // Apply all changes in a single batch
                itemsToHide.forEach(item => item.classList.add('hidden'));
                itemsToShow.forEach(item => item.classList.remove('hidden'));
                
                // Check and hide empty activity sections
                requestAnimationFrame(() => {
                    activitySections.forEach(section => {
                        const visibleItemsInSection = section.querySelectorAll('.activity-item:not(.hidden)');
                        if (visibleItemsInSection.length === 0) {
                            section.classList.add('empty');
                        } else {
                            section.classList.remove('empty');
                        }
                    });
                    
                    // Update load more position after all changes are complete
                    updateLoadMorePosition();
                    
                    // Remove filtering class after filtering is complete
                    setTimeout(() => {
                        if (activityCard) {
                            activityCard.classList.remove('filtering');
                        }
                    }, 50);
                });
            });
        }
        
        // Communication type filtering functionality
        function filterCommunicationTypes(communicationType) {
            const activityCard = document.getElementById('activity-timeline-card');
            
            // Add filtering class to disable all transitions
            if (activityCard) {
                activityCard.classList.add('filtering');
            }
            
            // Use requestAnimationFrame to batch DOM updates and prevent flickering
            requestAnimationFrame(() => {
                const visibleItems = document.querySelectorAll('.activity-item:not(#hidden-activities .activity-item)');
                const hiddenSectionItems = document.querySelectorAll('#hidden-activities .activity-item');
                const activitySections = document.querySelectorAll('.activity-section');
                
                // Batch all DOM changes together
                const itemsToShow = [];
                const itemsToHide = [];
                
                // Get current source filter value
                const sourceSelected = document.querySelector('#source-filter-dropdown .activity-filter-option.selected');
                const currentSourceFilter = sourceSelected ? sourceSelected.getAttribute('data-value') : 'all-sources';
                
                // Prepare visible items changes
                visibleItems.forEach(item => {
                    const itemFilters = item.getAttribute('data-filter') || '';
                    const itemType = item.getAttribute('data-communication-type') || '';
                    const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                    
                    // Only filter items that are communications
                    if (itemFilters.includes('communications')) {
                        // Check both communication type and source filters
                        const typeMatches = communicationType === 'all-communications' || itemType === communicationType;
                        const sourceMatches = currentSourceFilter === 'all-sources' || itemActivityType === currentSourceFilter;
                        
                        if (typeMatches && sourceMatches) {
                            itemsToShow.push(item);
                        } else {
                            itemsToHide.push(item);
                        }
                    }
                });
                
                // Prepare hidden section items changes (only if section is visible)
                const hiddenActivitiesSection = document.getElementById('hidden-activities');
                if (hiddenActivitiesSection && !hiddenActivitiesSection.classList.contains('hidden')) {
                    hiddenSectionItems.forEach(item => {
                        const itemFilters = item.getAttribute('data-filter') || '';
                        const itemType = item.getAttribute('data-communication-type') || '';
                        const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                        
                        // Only filter items that are communications
                        if (itemFilters.includes('communications')) {
                            // Check both communication type and source filters
                            const typeMatches = communicationType === 'all-communications' || itemType === communicationType;
                            const sourceMatches = currentSourceFilter === 'all-sources' || itemActivityType === currentSourceFilter;
                            
                            if (typeMatches && sourceMatches) {
                                itemsToShow.push(item);
                            } else {
                                itemsToHide.push(item);
                            }
                        }
                    });
                }
                
                // Apply all changes in a single batch
                itemsToHide.forEach(item => item.classList.add('hidden'));
                itemsToShow.forEach(item => item.classList.remove('hidden'));
                
                // Check and hide empty activity sections
                requestAnimationFrame(() => {
                    activitySections.forEach(section => {
                        const visibleItemsInSection = section.querySelectorAll('.activity-item:not(.hidden)');
                        if (visibleItemsInSection.length === 0) {
                            section.classList.add('empty');
                        } else {
                            section.classList.remove('empty');
                        }
                    });
                    
                    // Update load more position after all changes are complete
                    updateLoadMorePosition();
                    
                    // Remove filtering class after filtering is complete
                    setTimeout(() => {
                        if (activityCard) {
                            activityCard.classList.remove('filtering');
                        }
                    }, 50);
                });
            });
        }
        
        // Function removed - source filtering now handled by filterActivities()
        function filterCommunicationSource_DEPRECATED(sourceType) {
            const activityCard = document.getElementById('activity-timeline-card');
            
            // Add filtering class to disable all transitions
            if (activityCard) {
                activityCard.classList.add('filtering');
            }
            
            // Use requestAnimationFrame to batch DOM updates and prevent flickering
            requestAnimationFrame(() => {
                const visibleItems = document.querySelectorAll('.activity-item:not(#hidden-activities .activity-item)');
                const hiddenSectionItems = document.querySelectorAll('#hidden-activities .activity-item');
                const activitySections = document.querySelectorAll('.activity-section');
                
                // Get current type filter value
                const commTypeSelected = document.querySelector('#communication-type-filter-dropdown .activity-filter-option.selected');
                const currentTypeFilter = commTypeSelected ? commTypeSelected.getAttribute('data-value') : 'all-communications';
                
                // Batch all DOM changes together
                const itemsToShow = [];
                const itemsToHide = [];
                
                // Prepare visible items changes
                visibleItems.forEach(item => {
                    const itemFilters = item.getAttribute('data-filter') || '';
                    const itemType = item.getAttribute('data-communication-type') || '';
                    const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                    
                    // Only filter items that are communications
                    if (itemFilters.includes('communications')) {
                        // Check both communication type and source filters
                        const typeMatches = currentTypeFilter === 'all-communications' || itemType === currentTypeFilter;
                        const sourceMatches = sourceType === 'all-sources' || itemActivityType === sourceType;
                        
                        if (typeMatches && sourceMatches) {
                            itemsToShow.push(item);
                        } else {
                            itemsToHide.push(item);
                        }
                    }
                });
                
                // Prepare hidden section items changes (only if section is visible)
                const hiddenActivitiesSection = document.getElementById('hidden-activities');
                if (hiddenActivitiesSection && !hiddenActivitiesSection.classList.contains('hidden')) {
                    hiddenSectionItems.forEach(item => {
                        const itemFilters = item.getAttribute('data-filter') || '';
                        const itemType = item.getAttribute('data-communication-type') || '';
                        const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                        
                        // Only filter items that are communications
                        if (itemFilters.includes('communications')) {
                            // Check both communication type and source filters
                            const typeMatches = currentTypeFilter === 'all-communications' || itemType === currentTypeFilter;
                            const sourceMatches = sourceType === 'all-sources' || itemActivityType === sourceType;
                            
                            if (typeMatches && sourceMatches) {
                                itemsToShow.push(item);
                            } else {
                                itemsToHide.push(item);
                            }
                        }
                    });
                }
                
                // Apply all changes in a single batch
                itemsToHide.forEach(item => item.classList.add('hidden'));
                itemsToShow.forEach(item => item.classList.remove('hidden'));
                
                // Check and hide empty activity sections
                requestAnimationFrame(() => {
                    activitySections.forEach(section => {
                        const visibleItemsInSection = section.querySelectorAll('.activity-item:not(.hidden)');
                        if (visibleItemsInSection.length === 0) {
                            section.classList.add('empty');
                        } else {
                            section.classList.remove('empty');
                        }
                    });
                    
                    // Update load more position after all changes are complete
                    updateLoadMorePosition();
                    
                    // Remove filtering class after filtering is complete
                    setTimeout(() => {
                        if (activityCard) {
                            activityCard.classList.remove('filtering');
                        }
                    }, 50);
                });
            });
        }
        
        // Function to maintain consistent load more button positioning and visibility
        function updateLoadMorePosition() {
            const loadMoreSection = document.getElementById('load-more-section');
            const hiddenActivitiesSection = document.getElementById('hidden-activities');
            const activityCard = document.getElementById('activity-timeline-card');
            const leaseInfoColumn = document.getElementById('column-2-lease-info');
            
            if (loadMoreSection) {
                // Check for visible activities in the main timeline
                const visibleItems = document.querySelectorAll('.activity-item:not(.hidden):not(#hidden-activities .activity-item)');
                
                // Check for visible activities in expanded section (if expanded)
                const expandedVisibleItems = document.querySelectorAll('#hidden-activities .activity-item:not(.hidden)');
                const totalVisibleItems = visibleItems.length + expandedVisibleItems.length;
                
                // When timeline is expanded, always show collapse button
                // When collapsed, always show load more button since we have hidden activities
                let showBasedOnHeight = true;
                
                // Check if there are any hidden activities that could potentially match current filters
                let hasMatchingHiddenActivities = false;
                if (hiddenActivitiesSection && hiddenActivitiesSection.classList.contains('hidden')) {
                    // Get current filter from custom dropdown
                    const selectedFilterOption = document.querySelector('.activity-filter-option.selected');
                    const currentFilter = selectedFilterOption ? selectedFilterOption.getAttribute('data-value') : 'all';
                    
                    // Get communication sub-filters
                    const commTypeSelected = document.querySelector('#communication-type-filter-dropdown .activity-filter-option.selected');
                    const sourceSelected = document.querySelector('#source-filter-dropdown .activity-filter-option.selected');
                    const currentCommTypeFilter = commTypeSelected ? commTypeSelected.getAttribute('data-value') : 'all-communications';
                    const currentSourceFilter = sourceSelected ? sourceSelected.getAttribute('data-value') : 'all-sources';
                    
                    const hiddenItems = hiddenActivitiesSection.querySelectorAll('.activity-item');
                    hasMatchingHiddenActivities = Array.from(hiddenItems).some(item => {
                        const itemFilters = item.getAttribute('data-filter') || '';
                        const itemType = item.getAttribute('data-communication-type') || '';
                        const itemActivityType = item.getAttribute('data-activity-type') || 'user';
                        
                        // Check if item matches the current filter criteria
                        if (currentFilter === 'all') {
                            return true;
                        } else if (currentFilter === 'system') {
                            return itemActivityType === 'system';
                        } else if (currentFilter === 'user') {
                            return itemActivityType === 'user';
                        } else if (currentFilter === 'communications') {
                            // For communications, first check if item is a communication activity
                            if (itemFilters.includes('communications')) {
                                // Then check both type and source filters
                                const typeMatches = currentCommTypeFilter === 'all-communications' || itemType === currentCommTypeFilter;
                                const sourceMatches = currentSourceFilter === 'all-sources' || itemActivityType === currentSourceFilter;
                                return typeMatches && sourceMatches;
                            }
                            return false;
                } else {
                            // For other filters (work-orders, payments, etc.), check if item matches
                            return itemFilters.includes(currentFilter);
                        }
                        return false;
                    });
                }
                
                // If timeline is expanded, we always show the collapse button (even if no results)
                // because user needs a way to collapse back
                if (timelineExpanded) {
                    loadMoreSection.style.display = 'block';
                    loadMoreSection.style.opacity = totalVisibleItems === 0 ? '0.6' : '1';
                    // Position button at bottom when timeline is expanded
                    positionCollapseButtonAtBottom();
                                } else {
                    // When timeline is collapsed, always show load more button if hidden activities exist
                    if (hiddenActivitiesSection && hiddenActivitiesSection.children.length > 0) {
                        if (totalVisibleItems === 0 && !hasMatchingHiddenActivities) {
                            // Hide load more button if no visible activities AND no matching hidden activities
                            loadMoreSection.style.display = 'none';
                        } else if (totalVisibleItems === 0 && hasMatchingHiddenActivities) {
                            // Show but dim the load more button if no current results but matching hidden activities exist
                            loadMoreSection.style.display = 'block';
                            loadMoreSection.style.opacity = '0.6';
                        } else {
                            // Show normally when there are visible activities or hidden activities exist
                            loadMoreSection.style.display = 'block';
                    loadMoreSection.style.opacity = '1';
                        }
                    } else {
                        // No hidden activities at all, hide the button
                        loadMoreSection.style.display = 'none';
                    }
                }
            }
        }
        
        // Position collapse button at bottom of expanded timeline
        function positionCollapseButtonAtBottom() {
            const loadMoreSection = document.getElementById('load-more-section');
            const hiddenActivitiesSection = document.getElementById('hidden-activities');
            
            if (loadMoreSection && hiddenActivitiesSection && !hiddenActivitiesSection.classList.contains('hidden')) {
                // Only move if button is not already at the bottom
                if (loadMoreSection.parentNode !== hiddenActivitiesSection) {
                    // Move button to be the last child of hidden-activities section
                    hiddenActivitiesSection.appendChild(loadMoreSection);
                    loadMoreSection.style.marginTop = '1rem';
                }
            }
        }
        
        // Reset button position to original location
        function resetButtonPosition() {
            const loadMoreSection = document.getElementById('load-more-section');
            const activityTimelineContainer = document.getElementById('activity-timeline-container');
            
            if (loadMoreSection && activityTimelineContainer) {
                // Move button back to its original position after the timeline container
                activityTimelineContainer.insertAdjacentElement('afterend', loadMoreSection);
                loadMoreSection.style.marginTop = '';
                loadMoreSection.style.flexShrink = '';
                loadMoreSection.style.position = '';
                loadMoreSection.style.bottom = '';
            }
        }
        
        // Match activity timeline card height with lease info card
        function matchActivityTimelineHeight() {
            
            const activityCard = document.getElementById('activity-timeline-card');
            const leaseInfoColumn = document.getElementById('column-2-lease-info');
            const timelineContainer = document.getElementById('activity-timeline-container');
            const loadMoreSection = document.getElementById('load-more-section');
            
            if (activityCard && leaseInfoColumn && timelineContainer) {
                // Get the lease info column height
                const leaseInfoHeight = leaseInfoColumn.offsetHeight;
                
                // Only proceed if we have a valid height
                if (leaseInfoHeight > 0) {
                    // Get actual button height
                    const buttonHeight = loadMoreSection ? loadMoreSection.offsetHeight : 80;
                    
                    // The TOTAL height (card + button) should equal lease info height
                    const targetCardHeight = leaseInfoHeight - buttonHeight;
                    
                    // Calculate heights for card internals
                    const cardHeader = activityCard.querySelector('.card-header');
                    const activityFilters = activityCard.querySelector('.activity-filters');
                    
                    const headerHeight = cardHeader ? cardHeader.offsetHeight : 0;
                    const filtersHeight = activityFilters ? activityFilters.offsetHeight : 0;
                    const padding = 32; // Account for card padding
                    
                    // Calculate available height for timeline content
                    const availableTimelineHeight = targetCardHeight - headerHeight - filtersHeight - padding;
                    
                    // Set the card content area to the calculated height
                    const cardContent = activityCard.querySelector('.card-content');
                    if (cardContent) {
                        cardContent.style.height = targetCardHeight + 'px';
                        cardContent.style.overflow = 'hidden';
                    }
                    
                    // Limit timeline container height so content doesn't overflow
                    timelineContainer.style.maxHeight = availableTimelineHeight + 'px';
                    timelineContainer.style.overflowY = 'hidden';
                    
                    // Add class for styling
                    activityCard.classList.add('matched-height');
                    
                    console.log('Height calculation:', {
                        leaseInfoHeight,
                        buttonHeight,
                        targetCardHeight,
                        availableTimelineHeight
                    });
                }
            }
        }
        
        // View switching functionality
        function toggleView(viewName) {
            const overviewView = document.getElementById('overview-view');
            const ledgerView = document.getElementById('ledger-view');
            const overviewMenu = document.getElementById('overview-menu');
            const ledgerMenu = document.getElementById('ledger-menu');
            
            if (viewName === 'overview') {
                // Show overview, hide ledger
                overviewView.style.display = 'block';
                ledgerView.style.display = 'none';
                
                // Update menu states
                overviewMenu.classList.add('active');
                ledgerMenu.classList.remove('active');
            } else if (viewName === 'ledger') {
                // Show ledger, hide overview
                overviewView.style.display = 'none';
                ledgerView.style.display = 'block';
                
                // Update menu states
                overviewMenu.classList.remove('active');
                ledgerMenu.classList.add('active');
            }
        }
        
        // Ledger functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize pagination on page load
            if (document.getElementById('ledger-view')) {
                goToPage(1); // Start on page 1
                updatePaginationButtons();
                setExclusiveLedgerFilter('all'); // Set "All" filter as default
            }
            
            // Balance column toggle
            const showBalance = document.getElementById('show-balance');
            if (showBalance) {
                showBalance.addEventListener('change', function() {
                    const balanceColumns = document.querySelectorAll('th:nth-child(6), td:nth-child(6)');
                    balanceColumns.forEach(col => {
                        col.style.display = this.checked ? '' : 'none';
                    });
                });
            }
            
            // Close kebab menu when clicking outside
            document.addEventListener('click', function(e) {
                const kebabBtn = document.getElementById('ledger-kebab-btn');
                const kebabMenu = document.getElementById('ledger-kebab-menu');
                if (kebabBtn && kebabMenu && !kebabBtn.contains(e.target) && !kebabMenu.contains(e.target)) {
                    kebabMenu.classList.add('hidden');
                }
                
                // Close activity add menu when clicking outside
                const activityBtn = document.getElementById('activity-add-btn');
                const activityMenu = document.getElementById('activity-add-menu');
                if (activityBtn && activityMenu && !activityBtn.contains(e.target) && !activityMenu.contains(e.target)) {
                    activityMenu.classList.add('hidden');
                }
                
                // Close lease charges popover when clicking outside
                const leaseChargesPopover = document.getElementById('lease-charges-popover');
                const leaseChargesBtn = document.querySelector('[onclick*="toggleLeaseChargesPopover"]');
                if (leaseChargesPopover && leaseChargesBtn && 
                    !leaseChargesBtn.contains(e.target) && !leaseChargesPopover.contains(e.target)) {
                    leaseChargesPopover.classList.add('hidden');
                }
            });
        });
        
        // Ledger kebab menu functions
        function toggleLedgerKebab() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) {
                menu.classList.toggle('hidden');
            }
        }
        
        // Exclusive tab-style filter functionality
        function setExclusiveLedgerFilter(filterType) {
            const allButton = document.getElementById('filter-all');
            const unpaidButton = document.getElementById('filter-unpaid');
            const processingButton = document.getElementById('filter-processing');
            const hapButton = document.getElementById('filter-hap');
            const notHapButton = document.getElementById('filter-not-hap');
            
            // Deactivate all filters
            allButton.classList.remove('active');
            unpaidButton.classList.remove('active');
            processingButton.classList.remove('active');
            hapButton.classList.remove('active');
            notHapButton.classList.remove('active');
            
            // Activate the clicked filter
            const clickedButton = document.getElementById('filter-' + filterType);
            clickedButton.classList.add('active');
            
            // Filter table rows
            const tableRows = document.querySelectorAll('tbody tr');
            tableRows.forEach(row => {
                const statusCell = row.querySelector('td:nth-child(3)'); // Status column
                const typeCell = row.querySelector('td:nth-child(2)'); // Type column
                const descriptionCell = row.querySelector('td:nth-child(1)'); // Description column
                
                if (!statusCell || !typeCell || !descriptionCell) return;
                
                const status = statusCell.textContent.trim().toLowerCase();
                const type = typeCell.textContent.trim().toLowerCase();
                const description = descriptionCell.textContent.trim().toLowerCase();
                
                let showRow = false;
                
                if (filterType === 'all') {
                    showRow = true; // Show all rows
                } else if (filterType === 'unpaid') {
                    showRow = status.includes('unpaid');
                } else if (filterType === 'processing') {
                    showRow = status.includes('processing') && type.includes('payment');
                } else if (filterType === 'hap') {
                    // Show rows with HAP-related entries (rent subsidies, housing assistance)
                    showRow = description.includes('hap') || description.includes('housing assistance') || 
                              description.includes('rent subsidy') || description.includes('section 8') ||
                              type.includes('hap') || type.includes('subsidy');
                } else if (filterType === 'not-hap') {
                    // Show rows without HAP-related entries
                    showRow = !description.includes('hap') && !description.includes('housing assistance') && 
                              !description.includes('rent subsidy') && !description.includes('section 8') &&
                              !type.includes('hap') && !type.includes('subsidy');
                }
                
                row.style.display = showRow ? '' : 'none';
            });
            
            console.log('Filter set to:', filterType);
        }
        
        // Pagination functionality
        let currentPage = 1;
        let recordsPerPage = 10;
        
        function goToPage(pageNumber) {
            currentPage = pageNumber;
            
            // Hide all table rows
            const allRows = document.querySelectorAll('.table-row');
            allRows.forEach(row => {
                row.classList.add('hidden');
            });
            
            // Show rows for current page
            const currentPageRows = document.querySelectorAll(`[data-page="${pageNumber}"]`);
            currentPageRows.forEach(row => {
                row.classList.remove('hidden');
            });
            
            // Update pagination button styling
            const pageButtons = document.querySelectorAll('.pagination-page');
            pageButtons.forEach(btn => {
                btn.classList.remove('border-primary', 'bg-primary', 'text-white');
                btn.classList.add('border-gray-300', '', 'hover:bg-gray-50');
            });
            
            // Activate clicked page button
            const clickedButton = document.querySelector(`.pagination-page[data-page="${pageNumber}"]`);
            if (clickedButton) {
                clickedButton.classList.add('border-primary', 'bg-primary', 'text-white');
                clickedButton.classList.remove('border-gray-300', '', 'hover:bg-gray-50');
            }
            
            // Update previous/next button states
            updatePaginationButtons();
            
            console.log('Navigated to page:', pageNumber);
        }
        
        function updatePaginationButtons() {
            const prevButton = document.querySelector('.pagination-prev');
            const nextButton = document.querySelector('.pagination-next');
            
            // Update previous button
            if (currentPage === 1) {
                prevButton.disabled = true;
                prevButton.classList.add('text-gray-400');
                prevButton.classList.remove('');
            } else {
                prevButton.disabled = false;
                prevButton.classList.remove('text-gray-400');
                prevButton.classList.add('');
            }
            
            // Update next button (assuming we have 2 pages total)
            if (currentPage === 2) {
                nextButton.disabled = true;
                nextButton.classList.add('text-gray-400');
                nextButton.classList.remove('');
            } else {
                nextButton.disabled = false;
                nextButton.classList.remove('text-gray-400');
                nextButton.classList.add('');
            }
        }
        
        function previousPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }
        
        function nextPage() {
            if (currentPage < 2) { // Assuming 2 pages total
                goToPage(currentPage + 1);
            }
        }
        
        // Records per page functionality
        function changeRecordsPerPage(recordCount) {
            recordsPerPage = parseInt(recordCount);
            console.log('Changed records per page to:', recordCount);
            // Reset to page 1 when changing records per page
            goToPage(1);
        }
        
        function exportToExcel() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) menu.classList.add('hidden');
            alert('Export to Excel:\n\n• Generate Excel file with all transactions\n• Include current filters\n• Download automatically\n• Preserve formatting and calculations');
        }
        
        function exportToPDF() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) menu.classList.add('hidden');
            alert('Export to PDF:\n\n• Generate PDF report\n• Include resident summary\n• Professional formatting\n• Ready for printing or sharing');
        }
        
        function emailReport() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) menu.classList.add('hidden');
            alert('Email Report:\n\n• Send ledger report via email\n• Choose recipients\n• Add custom message\n• Include attachments (PDF/Excel)');
        }
        
        // View transaction details - Global function
        function viewTransactionDetails(controlNumber) {
            alert(`Transaction Details - ${controlNumber}\n\n• View complete transaction history\n• See payment method details\n• Access related documents\n• View audit trail\n• Check authorization codes\n• Review processing status`);
        }
        
        function printLedger() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) menu.classList.add('hidden');
            alert('Print Ledger:\n\n• Print current view\n• Optimize layout for printing\n• Include all visible transactions\n• Print-friendly formatting');
        }
        
        function scheduledReports() {
            const menu = document.getElementById('ledger-kebab-menu');
            if (menu) menu.classList.add('hidden');
            alert('Scheduled Reports:\n\n• Set up automated reports\n• Choose frequency (daily, weekly, monthly)\n• Select recipients\n• Customize report content');
        }

        // Table sorting functionality
        let currentSort = { column: null, direction: 'asc' };
        
        function sortTable(column) {
            const table = document.querySelector('#ledger-view table tbody');
            const rows = Array.from(table.querySelectorAll('tr'));
            
            // Determine sort direction
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.direction = 'asc';
            }
            currentSort.column = column;
            
            // Update sort icons
            updateSortIcons(column, currentSort.direction);
            
            // Sort rows based on column
            rows.sort((a, b) => {
                let aVal, bVal;
                
                switch(column) {
                    case 'date':
                        aVal = new Date(a.cells[0].textContent.trim());
                        bVal = new Date(b.cells[0].textContent.trim());
                        break;
                    case 'description':
                        aVal = a.cells[1].querySelector('.text-sm').textContent.trim().toLowerCase();
                        bVal = b.cells[1].querySelector('.text-sm').textContent.trim().toLowerCase();
                        break;
                    case 'status':
                        aVal = a.cells[2].textContent.trim().toLowerCase();
                        bVal = b.cells[2].textContent.trim().toLowerCase();
                        break;
                    case 'charges':
                        aVal = parseFloat(a.cells[3].textContent.replace(/[$,\-]/g, '')) || 0;
                        bVal = parseFloat(b.cells[3].textContent.replace(/[$,\-]/g, '')) || 0;
                        break;
                    case 'payments':
                        aVal = parseFloat(a.cells[4].textContent.replace(/[$,\-]/g, '')) || 0;
                        bVal = parseFloat(b.cells[4].textContent.replace(/[$,\-]/g, '')) || 0;
                        break;
                    case 'balance':
                        aVal = parseFloat(a.cells[5].textContent.replace(/[$,\-]/g, ''));
                        bVal = parseFloat(b.cells[5].textContent.replace(/[$,\-]/g, ''));
                        break;
                }
                
                if (currentSort.direction === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });
            
            // Reorder table rows
            rows.forEach(row => table.appendChild(row));
        }
        
        function updateSortIcons(sortedColumn, direction) {
            // Reset all sort icons
            document.querySelectorAll('#ledger-view th i').forEach(icon => {
                icon.className = 'fas fa-sort text-sm text-gray-400';
            });
            
            // Update the sorted column icon
            const columnMap = {
                'date': 0,
                'description': 1,
                'status': 2,
                'charges': 3,
                'payments': 4,
                'balance': 5
            };
            
            const columnIndex = columnMap[sortedColumn];
            const icon = document.querySelectorAll('#ledger-view th')[columnIndex].querySelector('i');
            
            if (direction === 'asc') {
                icon.className = 'fas fa-sort-up text-sm text-blue-600';
            } else {
                icon.className = 'fas fa-sort-down text-sm text-blue-600';
            }
        }
        
        // Pageslide functionality - Global functions
        function openPageslide(overlayId) {
            const overlay = document.getElementById(overlayId);
            if (overlay) {
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
                
                // Initialize kebab menus for roommate details pageslide
                if (overlayId === 'roommate-details-overlay') {
                    setTimeout(() => {
                        initializePageslideKebabs();
                    }, 100); // Small delay to ensure pageslide is fully rendered
                }
            }
        }

        function closePageslide(overlayId) {
            const overlay = document.getElementById(overlayId);
            if (overlay) {
                overlay.classList.remove('active');
                document.body.style.overflow = ''; // Restore scrolling
            }
        }
        
        // Initialize pageslide kebab menus - Global function
        function initializePageslideKebabs() {
            // Kebab menu functionality for pageslides
            function setupKebabMenuForPageslide(btnId, dropdownId, dropdownWidth = 180) {
                const kebabBtn = document.getElementById(btnId);
                const kebabDropdown = document.getElementById(dropdownId);
                
                console.log('Looking for pageslide elements:', { btnId, dropdownId, kebabBtn, kebabDropdown });
                
                if (kebabBtn && kebabDropdown) {
                    // Remove any existing listeners first
                    kebabBtn.removeEventListener('click', kebabBtn._kebabClickHandler);
                    
                    const clickHandler = function(e) {
                        e.stopPropagation();
                        console.log('Pageslide kebab clicked:', btnId);
                        
                        // Close all other dropdowns first
                        document.querySelectorAll('[id^="kebab-dropdown-"]').forEach(dropdown => {
                            if (dropdown !== kebabDropdown) {
                                dropdown.classList.add('hidden');
                                dropdown.style.display = 'none';
                            }
                        });
                        
                        // Toggle current dropdown
                        const isVisible = !kebabDropdown.classList.contains('hidden');
                        if (isVisible) {
                            kebabDropdown.classList.add('hidden');
                            kebabDropdown.style.display = 'none';
                        } else {
                            kebabDropdown.classList.remove('hidden');
                            kebabDropdown.style.display = 'block';
                            
                            // Position dropdown
                            const rect = kebabBtn.getBoundingClientRect();
                            kebabDropdown.style.position = 'fixed';
                            kebabDropdown.style.top = (rect.bottom + 5) + 'px';
                            kebabDropdown.style.left = Math.max(10, rect.right - dropdownWidth) + 'px';
                            kebabDropdown.style.zIndex = '10001'; // Higher than pageslide
                        }
                    };
                    
                    kebabBtn._kebabClickHandler = clickHandler;
                    kebabBtn.addEventListener('click', clickHandler);
                    
                    console.log('Successfully initialized pageslide kebab:', btnId);
                    return { kebabBtn, kebabDropdown };
                } else {
                    console.log('Failed to find elements for:', btnId, dropdownId);
                    return null;
                }
            }
            
            const roommateAngelaPageslideKebab = setupKebabMenuForPageslide('kebab-btn-roommate-angela-pageslide', 'kebab-dropdown-roommate-angela-pageslide', 180);
            const roommateJohnPageslideKebab = setupKebabMenuForPageslide('kebab-btn-roommate-john-pageslide', 'kebab-dropdown-roommate-john-pageslide', 180);
            
            // For RentCafe kebab, just ensure it works in pageslide context (it's already initialized globally)
            const rentcafeJohnBtn = document.getElementById('kebab-btn-rentcafe-john');
            const rentcafeJohnDropdown = document.getElementById('kebab-dropdown-rentcafe-john');
            console.log('RentCafe elements in pageslide:', { btn: rentcafeJohnBtn, dropdown: rentcafeJohnDropdown });
            
            if (rentcafeJohnBtn && rentcafeJohnDropdown) {
                console.log('Setting up RentCafe John kebab in pageslide...');
                
                // Clear any existing event listeners by cloning and replacing the button
                const newBtn = rentcafeJohnBtn.cloneNode(true);
                rentcafeJohnBtn.parentNode.replaceChild(newBtn, rentcafeJohnBtn);
                
                // Setup fresh event handler on the new button
                newBtn.addEventListener('click', function(e) {
                    console.log('✅ RentCafe kebab clicked!', e);
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Close all other dropdowns first
                    document.querySelectorAll('[id^="kebab-dropdown-"]').forEach(dropdown => {
                        if (dropdown !== rentcafeJohnDropdown) {
                            dropdown.classList.add('hidden');
                            dropdown.style.display = 'none';
                        }
                    });
                    
                    // Toggle this dropdown
                    const isHidden = rentcafeJohnDropdown.classList.contains('hidden');
                    console.log('Dropdown currently hidden:', isHidden);
                    
                    if (isHidden) {
                        // Show dropdown
                        rentcafeJohnDropdown.classList.remove('hidden');
                        rentcafeJohnDropdown.style.display = 'block';
                        rentcafeJohnDropdown.style.position = 'fixed';
                        rentcafeJohnDropdown.style.zIndex = '10001';
                        
                        // Position relative to button
                        const rect = newBtn.getBoundingClientRect();
                        console.log('Button rect:', rect);
                        rentcafeJohnDropdown.style.left = (rect.left - 160 + rect.width) + 'px'; // Position to the left of button
                        rentcafeJohnDropdown.style.top = (rect.bottom + 5) + 'px'; // Below button with small gap
                        
                        console.log('✅ Dropdown should now be visible');
                    } else {
                        // Hide dropdown
                        rentcafeJohnDropdown.classList.add('hidden');
                        rentcafeJohnDropdown.style.display = 'none';
                        console.log('✅ Dropdown hidden');
                    }
                });
                
                console.log('✅ RentCafe kebab setup complete with fresh event handler');
            } else {
                console.error('❌ RentCafe elements not found:', { btn: rentcafeJohnBtn, dropdown: rentcafeJohnDropdown });
            }
            
            console.log('Pageslide kebabs initialized:', {
                angela: roommateAngelaPageslideKebab,
                john: roommateJohnPageslideKebab,
                rentcafeJohnGlobal: 'Already initialized globally'
            });
            
            // Add global click listener to close pageslide dropdowns
            document.addEventListener('click', function(e) {
                const pageslideDropdowns = document.querySelectorAll('[id*="kebab-dropdown-roommate"][id*="pageslide"], [id="kebab-dropdown-rentcafe-john"]');
                pageslideDropdowns.forEach(dropdown => {
                    const isRoommateDropdown = dropdown.id.includes('roommate');
                    const isRentcafeDropdown = dropdown.id.includes('rentcafe');
                    
                    let shouldClose = false;
                    if (isRoommateDropdown) {
                        shouldClose = !dropdown.contains(e.target) && !e.target.closest('[id*="kebab-btn-roommate"][id*="pageslide"]');
                    } else if (isRentcafeDropdown) {
                        shouldClose = !dropdown.contains(e.target) && !e.target.closest('#kebab-btn-rentcafe-john');
                    }
                    
                    if (shouldClose) {
                        dropdown.classList.add('hidden');
                        dropdown.style.display = 'none';
                    }
                });
            });
        }
        
        // Basic interactivity for the CRM interface
        document.addEventListener('DOMContentLoaded', function() {
            // Kebab menu functionality for both Resident and Lease cards
            function setupKebabMenu(btnId, dropdownId, dropdownWidth = 180) {
                const kebabBtn = document.getElementById(btnId);
                const kebabDropdown = document.getElementById(dropdownId);
                
                console.log('Setting up kebab menu:', { btnId, dropdownId, kebabBtn, kebabDropdown });
                
                if (kebabBtn && kebabDropdown) {
                    kebabBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        console.log('Kebab button clicked:', btnId);
                        
                        // Close all other dropdowns first
                        document.querySelectorAll('[id^="kebab-dropdown-"]').forEach(dropdown => {
                            if (dropdown !== kebabDropdown) {
                                dropdown.classList.add('hidden');
                            }
                        });
                        
                        // Get button position and viewport dimensions
                        const rect = kebabBtn.getBoundingClientRect();
                        const viewportWidth = window.innerWidth;
                        const viewportHeight = window.innerHeight;
                        const dropdownHeight = 150; // Estimated dropdown height
                        
                        // Calculate initial position (right-aligned with button)
                        let left = rect.right - dropdownWidth;
                        let top = rect.bottom + 4;
                        
                        // Adjust horizontal position if dropdown would go off-screen
                        if (left < 10) {
                            // If too far left, align with left edge of button
                            left = rect.left;
                        } else if (left + dropdownWidth > viewportWidth - 10) {
                            // If too far right, position to the left of button
                            left = rect.left - dropdownWidth + rect.width;
                        }
                        
                        // Ensure minimum distance from left edge
                        left = Math.max(10, left);
                        
                        // Adjust vertical position if dropdown would go off-screen
                        if (top + dropdownHeight > viewportHeight - 10) {
                            // Position above the button instead
                            top = rect.top - dropdownHeight - 4;
                        }
                        
                        // Ensure minimum distance from top edge
                        top = Math.max(10, top);
                        
                        // Apply calculated position and show dropdown
                        console.log('Positioning dropdown:', dropdownId, 'at:', { left, top });
                        kebabDropdown.style.position = 'fixed';
                        kebabDropdown.style.left = left + 'px';
                        kebabDropdown.style.top = top + 'px';
                        kebabDropdown.style.zIndex = '9999';
                        
                        // Show dropdown
                        const isHidden = kebabDropdown.classList.contains('hidden');
                        console.log('Dropdown currently hidden:', isHidden, 'for:', dropdownId);
                        
                        if (isHidden) {
                            kebabDropdown.classList.remove('hidden');
                            kebabDropdown.style.display = 'block';
                            console.log('✅ Dropdown should now be visible:', dropdownId);
                        } else {
                            kebabDropdown.classList.add('hidden');
                            kebabDropdown.style.display = 'none';
                            console.log('✅ Dropdown hidden:', dropdownId);
                        }
                    });
                } else {
                    console.error('❌ Kebab menu setup failed - missing elements:', { btnId, dropdownId, kebabBtn, kebabDropdown });
                }
                
                return { kebabBtn, kebabDropdown };
            }
            
            // Setup all kebab menus (except charges - handled manually below)
            console.log('🔧 Initializing kebab menus...');
            const residentKebab = setupKebabMenu('kebab-btn-resident', 'kebab-dropdown-resident', 180);
            const leaseKebab = setupKebabMenu('kebab-btn-lease', 'kebab-dropdown-lease', 200);
            const tenantHeaderManageKebab = setupKebabMenu('tenant-header-manage-btn', 'tenant-header-manage-dropdown', 200);
            const roommateAngelaKebab = setupKebabMenu('kebab-btn-roommate-angela', 'kebab-dropdown-roommate-angela', 180);
            const roommateJohnKebab = setupKebabMenu('kebab-btn-roommate-john', 'kebab-dropdown-roommate-john', 180);
            const rentcafeKebab = setupKebabMenu('kebab-btn-rentcafe', 'kebab-dropdown-rentcafe', 160);
            // Note: kebab-btn-rentcafe-john is handled in pageslide context only
            
            console.log('✅ Kebab menu initialization results:', {
                residentKebab: !!residentKebab?.kebabBtn,
                leaseKebab: !!leaseKebab?.kebabBtn,
                tenantHeaderManageKebab: !!tenantHeaderManageKebab?.kebabBtn,
                roommateAngelaKebab: !!roommateAngelaKebab?.kebabBtn,
                roommateJohnKebab: !!roommateJohnKebab?.kebabBtn,
                rentcafeKebab: !!rentcafeKebab?.kebabBtn
            });
            


            
            // Add charge button functionality
            const addChargeBtn = document.querySelector('.search-container button:first-of-type');
            if (addChargeBtn) {
                addChargeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    alert('Add Charge:\n\n• Create new charge\n• Select charge type\n• Set amount and due date\n• Apply to resident account');
                });
            }

            // Ledger button functionality for history records
            const ledgerButtons = document.querySelectorAll('.history-record .btn');
            ledgerButtons.forEach(button => {
                if (button.textContent.trim().includes('ledger')) {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Find the history record container
                        const historyRecord = this.closest('.history-record');
                        const recordType = historyRecord.querySelector('.text-sm').textContent.trim();
                        const metadataText = historyRecord.querySelector('.text-muted').parentElement.textContent.trim();
                        
                        // Extract prior lease from the metadata text
                        const priorLeaseMatch = metadataText.match(/Prior lease: (\d+)/);
                        const priorLease = priorLeaseMatch ? priorLeaseMatch[1] : 'Unknown';
                        
                        alert(`${recordType} Ledger:\n\n• Prior Lease: ${priorLease}\n• View detailed transaction history\n• Export ledger data\n• Print financial records\n• Review payment timeline`);
                    });
                }
            });
            
            // Manual setup for charges kebab menu
            const chargesKebabBtn = document.getElementById('kebab-btn-charges');
            const chargesKebabDropdown = document.getElementById('kebab-dropdown-charges');
            
            if (chargesKebabBtn && chargesKebabDropdown) {
                // Setup charges kebab click handler
                chargesKebabBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Close all other dropdowns first
                    document.querySelectorAll('[id^="kebab-dropdown-"]').forEach(dropdown => {
                        if (dropdown !== chargesKebabDropdown) {
                            dropdown.classList.add('hidden');
                        }
                    });
                    
                    // Toggle this dropdown
                    const isHidden = chargesKebabDropdown.classList.contains('hidden');
                    
                    if (isHidden) {
                        chargesKebabDropdown.classList.remove('hidden');
                        
                        // Position the dropdown relative to the button
                        const rect = chargesKebabBtn.getBoundingClientRect();
                        const dropdownWidth = 180;
                        const dropdownHeight = 160;
                        
                        // Position dropdown to the left of the button (since it's at the right edge)
                        let left = rect.right - dropdownWidth;
                        let top = rect.bottom + 8;
                        
                        // Ensure dropdown doesn't go off screen
                        const viewportWidth = window.innerWidth;
                        const viewportHeight = window.innerHeight;
                        
                        // Adjust horizontal position if needed
                        if (left < 10) {
                            left = rect.left; // Align with left edge of button if not enough space
                        }
                        if (left + dropdownWidth > viewportWidth - 10) {
                            left = viewportWidth - dropdownWidth - 10;
                        }
                        
                        // Adjust vertical position if needed
                        if (top + dropdownHeight > viewportHeight - 10) {
                            top = rect.top - dropdownHeight - 8; // Show above button
                        }
                        
                        chargesKebabDropdown.style.cssText = `
                            position: fixed !important;
                            left: ${left}px !important;
                            top: ${top}px !important;
                            z-index: 99999 !important;
                            width: 180px !important;
                            display: block !important;
                        `;
                    } else {
                        chargesKebabDropdown.classList.add('hidden');
                        chargesKebabDropdown.style.display = 'none';
                    }
                });
            } else {
                console.error('Charges kebab elements not found');
            }
            
            // Charges kebab menu actions
            const chargesKebabOptions = document.querySelectorAll('#kebab-dropdown-charges .kebab-option');
            chargesKebabOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const action = this.textContent.trim();
                    
                    if (action.includes('Receive payment')) {
                        alert('Receive Payment:\n\n• Process payment\n• Select payment method\n• Apply to outstanding charges\n• Send receipt');
                    } else if (action.includes('Print')) {
                        alert('Print Statement:\n\n• Generate printable statement\n• Include all charges and payments\n• Ready for physical delivery');
                    } else if (action.includes('Export to excel')) {
                        alert('Export to Excel:\n\n• Download detailed spreadsheet\n• All charge and payment data\n• Ready for analysis');
                    } else if (action.includes('Export to PDF')) {
                        alert('Export to PDF:\n\n• Generate PDF statement\n• Professional formatting\n• Ready for email or printing');
                    }
                    
                    // Close the dropdown
                    chargesKebabDropdown.classList.add('hidden');
                    chargesKebabDropdown.style.display = 'none';
                });
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                const allDropdowns = [
                    residentKebab.kebabDropdown, 
                    leaseKebab.kebabDropdown, 
                    tenantHeaderManageKebab.kebabDropdown,
                    roommateAngelaKebab.kebabDropdown,
                    roommateJohnKebab.kebabDropdown,
                    rentcafeKebab.kebabDropdown,
                    chargesKebabDropdown
                ];
                const allButtons = [
                    residentKebab.kebabBtn, 
                    leaseKebab.kebabBtn, 
                    tenantHeaderManageKebab.kebabBtn,
                    roommateAngelaKebab.kebabBtn,
                    roommateJohnKebab.kebabBtn,
                    rentcafeKebab.kebabBtn,
                    chargesKebabBtn
                ];
                
                // Check if click is outside all kebab elements
                const clickedDropdown = allDropdowns.find(dropdown => dropdown && dropdown.contains(e.target));
                const clickedButton = allButtons.find(button => button && (button === e.target || button.contains(e.target)));
                
                if (!clickedDropdown && !clickedButton) {
                    allDropdowns.forEach(dropdown => {
                        if (dropdown) {
                            dropdown.classList.add('hidden');
                            // Special handling for charges dropdown which uses direct style manipulation
                            if (dropdown === chargesKebabDropdown) {
                                dropdown.style.display = 'none';
                            }
                        }
                    });
                }
            });
            
            // Close dropdowns when scrolling to prevent positioning issues
            let scrollTimeout;
            function closeAllDropdowns() {
                const allDropdowns = [
                    residentKebab.kebabDropdown, 
                    leaseKebab.kebabDropdown, 
                    tenantHeaderManageKebab.kebabDropdown,
                    roommateAngelaKebab.kebabDropdown,
                    roommateJohnKebab.kebabDropdown,
                    rentcafeKebab.kebabDropdown,
                    chargesKebabDropdown
                ];
                
                allDropdowns.forEach(dropdown => {
                    if (dropdown) {
                        dropdown.classList.add('hidden');
                        // Special handling for charges dropdown
                        if (dropdown === chargesKebabDropdown) {
                            dropdown.style.display = 'none';
                        }
                    }
                });
                
                // Also close the resident header kebab menu (uses different class system)
                const residentHeaderDropdown = document.getElementById('resident-header-kebab-dropdown');
                if (residentHeaderDropdown) {
                    residentHeaderDropdown.classList.remove('active');
                }
                
                // Also close the tenant header manage dropdown (uses different class system)
                const tenantHeaderManageDropdown = document.getElementById('tenant-header-manage-dropdown');
                if (tenantHeaderManageDropdown) {
                    tenantHeaderManageDropdown.classList.add('hidden');
                }
                
                // Also close the activity filter dropdown
                const activityFilterDropdown = document.getElementById('activity-filter-dropdown');
                if (activityFilterDropdown) {
                    activityFilterDropdown.classList.remove('active');
                }
            }
            
            function handleScroll(e) {
                // Clear previous timeout
                if (scrollTimeout) {
                    clearTimeout(scrollTimeout);
                }
                
                // Set a small delay to avoid closing during smooth scrolling
                scrollTimeout = setTimeout(closeAllDropdowns, 50);
            }
            
            // Add scroll listeners to document and all scrollable containers
            document.addEventListener('scroll', handleScroll, { passive: true });
            window.addEventListener('scroll', handleScroll, { passive: true });
            
            // Also handle scroll events on pageslides and other containers
            document.querySelectorAll('.pageslide, .main-content, .content-grid').forEach(container => {
                container.addEventListener('scroll', handleScroll, { passive: true });
            });
            
            // Close dropdowns on window resize to prevent positioning issues
            window.addEventListener('resize', function() {
                closeAllDropdowns();
            });
            
            // Handle task action buttons
            document.addEventListener('click', function(e) {
                if (e.target.closest('.task-item button')) {
                    const button = e.target.closest('button');
                    const buttonText = button.textContent.trim();
                    
                    switch(buttonText) {
                        case 'Review Application':
                            alert('Roommate Application Review:\n\n• Review Angela Johnson\'s application\n• Verify background check\n• Approve or request additional information\n• Notify applicant of decision');
                            break;
                        case 'Check Status':
                            alert('Roommate Invitation Status:\n\n• Review John Smith\'s invitation status\n• Send follow-up if needed\n• Check application progress\n• Set reminder for next follow-up');
                            break;
                        case 'Send invitation':
                            alert('Send Roommate Invitation:\n\n• Generate invitation link for Angela Johnson\n• Send via email or SMS\n• Set reminder for follow-up\n• Track invitation status');
                            break;
                        case 'Approve application':
                            alert('Approve Roommate Application:\n\n• Final review of Angela Johnson\'s application\n• Process background check results\n• Generate lease addendum\n• Notify all parties of approval');
                            break;

                        case 'Create proposal':
                            alert('Create Lease Proposal:\n\n• Review current lease terms\n• Check market rent rates\n• Generate renewal proposal\n• Calculate new rent amount\n• Prepare proposal documents\n• Schedule tenant meeting');
                            break;
                        case 'View Details':
                            alert('Work Order Details:\n\nWork Order #26145\n• Date: Aug 17, 2025\n• Category: Appliances\n• Description: Refrigerator is not working\n• Priority: Medium\n• Status: Call\n• View full work order history and notes');
                            break;
                        case 'Complete':
                            alert('Complete Work Order:\n\n• Mark work order #26145 as completed\n• Add completion notes\n• Update resident communication\n• Close work order in system\n• Generate completion report');
                            break;
                    }
                }
            });
            
            // Handle kebab menu option clicks
            document.addEventListener('click', function(e) {
                if (e.target.closest('.kebab-option')) {
                    const button = e.target.closest('.kebab-option');
                    const buttonText = button.textContent.trim();
                    
                    // Close all kebab dropdowns
                    document.querySelectorAll('[id^="kebab-dropdown-"]').forEach(dropdown => {
                        dropdown.classList.add('hidden');
                    });
                    
                    switch(buttonText) {
                        case 'Change password':
                            alert('Change Password:\n\n• Generate new temporary password\n• Send to resident via email/SMS\n• Force password change on next login\n• Update security logs');
                            break;
                        case 'Lock account':
                            alert('Lock Account:\n\n• Temporarily disable account access\n• Prevent login attempts\n• Send notification to resident\n• Option to unlock later');
                            break;
                        // Add other kebab menu actions here as needed
                    }
                }
            });
            
            // Add click handlers for sidebar menu items
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all items
                    menuItems.forEach(mi => mi.classList.remove('active'));
                    // Add active class to clicked item
                    this.classList.add('active');
                });
            });

            // Add click handlers for dropdown menus
            const parentMenuItems = document.querySelectorAll('.menu-item.parent');
            parentMenuItems.forEach(item => {
                item.addEventListener('click', function() {
                    this.classList.toggle('expanded');
                });
            });

            // Add click handlers for Add links
            const addLinks = document.querySelectorAll('.add-link');
            addLinks.forEach(link => {
                link.addEventListener('click', function() {
                    alert('Add functionality would open here');
                });
            });

            // Add click handlers for blue links
            const blueLinks = document.querySelectorAll('.info-value.link');
            blueLinks.forEach(link => {
                link.addEventListener('click', function() {
                    alert('Link clicked: ' + this.textContent);
                });
            });

            // Add search functionality
            const searchInput = document.querySelector('.search-input');
            const searchBtn = document.querySelector('.search-btn');
            
            searchBtn.addEventListener('click', function() {
                const searchTerm = searchInput.value;
                if (searchTerm) {
                    alert('Searching for: ' + searchTerm);
                } else {
                    alert('Please enter a search term');
                }
            });

            // Enter key for search
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchBtn.click();
                }
            });

            // Add click handlers for header action buttons
            const actionBtns = document.querySelectorAll('.action-btn');
            actionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    if (icon) {
                        const iconClass = icon.className;
                        if (iconClass.includes('calendar')) {
                            alert('Calendar view would open here');
                        } else if (iconClass.includes('calculator')) {
                            alert('Calculator would open here');
                        } else if (iconClass.includes('star')) {
                            alert('Favorites would open here');
                        } else if (iconClass.includes('question')) {
                            alert('Help would open here');
                        } else if (iconClass.includes('cog')) {
                            alert('Settings would open here');
                        }
                    } else if (this.textContent === '0') {
                        alert('Notifications would open here');
                    }
                });
            });

            // Add click handler for Add New button
            const addNewBtn = document.querySelector('.add-new-btn');
            if (addNewBtn) {
            addNewBtn.addEventListener('click', function() {
                alert('Add New menu would open here');
            });
            }

            // Add click handler for user profile
            const userProfile = document.querySelector('.user-profile');
            if (userProfile) {
            userProfile.addEventListener('click', function() {
                alert('User profile menu would open here');
            });
            }

            // Add click handler for Verify ID button
            const verifyBtn = document.querySelector('.verified-badge');
            if (verifyBtn) {
            verifyBtn.addEventListener('click', function() {
                alert('ID Verification process would start here');
            });
            }





            // Resident action buttons for email, call, SMS, work order
            const residentActionBtns = document.querySelectorAll('.resident-action-btn');
            residentActionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.classList.contains('email')) {
                        alert('Send Email to Kamala Hakuna:\n\n• Compose new message\n• Use template\n• Send reminder\n• Schedule email');
                    } else if (this.classList.contains('call')) {
                        alert('Call Kamala Hakuna:\n\n• Primary phone: (555) 123-4567\n• Emergency contact: (555) 987-6543\n• Log call\n• Schedule callback');
                    } else if (this.classList.contains('sms')) {
                        alert('Send SMS to Kamala Hakuna:\n\n• Quick message\n• Payment reminder\n• Maintenance notice\n• Custom message');
                    } else if (this.classList.contains('work-order-btn')) {
                        alert('Create Work Order:\n\n• Report maintenance issue\n• Select category and priority\n• Add description and photos\n• Assign to maintenance team\n• Set schedule');
                    }
                });
            });

            // Header work order button
            const headerWorkOrderBtn = document.getElementById('header-work-order-btn');
            if (headerWorkOrderBtn) {
                headerWorkOrderBtn.addEventListener('click', function() {
                    alert('Create Work Order:\n\n• Report maintenance issue\n• Select category and priority\n• Add description and photos\n• Assign to maintenance team\n• Set schedule');
                });
            }
            
                        // Initialize activity timeline height to match lease info card
            setTimeout(() => {
                matchActivityTimelineHeight();
                
                // Initialize button text with count
                const loadMoreSection = document.getElementById('load-more-section');
                const toggleText = document.getElementById('toggle-activities-text');
                const hiddenActivities = document.getElementById('hidden-activities');
                
                if (loadMoreSection && toggleText && hiddenActivities) {
                    const allSections = hiddenActivities.querySelectorAll('.activity-section');
                    // Hide all sections initially for progressive loading
                    allSections.forEach(section => {
                        section.style.display = 'none';
                    });
                    toggleText.textContent = `Load more activities (${allSections.length} more periods)`;
                    console.log('Load more button initialized with count');
                } else {
                    console.log('Load more button NOT found');
                }
                
            }, 150);
            
            // Update heights on window resize (with debouncing)
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    matchActivityTimelineHeight();
                }, 250);
            });
            
            // Add debounce function to prevent rapid filter changes
            let filterTimeout = null;
            const originalFilterActivities = filterActivities;
            const originalFilterCommunicationTypes = filterCommunicationTypes;

            
            // Override filter functions with debounced versions
            window.filterActivities = function(filter) {
                if (filterTimeout) clearTimeout(filterTimeout);
                filterTimeout = setTimeout(() => {
                    originalFilterActivities(filter);
                }, 50);
            };
            
            window.filterCommunicationTypes = function(type) {
                if (filterTimeout) clearTimeout(filterTimeout);
                filterTimeout = setTimeout(() => {
                    originalFilterCommunicationTypes(type);
                }, 50);
            };


            // Activity filter dropdown functionality
            const activityFilterBtn = document.getElementById('activity-filter-btn');
            const activityFilterDropdown = document.getElementById('activity-filter-dropdown');
            const filterCurrentText = document.querySelector('.filter-current-text');
            
            // Communication filter elements
            const commTypeFilterBtn = document.getElementById('communication-type-filter-btn');
            const commTypeFilterDropdown = document.getElementById('communication-type-filter-dropdown');
            const sourceFilterBtn = document.getElementById('source-filter-btn');
            const sourceFilterDropdown = document.getElementById('source-filter-dropdown');
            
            if (activityFilterBtn && activityFilterDropdown) {
                activityFilterBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    activityFilterDropdown.classList.toggle('active');
                });

                // Handle filter option clicks
                const filterOptions = activityFilterDropdown.querySelectorAll('.activity-filter-option');
                filterOptions.forEach(option => {
                    option.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const value = this.getAttribute('data-value');
                        const text = this.querySelector('span').textContent;
                        
                        // Remove selected class from all options
                        filterOptions.forEach(opt => opt.classList.remove('selected'));
                        
                        // Add selected class to clicked option
                        this.classList.add('selected');
                        
                        // Update button text
                        filterCurrentText.textContent = text;
                        
                        // Close dropdown
                        activityFilterDropdown.classList.remove('active');
                        
                        // Apply filter
                        filterActivities(value);
                    });
                });
                
                // Set initial selected state
                const defaultOption = activityFilterDropdown.querySelector('[data-value="all"]');
                if (defaultOption) {
                    defaultOption.classList.add('selected');
                }
            }
            
            // Communication Type filter dropdown functionality
            if (commTypeFilterBtn && commTypeFilterDropdown) {
                commTypeFilterBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    commTypeFilterDropdown.classList.toggle('active');
                });

                // Handle filter option clicks
                const commTypeOptions = commTypeFilterDropdown.querySelectorAll('.activity-filter-option');
                commTypeOptions.forEach(option => {
                    option.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const value = this.getAttribute('data-value');
                        const text = this.querySelector('span').textContent;
                        
                        // Remove selected class from all options
                        commTypeOptions.forEach(opt => opt.classList.remove('selected'));
                        
                        // Add selected class to clicked option
                        this.classList.add('selected');
                        
                        // Update button text
                        commTypeFilterBtn.querySelector('.filter-current-text').textContent = text;
                        
                        // Close dropdown
                        commTypeFilterDropdown.classList.remove('active');
                        
                        // Apply filter
                        filterCommunicationTypes(value);
                    });
                });
                
                // Set initial selected state
                const defaultCommTypeOption = commTypeFilterDropdown.querySelector('[data-value="all-communications"]');
                if (defaultCommTypeOption) {
                    defaultCommTypeOption.classList.add('selected');
                }
            }
            
            // Source filter dropdown functionality
            if (sourceFilterBtn && sourceFilterDropdown) {
                sourceFilterBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    sourceFilterDropdown.classList.toggle('active');
                });

                // Handle filter option clicks
                const sourceOptions = sourceFilterDropdown.querySelectorAll('.activity-filter-option');
                sourceOptions.forEach(option => {
                    option.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const value = this.getAttribute('data-value');
                        const text = this.querySelector('span').textContent;
                        
                        // Remove selected class from all options
                        sourceOptions.forEach(opt => opt.classList.remove('selected'));
                        
                        // Add selected class to clicked option
                        this.classList.add('selected');
                        
                        // Update button text
                        sourceFilterBtn.querySelector('.filter-current-text').textContent = text;
                        
                        // Close dropdown
                        sourceFilterDropdown.classList.remove('active');
                        
                        // Re-apply current activity filter with new source selection
                        const currentActivityFilter = document.querySelector('#activity-filter-dropdown .activity-filter-option.selected');
                        const currentFilter = currentActivityFilter ? currentActivityFilter.getAttribute('data-value') : 'all';
                        filterActivities(currentFilter);
                    });
                });
                
                // Set initial selected state
                const defaultSourceOption = sourceFilterDropdown.querySelector('[data-value="all-sources"]');
                if (defaultSourceOption) {
                    defaultSourceOption.classList.add('selected');
                }
            }
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (activityFilterBtn && activityFilterDropdown && 
                    !activityFilterBtn.contains(e.target) && !activityFilterDropdown.contains(e.target)) {
                    activityFilterDropdown.classList.remove('active');
                }
                
                if (commTypeFilterBtn && commTypeFilterDropdown && 
                    !commTypeFilterBtn.contains(e.target) && !commTypeFilterDropdown.contains(e.target)) {
                    commTypeFilterDropdown.classList.remove('active');
                }
                
                if (sourceFilterBtn && sourceFilterDropdown && 
                    !sourceFilterBtn.contains(e.target) && !sourceFilterDropdown.contains(e.target)) {
                    sourceFilterDropdown.classList.remove('active');
                }
            });

            // Resident kebab menu functionality
            const residentKebabBtn = document.getElementById('resident-header-kebab-btn');
            const residentKebabDropdown = document.getElementById('resident-header-kebab-dropdown');
            
            if (residentKebabBtn && residentKebabDropdown) {
                residentKebabBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    residentKebabDropdown.classList.toggle('active');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!residentKebabBtn.contains(e.target) && !residentKebabDropdown.contains(e.target)) {
                        residentKebabDropdown.classList.remove('active');
                    }
                });
                
                // Close dropdown when scrolling to prevent positioning issues
                function closeResidentDropdown() {
                    residentKebabDropdown.classList.remove('active');
                }
                
                document.addEventListener('scroll', closeResidentDropdown, { passive: true });
                window.addEventListener('scroll', closeResidentDropdown, { passive: true });
                document.querySelectorAll('.pageslide, .main-content, .content-grid').forEach(container => {
                    container.addEventListener('scroll', closeResidentDropdown, { passive: true });
                });
                window.addEventListener('resize', closeResidentDropdown);

                // Handle kebab menu options
                const residentKebabOptions = document.querySelectorAll('.resident-kebab-option');
                residentKebabOptions.forEach(option => {
                    option.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const action = this.getAttribute('data-action');
                        const actionText = this.querySelector('span').textContent;
                        
                        residentKebabDropdown.classList.remove('active');
                        
                        switch(action) {
                            case 'renew-lease':
                                alert('Renew Lease for Kamala Hakuna:\n\n• New lease terms\n• Rental rate adjustment\n• Lease duration\n• Start date\n• Additional clauses');
                                break;
                            case 'receive':
                                alert('Receive Payment for Kamala Hakuna:\n\n• Payment Amount\n• Payment Method (Cash, Check, Card, ACH)\n• Payment Date\n• Reference Number\n• Notes');
                                break;
                            case 'add-charge':
                                alert('Add Charge for Kamala Hakuna:\n\n• Charge Type\n• Amount\n• Description\n• Due Date\n• Recurring Options');
                                break;
                            case 'add-lease-charge':
                                alert('Add Lease Charge for Kamala Hakuna:\n\n• Lease Charge Type\n• Amount\n• Effective Date\n• Lease Terms\n• Approval Required');
                                break;
                            case 'transfer-unit':
                                alert('Transfer Unit for Kamala Hakuna:\n\n• Select New Unit\n• Transfer Date\n• Reason for Transfer\n• Update Lease Terms\n• Notify Resident');
                                break;
                            case 'reverse-move-in':
                                alert('Reverse Move In for Kamala Hakuna:\n\n• Cancel move-in process\n• Restore previous status\n• Adjust charges\n• Update lease status\n• Generate documentation');
                                break;
                            case 'assign-unit':
                                alert('Assign Unit for Kamala Hakuna:\n\n• Select available unit\n• Set move-in date\n• Configure lease terms\n• Assign keys\n• Send welcome package');
                                break;
                            case 'apply-deposit':
                                alert('Apply Deposit for Kamala Hakuna:\n\n• Select deposit type\n• Apply to charges\n• Remaining balance\n• Transaction notes\n• Receipt generation');
                                break;
                            case 'adjust-lease-end':
                                alert('Adjust Lease End for Kamala Hakuna:\n\n• New end date\n• Reason for change\n• Prorated adjustments\n• Notice requirements\n• Documentation');
                                break;
                            case 'evict':
                                alert('Eviction Process for Kamala Hakuna:\n\n• Legal notice generation\n• Court filing options\n• Timeline tracking\n• Documentation requirements\n• Communication log');
                                break;
                            case 'month-to-month':
                                alert('Convert to Month-to-Month for Kamala Hakuna:\n\n• Update lease terms\n• New rental rate\n• Notice period settings\n• Automatic renewal options\n• Documentation updates');
                                break;
                            case 'notice':
                                alert('Send Notice to Kamala Hakuna:\n\n• Notice type selection\n• Custom message\n• Delivery method\n• Legal compliance\n• Tracking and follow-up');
                                break;
                            case 'promote-roommate':
                                alert('Promote Roommate for Kamala Hakuna:\n\n• Select roommate\n• Transfer lease responsibility\n• Update lease agreement\n• Credit check requirements\n• Legal documentation');
                                break;
                            default:
                                alert(`${actionText} selected`);
                        }
                    });
                });
            }

            // Suggested actions functionality
            const actionSuggestions = document.querySelectorAll('.action-suggestion');
            actionSuggestions.forEach(btn => {
                btn.addEventListener('click', function() {
                    const actionText = this.querySelector('span').textContent;
                    
                    if (this.classList.contains('reminder')) {
                        alert('Send Payment Reminder:\n\n• Email reminder about overdue balance\n• Include payment options\n• Set follow-up date\n• Log communication');
                    } else if (this.classList.contains('call')) {
                        alert('Call Resident:\n\n• Phone: (555) 123-4567\n• Discuss overdue payment\n• Offer payment plan options\n• Log call notes');
                    } else if (this.classList.contains('payment-plan')) {
                        alert('Create Payment Plan:\n\n• Set monthly installments\n• Choose payment dates\n• Define terms and conditions\n• Send agreement for signature');
                    } else if (this.classList.contains('schedule')) {
                        alert('Schedule Renewal Meeting:\n\n• Available dates and times\n• Meeting location options\n• Lease renewal terms to discuss\n• Send calendar invite');
                    } else if (this.classList.contains('renew')) {
                        alert('Renew Lease:\n\n• Generate renewal agreement\n• Update lease terms\n• Set new rental amount\n• Schedule signing appointment');
                    }
                });
            });

            // Clone icon functionality for customer information
            const cloneIcon = document.querySelector('.fa-clone');
            if (cloneIcon) {
                cloneIcon.addEventListener('click', function(e) {
                    e.preventDefault();
                    alert('Customer Profile:\n\n• Customer found across multiple properties\n• View unified customer journey\n• Access all property interactions\n• Cross-property payment history');
                });
            }

            // Section edit button functionality
            const sectionEditBtn = document.querySelector('.section-edit-btn');
            if (sectionEditBtn) {
                sectionEditBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    openPageslide('contact-edit-overlay');
                });
            }

            // Customer ID link functionality
            const customerIdLink = document.querySelector('.customer-id-link');
            if (customerIdLink) {
                customerIdLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    alert('View Customer Record:\n\n• Complete customer history\n• All property interactions\n• Application timeline\n• Cross-property payments\n• Communication log\n• Document repository');
                });
            }

            // Prospect ID link functionality
            const prospectIdElements = document.querySelectorAll('.info-value.link');
            prospectIdElements.forEach(element => {
                if (element.textContent.includes('p0012456')) {
                    element.addEventListener('click', function(e) {
                        e.preventDefault();
                        alert('View Prospect Record:\n\n• Original application details\n• Prospect journey at this property\n• Application timeline\n• Communication history\n• Lead source information');
                    });
                }
            });

            // Add links functionality for Roommates, Vehicles, and Pets
            const residentAddLinks = document.querySelectorAll('.add-link');
            residentAddLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const parentRow = this.closest('.info-row');
                    const label = parentRow.querySelector('.info-label').textContent;
                    
                    if (label.includes('Roommates')) {
                        alert('Add Roommate:\n\n• Add roommate information\n• Set roommate details\n• Update lease agreement\n• Configure access permissions');
                    } else if (label.includes('Vehicles')) {
                        alert('Add Vehicle:\n\n• Enter license plate number\n• Select state registration\n• Add vehicle make and model\n• Enter vehicle year\n• Specify vehicle color');
                    } else if (label.includes('Pets')) {
                        alert('Add Pet:\n\n• Pet type and breed\n• Pet registration\n• Vaccination records\n• Pet deposit/fees');
                    }
                });
            });

            // Roommate link functionality
            const roommateLink = document.querySelector('.roommate-link');
            if (roommateLink) {
                roommateLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    openPageslide('roommate-details-overlay');
                });
            }

            // Journey action buttons
            const journeyActionBtns = document.querySelectorAll('.journey-action-btn');
            journeyActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const action = this.querySelector('span').textContent;
                    alert(`${action} would open here`);
                });
            });

            // Stat card interactions
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach(card => {
                card.addEventListener('click', function(e) {
                    const pageslideId = this.getAttribute('data-pageslide');
                    const label = this.querySelector('.stat-label').textContent;
                    const value = this.querySelector('.stat-value').textContent;
                    
                    if (pageslideId) {
                        // Open pageslide for monthly charges
                        openPageslide(pageslideId + '-overlay');
                    } else {
                        // Show alert for other stat cards that don't have pageslides
                    }
                });
            });

            // Customer journey button
            const customerJourneyBtn = document.querySelector('.customer-journey-btn');
            if (customerJourneyBtn) {
                customerJourneyBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    openPageslide('customer-journey-overlay');
                });
            }

            // Close pageslide when clicking overlay or close button
            const pageslideOverlays = document.querySelectorAll('.pageslide-overlay');
            pageslideOverlays.forEach(overlay => {
                overlay.addEventListener('click', function(e) {
                    if (e.target === overlay) {
                        closePageslide(overlay.id);
                    }
                });

                const closeBtn = overlay.querySelector('.pageslide-close');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function() {
                        closePageslide(overlay.id);
                    });
                }
            });

            // Pageslide action buttons
            const chargesActionBtns = document.querySelectorAll('.charges-action-btn');
            chargesActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const actionText = this.querySelector('span').textContent;
                    
                    if (actionText.includes('Add Lease Charge')) {
                        alert('Add Lease Charge form would open:\n\n• Charge Type (Rent, Fee, etc.)\n• Amount\n• Effective Date\n• Description\n• Recurring Options');
                    } else if (actionText.includes('Export Details')) {
                        alert('Export options would open:\n\n• PDF Report\n• CSV Export\n• Excel Spreadsheet\n• Email Report');
                    }
                });
            });

            // Balance action buttons
            const balanceActionBtns = document.querySelectorAll('.balance-action-btn');
            balanceActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const actionText = this.querySelector('span').textContent;
                    
                    if (actionText.includes('Receive Payment')) {
                        alert('Payment Recording form would open:\n\n• Payment Amount: $2,100.00\n• Payment Method (Cash, Check, Card, ACH)\n• Payment Date\n• Reference Number\n• Notes');
                    } else if (actionText.includes('Add Charge')) {
                        alert('Add Charge interface would open:\n\n• Charge Type (Rent, Fee, etc.)\n• Amount\n• Due Date\n• Description\n• Billing Category');
                    } else if (actionText.includes('Send Reminder')) {
                        alert('Notice Options would open:\n\n• Email overdue notice\n• Generate printed letter\n• Schedule follow-up call\n• Set payment reminder\n• Escalate to collections');
                    } else if (actionText.includes('Export Statement')) {
                        alert('Statement Export options:\n\n• PDF Account Statement\n• Detailed Transaction Report\n• Payment History CSV\n• Email to Resident\n• Print for Files');
                    }
                });
            });

            // Timeline action buttons
            const timelineActionBtns = document.querySelectorAll('.timeline-action-btn');
            timelineActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const actionText = this.querySelector('span').textContent;
                    
                    if (actionText.includes('Add Timeline Event')) {
                        alert('Add Timeline Event form would open:\n\n• Event Type (Move In, Lease Renewal, etc.)\n• Date\n• Description\n• Notes\n• Attachments');
                    } else if (actionText.includes('Edit Timeline')) {
                        alert('Timeline Management interface would open:\n\n• Modify existing events\n• Update dates and descriptions\n• Add additional notes\n• Manage event visibility');
                    } else if (actionText.includes('Export Timeline')) {
                        alert('Timeline Export options:\n\n• PDF Timeline Report\n• Detailed Event History\n• CSV Export\n• Email to Resident\n• Print for Files');
                    }
                });
            });

            // Payment action buttons
            const paymentActionBtns = document.querySelectorAll('.payment-action-btn');
            paymentActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const actionText = this.querySelector('span').textContent;
                    
                    if (actionText.includes('Receive Payment')) {
                        alert('Receive Payment form would open:\n\n• Payment Amount\n• Payment Method (Cash, Check, Card, ACH)\n• Payment Date\n• Reference Number\n• Notes');
                    } else if (actionText.includes('Export Payment History')) {
                        alert('Export Payment History options:\n\n• PDF Payment Report\n• CSV Transaction Export\n• Excel Payment History\n• Email Payment Summary');
                    }
                });
            });

            // Payment quick action buttons
            const paymentQuickBtns = document.querySelectorAll('.payment-quick-btn');
            paymentQuickBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const actionText = this.querySelector('span').textContent;
                    
                    if (actionText.includes('Print')) {
                        alert('Print Payment History:\n\n• Print payment summary\n• Print detailed payment list\n• Print payment receipt\n• Print for files');
                    } else if (actionText.includes('Email')) {
                        alert('Email Payment History:\n\n• Send payment summary to resident\n• Email payment receipt\n• Send to management team\n• Custom email recipient');
                    }
                });
            });

            // Close pageslide with ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    pageslideOverlays.forEach(overlay => {
                        if (overlay.classList.contains('active')) {
                            closePageslide(overlay.id);
                        }
                    });
                }
            });

            // Roommate edit button functionality
            const roommateEditBtn = document.querySelector('.roommate-edit-btn');
            if (roommateEditBtn) {
                roommateEditBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    alert('Edit Roommate form would open:\n\n• Update contact information\n• Modify residency dates\n• Edit personal details\n• Update emergency contacts');
                });
            }

            // Roommate kebab menu option handlers
            const roommateKebabOptions = document.querySelectorAll('#kebab-dropdown-roommate-angela .kebab-option, #kebab-dropdown-roommate-john .kebab-option, #kebab-dropdown-roommate-angela-pageslide .kebab-option, #kebab-dropdown-roommate-john-pageslide .kebab-option');
            roommateKebabOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const action = this.textContent.trim();
                    const parentDropdown = this.closest('[id*="kebab-dropdown-roommate"]');
                    const isAngela = parentDropdown && parentDropdown.id.includes('angela');
                    const roommateType = isAngela ? 'Angela Johnson (Pending Application)' : 'John Smith (Current Resident)';
                    
                    // Close the dropdown
                    parentDropdown.classList.add('hidden');
                    
                    if (action.includes('Edit details')) {
                        alert(`Edit ${roommateType}:\n\n• Update contact information\n• Modify residency dates\n• Edit personal details\n• Update emergency contacts`);
                    } else if (action.includes('Send invitation')) {
                        alert(`Send Invitation to ${roommateType}:\n\n• Generate invitation link\n• Send via email or SMS\n• Set reminder for follow-up\n• Track invitation status`);
                    } else if (action.includes('Approve application')) {
                        alert(`Approve Application for ${roommateType}:\n\n• Final review of application\n• Process background check results\n• Generate lease addendum\n• Notify all parties of approval`);
                    } else if (action.includes('View customer record')) {
                        alert(`View Customer Record for ${roommateType}:\n\n• Complete customer history\n• All property interactions\n• Application timeline\n• Cross-property payments\n• Communication log`);
                    } else if (action.includes('Remove roommate')) {
                        if (confirm(`Are you sure you want to remove ${roommateType} from this lease?`)) {
                            alert(`${roommateType} would be removed from the lease.`);
                        }
                    }
                });
            });

            // View Customer Record button functionality
            const viewRecordBtn = document.querySelector('.view-record-btn');
            if (viewRecordBtn) {
                viewRecordBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    alert('Navigate to Customer Record:\n\n• Full customer profile\n• Account history\n• Payment records\n• Communication log');
                });
            }

            // Contact action buttons
            const contactActionBtns = document.querySelectorAll('.contact-action-btn');
            contactActionBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const icon = this.querySelector('i');
                    const contactItem = this.closest('.contact-item');
                    const contactValue = contactItem.querySelector('.contact-value').textContent;
                    
                    if (icon.classList.contains('fa-envelope')) {
                        alert(`Send Email to ${contactValue}:\n\n• Compose email message\n• Select email template\n• Add attachments\n• Schedule send time`);
                    } else if (icon.classList.contains('fa-phone')) {
                        alert(`Call ${contactValue}:\n\n• Initiate phone call\n• Add call to calendar\n• Log call details\n• Set follow-up reminder`);
                    } else if (icon.classList.contains('fa-mobile-alt')) {
                        alert(`Send Text to ${contactValue}:\n\n• Compose SMS message\n• Send instant message\n• Schedule text message\n• Add to message thread`);
                    }
                });
            });

            // Roommate counter functionality
            const roommateCounter = document.querySelector('.roommate-counter');
            if (roommateCounter) {
                roommateCounter.addEventListener('click', function() {
                    openPageslide('roommate-details-overlay');
                });
            }

            // Kebab menu functionality
            const kebabBtns = document.querySelectorAll('.charge-kebab-menu .kebab-btn');
            kebabBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const menu = this.parentElement;
                    
                    // Close all other kebab menus
                    document.querySelectorAll('.charge-kebab-menu').forEach(otherMenu => {
                        if (otherMenu !== menu) {
                            otherMenu.classList.remove('active');
                        }
                    });
                    
                    // Toggle current menu
                    menu.classList.toggle('active');
                });
            });

            // Close kebab menus when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.charge-kebab-menu')) {
                    document.querySelectorAll('.charge-kebab-menu').forEach(menu => {
                        menu.classList.remove('active');
                    });
                }
                

            });

            // Kebab menu option handlers
            const kebabOptions = document.querySelectorAll('.kebab-option');
            kebabOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const action = this.classList.contains('edit-charge') ? 'edit' : 'delete';
                    const chargeItem = this.closest('.charge-item');
                    const chargeName = chargeItem.querySelector('.balance-description').textContent;
                    const chargeAmount = chargeItem.querySelector('.charge-amount').textContent;
                    
                    if (action === 'edit') {
                        alert(`Edit Charge: ${chargeName}\n\nCurrent Amount: ${chargeAmount}\n\n• Modify amount\n• Update description\n• Change effective date\n• Adjust recurring settings`);
                    } else if (action === 'delete') {
                        if (confirm(`Are you sure you want to delete "${chargeName}" (${chargeAmount})?`)) {
                            alert(`Charge "${chargeName}" would be deleted from the lease.`);
                        }
                    }
                    
                    // Close menu after action
                    this.closest('.charge-kebab-menu').classList.remove('active');
                });
            });

            // Health score tooltip positioning
            const healthTooltip = document.querySelector('.health-score-tooltip');
            const tooltipContent = document.querySelector('.tooltip-content');
            
            if (healthTooltip && tooltipContent) {
                healthTooltip.addEventListener('mouseenter', function() {
                    const rect = this.getBoundingClientRect();
                    
                    // Position tooltip below the health score indicator
                    const left = rect.left + (rect.width / 2) - (280 / 2); // Center horizontally, 280 is tooltip width
                    const top = rect.bottom + 10; // Position below with 10px gap
                    
                    tooltipContent.style.left = `${Math.max(10, left)}px`; // Ensure it doesn't go off screen
                    tooltipContent.style.top = `${top}px`;
                });
            }

            // Contact edit form handling
            const contactEditForm = document.querySelector('.contact-edit-form');
            if (contactEditForm) {
                contactEditForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get form data
                    const formData = new FormData(this);
                    const firstName = document.querySelector('input[placeholder="Enter name"]').value;
                    const lastName = document.querySelector('input[value="Hakuna"]').value;
                    const email = document.querySelector('input[type="email"]').value;
                    const phone = document.querySelector('input[value="(555) 123-4567"]').value;
                    const preferredContact = document.querySelector('input[name="preferred-contact"]:checked')?.value;
                    
                    // Show success message
                    alert(`Contact Information Updated Successfully!\n\n` +
                          `Name: ${firstName} ${lastName}\n` +
                          `Email: ${email}\n` +
                          `Phone: ${phone}\n` +
                          `Preferred Contact: ${preferredContact || 'None'}\n\n` +
                          `Changes have been saved to the customer profile.`);
                    
                    // Close the pageslide
                    closePageslide('contact-edit-overlay');
                });
            }

            // Dynamic height matching for columns (activity timeline has fixed height)
            function matchColumnHeights() {
                const column1 = document.getElementById('column-1-resident-notes');
                const column2 = document.getElementById('column-2-lease-info');
                const activityCard = document.getElementById('activity-timeline-card');
                // Activity card height is fixed, no need to include in matching
                
                if (column1 && column2) {
                    // Reset heights to auto to get natural heights
                    column1.style.minHeight = 'auto';
                    column2.style.minHeight = 'auto';
                    column1.style.height = 'auto';
                    column2.style.height = 'auto';
                    
                    // Activity card maintains fixed height - no adjustments needed
                    
                    // Force a reflow to get accurate measurements
                    column1.offsetHeight;
                    column2.offsetHeight;
                    
                    // Get the natural heights after small delay
                    setTimeout(() => {
                        const height1 = column1.offsetHeight;
                        const height2 = column2.offsetHeight;
                        
                        // Calculate the maximum height of the left columns
                        const maxHeight = Math.max(height1, height2);
                        column1.style.minHeight = maxHeight + 'px';
                        column2.style.minHeight = maxHeight + 'px';
                        
                        // Activity card maintains fixed height - no matching needed
                        
                        // Debug log (remove in production)
                        console.log('Height matching applied:', {
                            column1Height: height1,
                            column2Height: height2,
                            maxHeight: maxHeight,
                            activityCardMatched: !!activityCard && !timelineExpanded,
                            timelineExpanded: timelineExpanded
                        });
                    }, 10);
                } else {
                    console.log('Column elements not found:', {
                        column1: !!column1,
                        column2: !!column2,
                        activityCard: !!activityCard
                    });
                }
            }

            // Call height matching on page load (with small delay to ensure content is loaded)
            // setTimeout(matchColumnHeights, 100); // Temporarily disabled

            // Re-match heights when window is resized
            // window.addEventListener('resize', function() {
            //     // Debounce the resize event
            //     clearTimeout(window.resizeTimeout);
            //     window.resizeTimeout = setTimeout(matchColumnHeights, 250);
            // }); // Temporarily disabled

            // Re-match heights when content changes (e.g., pageslide opens/closes)
            const observeContentChanges = function() {
                const observer = new MutationObserver(function(mutations) {
                    let shouldUpdate = false;
                    mutations.forEach(function(mutation) {
                        // Check if any changes affect the two-column layout
                        if (mutation.target.closest('#two-column-layout') || 
                            mutation.target.id === 'column-1-resident-notes' ||
                            mutation.target.id === 'column-2-lease-info') {
                            shouldUpdate = true;
                        }
                    });
                    
                    if (shouldUpdate) {
                        // Debounce the height matching
                        clearTimeout(window.heightMatchTimeout);
                        window.heightMatchTimeout = setTimeout(matchColumnHeights, 100);
                    }
                });

                // Observe changes in the two-column layout
                const twoColumnLayout = document.getElementById('two-column-layout');
                if (twoColumnLayout) {
                    observer.observe(twoColumnLayout, {
                        childList: true,
                        subtree: true,
                        attributes: true,
                        attributeFilter: ['style', 'class']
                    });
                }
            };

            // Start observing content changes
            // observeContentChanges(); // Temporarily disabled

        });


    </script>
</body>
</html>

